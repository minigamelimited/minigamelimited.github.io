window.__require=function t(e,o,i){function n(a,s){if(!o[a]){if(!e[a]){var c=a.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+a+"'")}a=c}var u=o[a]={exports:{}};e[a][0].call(u.exports,function(t){return n(e[a][1][t]||t)},u,u.exports,t,e,o,i)}return o[a].exports}for(var r="function"==typeof __require&&__require,a=0;a<i.length;a++)n(i[a]);return n}({ActionEx:[function(t,e,o){"use strict";cc._RF.push(e,"7cd16kOurFLn4nnjX2yGw51","ActionEx");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0}),o.JXActionMgr=o.Shake=o.JXFollow=o.JXMoveTo=o.JXMoveBy=o.JXBezierTo=o.JXBezierBy=o.JXSpriteFrameAciton=o.JXActionMsg=o.QUEUE_ACTION_TAG=void 0;var a=t("../Math/MathEx"),s=cc.Vec2.ZERO;function c(t,e,o){for(var i,n=[],a=3;a<arguments.length;a++)n[a-3]=arguments[a];return(i=t.prototype[e]).call.apply(i,r([o],n))}cc.Vec2.ZERO,o.QUEUE_ACTION_TAG=1001,o.JXActionMsg={action:{end:"JXActionMsg.action,end"}};var l=function(t){function e(e,o,i){void 0===i&&(i=!0);var n=t.call(this)||this;n.playOnce=!1,n.sprites=o,n.lenth=n.sprites.length,n.fps=e;var r=1/e*n.lenth;return c(cc.ActionInterval,"initWithDuration",n,r),n.setOnce(!i),n}return n(e,t),e.prototype.setOnce=function(t){return this.playOnce=t,t?(this._repeatForever=!1,this._repeatMethod=!1,this._timesForRepeat=1):this.repeatForever(),this},e.prototype.startWithTarget=function(t){c(cc.ActionInterval,"startWithTarget",this,t);var e=t.getComponent(cc.Sprite);e&&(this._sprite=e,this.curIndex=0,this.curTime=0)},e.prototype.update=function(t){this.curIndex<this.lenth&&(this._sprite.spriteFrame!=this.sprites[this.curIndex]&&(this._sprite.spriteFrame=this.sprites[this.curIndex]),this.curTime+=t,this._elapsed=1/this.fps*this.curIndex,this.curTime>=1/this.fps&&(this.curIndex++,this.curTime=0))},e}(cc.ActionInterval);function u(t,e,o,i,n){return Math.pow(1-n,3)*t+3*n*Math.pow(1-n,2)*e+3*Math.pow(n,2)*(1-n)*o+Math.pow(n,3)*i}o.JXSpriteFrameAciton=l;var h=function(t){function e(e,o){return t.call(this,e,o)||this}return n(e,t),e.prototype.initWithDuration=function(t,e){return!!c(cc.ActionInterval,"initWithDuration",this,t)&&(this._config=e,!0)},e.prototype.update=function(t){t=c(cc.BezierBy,"_computeEaseTime",this,t);var e=this.target;if(e){var o=this._config,i=o[0].x,n=o[1].x,r=o[2].x,l=o[0].y,h=o[1].y,p=o[2].y,d=u(0,i,n,r,t),f=u(0,l,h,p,t),g=this._startPosition;if(s.x=e.x,s.y=e.y,cc.macro.ENABLE_STACKABLE_ACTIONS){var _=this._previousPosition;if(g.x=g.x+s.x-_.x,g.y=g.y+s.y-_.y,d+=g.x,f+=g.y,_.x=d,_.y=f,e.setPosition(d,f),s.equals(_))return;var m=a.default.getAngleX(s,_);e.angle=m}else{if(e.setPosition(g.x+d,g.y+f),s.equals(_))return;m=a.default.getAngleX(s,e.position),e.angle=m}}},e}(cc.BezierBy);o.JXBezierBy=h;var p=function(t){function e(e,o){var i=t.call(this,e,o)||this;return i._toConfig=[],i._toConfig=o,i}return n(e,t),e.prototype.initWithDuration=function(t,e){return!!c(cc.ActionInterval,"initWithDuration",this,t)&&(this._config=e,!0)},e.prototype.startWithTarget=function(t){c(cc.BezierBy,"startWithTarget",this,t);var e=this._startPosition,o=this._toConfig,i=this._config;i[0]=o[0].sub(e),i[1]=o[1].sub(e),i[2]=o[2].sub(e)},e}(h);o.JXBezierTo=p;var d=function(t){function e(e,o){return t.call(this,e,o)||this}return n(e,t),e.prototype.update=function(t){t=c(cc.BezierBy,"_computeEaseTime",this,t);var e=this.target;if(e){var o=this._positionDelta.x*t,i=this._positionDelta.y*t,n=this._startPosition;if(s.x=e.x,s.y=e.y,cc.macro.ENABLE_STACKABLE_ACTIONS){var r=this._previousPosition;if(n.x=n.x+s.x-r.x,n.y=n.y+s.y-r.y,o+=n.x,i+=n.y,r.x=o,r.y=i,e.setPosition(o,i),s.equals(r))return;var l=a.default.getAngleX(s,r);e.angle=l}else{if(e.setPosition(n.x+o,n.y+i),s.equals(r))return;l=a.default.getAngleX(s,r),e.angle=l}}},e}(cc.MoveBy);o.JXMoveBy=d;var f=function(t){function e(e,o){var i=t.call(this,e,o)||this;return i._endPosition=null,i._endPosition=o,i}return n(e,t),e.prototype.startWithTarget=function(t){c(cc.MoveBy,"startWithTarget",this,t),this._positionDelta.x=this._endPosition.x-t.x,this._positionDelta.y=this._endPosition.y-t.y;var e=a.default.getAngleX(t.position,this._endPosition);t.angle=e},e}(d);o.JXMoveTo=f;var g=function(t){function e(e,o,i){var n=t.call(this)||this;return n._followNode=null,n._followSpeed=null,n._offset=null,n._followNode=e,n._followSpeed=o,n._offset=i,n}return n(e,t),e.prototype.step=function(t){var e=this.target,o=e.convertToWorldSpaceAR(cc.Vec2.ZERO),i=this._followNode.convertToWorldSpaceAR(cc.Vec2.ZERO).add(this._offset?this._offset:cc.Vec2.ZERO),n=a.default.getAngleX(o,i);e.angle=n+90;var r=this._followSpeed*t,s=o.sub(i).mag();r>s&&(r=s);var c=a.default.getAnglePos(n,r);e.position=e.position.add(c)},e.prototype.isDone=function(){var t=this.target.convertToWorldSpaceAR(cc.Vec2.ZERO),e=this._followNode.convertToWorldSpaceAR(cc.Vec2.ZERO).add(this._offset?this._offset:cc.Vec2.ZERO);return t.sub(e).mag()<5},e}(cc.Action);o.JXFollow=g;var _=function(t){function e(e,o,i){var n=t.call(this)||this;return n._nodeInitialPos=null,n._shakeParams=[],n._dir=1,n.initWithDuration(e,o,i),n}return n(e,t),e.prototype.initShakeParams=function(t,e){this._shakeParams[0]=t,this._shakeParams[1]=e},e.prototype.getRandomStrength=function(t,e){return Math.random()*(e-t+1)+t},e.prototype.update=function(){var t=this._shakeParams[0]*(1-this._elapsed/this.getDuration())*this._dir,e=this._shakeParams[1]*(1-this._elapsed/this.getDuration())*this._dir;this._dir*=-1,this.target.position=this._nodeInitialPos.add(cc.v2(t,e))},e.prototype.initWithDuration=function(t,e,o){return!!c(cc.ActionInterval,"initWithDuration",this,t)&&(this.initShakeParams(e,o),!0)},e.prototype.startWithTarget=function(t){c(cc.ActionInterval,"startWithTarget",this,t),this._nodeInitialPos=t.position},e.prototype.stop=function(){this.target.position=this._nodeInitialPos},e}(cc.ActionInterval);o.Shake=_;var m=function(t){function e(){var e=t.call(this)||this;return e._evt=null,e}return n(e,t),e.prototype.bindEvtMgr=function(t){this._evt=t},e.prototype.addTweenAction=function(t){if(!t._target)return cc.warn("Please set target to tween first"),this;t._finalAction&&cc.director.getActionManager().removeAction(t._finalAction),t._finalAction=t._union(),this.addAction(t._finalAction,t._target,!1)},e.prototype.addAction=function(e,i,n){void 0===n&&(n=!1),i._id||(i._id=i.wrapId),i._id?(e.getTag()==o.QUEUE_ACTION_TAG&&(i._hasQueueAction=!0),t.prototype.addAction.call(this,e,i,n)):cc.error("can not find target property: _id!")},e.prototype.removeAction=function(e,i){void 0===i&&(i=!1),e&&this._evt&&this._evt.post(o.JXActionMsg.action.end,e),!i&&e.__endCallBack&&(e.__endCallBack(),e.__endCallBack=null),e.getTag()==o.QUEUE_ACTION_TAG&&(e.getOriginalTarget()._hasQueueAction=!1),t.prototype.removeAction.call(this,e)},e.prototype.getTargetAction=function(t,e){if(t!==cc.Action.TAG_INVALID){var o=this._hashTargets[e._id];if(o&&null!=o.actions)for(var i=0;i<o.actions.length;++i){var n=o.actions[i];if(n&&n.getTag()===t)return n}return null}},e.prototype.hasQueueAction=function(t){return t._hasQueueAction},e.prototype.hasAction=function(){var t=this._arrayTargets;if(0==t.length)return!1;for(var e=0;e<t.length;e++){var o=t[e].actions;if(o&&o.length>0)return!1}return!0},e}(cc.ActionManager);o.JXActionMgr=m,cc._RF.pop()},{"../Math/MathEx":"MathEx"}],AnimationEvent:[function(t,e,o){"use strict";cc._RF.push(e,"7debaLy6r9LiapHZFVpIic+","AnimationEvent");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.menu,l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.frameEvent=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.frameCallBack&&this.frameCallBack.apply(this,t)},r([s,c("FrameEx/AnimationEvent")],e)}(cc.Component);o.default=l,cc._RF.pop()},{}],AppCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"90bd9SsAgVEJryZyMputKgb","AppCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/FrameEx/GComponent"),s=cc._decorator,c=s.ccclass,l=s.property,u=s.menu,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.guideEditor=!1,e}return n(e,t),e.prototype.initEvent=function(){},e.prototype.__onLoad=function(){},r([l()],e.prototype,"guideEditor",void 0),r([c,u("AppCtrl")],e)}(a.default);o.default=h,cc._RF.pop()},{"../../../Core/FrameEx/GComponent":"GComponent"}],AppStart:[function(t,e,o){"use strict";cc._RF.push(e,"1ec996CbopHOK1RY+rXa8ix","AppStart");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/FrameEx/GComponent"),s=t("../../Common/UI"),c=t("../../Common/UIResources"),l=t("../../Logic/GameMgr"),u=t("./../../Common/Define"),h=t("./../../Common/UI"),p=t("./../../Logic/ToastMgr"),d=t("./AppCtrl"),f=cc._decorator,g=f.ccclass,_=(f.property,f.menu),m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.__onLoad=function(){var t=this;i18n.init("zh_CN",function(){cc.Button.comAudio=c.Res.audio.btnClick,l.default.uiMgr.initWinInfos(s.JXWinInfo,s.JXViewPreLoad,function(t){return new p.Toast(t)}),t.onGameStart()})},e.prototype.start=function(){},e.prototype.onGameStart=function(){var t=cc.director.getScene().getChildByName("AppCtrl");t||(t=new cc.Node)&&(t.name="AppCtrl",t.addComponent(d.default).initEvent(),cc.game.addPersistRootNode(t)),l.default.uiMgr.showWin(h.VIEW_ID.load,u.LoadingType.AppStart)},r([g,_("AppStart")],e)}(a.default);o.default=m,cc._RF.pop()},{"../../../Core/FrameEx/GComponent":"GComponent","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr","./../../Common/Define":"Define","./../../Common/UI":"UI","./../../Logic/ToastMgr":"ToastMgr","./AppCtrl":"AppCtrl"}],ArmRoleScript:[function(t,e,o){"use strict";cc._RF.push(e,"c4855KKjX5Km6gl3lnKQTtr","ArmRoleScript");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../Core/GCtrl"),s=t("../../Core/GView/GChild"),c=t("../../Core/Manager/AudioMgr"),l=t("../Common/BtnCDTime"),u=t("../Common/Define"),h=t("../Common/UIResources"),p=t("../Logic/GameMgr"),d=t("../Logic/UserMgr"),f=t("../Views/Common/TopUiItem"),g=cc._decorator,_=g.ccclass,m=g.property,y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.heroNode=null,e.skeleton=null,e.bloodBar=null,e.hitNode=null,e.toastNode=null,e.type=0,e._roleName="",e._roleId=0,e._roledata=null,e._lifetime=600,e._isLife=!0,e._icon="",e._propType=1,e}var o;return n(e,t),o=e,e.prototype.start=function(){1==this.type?(this._propType=u.CURRENCY.GOLD,this._icon="coinBg"):2==this.type?(this._propType=u.CURRENCY.YUSHI,this._icon="gemBg"):(this._propType=u.CURRENCY.WHEAT,this._icon="armyBg"),1!=this.type&&2!=this.type?(this.node.scaleX=this.node.scaleY=.3,this.bloodBar.progress=0):this._lifetime=0},e.prototype.initSkel=function(){if(!this.skeleton){var t=this.heroNode.getComponent(sp.Skeleton);t||(t=this.addComponent(sp.Skeleton)),this.skeleton=t}},e.prototype.setRoleData=function(t){var e=this,o=p.default.heroData.getRaw(t);this._roledata=o,this._roleId=o.id,this._roleName=o.name,this.bloodBar.progress=1,this.heroNode.opacity=255,this.assetImpl.spriteFrame(this.bloodBar.node.getChildByName("bar").getComponent(cc.Sprite),"battleView/bar3");var i=h.Res.model+o.animation+"/"+o.animation;this.assetImpl.spine(i,function(t){setTimeout(function(){e.skeleton&&(e.skeleton.skeletonData=t,e.skeleton.setSkin(o.aniSkin),e.skeleton.setAnimation(0,o.ani[1],!0))},50)})},e.prototype.changeAnimation=function(t,e,o,i){if(void 0===e&&(e=!1),void 0===i&&(i=!0),this.skeleton){var n=t,r=this.skeleton.setAnimation(0,n,e);if(o?this.skeleton.setCompleteListener(o):this.skeleton.setCompleteListener(null),r)return{track:r,duration:r.animation.duration};console.log(this._roleName+"\u627e\u4e0d\u5230\u52a8\u4f5c: ",t)}},e.prototype.update=function(){this._lifetime--,this._lifetime<0||1!=this.type&&2!=this.type&&(this.bloodBar.progress=1-this._lifetime/600,this._lifetime<=0&&(this.toastNode.active=!0,cc.tween(this.toastNode).delay(2).to(.2,{opacity:0}).start(),this.skeleton.setAnimation(0,this._roledata.ani[0],!0),cc.tween(this.node).delay(10).call(this.waitGet,this).start()))},e.prototype.isLife=function(){return this._isLife},e.prototype.getNow=function(){1==this.type&&(this._lifetime=20),this._isLife=!1;var t=null,e=null,i=cc.v2(0,-500);p.default.uiMgr.uiRoot.getChildByName("TopUiItem")&&(e=(t=p.default.uiMgr.uiRoot.getChildByName("TopUiItem").getChildByName(this._icon).getChildByName("coin")).parent.convertToWorldSpaceAR(t.position),i=this.node.convertToNodeSpaceAR(e),p.default.uiMgr.uiRoot.getChildByName("TopUiItem").getComponent(f.default).showProgressBar(this._icon),1==this.type?p.default.uiMgr.uiRoot.getChildByName("TopUiItem").getComponent(f.default).showAddNum(o._addCoinNum,u.CURRENCY.GOLD):2==this.type?p.default.uiMgr.uiRoot.getChildByName("TopUiItem").getComponent(f.default).showAddNum(50,u.CURRENCY.YUSHI):p.default.uiMgr.uiRoot.getChildByName("TopUiItem").getComponent(f.default).showAddNum(o._addWheatNum,u.CURRENCY.WHEAT));var n=2==this.type?80:1!=this.type?200:100;this.playCoinFlyAnim(10,new cc.Vec2(0,0),i,null,this._propType,n),c.AudioMgr.Ins().playEffect(1==this.type||2==this.type?h.Res.audio.battle+"getCoin":h.Res.audio.battle+"shibing")},e.prototype.waitGet=function(t){if(t&&t.target){var e=t.target;if(e.getChildByName("ui_cd")&&!e.getChildByName("ui_cd").getComponent(l.default).isCDEnd())return;e.getChildByName("ui_cd")&&e.getChildByName("ui_cd").getComponent(l.default).ontouch(),d.default.ins().addDailyTaskState(4,1)}this._lifetime>0||this.getNow()},e.prototype.playCoinFlyAnim=function(t,e,i,n,r,s){var c=this;(void 0===s&&(s=200),null!=e&&null!=i)&&(0==this.type&&this.node.removeAllChildren(),this.getCirclePoints(s,e,t).map(function(t){var o=new cc.Node("New Sprite");o.addComponent(cc.Sprite),1==c.type?o.scaleX=o.scaleY=.5:2==c.type?o.scaleX=o.scaleY=1:o.scaleX=o.scaleY=3;var n=o.getComponent(cc.Sprite);return r==u.CURRENCY.GOLD?c.assetImpl.spriteAtlasFrame(n,h.Res.texture.views.icon,"icon_101"):r==u.CURRENCY.YUSHI?c.assetImpl.spriteAtlasFrame(n,h.Res.texture.views.icon,"icon_100b"):c.assetImpl.spriteAtlasFrame(n,h.Res.texture.views.mainUi,"ui_sb"),c.node.addChild(o),o.setPosition(t.x,t.y),{node:o,startPos:e,midPos:t,endPos:i,dis:c.calcDistance(t,i)}}).forEach(function(t,e){cc.tween(t.node).to(.15,{position:cc.v2(t.midPos.x,t.midPos.y)}).delay(.02*e).to(.35,{position:cc.v2(t.endPos.x,t.endPos.y)}).call(function(){t.node.destroy()}).union().start()}),this.scheduleOnce(function(){0==c.type?(a.GCtrl.ES.emit(u.CMsg.client.bag.onBagItemChange,[[u.CURRENCY.WHEAT,u.ITEM_TYPE.CURRENCY,o._addWheatNum]]),o._addWheatNum<1e5&&(o._addWheatNum+=50),c.node.removeFromParent()):(a.GCtrl.ES.emit(u.CMsg.client.bag.onBagItemChange,[[u.CURRENCY.GOLD,u.ITEM_TYPE.CURRENCY,o._addCoinNum]]),o._addCoinNum<1e4&&(o._addCoinNum+=25)),n&&n()},.8))},e.prototype.getCirclePoints=function(t,e,o,i){void 0===i&&(i=50);for(var n=[],r=0;r<o;r++){var a=Math.PI/180*Math.round(360/o),s=e.x+t*Math.sin(a*r),c=e.y+t*Math.cos(a*r);n.unshift(cc.v3(s+Math.random()*i,c+Math.random()*i,0))}return n},e.prototype.calcDistance=function(t,e){var o=t.x-e.x,i=t.y-e.y;return Math.pow(o*o+i*i,.5)},e._addWheatNum=200,e._addCoinNum=50,r([m(cc.Node)],e.prototype,"heroNode",void 0),r([m(sp.Skeleton)],e.prototype,"skeleton",void 0),r([m(cc.ProgressBar)],e.prototype,"bloodBar",void 0),r([m(cc.Node)],e.prototype,"hitNode",void 0),r([m(cc.Node)],e.prototype,"toastNode",void 0),r([m()],e.prototype,"type",void 0),o=r([_],e)}(s.default);o.default=y,cc._RF.pop()},{"../../Core/GCtrl":"GCtrl","../../Core/GView/GChild":"GChild","../../Core/Manager/AudioMgr":"AudioMgr","../Common/BtnCDTime":"BtnCDTime","../Common/Define":"Define","../Common/UIResources":"UIResources","../Logic/GameMgr":"GameMgr","../Logic/UserMgr":"UserMgr","../Views/Common/TopUiItem":"TopUiItem"}],AudioMgr:[function(t,e,o){"use strict";cc._RF.push(e,"44a3ckGuhNHNo49V45H+54D","AudioMgr"),Object.defineProperty(o,"__esModule",{value:!0}),o.AudioMgr=o.SoundStorageKey=void 0;var i,n=t("../GLoader/GLoader");(function(t){t.MusicVolume="music_volume",t.MusicName="music_name",t.EffectVolume="effect_Volume"})(i=o.SoundStorageKey||(o.SoundStorageKey={}));var r=-1,a=function(){function t(){this._bgMusicId=r,this._bgMusicPath="",this._lastBgMusicPath="",this._soundScale=.6,this._bgMusicVolume=1,this._effectMusicVolume=1,this._curLoadMusicPath="",this._bgMusicId=r,this._bgMusicPath="";var t=cc.sys.localStorage.getItem(i.MusicVolume);this._bgMusicVolume=null==t?1:parseFloat(t),t=cc.sys.localStorage.getItem(i.EffectVolume),this._effectMusicVolume=null==t?1:parseFloat(t),this.initGameListener()}return t.Ins=function(){return this._instance||(this._instance=new t),this._instance},t.setFinishCallBack=function(t,e){cc.audioEngine.setFinishCallback(t,e)},t.prototype.initGameListener=function(){var t=this,e="",o=0;cc.game.on(cc.game.EVENT_SHOW,function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];e&&t.getMusicID()==r&&(t.playMusic(e),t.getMusicID()!=r&&cc.audioEngine.setCurrentTime(t.getMusicID(),o))}),cc.game.on(cc.game.EVENT_HIDE,function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];t.getMusicID()!=r&&(e=t._bgMusicPath)&&(o=cc.audioEngine.getCurrentTime(t.getMusicID()),t.stopMusic(!1))})},t.prototype.getUrl=function(t){return cc.url.raw("resources"+t)},t.prototype.setMusicVolume=function(t,e){if(void 0===e&&(e=!0),e&&(this._bgMusicVolume=t,cc.sys.localStorage.setItem(i.MusicVolume,t.toFixed(2).toString())),cc.audioEngine.setMusicVolume(t*this._soundScale),this.getMusicID()!=r);else if(t>0)if(this._bgMusicPath){var o=this._bgMusicPath;this._bgMusicPath=null,this.playMusic(o)}else null!=this._curLoadMusicPath&&this.playMusic(this._curLoadMusicPath)},t.prototype.setEffectVolume=function(t){this._effectMusicVolume=t,cc.sys.localStorage.setItem(i.EffectVolume,t.toFixed(2).toString())},t.prototype.playMusic=function(t){var e=this;this._bgMusicPath!=t&&(this._curLoadMusicPath=n.GAssetImpl.realUrl(t),this._bgMusicVolume<=0||(this.getMusicID()!=r&&this.stopMusic(),n.GLoader.audioClip(t,function(o){if(t==e._curLoadMusicPath){var i=cc.audioEngine.playMusic(o,!0);i>=0&&(cc.audioEngine.setMusicVolume(e._bgMusicVolume*e._soundScale),e.setMusicID(i),e.setMusicName(t))}})))},t.prototype.playLastMusic=function(){this._lastBgMusicPath&&this.playMusic(this._lastBgMusicPath)},t.prototype.stopMusic=function(t){void 0===t&&(t=!0),this.getMusicID()!=r&&(t&&(this._lastBgMusicPath=this._bgMusicPath),cc.audioEngine.stopMusic(),this.setMusicID(r),this.setMusicName(""))},t.prototype.playEffect=function(t,e,o){var i=this;this._effectMusicVolume<=0||n.GLoader.audioClip(t,function(n){var r=cc.audioEngine.play(n,!1,i._effectMusicVolume*i._soundScale);e&&r>=0&&e(t,r),o&&r>=0&&cc.audioEngine.setFinishCallback(r,function(){o(t,r)})})},t.prototype.stopAll=function(){this.stopMusic(),cc.audioEngine.stopAll()},t.prototype.pauseAll=function(){cc.audioEngine.pauseAll()},t.prototype.resumeAll=function(){cc.audioEngine.resumeAll()},t.prototype.getMusicName=function(){return this._bgMusicPath},t.prototype.setMusicName=function(t){this._bgMusicPath=t,cc.sys.localStorage.setItem(i.MusicName,t)},t.prototype.getMusicID=function(){return this._bgMusicId},t.prototype.setMusicID=function(t){this._bgMusicId=t},t.prototype.getMusicVolume=function(){return this._bgMusicVolume},t.prototype.getEffectVolume=function(){return this._effectMusicVolume},t._instance=null,t}();o.AudioMgr=a,cc._RF.pop()},{"../GLoader/GLoader":"GLoader"}],BaseView:[function(t,e,o){"use strict";cc._RF.push(e,"a2759xTcytDXY1/uQ4W1qEV","BaseView");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("./uiManager"),s=cc._decorator,c=s.ccclass,l=s.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.zIndex=100,e.AniNode=null,e.dialogPath="",e.args=null,e}return n(e,t),e.prototype.show=function(t){this.args=t,null!=this.AniNode&&(this.AniNode.scale=.1,cc.tween(this.AniNode).to(.2,{scale:1}).start())},e.prototype.close=function(){var t=this;null!=this.AniNode?cc.tween(this.AniNode).to(.2,{scale:.1}).call(function(){t.node.active=!1,t.AniNode.scale=1,a.uiManager.instance.hideDialog(t.dialogPath)}).start():a.uiManager.instance.hideDialog(this.dialogPath)},r([l()],e.prototype,"zIndex",void 0),r([l(cc.Node)],e.prototype,"AniNode",void 0),r([c("BaseView")],e)}(cc.Component);o.default=u,cc._RF.pop()},{"./uiManager":"uiManager"}],BattleAutoView:[function(t,e,o){"use strict";cc._RF.push(e,"9c61aRuOjdA26+r3MCQSsc6","BattleAutoView");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},a=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a},s=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0});var c=t("../../../Core/GView/GViewBase"),l=t("../../../Core/Manager/AudioMgr"),u=t("../../Common/UIResources"),h=t("../../Logic/GameMgr"),p=t("../../../Core/GCtrl"),d=t("../../Common/Define"),f=t("../../Manager/RoleManager"),g=t("../../Entity/RoleHead"),_=t("../../../conventions/JXCommon"),m=t("../../../tyqSDK/tyqSDK"),y=cc._decorator,v=y.ccclass,C=y.property,I=y.menu,E=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.enemyNode=null,e.armNode=null,e.uiRoot=null,e.enemyList=null,e.heroList=null,e.fightStart1=null,e.fightStart2=null,e.jiantou=null,e._winArgs=null,e._secenId=null,e._cmdMgr=null,e._enemyListId=[2001,2002],e._heroListId=[1001,1002,1003,1004,1005],e._heroListData=[],e._enemyListData=[],e._fightInfoData=[],e._curFightStep=0,e._curLevel=0,e._delayState=100,e._isFullPower=!1,e}return n(e,t),e.prototype.onGStart=function(t){var e=this;this._winArgs=t;var o=this._winArgs;this._secenId=o.sceneId;var i=o.args.level;m.tyqSDK.eventLevelStart(i),this._isFullPower=o.args.isFullPower;var n=h.default.userMgr.getLevelRaw(i);this._enemyListId=n.monsterList,this._curLevel=i,this._heroListId=[],h.default.rHeroData.heroIdsInBattle.forEach(function(t){t>0&&e._heroListId.push(t)});var r=s(this._enemyListId,this._heroListId);f.default.getInstance().loadAllRoundAssets(r,this.onResLoaded.bind(this)),p.GCtrl.ES.on("fightViewClose",this,this.onViewClose.bind(this));var a=u.Res.audio.battle+"battle_"+(Math.floor(5*Math.random())+1);l.AudioMgr.Ins().playMusic(a)},e.prototype.onViewClose=function(){this.onClose()},e.prototype.onGDestroy=function(){p.GCtrl.ES.off(this)},e.prototype.onResLoaded=function(){this.dealFightData()},e.prototype.dealFightData=function(){var t=h.default.systemConfig.value(_.JXDef.SYS_CONFIG_KEY.basicsWheat);t+=h.default.lUserData.getUserBuff(d.BUFFINFO.InitBattlefieldRes);for(var e=h.default.RBagData.getMegreItems(d.CURRENCY.WHEAT,d.ITEM_TYPE.CURRENCY).num+t,o=0,i=0;i<this._heroListId.length&&e>0;i++){var n=this._heroListId[i],a=f.default.getInstance().getRolePowerProp(n),s=this._isFullPower?a[2]:Math.min(a[2],e);o+=s;var c={roleId:n,power:a,maxHp:s};this._isFullPower||(e-=Math.min(a[2],e)),p.GCtrl.ES.emit(d.CMsg.client.bag.onBagItemChange,[[d.CURRENCY.WHEAT,d.ITEM_TYPE.CURRENCY,0-Math.min(a[2],e)]]),this._heroListData.push(c)}var l=Math.min(o,h.default.RBagData.getMegreItems(d.CURRENCY.WHEAT,d.ITEM_TYPE.CURRENCY).num+t);p.GCtrl.ES.emit(d.CMsg.client.bag.onBagItemChange,[[d.CURRENCY.WHEAT,d.ITEM_TYPE.CURRENCY,0-l]]);var u=0,g=0,m=0,y=this.getEnemyData();if(y)y.forEach(function(t){t.maxHp<=0&&g++}),this._enemyListData=y;else{var v=h.default.userMgr.getLevelRaw(this._curLevel);for(i=0;i<this._enemyListId.length;i++)c={roleId:n=this._enemyListId[i],power:a=f.default.getInstance().getEnemyPowerProp(n,v.monsterLevel[i],v.powerPro[i]),maxHp:a[2]},this._enemyListData.push(c)}var C={fightStep:0,heroData:this.getCopyListData(this._heroListData),enemyData:this.getCopyListData(this._enemyListData),curFightEnemy:this._enemyListData[g]?r({},this._enemyListData[g]):null,curFightHero:this._heroListData[u]?r({},this._heroListData[u]):null,curHurt:[0,0]};for(this._fightInfoData.push(C);g<this._enemyListData.length&&u<this._heroListData.length;){m++;var I=this._enemyListData[g],E=this._heroListData[u],S=this.getCurHurt(E,I);(I.maxHp-=S[1])<=0&&g++,(E.maxHp-=S[0])<=0&&u++;var R={fightStep:m,heroData:this.getCopyListData(this._heroListData),enemyData:this.getCopyListData(this._enemyListData),curFightEnemy:this._enemyListData[g]?r({},this._enemyListData[g]):null,curFightHero:this._heroListData[u]?r({},this._heroListData[u]):null,curHurt:S};this._fightInfoData.push(R)}},e.prototype.getCurHurt=function(t,e){var o=f.default.getInstance().dealCurDamage(t.roleId,e.roleId,t.power,e.power),i=f.default.getInstance().dealCurDamage(e.roleId,t.roleId,e.power,t.power),n=Math.ceil(Math.min(t.maxHp/i,e.maxHp/o));return[i*n,o*n]},e.prototype.getCopyListData=function(t){var e=[];return t.forEach(function(t){e.push(r({},t))}),e},e.prototype.updateList=function(){var t=this._fightInfoData[this._curFightStep].enemyData,e=this._fightInfoData[this._curFightStep].heroData;if(null!=t&&null!=e){for(var o=0,i=0;i<t.length;i++){var n=t[i],r=this.enemyList.getChildByName("enemy"+n.roleId);n.maxHp<=0?(o+=120,r.getComponent(g.default).setState(g.default.State_Die)):this._fightInfoData[this._curFightStep].curFightEnemy&&n.roleId==this._fightInfoData[this._curFightStep].curFightEnemy.roleId?r.getComponent(g.default).setState(g.default.State_Fight):r.getComponent(g.default).setState(g.default.State_Wait)}for(cc.tween(this.enemyList).to(.2,{x:-o}).start(),o=0,i=0;i<e.length;i++)n=e[i],r=this.heroList.getChildByName("hero"+n.roleId),n.maxHp<=0?(o+=120,r.getComponent(g.default).setState(g.default.State_Die)):this._fightInfoData[this._curFightStep].curFightHero&&n.roleId==this._fightInfoData[this._curFightStep].curFightHero.roleId?r.getComponent(g.default).setState(g.default.State_Fight):r.getComponent(g.default).setState(g.default.State_Wait);cc.tween(this.heroList).to(.2,{x:o}).start()}},e.prototype.onGLoad=function(){},e.prototype.update=function(){},e.prototype.saveEnemyData=function(){cc.sys.localStorage.setItem("leveldata"+this._curLevel,JSON.stringify(this._enemyListData))},e.prototype.getEnemyData=function(){var t=cc.sys.localStorage.getItem("leveldata"+this._curLevel);return t?JSON.parse(t):null},a([C(cc.Node)],e.prototype,"enemyNode",void 0),a([C(cc.Node)],e.prototype,"armNode",void 0),a([C(cc.Node)],e.prototype,"uiRoot",void 0),a([C(cc.Node)],e.prototype,"enemyList",void 0),a([C(cc.Node)],e.prototype,"heroList",void 0),a([C(cc.Node)],e.prototype,"fightStart1",void 0),a([C(cc.Node)],e.prototype,"fightStart2",void 0),a([C(cc.Node)],e.prototype,"jiantou",void 0),a([v,I("View/Fight/BattleAutoView")],e)}(c.default);o.default=E,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../../Core/GView/GViewBase":"GViewBase","../../../Core/Manager/AudioMgr":"AudioMgr","../../../conventions/JXCommon":"JXCommon","../../../tyqSDK/tyqSDK":"tyqSDK","../../Common/Define":"Define","../../Common/UIResources":"UIResources","../../Entity/RoleHead":"RoleHead","../../Logic/GameMgr":"GameMgr","../../Manager/RoleManager":"RoleManager"}],BattleResultCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"38a5c8vfW5LaoErF4yOT7cd","BattleResultCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/GView/GViewBase"),c=t("../../../Core/Manager/AudioMgr"),l=t("../../Common/UI"),u=t("../../Data/RunTime/RunRaw/RJXItem"),h=t("../../Logic/GameMgr"),p=t("../Common/JXItem"),d=t("../JXBattle/JXULDefine"),f=t("./../../../Core/GCtrl"),g=t("./../../Common/Define"),_=t("./../../Common/UIResources"),m=t("./JXResultHero"),y=cc._decorator,v=y.ccclass,C=y.property,I=y.menu,E=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.stars=null,e.rewardLayer=null,e.heroLayer=null,e.btnLayer=null,e.shareBtn=null,e.sk_Over=null,e.heroHurt=null,e.quzengqiang=null,e._ans=null,e._cb=null,e._isWin=null,e._level=null,e._levelRaw=null,e._TowerData=null,e._secenId=null,e._star=0,e._reward=null,e}return n(e,t),e.prototype.onGStart=function(t,e,o,i){this._secenId=t,this._ans=o,this._cb=i,this._level=e,this._isWin=this._ans.isDefWin,1==this._level&&(h.default.lUserData.level=1,h.default.lUserData.setStarByLevel(1,3)),this._secenId==g.PART_BTL_SCENE.ARENA?this._TowerData=h.default.towerData.getRaw(e):this._levelRaw=h.default.storyData.getRaw(e),this.win.maskNode.opacity=200,this.setView(),this.shareBtn.active=h.default.sdkMgr.isShowRecordBtn()},e.prototype.setView=function(){var t=this,e=0,o=[];switch(c.AudioMgr.Ins().stopMusic(),this._isWin?c.AudioMgr.Ins().playEffect(_.Res.audio.suc):c.AudioMgr.Ins().playEffect(_.Res.audio.lost),this._secenId){case g.PART_BTL_SCENE.ARENA:var i=this._levelRaw;this._isWin?(this.sk_Over.setAnimation(0,d.JXEOverAniNames.shengli1,!1),this.scheduleOnce(function(){t.sk_Over.setAnimation(0,d.JXEOverAniNames.shengli2,!0)},.75),this.stars.active=!1,h.default.lUserData.sportsLv=this._TowerData.id,o=this._TowerData.winAward):(this.sk_Over.setAnimation(0,d.JXEOverAniNames.shibai1,!1),this.scheduleOnce(function(){t.sk_Over.setAnimation(0,d.JXEOverAniNames.shibai2,!1)},.75),o=this._TowerData.lose),this.setHeroHurt();break;case g.PART_BTL_SCENE.GUANQIA:i=this._levelRaw,this._isWin?(i.win.forEach(function(o){t._ans.barrackHps>=o&&e++}),o=this._levelRaw["star"+e],this.sk_Over.setAnimation(0,d.JXEOverAniNames.shengli1,!1),this.scheduleOnce(function(){t.sk_Over.setAnimation(0,d.JXEOverAniNames.shengli2,!0)},.75),h.default.lUserData.setStarByLevel(this._levelRaw.id,e),this.setHeroHurt()):(this._level>=4&&(this.heroHurt.active=!1,this.btnLayer.active=!1,this.quzengqiang.active=!0),o=this._levelRaw.lose,this.sk_Over.setAnimation(0,d.JXEOverAniNames.shibai1,!1),this.scheduleOnce(function(){t.sk_Over.setAnimation(0,d.JXEOverAniNames.shibai2,!1)},.75))}this._reward=o,this.setStar(e)},e.prototype.setHeroHurt=function(){var t=this,e=0;h.default.lUserData.heroInBattle.forEach(function(o){var i=t._ans.heroHurdInfo.get(o);i>e&&(e=i)})},e.prototype.setStar=function(t){var e=this;this._star=t,this.stars.children.forEach(function(o,i){t>=i+1&&e.stars.children[i].getComponent(sp.Skeleton).setAnimation(0,"start",!1)})},e.prototype.setReward=function(t){var e=this;this.assetImpl.prefab(_.Res.prefab.item.jxItem,function(o){for(var i=0;i<t.length;i++){var n=new u.default(t[i]),r=cc.instantiate(o),a=r.getComponent(p.default);r.setScale(1.2),a.setView(n,g.ITEM_DETAIL_FLAG.LIGHT|g.ITEM_DETAIL_FLAG.SHOWLIGHT),e.rewardLayer.addChild(r)}})},e.prototype.setHeroHead=function(){var t=this,e=h.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.basic),o=this._star>0?this._levelRaw.exp[this._star-1]:0,i=Math.round(o*e),n=o-i;this.assetImpl.prefab(_.Res.prefab.vw.fight.resultHero,function(e){t._ans.defTPL.partnerData.forEach(function(o){var r=cc.instantiate(e),a=r.getComponent(m.default),s=t._ans.heroHurdInfo.get(o.tableId);s=s||0;var c=Math.round(i/t._ans.heroHurdInfo.size+n*(s/t._ans.allHurt));c||(c=0),a.setView(o.tableId,c),t.heroLayer.addChild(r)})})},e.prototype.onGetRewardClick=function(t,e){var o=this;Number(e)?h.default.sdkMgr.watchAd(function(){o._reward.forEach(function(t,e){o._reward[e][g.PART_ITEM.NUM]+=t[g.PART_ITEM.NUM]}),f.GCtrl.ES.emit(g.CMsg.client.bag.onBagItemChange,o._reward)},function(){},"\u7ed3\u7b97\u53cc\u500d\u9886\u53d6"):f.GCtrl.ES.emit(g.CMsg.client.bag.onBagItemChange,this._reward),this.onClose()},e.prototype.continue=function(){this._secenId==g.PART_BTL_SCENE.GUANQIA?this._level>=4&&!this._isWin?(this._cb&&this._cb(),h.default.jumpToMgr.jumpGoTo(l.VIEW_ID.heroPage),f.GCtrl.ES.emit(g.CMsg.client.home.onaddLevel)):(t.prototype.onClose.call(this),h.default.jumpToMgr.jumpGoTo(l.VIEW_ID.battleReward,this._secenId,this._level,this._ans,this._cb)):this._secenId==g.PART_BTL_SCENE.ARENA&&(t.prototype.onClose.call(this),h.default.jumpToMgr.jumpGoTo(l.VIEW_ID.battleReward,this._secenId,this._level,this._ans,this._cb))},r([C(cc.Node)],e.prototype,"stars",void 0),r([C(cc.Node)],e.prototype,"rewardLayer",void 0),r([C(cc.Node)],e.prototype,"heroLayer",void 0),r([C(cc.Node)],e.prototype,"btnLayer",void 0),r([C(cc.Node)],e.prototype,"shareBtn",void 0),r([C({type:sp.Skeleton,tooltip:"\u80dc\u5229\u5931\u8d25\u7279\u6548"})],e.prototype,"sk_Over",void 0),r([C({type:cc.Node,tooltip:"\u82f1\u96c4\u4f24\u5bb3\u8868"})],e.prototype,"heroHurt",void 0),r([C({type:cc.Node,tooltip:"\u53bb\u589e\u5f3a"})],e.prototype,"quzengqiang",void 0),r([v,I("View/Fight/BattleResultCtrl")],e)}(s.default);o.default=E,cc._RF.pop()},{"../../../Core/GView/GViewBase":"GViewBase","../../../Core/Manager/AudioMgr":"AudioMgr","../../../conventions/JXCommon":"JXCommon","../../Common/UI":"UI","../../Data/RunTime/RunRaw/RJXItem":"RJXItem","../../Logic/GameMgr":"GameMgr","../Common/JXItem":"JXItem","../JXBattle/JXULDefine":"JXULDefine","./../../../Core/GCtrl":"GCtrl","./../../Common/Define":"Define","./../../Common/UIResources":"UIResources","./JXResultHero":"JXResultHero"}],BattleResultView:[function(t,e,o){"use strict";cc._RF.push(e,"55c34Jpb5pHirm1h/uVgssN","BattleResultView");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../Logic/GameMgr"),s=t("../../Common/UI"),c=t("../../Common/Define"),l=t("../../Common/UIResources"),u=t("../../Data/RunTime/RunRaw/RJXItem"),h=t("../Common/JXItem"),p=t("../JXBattle/JXULDefine"),d=t("../../../Core/GCtrl"),f=t("../../../Core/GEvent/GParam"),g=t("../../Manager/RoleManager"),_=t("../../../tyqSDK/tyqSDK"),m=t("../../../Core/GView/RewardAnimalView"),y=t("../../Common/Zh"),v=t("../../Guide/GuideLogic"),C=t("../../../tyqSDK/tyqAdManager"),I=t("../../Logic/SdkMgr"),E=cc._decorator,S=E.ccclass,R=E.property,D=E.menu,b=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rewardLayer=null,e.sk_Over=null,e.failbg=null,e.nextLvBtn=null,e.doubleBtn=null,e.zhuyeBtn=null,e._isWin=null,e._level=null,e._reward=null,e._Currencyanim=[],e}return n(e,t),e.prototype.start=function(){},e.prototype.onGStart=function(e,o,i){t.prototype.onGStart.call(this),this._level=o,this._isWin=i.isWin,this.doubleBtn.active=!1,this.zhuyeBtn.active=!1,this.nextLvBtn.active=!1;var n=this;this.scheduleOnce(function(){n.doubleBtn.active=!0,n.zhuyeBtn.active=!0,n.nextLvBtn.active=1==this._isWin},.4),this._isWin?(this.nextLvBtn.x=0,this.nextLvBtn.y=-430):(this.nextLvBtn.x=120,this.nextLvBtn.y=-319),_.tyqSDK.eventLevelEnd(this._level,this._isWin),this.setView(),a.default.rHeroData.heroIdsInBattle.forEach(function(t){if(t>0){var e={heroId:t,exp:10+o};d.GCtrl.ES.emit(c.CMsg.client.hero.onHeroAddExp,new f.default(e))}}),_.tyqSDK.getConfigProbability("tyq_ad_custom_rect_switch")&&!v.GuideLogic.ins().isGuidding()&&C.tyqAdManager.showFullRewardedAd()},e.prototype.setReward=function(t){var e=this;this._reward=t,this._reward.forEach(function(t,o){e._reward[o][c.PART_ITEM.NUM]+=t[c.PART_ITEM.NUM]}),d.GCtrl.ES.emit(c.CMsg.client.bag.onBagItemChange,this._reward),this.assetImpl.prefab(l.Res.prefab.item.jxItem,function(o){for(var i=0;i<t.length;i++){var n=new u.default(t[i]),r=cc.instantiate(o),a=r.getComponent(h.default);r.setScale(1.2),a.setView(n,c.ITEM_DETAIL_FLAG.LIGHT|c.ITEM_DETAIL_FLAG.SHOWLIGHT),e.rewardLayer.addChild(r);var s={startPos:a.node.position,id:n.id};e._Currencyanim.push(s)}e.scheduleOnce(function(){e.showCurency()},.2)})},e.prototype.showCurency=function(){var t=this;this._Currencyanim.forEach(function(e){t.change(e)})},e.prototype.onGetRewardClick=function(){var t=this;this.showCurency(),a.default.sdkMgr.watchAd(function(){t._reward.forEach(function(e,o){t._reward[o][c.PART_ITEM.NUM]+=e[c.PART_ITEM.NUM]}),d.GCtrl.ES.emit(c.CMsg.client.bag.onBagItemChange,t._reward),a.default.uiMgr.showToast(y.JXLocales.tip.alldoubleClick)},function(){},"\u7ed3\u7b97\u53cc\u500d\u5956\u52b1"),this.continue()},e.prototype.setView=function(){var t=this,e=a.default.userMgr.getLevelRaw(a.default.lUserData.level+1);this._isWin?(this.sk_Over.setAnimation(0,p.JXEOverAniNames.shengli1,!1),this.scheduleOnce(function(){t.sk_Over.setAnimation(0,p.JXEOverAniNames.shengli2,!0)},.75),this.setReward(e.star3)):(this.assetImpl.spriteFrame(this.failbg.getComponent(cc.Sprite),"bg/main/failure"),this.sk_Over.setAnimation(0,p.JXEOverAniNames.shibai1,!1),this.scheduleOnce(function(){t.sk_Over.setAnimation(0,p.JXEOverAniNames.shibai2,!0)},.75),this.setReward(e.lose))},e.prototype.continue=function(){t.prototype.onClose.call(this),this.showCurency(),a.default.jumpToMgr.jumpGoTo(s.VIEW_ID.heroPage),_.tyqSDK.getConfigProbability("tyq_ad_custom_rect_switch")&&!v.GuideLogic.ins().isGuidding()&&(I.default.ins._isWhitePag||a.default.jumpToMgr.jumpGoTo(s.VIEW_ID.MoreGameCtrl)),this._isWin&&this.addLevel(),d.GCtrl.ES.emit(c.CMsg.client.home.onChangeLevel)},e.prototype.addLevel=function(){var t=a.default.lUserData.level;t++,a.default.lUserData.level=t},e.prototype.nextLevel=function(){this.showCurency(),t.prototype.onClose.call(this),d.GCtrl.ES.emit("fightViewClose"),this._isWin&&this.addLevel(),setTimeout(function(){g.default.getInstance().onStartFight()},200)},r([R(cc.Node)],e.prototype,"rewardLayer",void 0),r([R({type:sp.Skeleton,tooltip:"\u80dc\u5229\u5931\u8d25\u7279\u6548"})],e.prototype,"sk_Over",void 0),r([R(cc.Node)],e.prototype,"failbg",void 0),r([R(cc.Node)],e.prototype,"nextLvBtn",void 0),r([R(cc.Node)],e.prototype,"doubleBtn",void 0),r([R(cc.Node)],e.prototype,"zhuyeBtn",void 0),r([S,D("BattleResultView")],e)}(m.default);o.default=b,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../../Core/GEvent/GParam":"GParam","../../../Core/GView/RewardAnimalView":"RewardAnimalView","../../../tyqSDK/tyqAdManager":"tyqAdManager","../../../tyqSDK/tyqSDK":"tyqSDK","../../Common/Define":"Define","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Common/Zh":"Zh","../../Data/RunTime/RunRaw/RJXItem":"RJXItem","../../Guide/GuideLogic":"GuideLogic","../../Logic/GameMgr":"GameMgr","../../Logic/SdkMgr":"SdkMgr","../../Manager/RoleManager":"RoleManager","../Common/JXItem":"JXItem","../JXBattle/JXULDefine":"JXULDefine"}],BattleRewardCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"a2bb4jWY15IoIN38KxtWVMm","BattleRewardCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/GView/GViewBase"),c=t("../../Common/UI"),l=t("../../Data/RunTime/RunRaw/RJXItem"),u=t("../../Logic/GameMgr"),h=t("../Common/JXItem"),p=t("./../../../Core/GCtrl"),d=t("./../../Common/Define"),f=t("./../../Common/UIResources"),g=t("./JXResultHero"),_=cc._decorator,m=_.ccclass,y=_.property,v=_.menu,C=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rewardLayer=null,e.heroLayer=null,e.double=null,e._ans=null,e._cb=null,e._isWin=null,e._levelRaw=null,e._TowerData=null,e._secenId=null,e._star=0,e._reward=null,e}return n(e,t),e.prototype.onGStart=function(t,e,o,i){this._secenId=t,this._ans=o,this._cb=i,this._isWin=this._ans.isDefWin,this._secenId==d.PART_BTL_SCENE.ARENA?this._TowerData=u.default.towerData.getRaw(e):this._levelRaw=u.default.storyData.getRaw(e),this.win.maskNode.opacity=200,this.setView()},e.prototype.setView=function(){var t=this,e=0,o=[];switch(this._secenId){case d.PART_BTL_SCENE.ARENA:var i=this._levelRaw;this._isWin?(u.default.lUserData.sportsLv=this._TowerData.id,o=this._TowerData.winAward):o=this._TowerData.lose;break;case d.PART_BTL_SCENE.GUANQIA:i=this._levelRaw,this._isWin?(i.win.forEach(function(o){t._ans.barrackHps>=o&&e++}),o=this._levelRaw["star"+e],u.default.lUserData.level=i.id):o=this._levelRaw.lose}this._reward=o,this._star=e,this.setReward(o),this.setHeroHead()},e.prototype.setReward=function(t){var e=this;this.assetImpl.prefab(f.Res.prefab.item.jxItem,function(o){for(var i=0;i<t.length;i++){var n=new l.default(t[i]),r=cc.instantiate(o),a=r.getComponent(h.default);r.setScale(1.2),a.setView(n,d.ITEM_DETAIL_FLAG.LIGHT|d.ITEM_DETAIL_FLAG.SHOWLIGHT),e.rewardLayer.addChild(r)}})},e.prototype.setHeroHead=function(){var t=this,e=u.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.basic),o=this._star>0?this._levelRaw.exp[this._star-1]:0;this._secenId==d.PART_BTL_SCENE.ARENA&&(o=this._isWin?this._TowerData.exp[1]:this._TowerData.exp[0]);var i=Math.round(o*e),n=o-i;this.assetImpl.prefab(f.Res.prefab.vw.fight.resultHero,function(e){t._ans.defTPL.partnerData.forEach(function(o){var r=cc.instantiate(e),a=r.getComponent(g.default);r.scale=.9,r.x=-145;var s=t._ans.heroHurdInfo.get(o.tableId);s=s||0;var c=Math.round(i/t._ans.heroHurdInfo.size+n*(s/t._ans.allHurt));c||(c=0),a.setView(o.tableId,c,t._cb),t._secenId==d.PART_BTL_SCENE.GUANQIA&&a.openUp(),t.heroLayer.addChild(r)})})},e.prototype.onGetRewardClick=function(t,e){var o=this;Number(e)?u.default.sdkMgr.watchAd(function(){o.double.active=!1,o._reward.forEach(function(t,e){o._reward[e][d.PART_ITEM.NUM]+=t[d.PART_ITEM.NUM]}),p.GCtrl.ES.emit(d.CMsg.client.bag.onBagItemChange,o._reward),o.onClose()},function(){},"\u606d\u559c\u83b7\u5f97\u53cc\u500d\u9886\u53d6"):(p.GCtrl.ES.emit(d.CMsg.client.bag.onBagItemChange,this._reward),this.onClose())},e.prototype.onClose=function(){t.prototype.onClose.call(this),this._cb&&this._cb(),this._secenId!=d.PART_BTL_SCENE.ARENA&&u.default.jumpToMgr.jumpGoTo(c.VIEW_ID.mainPage),p.GCtrl.ES.emit(d.CMsg.client.home.onaddLevel)},r([y(cc.Node)],e.prototype,"rewardLayer",void 0),r([y(cc.Node)],e.prototype,"heroLayer",void 0),r([y(cc.Node)],e.prototype,"double",void 0),r([m,v("View/Fight/BattleRewardCtrl")],e)}(s.default);o.default=C,cc._RF.pop()},{"../../../Core/GView/GViewBase":"GViewBase","../../../conventions/JXCommon":"JXCommon","../../Common/UI":"UI","../../Data/RunTime/RunRaw/RJXItem":"RJXItem","../../Logic/GameMgr":"GameMgr","../Common/JXItem":"JXItem","./../../../Core/GCtrl":"GCtrl","./../../Common/Define":"Define","./../../Common/UIResources":"UIResources","./JXResultHero":"JXResultHero"}],BattleTextParse:[function(t,e,o){"use strict";var i;cc._RF.push(e,"6412d8tFZlK/YSoOkxhboF1","BattleTextParse"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./JXBattleCb"),r=t("./JXBattleDefine"),a=function(){function t(){}return t.getTextReport=function(t,e,o){void 0===o&&(o=!1);var i="",n=this.getRoleNames(e),a=e.DPL_getCurRecord(t,!1);if(a){switch(a[r.JXBtlArrIx.Zero]){case r.JXBattleEvt.START:i+=P="\u5f00\u59cb\u6218\u6597\u64ad\u62a5",o&&console.log(P);break;case r.JXBattleEvt.ROLE_BEGIN:i+=P=n[s=a[r.JXBtlArrIx.One]]+"\u5f00\u59cb\u884c\u52a8",o&&console.log(P);break;case r.JXBattleEvt.ROLE_END:i+=P=n[s=a[r.JXBtlArrIx.One]]+"\u7ed3\u675f\u884c\u52a8",o&&(console.log(P),console.log());break;case r.JXBattleEvt.ROLE_SKILL_PREPARE:var s=a[r.JXBtlArrIx.One],c=a[r.JXBtlArrIx.Two];i+=P=n[s]+"\u7684\u6280\u80fd"+this.getSkillName(c)+"\u8fdb\u5165\u51c6\u5907",o&&console.log(P);break;case r.JXBattleEvt.ROLE_SKILL_PRESS:var l=a[r.JXBtlArrIx.One];s=(u=e.skillInfos[l]).execer,c=u.skillId,i+=P=n[s]+"\u91ca\u653e\u6280\u80fd"+this.getSkillName(c),o&&console.log(P);break;case r.JXBattleEvt.ROLE_SKILL_PRESS_END:var u;l=a[r.JXBtlArrIx.One],s=(u=e.skillInfos[l]).execer,c=u.skillId,i+=P=n[s]+"\u7684\u6280\u80fd"+this.getSkillName(c)+"\u91ca\u653e\u7ed3\u675f",o&&(console.log(P),console.log());break;case r.JXBattleEvt.ROLE_SKILL_BREAK:s=a[r.JXBtlArrIx.One],c=a[r.JXBtlArrIx.Two],i+=P=n[s]+"\u7684\u6280\u80fd"+this.getSkillName(c)+"\u65bd\u6cd5\u88ab\u6253\u65ad",o&&console.log(P);break;case r.JXBattleEvt.ROLE_COM_ATK:var h=a[r.JXBtlArrIx.One];i+=P=n[(R=e.hurtInfos[h]).execer]+"\u5bf9"+n[R.target]+"\u53d1\u8d77\u666e\u901a\u653b\u51fb\n"+n[R.target]+"\u8840\u91cf-"+R.damage+", \u62a4\u76fe-"+R.protect,o&&console.log(P);break;case r.JXBattleEvt.ROLE_CONTRLED:a[0],s=a[1];var p=a[2],d=a[3],f=n[s],g=this.getEffectMoldName(p),_=e.buffInfos[d];i+=P=f+"\u56e0"+n[e.skillInfos[_.insSkillId].execer]+"\u65bd\u52a0\u7684"+this.getEffectName(_.buffId)+"\u6548\u679c\u800c"+g,o&&console.log(P);break;case r.JXBattleEvt.ROLE_IMDE:a[0],f=a[1];var m=a[2],y=a[3],v=a[4];i+=P=n[f]+"\u56e0"+this.getEffectName(v)+"\u65e0\u6cd5\u65bd\u52a0\u6548\u679c"+this.getEffectName(y),o&&console.log(P);break;case r.JXBattleEvt.ROLE_SKILL_HURT:h=a[r.JXBtlArrIx.One];var C=n[(R=e.hurtInfos[h]).execer],I=n[R.target],E=e.buffInfos[R.insBuff];i+=P=I+"\u53d7\u5230\u6765\u81ea"+C+"\u7684"+this.getEffectName(E.buffId)+",\u8840\u91cf-"+R.damage+", \u62a4\u76fe-"+R.protect,o&&console.log(P);break;case r.JXBattleEvt.ROLE_SKILL_ADDHP:case r.JXBattleEvt.ROLE_HURT_2_HP:case r.JXBattleEvt.ROLE_ATK_2_PROTECT:case r.JXBattleEvt.ROLE_HURT_2_PROTECT:l=a[r.JXBtlArrIx.One],i+=P=n[(S=e.addHpInfos[l]).target]+" "+(S.isProtect?"\u56e0\u4e3a\u89d2\u8272\u53d7\u5230\u62a4\u76fe\u6548\u679c":"\u56e0\u4e3a\u89d2\u8272\u53d7\u5230\u56de\u8840\u6548\u679c")+" "+(S.isProtect?"\u83b7\u5f97\u62a4\u76fe":"\u6062\u590d\u8840\u91cf")+"+"+S.addNum,o&&console.log(P);break;case r.JXBattleEvt.HURT_BARKS:l=a[r.JXBtlArrIx.One],i+=P=n[(S=e.bracksHurtInfos[l]).execer]+" "+this.evtNames[a[r.JXBtlArrIx.Zero]]+" \u5bf9\u519b\u8425\u9020\u6210"+S.damage+"\u70b9\u4f24\u5bb3",o&&console.log(P);break;case r.JXBattleEvt.ROLE_SKILL_ADDMAXHP:var S;l=a[r.JXBtlArrIx.One],C=n[(S=e.addMaxHpInfos[l]).execer],I=n[S.target],E=e.buffInfos[S.insBuff],i+=P=I+"\u53d7\u5230\u6765\u81ea"+C+"\u7684"+this.getEffectName(E.buffId)+",\u6700\u5927\u8840\u91cf"+S.oldMaxHp+" +"+S.addNum+", ",o&&console.log(P);break;case r.JXBattleEvt.ROLE_HURT_2_ATK:var R;h=a[r.JXBtlArrIx.One],i+=P=n[(R=e.hurtInfos[h]).target]+"\u53d7\u5230\u6765\u81ea"+n[R.execer]+"\u7684\u53cd\u5f39\u4f24\u5bb3\uff0c\u8840\u91cf-"+R.damage+", \u62a4\u76fe-"+R.protect,o&&console.log(P);break;case r.JXBattleEvt.ROLE_ADD_BUFF:a[0],a[1],d=a[2],c=a[3];var D=a[4],b=a[5],w=a[6],A=(e.buffInfos[d],n[b]);i+=P=n[w]+"\u65bd\u52a0\u4e86\u6765\u81ea"+A+"\u7684"+this.getEffectName(D)+"\u7684\u6548\u679c",o&&console.log(P);break;case r.JXBattleEvt.ROLE_PREPARE_BUFF:a[0],a[1],d=a[2];var T=a[3];i+=P=n[(_=e.buffInfos[d]).target]+"\u7684"+this.getEffectName(_.buffId)+"\u6548\u679c\u8fdb\u5165\u51c6\u5907\uff0c\u9700\u8981"+T+"\u56de\u5408",o&&console.log(P);break;case r.JXBattleEvt.ROLE_REMOVE_BUFF:a[0],b=a[1],d=a[2],a[3],D=a[4],w=a[5],e.buffInfos[d],A=n[b],i+=P=n[w]+"\u6765\u81ea"+A+"\u7684"+this.getEffectName(D)+"\u7684\u6548\u679c\u5931\u6548",o&&console.log(P);break;case r.JXBattleEvt.ROLE_DIE:i+=P=n[s=a[r.JXBtlArrIx.One]]+"\u6b7b\u4ea1",o&&console.log(P);break;case r.JXBattleEvt.ROLE_RELIFE:i+=P=n[s=a[r.JXBtlArrIx.One]]+"\u590d\u6d3b",o&&console.log(P);break;case r.JXBattleEvt.CLEAR_LOCK_HP:i+=P=n[s=a[r.JXBtlArrIx.One]]+"\u5931\u53bb\u9501\u8840\u72b6\u6001",o&&console.log(P);break;case r.JXBattleEvt.LOCK_HP_EFFECT:i+=P=n[s=a[r.JXBtlArrIx.One]]+"\u5f00\u59cb\u9501\u8840\u4e2d",o&&console.log(P);break;case r.JXBattleEvt.LIFE_TIME_CHANGE:a[0],a[1],d=a[2];var M=a[3],L=a[4],P=(_=e.buffInfos[d],"");for(m=0;m<M.length;m++){var B=e.buffInfos[M[m]];P+=n[_.target]+"\u7684\u6548\u679c"+this.getEffectName(B.buffId)+"\u6301\u7eed\u65f6\u95f4\u5ef6\u957f"+L+"\u56de\u5408",(m=M.length-1)&&(P+="\n")}i+=P,o&&console.log(P);break;case r.JXBattleEvt.DETONATED_BUFF:a[0],a[1],d=a[2];var O=a[3];for(L=a[4],_=e.buffInfos[d],P="",m=0;m<O.length;m++)B=e.buffInfos[O[m].uuid],P+=n[_.target]+"\u7684\u6548\u679c"+this.getEffectName(B.buffId)+"\u88ab\u5f15\u7206",(m=O.length-1)&&(P+="\n");i+=P,o&&console.log(P);break;case r.JXBattleEvt.END_FIGHT:i+=P="\u7ed3\u675f\u6218\u6597\u64ad\u62a5",o&&console.log(P),console.log()}return i+"\n"}},t.parseCmd=function(){},t.getSkillName=function(t){var e=n.JXBattleCb.getSkillData(t),o=this.i18n(e.name);return"'"+this.skillTypeName[e.type]+"<"+o+">'"},t.getEffectName=function(t){return"("+n.JXBattleCb.getEffectData(t).name+")"},t.getRoleNames=function(t){for(var e=Object.create(null),o=0;o<t.iBtlTeams.length;o++)for(var i=0,a=t.iBtlTeams[o];i<a.heroIds.length;i++){var s=a.heroIds[i];if(s!=r.JXBtlPs.InvalidString){for(var c=null,l=0;l<a.partnerData.length;l++)if(a.partnerData[l].heroId==s){c=a.partnerData[l];break}if(c){var u=n.JXBattleCb.getCardData(c.tableId),h=this.i18n(u.name);e[s]="\u3010("+h+")["+(o==r.JXBtlCamp.Attacker?"\u653b\u51fb":"\u9632\u5b88")+i+"]\u3011"}else e[s]="(\u672a\u77e5\u5bf9\u8c61)\u3010ikey = "+s+"\u3011"}}var p=Object.keys(t.extras);for(o=0;o<p.length;o++){var d,f=t.extras[p[o]];d=f.camp==r.JXBtlCamp.NoCamp?"\u65e0\u9635\u8425":f.camp==r.JXBtlCamp.Attacker?"\u653b\u51fb":"\u9632\u5b88",e[p[o]]="\u3010(\u73af\u5883)["+d+f.id+"]\u3011"}return e},t.getEffectMoldName=function(t){var e="";switch(t){case r.JXBtlBEM.Hurt:e="\u4f24\u5bb3";break;case r.JXBtlBEM.AddHp:e="\u6cbb\u7597";break;case r.JXBtlBEM.SubPropts:e="\u964d\u4f4e\u5c5e\u6027\uff08\u56fa\u5b9a\u503c\uff09";case r.JXBtlBEM.SubMulPropts:e="\u964d\u4f4e\u5c5e\u6027\uff08\u767e\u5206\u6bd4\uff09";case r.JXBtlBEM.DBHit:e="\u4e8c\u6b21\u666e\u653b";break;case r.JXBtlBEM.AddPropts:e="\u63d0\u5347\u5c5e\u6027\uff08\u56fa\u5b9a\u503c\uff09";break;case r.JXBtlBEM.AddMulPropts:e="\u63d0\u5347\u5c5e\u6027\uff08\u767e\u5206\u6bd4\uff09";break;case r.JXBtlBEM.HurtToHp:e="\u8f93\u51fa\u5438\u8840";break;case r.JXBtlBEM.HurtToAtk:e="\u53cd\u5f39\u4f24\u5bb3";break;case r.JXBtlBEM.RoundActivePropts:e="\u751f\u6548\u671f\u95f4\uff0c\u6bcf\u56de\u5408\u5f00\u59cb\u91cd\u65b0\u8ba1\u7b97";break;case r.JXBtlBEM.BanAttack:e="\u7981\u6b62\u666e\u653b";break;case r.JXBtlBEM.BanSkill:e="\u7981\u6b62\u6280\u80fd";break;case r.JXBtlBEM.Confusion:e="\u654c\u6211\u4e0d\u5206: \u6df7\u4e71 ";break;case r.JXBtlBEM.Mock:e="\u5632\u8bbd\u76ee\u6807";break;case r.JXBtlBEM.BanAddHp:e="\u7981\u6b62\u6cbb\u7597";break;case r.JXBtlBEM.BanBuff:e="\u7981\u6b62\u589e\u76ca";break;case r.JXBtlBEM.BanIme:e="\u7981\u6b62\u514d\u75ab";break;case r.JXBtlBEM.BanAction:e="\u7981\u6b62\u884c\u52a8";break;case r.JXBtlBEM.ImDamage:e="\u514d\u75ab\u4f24\u5bb3";break;case r.JXBtlBEM.ImDeBuff:e="\u514d\u75ab\u51cf\u76ca";break;case r.JXBtlBEM.ImDeCtrl:e="\u514d\u75ab\u63a7\u5236";break;case r.JXBtlBEM.ClDamage:e="\u6e05\u9664\u4f24\u5bb3 ";break;case r.JXBtlBEM.ClDeBuff:e="\u6e05\u9664\u51cf\u76ca ";break;case r.JXBtlBEM.ClCtl:e="\u6e05\u9664\u63a7\u5236 ";break;case r.JXBtlBEM.ClAddHp:e="\u6e05\u9664\u6cbb\u7597 ";break;case r.JXBtlBEM.ClBuff:e="\u6e05\u9664\u589e\u76ca ";break;case r.JXBtlBEM.ClIm:e="\u6e05\u9664\u514d\u75ab ";break;case r.JXBtlBEM.RELife:e="* \u590d\u6d3b ";break;case r.JXBtlBEM.LockHp:e="\u751f\u547d\u9501\u5b9a ";break;case r.JXBtlBEM.ExEffect:e="\u6548\u679c\u5ef6\u957f ";break;case r.JXBtlBEM.Detonated:e="\u6548\u679c\u5f15\u7206 "}return"["+e+"]"},t.evtNames=((i={})[r.JXBattleEvt.START]="\u5f00\u59cb",i[r.JXBattleEvt.ROLE_BEGIN]="\u89d2\u8272\u5f00\u59cb\u884c\u52a8",i[r.JXBattleEvt.ROLE_SKILL_PREPARE]="\u89d2\u8272\u6280\u80fd\u8fdb\u5165\u51c6\u5907\u56de\u5408",i[r.JXBattleEvt.ROLE_SKILL_PRESS]="\u89d2\u8272\u91ca\u653e\u6280\u80fd",i[r.JXBattleEvt.ROLE_SKILL_PRESS_END]="\u89d2\u8272\u6280\u80fd\u91ca\u653e\u7ed3\u675f",i[r.JXBattleEvt.ROLE_SKILL_BREAK]="\u89d2\u8272\u6280\u80fd\u88ab\u6253\u65ad",i[r.JXBattleEvt.ROLE_COM_ATK]="\u89d2\u8272\u53d1\u8d77\u666e\u901a\u653b\u51fb",i[r.JXBattleEvt.ROLE_CONTRLED]="\u89d2\u8272\u88ab\u63a7\u5236",i[r.JXBattleEvt.ROLE_SKILL_HURT]="\u89d2\u8272\u53d7\u5230\u6280\u80fd\u653b\u51fb",i[r.JXBattleEvt.ROLE_SKILL_ADDHP]="\u89d2\u8272\u53d7\u5230\u56de\u8840",i[r.JXBattleEvt.ROLE_SKILL_ADDMAXHP]="\u89d2\u8272\u6700\u5927\u751f\u547d\u503c\u589e\u52a0",i[r.JXBattleEvt.ROLE_ATK_2_HP]="\u89d2\u8272\u5438\u8840",i[r.JXBattleEvt.ROLE_HURT_2_ATK]="\u89d2\u8272\u53cd\u5f39\u4f24\u5bb3",i[r.JXBattleEvt.ROLE_ATK_2_PROTECT]="\u89d2\u8272\u8f93\u51fa\u5438\u76fe",i[r.JXBattleEvt.ROLE_HURT_2_HP]="\u89d2\u8272\u53d7\u4f24\u56de\u8840",i[r.JXBattleEvt.ROLE_HURT_2_PROTECT]="\u89d2\u8272\u53d7\u4f24\u8f6c\u62a4\u76fe",i[r.JXBattleEvt.ROLE_ADD_BUFF]="\u89d2\u8272BUFF\u76ee\u6807\u9501\u5b9a",i[r.JXBattleEvt.ROLE_PREPARE_BUFF]="\u89d2\u8272BUFF\u51c6\u5907\u4e2d",i[r.JXBattleEvt.ROLE_REMOVE_BUFF]="\u89d2\u8272BUFF\u79fb\u9664",i[r.JXBattleEvt.ROLE_END]="\u89d2\u8272\u884c\u52a8\u7ed3\u675f",i[r.JXBattleEvt.ROLE_DIE]="\u89d2\u8272\u6b7b\u4ea1",i[r.JXBattleEvt.ROLE_RELIFE]="\u89d2\u8272\u590d\u6d3b",i[r.JXBattleEvt.CLEAR_LOCK_HP]="\u6e05\u9664\u9501\u8840\u72b6\u6001",i[r.JXBattleEvt.LOCK_HP_EFFECT]="\u5f53\u524d\u89d2\u8272\u9501\u8840\u4e2d",i[r.JXBattleEvt.LIFE_TIME_CHANGE]="BUFF\u6301\u7eed\u65f6\u95f4\u53d8\u66f4",i[r.JXBattleEvt.DETONATED_BUFF]="BUFF\u6548\u679c\u5f15\u7206",i[r.JXBattleEvt.HURT_BARKS]="\u8fdb\u653b\u519b\u8425",i[r.JXBattleEvt.END_FIGHT]="\u7ed3\u675f\u6218\u6597",i),t.skillTypeName=["\u5168\u5c40\u6280","\u4e3b\u52a8\u6280","\u88ab\u52a8\u6280","\u8ffd\u51fb\u6280","\u53cd\u51fb\u6280"],t.i18n=function(t){return t},t}();o.default=a,cc._RF.pop()},{"./JXBattleCb":"JXBattleCb","./JXBattleDefine":"JXBattleDefine"}],BattleViewCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"cfa39GTTstB8obo56b42biL","BattleViewCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/CoreDefine"),s=t("../../../Core/GView/GViewBase"),c=t("../../../Core/Manager/AudioMgr"),l=t("../../Common/UI"),u=t("../../Common/UIResources"),h=t("../../Logic/BtlMap/BtlCameraMap"),p=t("../../Logic/GameMgr"),d=t("./../../../Core/GCtrl"),f=t("./../../Common/Define"),g=cc._decorator,_=g.ccclass,m=g.property,y=g.menu,v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mapRoot=null,e._winArgs=null,e._secenId=null,e}return n(e,t),e.prototype.onGStart=function(t){this._winArgs=t;var e=this._winArgs;this._secenId=e.sceneId;var o;o=e.sceneId===f.PART_BTL_SCENE.GUANQIA?p.default.storyData.getRaw(e.args.level):p.default.towerData.getRaw(e.args.level);var i=u.Res.audio.battle+"battle_"+o.music;c.AudioMgr.Ins().playMusic(i),p.default.mapMgr.mapId=o.mapld,this.initMapLayer()},e.prototype.onGLoad=function(){d.GCtrl.ES.on(f.CMsg.client.fight_ui.onRetreatClick,this,this.onRetreatClick.bind(this),a.PRIORITY_VIEW),d.GCtrl.ES.on(f.CMsg.client.fight_ui.onFinishSettle,this,this.onRetreatClick.bind(this),a.PRIORITY_VIEW),this.node.setContentSize(d.GCtrl.actualSize)},e.prototype.initMapLayer=function(){var t=this;this.assetImpl.prefab(u.Res.prefab.vw.fight.mapLayer,function(e){if(t.isValid){t.mapRoot.destroyAllChildren();var o=cc.instantiate(e);t.mapRoot.addChild(o),o.setContentSize(cc.winSize);var i=o.getComponent(h.default);i.setBattle(t._winArgs),i.startLoadData()}})},e.prototype.onRetreatClick=function(){switch(this.onClose(),this._secenId){case f.PART_BTL_SCENE.GUANQIA:this._winArgs,p.default.jumpToMgr.jumpGoTo(l.VIEW_ID.mainPage);break;case f.PART_BTL_SCENE.ARENA:this._winArgs}},r([m(cc.Node)],e.prototype,"mapRoot",void 0),r([_,y("View/Fight/BattleViewCtrl")],e)}(s.default);o.default=v,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/GView/GViewBase":"GViewBase","../../../Core/Manager/AudioMgr":"AudioMgr","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Logic/BtlMap/BtlCameraMap":"BtlCameraMap","../../Logic/GameMgr":"GameMgr","./../../../Core/GCtrl":"GCtrl","./../../Common/Define":"Define"}],BattleViewPut:[function(t,e,o){"use strict";cc._RF.push(e,"feeabMpGbBLHIu9EAJ/ORMd","BattleViewPut");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},a=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a},s=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0});var c=t("../../../Core/GView/GViewBase"),l=t("../../../Core/Manager/AudioMgr"),u=t("../../Common/UIResources"),h=t("../../Logic/GameMgr"),p=t("../../../Core/GCtrl"),d=t("../../Common/Define"),f=t("../../Manager/RoleManager"),g=t("../../Entity/RoleScript"),_=t("../../Entity/RoleHead"),m=t("../../Common/UI"),y=t("../../../conventions/JXCommon"),v=t("../../../tyqSDK/tyqSDK"),C=t("../../Guide/GuideLogic"),I=t("../../Logic/SdkMgr"),E=t("../../Logic/UserMgr"),S=cc._decorator,R=S.ccclass,D=S.property,b=S.menu,w=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.enemyNode=null,e.armNode=null,e.uiRoot=null,e.enemyList=null,e.heroList=null,e.fightStart1=null,e.fightStart2=null,e.jiantou=null,e.btnExit=null,e.btnSkip=null,e._winArgs=null,e._secenId=null,e._cmdMgr=null,e._enemyListId=[2001,2002],e._heroListId=[1001,1002,1003,1004,1005],e._heroListData=[],e._enemyListData=[],e._fightInfoData=[],e._curFightEnemyRole=null,e._curFightHeroRole=null,e._curFightStep=0,e._curLevel=0,e._delayState=100,e._curGameState=o.state_stop,e._isFullPower=!1,e}var o;return n(e,t),o=e,e.prototype.onGStart=function(t){var e=this;this._winArgs=t;var o=this._winArgs;this._secenId=o.sceneId;var i=o.args.level;v.tyqSDK.eventLevelStart(i),this._isFullPower=o.args.isFullPower;var n=h.default.userMgr.getLevelRaw(i);this._enemyListId=n.monsterList,this._curLevel=i,this._heroListId=[],h.default.rHeroData.heroIdsInBattle.forEach(function(t){t>0&&e._heroListId.push(t)});var r=s(this._enemyListId,this._heroListId);f.default.getInstance().loadAllRoundAssets(r,this.onResLoaded.bind(this)),p.GCtrl.ES.on("fightViewClose",this,this.onViewClose.bind(this));var a=u.Res.audio.battle+"battle_"+(Math.floor(5*Math.random())+1);l.AudioMgr.Ins().playMusic(a),this.btnExit.active=!C.GuideLogic.ins().isGuidding(),this.btnSkip.active=!C.GuideLogic.ins().isGuidding(),this.btnSkip.getChildByName("icon_video").active=!h.default.lUserData.isVideoSkipGame},e.prototype.onViewClose=function(){this.onClose()},e.prototype.onGDestroy=function(){p.GCtrl.ES.off(this)},e.prototype.onResLoaded=function(){this.dealFightData(),this.initHeroList()},e.prototype.dealFightData=function(){var t=h.default.systemConfig.value(y.JXDef.SYS_CONFIG_KEY.basicsWheat);t+=h.default.lUserData.getUserBuff(d.BUFFINFO.InitBattlefieldRes);for(var e=h.default.RBagData.getMegreItems(d.CURRENCY.WHEAT,d.ITEM_TYPE.CURRENCY).num+t,o=0,i=0;i<this._heroListId.length&&e>0;i++){var n=this._heroListId[i],a=f.default.getInstance().getRolePowerProp(n),s=this._isFullPower?a[2]:Math.min(a[2],e);o+=s;var c={roleId:n,power:a,maxHp:s};this._isFullPower||(e-=Math.min(a[2],e)),p.GCtrl.ES.emit(d.CMsg.client.bag.onBagItemChange,[[d.CURRENCY.WHEAT,d.ITEM_TYPE.CURRENCY,0-Math.min(a[2],e)]]),this._heroListData.push(c)}var l=Math.min(o,h.default.RBagData.getMegreItems(d.CURRENCY.WHEAT,d.ITEM_TYPE.CURRENCY).num+t);p.GCtrl.ES.emit(d.CMsg.client.bag.onBagItemChange,[[d.CURRENCY.WHEAT,d.ITEM_TYPE.CURRENCY,0-l]]);var u=0,g=0,_=0,m=this.getEnemyData();if(m)m.forEach(function(t){t.maxHp<=0&&g++}),this._enemyListData=m;else{var v=h.default.userMgr.getLevelRaw(this._curLevel);for(i=0;i<this._enemyListId.length;i++)c={roleId:n=this._enemyListId[i],power:a=f.default.getInstance().getEnemyPowerProp(n,v.monsterLevel[i],v.powerPro[i]),maxHp:a[2]},this._enemyListData.push(c)}var C={fightStep:0,heroData:this.getCopyListData(this._heroListData),enemyData:this.getCopyListData(this._enemyListData),curFightEnemy:this._enemyListData[g]?r({},this._enemyListData[g]):null,curFightHero:this._heroListData[u]?r({},this._heroListData[u]):null,curHurt:[0,0]};for(this._fightInfoData.push(C);g<this._enemyListData.length&&u<this._heroListData.length;){_++;var I=this._enemyListData[g],E=this._heroListData[u],S=this.getCurHurt(E,I);(I.maxHp-=S[1])<=0&&g++,(E.maxHp-=S[0])<=0&&u++;var R={fightStep:_,heroData:this.getCopyListData(this._heroListData),enemyData:this.getCopyListData(this._enemyListData),curFightEnemy:this._enemyListData[g]?r({},this._enemyListData[g]):null,curFightHero:this._heroListData[u]?r({},this._heroListData[u]):null,curHurt:S};this._fightInfoData.push(R)}},e.prototype.getCurHurt=function(t,e){var o=f.default.getInstance().dealCurDamage(t.roleId,e.roleId,t.power,e.power),i=f.default.getInstance().dealCurDamage(e.roleId,t.roleId,e.power,t.power),n=Math.ceil(Math.min(t.maxHp/i,e.maxHp/o));return[i*n,o*n]},e.prototype.getCopyListData=function(t){var e=[];return t.forEach(function(t){e.push(r({},t))}),e},e.prototype.initHeroList=function(){for(var t=this,e=0;e<this._enemyListId.length;e++)(i=f.default.getInstance().createRoleHead(this._enemyListId[e])).parent=this.enemyList,i.opacity=0,i.x=120*e+120,i.name="enemy"+this._enemyListId[e],i.getComponent(_.default).setRoleId(2,this._enemyListId[e]),cc.tween(i).delay(.1*e).to(.3,{opacity:255,x:120*e}).start();for(e=0;e<this._heroListData.length;e++){var i;(i=f.default.getInstance().createRoleHead(this._heroListData[e].roleId)).parent=this.heroList,i.opacity=0,i.x=-120*e-120,i.name="hero"+this._heroListId[e],i.getComponent(_.default).setRoleId(1,this._heroListId[e]),cc.tween(i).delay(.1*e).to(.3,{opacity:255,x:-120*e}).start()}setTimeout(function(){t._delayState=80,t._curGameState=o.state_put,l.AudioMgr.Ins().playEffect(u.Res.audio.goBattle),t.fightStart1.active=!0,t.fightStart2.active=!0;var e=t.jiantou;cc.tween(t.fightStart1).set({x:-800}).to(.2,{x:0}).call(function(){e.active=!0}).delay(.7).to(.2,{x:800}).start(),cc.tween(t.fightStart2).set({x:800}).to(.2,{x:0}).delay(.7).to(.2,{x:-800}).start(),l.AudioMgr.Ins().playEffect(u.Res.audio.battle+"fighteffect")},1e3)},e.prototype.updateList=function(){var t=this._fightInfoData[this._curFightStep].enemyData,e=this._fightInfoData[this._curFightStep].heroData;if(null!=t&&null!=e){for(var o=0,i=0;i<t.length;i++){var n=t[i],r=this.enemyList.getChildByName("enemy"+n.roleId);n.maxHp<=0?(o+=120,r.getComponent(_.default).setState(_.default.State_Die)):this._fightInfoData[this._curFightStep].curFightEnemy&&n.roleId==this._fightInfoData[this._curFightStep].curFightEnemy.roleId?r.getComponent(_.default).setState(_.default.State_Fight):r.getComponent(_.default).setState(_.default.State_Wait)}for(cc.tween(this.enemyList).to(.2,{x:-o}).start(),o=0,i=0;i<e.length;i++)n=e[i],r=this.heroList.getChildByName("hero"+n.roleId),n.maxHp<=0?(o+=120,r.getComponent(_.default).setState(_.default.State_Die)):this._fightInfoData[this._curFightStep].curFightHero&&n.roleId==this._fightInfoData[this._curFightStep].curFightHero.roleId?r.getComponent(_.default).setState(_.default.State_Fight):r.getComponent(_.default).setState(_.default.State_Wait);cc.tween(this.heroList).to(.2,{x:o}).start()}},e.prototype.putUpRole=function(){if(null!=this._fightInfoData[this._curFightStep]){var t=this._fightInfoData[this._curFightStep].curFightEnemy,e=this._fightInfoData[this._curFightStep].curFightHero;if(null!=this._curFightEnemyRole&&this._curFightEnemyRole.getRoleHp()<=0&&(this._curFightEnemyRole.node.removeFromParent(),this._curFightEnemyRole=null),null!=this._curFightHeroRole&&this._curFightHeroRole.getRoleHp()<=0&&(this._curFightHeroRole.node.removeFromParent(),this._curFightHeroRole=null),e){if(null==this._curFightHeroRole){var i=f.default.getInstance().createRole(e.roleId,g.default.Type_Hero,e.maxHp,e.power);i.parent=this.armNode,this._curFightHeroRole=i.getComponent(g.default)}this._curFightHeroRole.setRoleReady()}if(t){if(null==this._curFightEnemyRole){var n=f.default.getInstance().createRole(t.roleId,g.default.Type_Enemy,t.maxHp,t.power);n.parent=this.enemyNode,this._curFightEnemyRole=n.getComponent(g.default)}this._curFightEnemyRole.setRoleReady()}this._delayState=30,this.updateList(),this._curFightStep++,this._curGameState=o.state_fight}else this._curGameState=o.state_end},e.prototype.dofight=function(){if(null!=this._fightInfoData[this._curFightStep]){if(this._curFightHeroRole.isReady()&&this._curFightEnemyRole.isReady()){l.AudioMgr.Ins().playEffect(u.Res.audio.battle+"daojian"),this._curFightHeroRole.setRoleState(g.default.State_Fight),this._curFightEnemyRole.setRoleState(g.default.State_Fight);var t=this._fightInfoData[this._curFightStep].curHurt,e=this._curFightHeroRole.setRoleBeAttacked(t[0]),i=this._curFightEnemyRole.setRoleBeAttacked(t[1]);if(this._delayState=120,null==this._fightInfoData[this._curFightStep+1])return this._delayState=100,void(this._curGameState=o.state_end);e<=0||i<=0?(this._delayState+=60,this._curGameState=o.state_put):this._curGameState=o.state_fight}}else this._curGameState=o.state_end},e.prototype.onGLoad=function(){},e.prototype.update=function(){var t=this;if(this._delayState>0)this._delayState--;else switch(this._curGameState){case o.state_stop:break;case o.state_put:this.putUpRole();break;case o.state_fight:this.dofight();break;case o.state_end:this.updateList(),this._curGameState=o.state_stop;var e={sceneId:this._secenId,isWin:null==this._fightInfoData[this._fightInfoData.length-1].curFightEnemy};e.isWin?(cc.sys.localStorage.removeItem("leveldata"+this._curLevel),l.AudioMgr.Ins().playEffect(u.Res.audio.nextWave),E.default.ins().addDailyTaskState(10,1)):this.saveEnemyData(),C.GuideLogic.ins().isGuidding()||I.default.ins._isWhitePag||v.tyqSDK.showInterstitialAd(),this.scheduleOnce(function(){t.bgImage.node.removeAllChildren(),h.default.jumpToMgr.jumpGoTo(m.VIEW_ID.battleResultView,t._secenId,t._curLevel,e,function(){p.GCtrl.ES.emit(d.CMsg.client.fight_ui.onFinishSettle,e)})},2)}},e.prototype.saveEnemyData=function(){cc.sys.localStorage.setItem("leveldata"+this._curLevel,JSON.stringify(this._enemyListData))},e.prototype.getEnemyData=function(){var t=cc.sys.localStorage.getItem("leveldata"+this._curLevel);return t?JSON.parse(t):null},e.prototype.onExitGame=function(){if(null==this._fightInfoData[this._curFightStep].curFightEnemy){cc.sys.localStorage.removeItem("leveldata"+this._curLevel);var t=h.default.lUserData.level;t++,h.default.lUserData.level=t}else cc.sys.localStorage.setItem("leveldata"+this._curLevel,JSON.stringify(this._fightInfoData[this._curFightStep].enemyData));p.GCtrl.ES.emit(d.CMsg.client.home.onChangeLevel),this.onClose()},e.prototype.onSkipGame=function(){if(h.default.lUserData.isVideoSkipGame)this.skipGame();else{var t=this;h.default.sdkMgr.watchAd(function(){h.default.lUserData.isVideoSkipGame=!0,t.skipGame()},null,"\u8df3\u8fc7\u6e38\u620f")}},e.prototype.skipGame=function(){var t={sceneId:this._secenId,isWin:null==this._fightInfoData[this._fightInfoData.length-1].curFightEnemy};t.isWin?(cc.sys.localStorage.removeItem("leveldata"+this._curLevel),l.AudioMgr.Ins().playEffect(u.Res.audio.nextWave)):this.saveEnemyData(),this.bgImage.node.removeAllChildren(),h.default.jumpToMgr.jumpGoTo(m.VIEW_ID.battleResultView,this._secenId,this._curLevel,t,function(){p.GCtrl.ES.emit(d.CMsg.client.fight_ui.onFinishSettle,t)})},e.state_stop=0,e.state_put=1,e.state_fight=2,e.state_end=3,a([D(cc.Node)],e.prototype,"enemyNode",void 0),a([D(cc.Node)],e.prototype,"armNode",void 0),a([D(cc.Node)],e.prototype,"uiRoot",void 0),a([D(cc.Node)],e.prototype,"enemyList",void 0),a([D(cc.Node)],e.prototype,"heroList",void 0),a([D(cc.Node)],e.prototype,"fightStart1",void 0),a([D(cc.Node)],e.prototype,"fightStart2",void 0),a([D(cc.Node)],e.prototype,"jiantou",void 0),a([D(cc.Node)],e.prototype,"btnExit",void 0),a([D(cc.Node)],e.prototype,"btnSkip",void 0),o=a([R,b("View/Fight/BattleViewCtrl")],e)}(c.default);o.default=w,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../../Core/GView/GViewBase":"GViewBase","../../../Core/Manager/AudioMgr":"AudioMgr","../../../conventions/JXCommon":"JXCommon","../../../tyqSDK/tyqSDK":"tyqSDK","../../Common/Define":"Define","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Entity/RoleHead":"RoleHead","../../Entity/RoleScript":"RoleScript","../../Guide/GuideLogic":"GuideLogic","../../Logic/GameMgr":"GameMgr","../../Logic/SdkMgr":"SdkMgr","../../Logic/UserMgr":"UserMgr","../../Manager/RoleManager":"RoleManager"}],BlessCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"1163etvqdtCqJJNRbmgU5Hu","BlessCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a},a=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0});var s=t("../../../conventions/JXCommon"),c=t("../../../Core/CoreDefine"),l=t("../../../Core/GCtrl"),u=t("../../../Core/GEvent/GParam"),h=t("../../../Core/GView/GListView"),p=t("../../../Core/GView/GViewBase"),d=t("../../../Core/Manager/AudioMgr"),f=t("../../../Core/Manager/UIMgr"),g=t("../../../Core/Math/MathEx"),_=t("../../Common/Define"),m=t("../../Common/Language"),y=t("../../Common/UI"),v=t("../../Common/UIResources"),C=t("../../Common/Zh"),I=t("../../Data/RunTime/RunRaw/RJXItem"),E=t("../../Entity/BlessJxItem"),S=t("../../Logic/GameMgr"),R=t("../../Logic/HeroMgr"),D=t("../../Logic/UserMgr"),b=t("../Common/TopUiItem"),w=t("../JXBattle/JXULDefine"),A=cc._decorator,T=A.ccclass,M=A.property,L=A.menu,P=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.equipView=null,e.synthesis=null,e.strengthen=null,e.view=null,e.content=null,e.equipArr=[],e.putArr=[],e.putResult=null,e.equip=null,e.attribute=null,e.numLab=null,e.blessImg=null,e.blessLv=[],e.strLab=null,e.strView=null,e.strRate=null,e.strAdRate=null,e.strAdRedRate=null,e.strcoinCount=null,e.strBtn=null,e.synthesisBtn=null,e.strEffect=null,e.synthesisEffectL=null,e.synthesisEffectR=null,e.backBtn=null,e._listView=null,e._IHeroData=null,e._isUseAdRate=!1,e._isAddAdRate=!1,e._readyBless=[],e._trait=1,e._equipItem=null,e._qhItem=null,e._checkCurIndex=0,e}return n(e,t),e.prototype.synthesisView=function(){this.synthesis.active=!0,this.strengthen.active=!1,this.equipArr[_.BLESS.BLESS4].active=!1,this.delEquip()},e.prototype.strengthenView=function(){this.synthesis.active=!1,this.strengthen.active=!0,this.equipArr[_.BLESS.BLESS4].active=!1,this.delEquip()},e.prototype.setRedPoint=function(){var t=this.checkCanSynthes();S.default.redMgr.setRPointView(this.synthesisBtn,this.synthesisBtn,t,_.RedpointEffect.REDPOINT)},e.prototype.delEquip=function(){this._readyBless=[],this.initEmbattle()},e.prototype.onGStart=function(t){l.GCtrl.ES.on(_.CMsg.client.equip.onBlessEquip,this,this.onBlessEquip.bind(this),c.PRIORITY_VIEW),l.GCtrl.ES.on(_.CMsg.client.equip.ondelEquip,this,this.initEmbattle.bind(this),c.PRIORITY_VIEW),l.GCtrl.ES.on(_.CMsg.client.equip.onBlessClearPut,this,this.clrearPut.bind(this),c.PRIORITY_VIEW),this._IHeroData=t;var e=S.default.lUserData.heroNames(this._IHeroData.tableId);S.default.sdkMgr.umaSetPoint(s.JXDef.umaPoint.blessEquip,{msg:e+"\u88c5\u5907"}),this.node.setContentSize(cc.winSize),this.initEmbattle(),this.setRedPoint(),this.synthesisView();var o,i=cc.view.getFrameSize(),n=cc.view.getDesignResolutionSize();o=i.width/i.height<=.5625?i.width/n.width:i.height/n.height,this.view.height=Math.min(472,i.height/o/2-568+440),this.backBtn.getComponent(b.default).onGStart()},e.prototype.close=function(){this.node.removeFromParent()},e.prototype.blessView=function(t,e){var o=this,i=this.equipArr[t.site].getChildByName("JXItem");i&&i.destroy(),this.assetImpl.prefab(v.Res.prefab.item.jxItem,function(i){o._readyBless[t.site]=t.equipId;var n=o.assetImpl.addGChild(i);if(e){var r=e.itemData;n.node.parent=o.equipArr[t.site],n.node.setPosition(0,0),2==t.site&&(n.node.setPosition(0,110),cc.tween(n.node).repeatForever(cc.tween(n.node).to(1,{position:cc.v2(0,150)}).to(1,{position:cc.v2(0,110)}).start()).start()),n.setView(r,_.ITEM_DETAIL_FLAG.NO_BG|_.ITEM_DETAIL_FLAG.BLESS|_.ITEM_DETAIL_FLAG.SCALEBLESSICON|_.ITEM_DETAIL_FLAG.FONTHECHENG,function(){},e.insId),n.setTouch(o._IHeroData,o.equipArr),n.eqlv1.node.active=!1}o.initEmbattle()})},e.prototype.onBlessEquip=function(t,e){var o=e.get(),i=S.default.RBagData.getEquipDataById(o.equipId),n=!1;if(o.site!=_.BLESS.BLESS3)if(o.site!=_.BLESS.BLESS2){var r=S.default.RBagData.getEquipDataById(this._readyBless[_.BLESS.BLESS0]),a=S.default.RBagData.getEquipDataById(this._readyBless[_.BLESS.BLESS1]);r&&o.site==_.BLESS.BLESS1&&r.quality==i.quality?(n=!0,this._trait=i.quality):a&&o.site==_.BLESS.BLESS0&&a.quality==i.quality?(n=!0,this._trait=i.quality):r||a||!i||(n=!0),n?this.blessView(o,i):S.default.uiMgr.showToast(C.JXLocales.tip.bless)}else this.blessView(o,i);else for(var s=0;s<this._readyBless.length;s++)if(this._readyBless[s]==o.equipId){this._readyBless[s]=null;var c=this.equipArr[s].getChildByName("JXItem");c&&(c.destroy(),this.initEmbattle())}},e.prototype.initView=function(){var t=this,e=null,o=null,i=null,n=null,r=null;if(this._readyBless[_.BLESS.BLESS0]&&null!=this._readyBless[_.BLESS.BLESS0]?(e=S.default.RBagData.getEquipDataById(this._readyBless[_.BLESS.BLESS0]))&&(this.blessLv[_.BLESS.BLESS0].string="LV:"+e.sLv):this.blessLv[_.BLESS.BLESS0].string="",this._readyBless[_.BLESS.BLESS1]&&null!=this._readyBless[_.BLESS.BLESS1]?(o=S.default.RBagData.getEquipDataById(this._readyBless[_.BLESS.BLESS1]))&&(this.blessLv[_.BLESS.BLESS1].string="LV:"+o.sLv):this.blessLv[_.BLESS.BLESS1].string="",this._readyBless[_.BLESS.BLESS2]&&null!=this._readyBless[_.BLESS.BLESS2]){if(i=S.default.RBagData.getEquipDataById(this._readyBless[_.BLESS.BLESS2]),this.strView.active=!0,i){i.sLv>0?this.strLab.string="+"+i.sLv+" "+i.itemData.raw.name:this.strLab.string=""+i.itemData.raw.name;var a=S.default.lvUpData.getRaw(i.sLv+1).odds;1==a?r="\u6210\u529f\u7387\uff1a100%":(n=a<1?(100*a).toFixed()+"%":a.toString(),r=m.L(C.JXLocales.bless["info"+_.BLESS.BLESS2],n));var c=new I.default(i.itemData.raw.expend);c.num+=1+S.default.lvUpData.getRaw(i.sLv+1).moneyUp;var l=S.default.lUserData.getUserBuff(_.BUFFINFO.strengthenResConsumption);l>0&&(c.num-=c.num*l),this.strcoinCount.string=Math.floor(c.num)+"";var u=S.default.systemConfig.value(s.JXDef.SYS_CONFIG_KEY.videoForging),h=u<1?(100*u).toFixed()+"%":u.toString();this.strAdRate.string=r,this.strAdRedRate.string="+"+h,this.strRate.string=r}}else this.strView.active=!1,this.strLab.string="",this.strRate.string="";if(e&&o){var p=S.default.systemConfig.value(s.JXDef.SYS_CONFIG_KEY.equipFitMoney)[this._trait-1];this.numLab.string=m.LCoin(p)+"",this.assetImpl.prefab(v.Res.prefab.item.jxItem,function(e){if(!t._qhItem){var o=t.assetImpl.addGChild(e);o.node.parent=t.synthesisBtn,o.node.setPosition(10,0),t._qhItem=o}var i=new I.default([100,3,p]);t._qhItem.setView(i,_.ITEM_DETAIL_FLAG.MATERIAL_STYLE_LINE|_.ITEM_DETAIL_FLAG.MATERIAL_NO_HAVE|_.ITEM_DETAIL_FLAG.NOT_TOUCH|_.ITEM_DETAIL_FLAG.FONTHECHENG)})}else this.blessImg.spriteFrame=null,this.numLab.string=""},e.prototype.adStrRate=function(){var t=this;this._isUseAdRate=!0,S.default.sdkMgr.watchAd(function(){t._isUseAdRate=!1,t._isAddAdRate=!0,t.strengthenClick()},function(){S.default.uiMgr.showToast("\u5e7f\u544a\u52a0\u8f7d\u5931\u8d25"),t._isAddAdRate=!1,t._isUseAdRate=!1})},e.prototype.initEmbattle=function(){var t=this;this._listView?this.dealWithData():this.assetImpl.prefab(v.Res.prefab.item.jxItem,function(e){t._listView=new h.GListView({scrollview:t.equipView,mask:t.view,content:t.content,itemTpl:cc.instantiate(e),itemSetter:t.onItemSetter.bind(t),column:5,row:3,gapY:15,gapX:15,padingY:10,padingX:25,isCbClass:!0,isWidget:!1}),t.dealWithData()})},e.prototype.onItemSetter=function(t,e){var o=this;if(e){var i=S.default.RBagData.getEquipDataById(e),n=i.itemData,r=null==this._equipItem||null!=this._equipItem&&n.raw.id==this._equipItem.raw.id&&this._equipItem.raw.trait==n.raw.trait&&this._equipItem.raw.lv==n.raw.lv;t.eqlv1.node.active=!1,t.setView(n,_.ITEM_DETAIL_FLAG.BLESS,function(){r&&o.itemTouch(e)},i.insId,!0),t.setGray(!r)}else t.eqlv1.node.active=!1,n=new I.default([0,0,0]),t.setView(n,_.ITEM_DETAIL_FLAG.NULLICON,null,null,!0),t.setGray(!1)},e.prototype.itemTouch=function(t){for(var e=this,o=null,i=0,n=0;n<3;n++)if(this.putArr[n].getComponent(E.default).getState()!=E.default.ItemPut){o=this.putArr[n],i=n;break}if(o){var r=S.default.RBagData.getEquipDataById(t),a=r.itemData;o.getComponent(E.default).showxItem(E.default.ItemPut,a,_.ITEM_DETAIL_FLAG.TPL,function(){e.unPutItem(i)},r.insId,!0),this._readyBless[i]=r.insId,this._equipItem=a,this.updatePutItemState();var c=this.getBlessResult(1);c&&this.putResult.getComponent(E.default).showxItem(E.default.ItemResult,c,_.ITEM_DETAIL_FLAG.NO_NUM|_.ITEM_DETAIL_FLAG.SHOWLIGHT,function(){e.clrearPut(),e.initEmbattle()}),this._trait=r.quality;var l=S.default.systemConfig.value(s.JXDef.SYS_CONFIG_KEY.equipFitMoney)[this._trait-1];this.numLab.string=m.LCoin(l)+""}},e.prototype.getBlessResult=function(t){var e=S.default.RBagData.getEquipDataById(this._readyBless[_.BLESS.BLESS0]),o=e.quality;++o>=_.SQUAD_BUTTON.SCHOLAR&&(o=_.SQUAD_BUTTON.SCHOLAR);var i=e.itemData.raw.lv,n=S.default.heroData.getRaw(this._IHeroData.tableId).type,r=S.default.equipData.getJackpot(n,this._IHeroData.tableId,i,i,o,1),a=null,c=[],l=e.itemData.raw.seat;r.forEach(function(t,e){t.seat==l&&c.push(t),e==r.length-1&&(a=c[0])});var u=S.default.systemConfig.value(s.JXDef.SYS_CONFIG_KEY.equipFitMoney)[o-1];return this.numLab.string=m.LCoin(u)+"",0==t?a:a?new I.default([a.id,e.itemData.type,1]):null},e.prototype.clrearPut=function(){this._equipItem=null,this._readyBless=[];for(var t=0;t<this.putArr.length;t++)this.putArr[t].getComponent(E.default).showxItem(E.default.ItemNull);this.putResult.getComponent(E.default).showxItem(E.default.ItemNull)},e.prototype.unPutItem=function(t){this.putArr[t].getComponent(E.default).showxItem(E.default.ItemNull),this._readyBless[t]=null,this.updatePutItemState()},e.prototype.updatePutItemState=function(){for(var t=null,e=0,o=0;o<3;o++)if(this.putArr[o].getComponent(E.default).getState()==E.default.ItemPut){t=this.putArr[o],e=o;break}if(t){var i=S.default.RBagData.getEquipDataById(this._readyBless[e]);if(i&&i.itemData)for(o=0;o<3;o++)this.putArr[o].getComponent(E.default).getState()!=E.default.ItemPut&&this.putArr[o].getComponent(E.default).showxItem(E.default.ItemTishi,i.itemData,_.ITEM_DETAIL_FLAG.TPL|_.ITEM_DETAIL_FLAG.BLESS,function(){},i.insId,!0)}else this.clrearPut();this.initEmbattle()},e.prototype.checkCanSynthes=function(){var t=S.default.RBagData.getHeroEquip(this._IHeroData.tableId),e=t.equip,o=t.book;e=this.isWear(e),o=this.isWear(o);for(var i=a(e,o),n=[],r=0;r<i.length;r++){var s=i[r],c=S.default.RBagData.getEquipDataById(s);n[c.equipId]||(n[c.equipId]=0),n[c.equipId]++}var l=!1;return n.forEach(function(t){if(t>=3)return l=!0,!0}),l},e.prototype.dealWithData=function(){var t=20,e=S.default.RBagData.getHeroEquip(this._IHeroData.tableId),o=e.equip,i=e.book;o=this.isWear(o);var n=this.synthesis.active;i=S.default.RBagData.getAllBook(n),i=this.isWear(i),t-=o.length,(t-=i.length)<0&&(t=0);var r=new Array(t),s=[R.IHeroSort.sortEquipZhanli],c=function(t,e){var o=S.default.RBagData.getEquipDataById(t),i=S.default.RBagData.getEquipDataById(e);return R.IHeroSort.sortsEquire(s,o,i)};o.sort(c),i.sort(c);var l=a(o,i,r);this._listView.setData(l)},e.prototype.isWear=function(t){for(var e=[],o=0;o<this._readyBless.length;o++)this._readyBless[o]&&null!=this._readyBless[o]&&e.push(this._readyBless[o]);return this.strengthen.active||this._IHeroData.equips.forEach(function(o){t.forEach(function(t){t==o&&e.push(t)})}),e.forEach(function(e){t.forEach(function(o,i){e==o&&t.splice(i,1)})}),t},e.prototype.synthesisTishi=function(){var t=S.default.RBagData.getHeroEquip(this._IHeroData.tableId),e=t.equip,o=t.book;e=this.isWear(e);var i=this.synthesis.active;o=S.default.RBagData.getAllBook(i),o=this.isWear(o);var n=a(e,o);if(this._readyBless[_.BLESS.BLESS0]&&this._readyBless[_.BLESS.BLESS1]&&this._readyBless[_.BLESS.BLESS2]){for(var r=0;r<3;r++)this.unPutItem(r);if(this._checkCurIndex>=n.length&&(this._checkCurIndex=0),this.checkCanTishi(n,this._checkCurIndex))return;0!=this._checkCurIndex&&this.checkCanTishi(n,0)}else{var s=this._readyBless[_.BLESS.BLESS0]||this._readyBless[_.BLESS.BLESS1]||this._readyBless[_.BLESS.BLESS2];if(s)for(var c=S.default.RBagData.getEquipDataById(s),l=0;l<n.length;l++){var u=n[l];S.default.RBagData.getEquipDataById(u).equipId==c.equipId&&this.itemTouch(u)}else this.checkCanTishi(n,0)||f.UIMgr.showToast("\u6ca1\u6709\u80fd\u591f\u5408\u6210\u7684\u88c5\u5907")}},e.prototype.checkCanTishi=function(t,e){for(var o=[],i=e;i<t.length;i++){var n=t[i],r=S.default.RBagData.getEquipDataById(n);if(o[r.equipId]||(o[r.equipId]=[]),o[r.equipId].push(r.insId),o[r.equipId].length>=3){for(var a=0;a<3;a++)this.itemTouch(o[r.equipId][a]);return this._checkCurIndex=i,!0}}return!1},e.prototype.synthesisClick=function(){if(this._readyBless[_.BLESS.BLESS2]&&this._readyBless[_.BLESS.BLESS0]&&this._readyBless[_.BLESS.BLESS1]&&null!=this._readyBless[_.BLESS.BLESS0]&&null!=this._readyBless[_.BLESS.BLESS1]&&null!=this._readyBless[_.BLESS.BLESS2]){var t=!1,e=S.default.systemConfig.value(s.JXDef.SYS_CONFIG_KEY.equipFitMoney)[this._trait-1],o=new I.default([_.CURRENCY.YUSHI,_.ITEM_TYPE.CURRENCY,e]),i=S.default.lUserData.getUserBuff(_.BUFFINFO.syntheticConsumptionRes);i>0&&(o.num-=o.num*i);var n=S.default.itemMgr.testCost(o,1,!0);if(n.enough?t=!0:S.default.uiMgr.showToast(n.tip),t){this.synthesisEffectL.node.active?(this.synthesisEffectL.node.x=0,this.synthesisEffectL.setAnimation(0,w.JXEBlessAniNames.hecheng,!1)):(this.synthesisEffectL.node.active=!0,this.synthesisEffectL.setAnimation(0,w.JXEBlessAniNames.hecheng,!1));var r=S.default.RBagData.getEquipDataById(this._readyBless[_.BLESS.BLESS0]),a=S.default.RBagData.getEquipDataById(this._readyBless[_.BLESS.BLESS1]),c=S.default.RBagData.getEquipDataById(this._readyBless[_.BLESS.BLESS2]);if(!r||!a||!c)return void S.default.uiMgr.showToast(C.JXLocales.tip.result);var u=this.getBlessResult(0);if(u){var h={id:u.id,slv:r.sLv,type:_.ITEM_TYPE.EQUIPDATA,num:1};this.scheduleOnce(function(){l.GCtrl.ES.emit(_.CMsg.client.equip.AddSynthesisEquip,h),l.GCtrl.ES.emit(_.CMsg.client.equip.ondelEquip,this._readyBless[_.BLESS.BLESS0]),l.GCtrl.ES.emit(_.CMsg.client.equip.ondelEquip,this._readyBless[_.BLESS.BLESS1]),l.GCtrl.ES.emit(_.CMsg.client.equip.ondelEquip,this._readyBless[_.BLESS.BLESS2]),this._equipItem=null,this.initEmbattle(),this.setRedPoint()},.8),l.GCtrl.ES.emit(_.CMsg.client.bag.onBagItemChange,[[_.CURRENCY.YUSHI,_.ITEM_TYPE.CURRENCY,-e]]),D.default.ins().addDailyTaskState(9,1)}else S.default.uiMgr.showToast(C.JXLocales.tip.result)}this.setRedPoint()}else S.default.uiMgr.showToast(C.JXLocales.tip.noEnoughtBless)},e.prototype.strengthenClick=function(){if(this._readyBless[_.BLESS.BLESS2]){var t=S.default.RBagData.getEquipDataById(this._readyBless[_.BLESS.BLESS2]),e=!1;if(t.itemData.raw.type==_.BLESS.BLESS0){var o=new I.default(t.itemData.raw.expend);o.num+=1+S.default.lvUpData.getRaw(t.sLv+1).moneyUp;var i=S.default.lUserData.getUserBuff(_.BUFFINFO.strengthenResConsumption);i>0&&(o.num-=o.num*i),o.num=Math.floor(o.num);var n=S.default.itemMgr.testCost(o,1,!0);if(n.enough?e=!0:this._isAddAdRate?e=!0:S.default.uiMgr.showToast(n.tip),e&&!this._isUseAdRate){this.strEffect.node.active?this.strEffect.setAnimation(0,w.JXEBlessAniNames.animation,!1):this.strEffect.node.active=!0;var r=S.default.lvUpData.getRaw(t.sLv+1).odds,a=[];S.default.heroData.getRaw(this._IHeroData.tableId),this._isAddAdRate&&(r+=S.default.systemConfig.value(s.JXDef.SYS_CONFIG_KEY.videoForging));var c=100-(r*=100);if(c>0)for(var h=0;h<c;h++)a.push(_.BLESS.BLESS0);for(var p=0;p<r;p++)a.push(_.BLESS.BLESS1);if((a=g.default.fisherYatesShuffle(a))[Math.floor(Math.random()*a.length)]==_.BLESS.BLESS1){d.AudioMgr.Ins().playEffect(v.Res.audio.qh);var f={equipId:this._readyBless[_.BLESS.BLESS2],exp:1};d.AudioMgr.Ins().playEffect(v.Res.audio.qhSuc),l.GCtrl.ES.emit(_.CMsg.client.equip.onAddEquipSlv,new u.default(f)),this._isAddAdRate||l.GCtrl.ES.emit(_.CMsg.client.bag.onBagItemChange,[[o.id,o.type,-o.num]]),S.default.jumpToMgr.jumpGoTo(y.VIEW_ID.strengthenView,t,_.BLESSEND_INFO.strSus),this.setRedPoint(),this.initView()}else{d.AudioMgr.Ins().playEffect(v.Res.audio.qh);var m=S.default.lvUpData.getRaw(t.sLv).levelOff;f={equipId:this._readyBless[_.BLESS.BLESS2],exp:-m},l.GCtrl.ES.emit(_.CMsg.client.equip.onAddEquipSlv,new u.default(f)),S.default.uiMgr.showToast(C.JXLocales.tip.blessLose),S.default.jumpToMgr.jumpGoTo(y.VIEW_ID.strengthenView,t,_.BLESSEND_INFO.strFail),this.initView()}}}else S.default.uiMgr.showToast(C.JXLocales.tip.unBless)}},r([M({type:cc.ScrollView,tooltip:"\u88c5\u5907\u89c6\u56fe"})],e.prototype,"equipView",void 0),r([M({type:cc.Node,tooltip:"\u5408\u6210\u89c6\u56fe"})],e.prototype,"synthesis",void 0),r([M({type:cc.Node,tooltip:"\u5f3a\u5316\u89c6\u56fe"})],e.prototype,"strengthen",void 0),r([M({type:cc.Node,tooltip:"\u53ef\u89c6\u533a\u57df"})],e.prototype,"view",void 0),r([M({type:cc.Node,tooltip:"\u88c5\u5907\u5b58\u653e\u8282\u70b9"})],e.prototype,"content",void 0),r([M({type:cc.Node,tooltip:"\u62d6\u62fd\u4f4d\u7f6e"})],e.prototype,"equipArr",void 0),r([M({type:cc.Node,tooltip:"\u5408\u6210\u4f4d\u7f6e"})],e.prototype,"putArr",void 0),r([M({type:cc.Node,tooltip:"\u5408\u6210\u4f4d\u7f6e"})],e.prototype,"putResult",void 0),r([M({type:cc.Node})],e.prototype,"equip",void 0),r([M({type:cc.Node})],e.prototype,"attribute",void 0),r([M({type:cc.Label,tooltip:"\u5408\u6210\u91d1\u5e01\u6570\u91cf"})],e.prototype,"numLab",void 0),r([M({type:cc.Sprite,tooltip:"\u5408\u6210\u91d1\u5e01\u56fe\u7247"})],e.prototype,"blessImg",void 0),r([M({type:cc.Label,tooltip:"\u5408\u6210\u7b49\u7ea7"})],e.prototype,"blessLv",void 0),r([M({type:cc.Label,tooltip:"\u5f3a\u5316\u7b49\u7ea7 + \u88c5\u5907\u540d\u5b57"})],e.prototype,"strLab",void 0),r([M({type:cc.Node,tooltip:"\u5f3a\u5316\u4fe1\u606f\u9762\u677f"})],e.prototype,"strView",void 0),r([M({type:cc.Label,tooltip:"\u5f3a\u5316\u6210\u529f\u7387"})],e.prototype,"strRate",void 0),r([M({type:cc.Label,tooltip:"\u89c2\u770b\u89c6\u9891+\u5f3a\u5316\u6210\u529f\u7387"})],e.prototype,"strAdRate",void 0),r([M({type:cc.Label,tooltip:"\u89c2\u770b\u89c6\u9891+\u5f3a\u5316\u6210\u529f\u7387"})],e.prototype,"strAdRedRate",void 0),r([M({type:cc.Label,tooltip:"\u5f3a\u5316\u91d1\u5e01\u6570\u91cf"})],e.prototype,"strcoinCount",void 0),r([M({type:cc.Node,tooltip:"\u5f3a\u5316\u6309\u94ae"})],e.prototype,"strBtn",void 0),r([M({type:cc.Node,tooltip:"\u5408\u6210\u6309\u94ae"})],e.prototype,"synthesisBtn",void 0),r([M({type:sp.Skeleton,tooltip:"\u5f3a\u5316\u7279\u6548"})],e.prototype,"strEffect",void 0),r([M({type:sp.Skeleton,tooltip:"\u5408\u6210\u7279\u6548"})],e.prototype,"synthesisEffectL",void 0),r([M({type:sp.Skeleton,tooltip:"\u5408\u6210\u7279\u6548"})],e.prototype,"synthesisEffectR",void 0),r([M({type:cc.Node})],e.prototype,"backBtn",void 0),r([T,L("View/Home/BlessCtrl")],e)}(p.default);o.default=P,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/GCtrl":"GCtrl","../../../Core/GEvent/GParam":"GParam","../../../Core/GView/GListView":"GListView","../../../Core/GView/GViewBase":"GViewBase","../../../Core/Manager/AudioMgr":"AudioMgr","../../../Core/Manager/UIMgr":"UIMgr","../../../Core/Math/MathEx":"MathEx","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/Language":"Language","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Common/Zh":"Zh","../../Data/RunTime/RunRaw/RJXItem":"RJXItem","../../Entity/BlessJxItem":"BlessJxItem","../../Logic/GameMgr":"GameMgr","../../Logic/HeroMgr":"HeroMgr","../../Logic/UserMgr":"UserMgr","../Common/TopUiItem":"TopUiItem","../JXBattle/JXULDefine":"JXULDefine"}],BlessJxItem:[function(t,e,o){"use strict";cc._RF.push(e,"abe06wmuzhCk630ksL4wo3R","BlessJxItem");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../Core/GLoader/GLoader"),s=t("../Common/Define"),c=t("../Common/UIResources"),l=t("../Views/Common/JXItem"),u=cc._decorator,h=u.ccclass,p=(u.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._state=o.ItemNull,e._jxitem=null,e}var o;return n(e,t),o=e,Object.defineProperty(e.prototype,"assetImpl",{get:function(){return this._assetImpl||(this._assetImpl=a.GAssetImpl.getAssetImpl(cc.js.getClassName(this))),this._assetImpl},enumerable:!1,configurable:!0}),e.prototype.start=function(){var t=this;this.assetImpl.prefab(c.Res.prefab.item.jxItem,function(e){var o=cc.instantiate(e);o.parent=t.node,t._jxitem=o.getComponent(l.default)}),this.node.opacity=0},e.prototype.setJxitem=function(t,e,o,i,n,r){var a=this;void 0===e&&(e=s.ITEM_DETAIL_FLAG.TPL),void 0===n&&(n=!1),void 0===r&&(r=!1),this.assetImpl.prefab(c.Res.prefab.item.jxItem,function(s){var c=cc.instantiate(s);c.parent=a.node;var u=c.getComponent(l.default);u.eqlv1.node.active=!1,u.setView(t,e,o,i,n),a._jxitem=u,a._jxitem.setGray(r)})},e.prototype.showxItem=function(t,e,i,n,r,a){void 0===i&&(i=s.ITEM_DETAIL_FLAG.TPL),void 0===a&&(a=!1),this._state=t,this._state!=o.ItemNull?(this._state==o.ItemTishi?(this.node.opacity=255,this._jxitem&&this._jxitem.setGray(!0)):this._state==o.ItemPut?(this.node.opacity=255,this._jxitem&&this._jxitem.setGray(!1)):this._state==o.ItemResult&&(this.node.opacity=255,this.node.scale=1.2,this._jxitem&&this._jxitem.setGray(!1)),this._jxitem?this._jxitem.setView(e,i,n,r,a):this.setJxitem(e,i,n,r,a,this._state==o.ItemTishi)):this.node.opacity=0},e.prototype.getState=function(){return this._state},e.ItemNull=1,e.ItemTishi=2,e.ItemPut=3,e.ItemResult=4,o=r([h],e)}(cc.Component));o.default=p,cc._RF.pop()},{"../../Core/GLoader/GLoader":"GLoader","../Common/Define":"Define","../Common/UIResources":"UIResources","../Views/Common/JXItem":"JXItem"}],BoxItem:[function(t,e,o){"use strict";cc._RF.push(e,"75680JtgVlIhoNwB4WZ1yoo","BoxItem");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/GCtrl"),c=t("../../../Core/GView/GChild"),l=t("../../Common/Define"),u=t("../../Common/Language"),h=t("../../Common/UI"),p=t("../../Common/UIResources"),d=t("../../Common/Zh"),f=t("../../Logic/GameMgr"),g=cc._decorator,_=g.ccclass,m=g.property,y=g.menu,v=(g.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boxLevel=null,e.boxImg=null,e.receive=null,e.box=null,e.curChapter=0,e.levelStr=1,e._index=null,e._curLevel=1,e}return n(e,t),e.prototype.initBox=function(t,e,o,i){var n=this;this._index=e,this.levelStr=i,this.curChapter=o,this.boxLevel.string="\u7b2c"+e+"\u5173",this._data=t;var r=f.default.lUserData.level,a=f.default.lUserData.chapterBoxArr,s=!1;a.length>0?a.forEach(function(e){s||(e==n._data.id?(s=!0,n.boxImg.node.getComponent(cc.Button).interactable=!1,n.showImg(l.CHAPTERBOX.receive)):t.id<=r?(n.showImg(l.CHAPTERBOX.lock),n.boxImg.node.getComponent(cc.Button).interactable=!0):t.id>r&&(n.showImg(l.CHAPTERBOX.unLock),n.boxImg.node.getComponent(cc.Button).interactable=!1))}):t.id<=r?(this.showImg(l.CHAPTERBOX.lock),this.boxImg.node.getComponent(cc.Button).interactable=!0):t.id>r&&(this.showImg(l.CHAPTERBOX.unLock),this.boxImg.node.getComponent(cc.Button).interactable=!1)},e.prototype._onTouchStar0=function(){var t=f.default.userMgr.getLevelRaw(this._curLevel);f.default.jumpToMgr.jumpGoTo(h.VIEW_ID.previewCtrl,t,l.BOXPREVIEW.LEVELBOX)},e.prototype.initBox2=function(t){this._curLevel=t,this.boxLevel.string="\u7b2c"+t+"\u5173",this.boxImg.node.getComponent(cc.Button).interactable=!1,t>f.default.lUserData.level+1?this.showImg(l.CHAPTERBOX.unLock):t==f.default.lUserData.level+1?this.showImg(l.CHAPTERBOX.lock):this.showImg(l.CHAPTERBOX.receive)},e.prototype.showImg=function(t){var e=this;switch(t){case l.CHAPTERBOX.unLock:this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStar0,this),this.assetImpl.spriteAtlasFrame(this.boxImg,p.Res.texture.views.mainUi,"levelsuo"),this.receive.active=!1;break;case l.CHAPTERBOX.lock:this.receive.active=!1,this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStar0,this),this.schedule(function(){e.box.play()},2),this.assetImpl.spriteAtlasFrame(this.boxImg,p.Res.texture.views.mainUi,"levelcur");break;case l.CHAPTERBOX.receive:this.boxImg.node.getComponent(cc.Animation).stop(),this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchStar0,this),this.receive.active=!0,this.boxImg.spriteFrame=null}},e.prototype.receiveBox=function(){var t=f.default.lUserData.chapterBoxArr;t.push(this._data.id),f.default.lUserData.chapterBoxArr=t,f.default.jumpToMgr.jumpGoTo(h.VIEW_ID.rewardCtrl,this._data.sectionBox),s.GCtrl.ES.emit(l.CMsg.client.home.onaddLevel),f.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.mainBox,{msg:u.L(d.JXLocales.tower["mainBox"+this.curChapter],"+"+this._index)})},r([m({type:cc.Label,tooltip:"\u5b9d\u7bb1\u6240\u5728\u5173\u5361"})],e.prototype,"boxLevel",void 0),r([m({type:cc.Sprite,tooltip:"\u5b9d\u7bb1\u56fe\u7247"})],e.prototype,"boxImg",void 0),r([m({type:cc.Node,tooltip:"\u5b9d\u7bb1\u56fe\u7247"})],e.prototype,"receive",void 0),r([m({type:cc.Animation,tooltip:"\u5b9d\u7bb1\u6643\u52a8"})],e.prototype,"box",void 0),r([_,y("View/Home/BoxItem")],e)}(c.default));o.default=v,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../../Core/GView/GChild":"GChild","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/Language":"Language","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Common/Zh":"Zh","../../Logic/GameMgr":"GameMgr"}],BtHeroHurt:[function(t,e,o){"use strict";cc._RF.push(e,"fe6b8ZFmxFBBoB1JZP+kbMn","BtHeroHurt");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GView/GChild"),s=t("../../Common/UIResources"),c=t("../../Logic/GameMgr"),l=t("./JXResultHero"),u=cc._decorator,h=u.ccclass,p=u.property,d=u.menu,f=(u.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.icon=null,e.hurtNum=null,e.heroName=null,e._ans=null,e._heroId=null,e._show=!1,e}return n(e,t),e.prototype.setView=function(t,e,o){if(!c.default.rHeroData.getHero(t))return this.node.removeFromParent(),void this.node.destroy();this._heroId=t,this._heroId==o&&(this._show=!0),this._ans=e,this.setHeroHead()},e.prototype.setHeroHead=function(){var t=this;this.assetImpl.prefab(s.Res.prefab.vw.fight.resultHero,function(e){t._ans.defTPL.partnerData.forEach(function(o){if(o.tableId==t._heroId){var i=cc.instantiate(e),n=i.getComponent(l.default),r=t._ans.heroHurdInfo.get(o.tableId),a={coin:(r=r||0).toString(),add:r.toString()},s=c.default.heroData.getRaw(o.tableId).name;t.heroName.string=s+"",t.onAddCoin(a),n.setView(o.tableId,0),n.closeExp(),t._show&&n.showKing(),t.icon.addChild(i)}})})},e.prototype.onAddCoin=function(t){var e=this,o=parseInt(t.coin)-parseInt(t.add);this.hurtNum.string=""+t.coin,cc.tween({a:0}).to(.3,{a:100},{progress:function(i,n,r,a){e.node&&(e.hurtNum.string=o+Math.floor(parseFloat(t.add)*a)+"")}}).start()},r([p({type:cc.Node,tooltip:"\u82f1\u96c4\u5934\u50cf"})],e.prototype,"icon",void 0),r([p(cc.Label)],e.prototype,"hurtNum",void 0),r([p(cc.Label)],e.prototype,"heroName",void 0),r([h,d("View/Fight/BtHeroHurt")],e)}(a.default));o.default=f,cc._RF.pop()},{"../../../Core/GView/GChild":"GChild","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr","./JXResultHero":"JXResultHero"}],BtlCameraMap:[function(t,e,o){"use strict";cc._RF.push(e,"011b5sPvS1HKInlRG2Jj44l","BtlCameraMap");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a,s=t("../../../Core/FrameEx/ES5Ex"),c=t("../../../Core/GView/GChild"),l=t("../../../Core/Manager/GNodePool"),u=t("../../../Core/Math/MathEx"),h=t("../../Common/Define"),p=t("../../Common/UIResources"),d=t("../GameMgr"),f=t("./../../../Core/CoreDefine"),g=t("./../../../Core/GCtrl"),_=t("./../../Common/Define"),m=t("./BtlFighltLayer"),y=t("./BtlMapCanverts"),v=t("./BtlMapElement"),C=t("./BtlMapParser"),I=t("./BtlMapTouchLayer"),E=function(t){function e(e,o){var i=t.call(this,e)||this;return i._opt=o,i}return n(e,t),e.prototype.syncCreate=function(){var t=new cc.Node;return this._opt.size&&t.setContentSize(this._opt.size),this._opt.anchor&&t.setAnchorPoint(this._opt.anchor),t},e.prototype.asyncCreate=function(t){t(this.syncCreate())},e}(l.GNodePool),S=function(t){function e(e,o){var i=t.call(this,e)||this;return i._opt=o,i}return n(e,t),e.prototype.syncCreate=function(){var t=new cc.Node,e=t.addComponent(cc.Sprite);return this._opt.size&&t.setContentSize(this._opt.size),this._opt.anchor&&t.setAnchorPoint(this._opt.anchor),null!=this._opt.type&&(e.type=this._opt.type),null!=this._opt.sizeMode&&(e.sizeMode=this._opt.sizeMode),null!=this._opt.trim&&(e.trim=this._opt.trim),null!=this._opt.src&&(e.srcBlendFactor=this._opt.src),t},e.prototype.asyncCreate=function(t){t(this.syncCreate())},e}(l.GNodePool),R=2e3;(function(t){t[t.VSIdle=0]="VSIdle",t[t.VSInit=1]="VSInit",t[t.VSUpdate=2]="VSUpdate"})(a||(a={}));var D=cc._decorator,b=D.ccclass,w=D.property,A=D.menu,T=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.camera=null,e.objectLayer=null,e.UIRoot2d=null,e.mapLayer=null,e.touchLayer=null,e.fightLayer=null,e.ground=null,e.border=null,e.bottom=null,e.mapGridSize=cc.size(0),e.heroLayer=null,e.wheat=null,e.level=null,e.bool=null,e.wave=null,e.close=null,e._initFlag=0,e._touchLayer=null,e._fightLayer=null,e._layers=new s.MapWrap,e._layerPools=new s.MapWrap,e._unitSize=null,e._gridSize=null,e._visitRect=null,e._drawState=a.VSIdle,e._elementComponents=new s.MapWrap,e._recoverComponents=new Array,e._parser=null,e.mapRaw=null,e.mapStyle=null,e._click=!1,e._touch=!1,e._bMove=!1,e._touchDrawDelta=cc.Vec2.ZERO,e._lastTouchTimes=[],e._lastTouchPoints=[],e._staticCheckTimer=-1,e._speed=0,e._moveDelta=cc.v2(0,0),e._bSpeedAddState=!1,e._acceleration=R,e._winArgs=null,e._spritePool=new cc.NodePool,e._NodePool=new cc.NodePool,e}return n(e,t),Object.defineProperty(e.prototype,"mapSize",{get:function(){return this._mapSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitSize",{get:function(){return this._unitSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gridSize",{get:function(){return this._gridSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"visitRect",{get:function(){return this._visitRect},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"convert",{get:function(){return this._convert},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"static",{get:function(){return this._parser},set:function(t){this._parser=t,this._initConfigure()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"touch",{get:function(){return this._touch},enumerable:!1,configurable:!0}),e.prototype.onGLoad=function(){var t=d.default.mapMgr.mapId;this.mapRaw=d.default.mapData.getRaw(t),this.mapStyle=d.default.mapStyle.getRaw(this.mapRaw.style),this.assetImpl.spriteFrame(this.bottom,p.Res.bigpic.map+"bottom"+this.mapStyle.id),this.assetImpl.spriteFrame(this.ground,p.Res.bigpic.map+"ground"+this.mapStyle.id),this.assetImpl.spriteFrame(this.border,p.Res.bigpic.map+"border"+this.mapStyle.id)},e.prototype.startLoadData=function(){var t=this,e="map/mapData"+this.mapRaw.map;this._parser=new C.BtlMapParser(e,function(e,o,i){e===C.MapParseProgress.MPP_LoadMapData&&o===C.MapParseStatus.MPS_LoadSuccess&&(t.static=i,t.allReady(1),t._fightLayer.fightInit(t._winArgs,function(e){t._cmdMgr=e,t.allReady(4)}))},this.assetImpl),this._parser.loadMapData(),d.default.mapMgr._fsMapPatser=this._parser},e.prototype.setBattle=function(t){if(this._fightLayer=this.fightLayer.addComponent(m.default),this._fightLayer.heroContent=this.heroLayer,this._fightLayer.wheatNode=this.wheat.node.parent,this._fightLayer.bool=this.bool,this._fightLayer.level=this.level,this._winArgs=t,t.sceneId===h.PART_BTL_SCENE.GUANQIA){var e=t,o=d.default.lUserData.level<1,i=d.default.lUserData.level<2;(1===e.args.level&&o||2===e.args.level&&i)&&(this.close.active=!1)}},e.prototype.start=function(){this.allReady(2)},e.prototype.onGDestroy=function(){this._recoverComponents.forEach(function(t){t.layerElements.values().forEach(function(t){t.destroy()})});for(var t=0;t<this._spritePool.size();t++)this._spritePool.get().destroy();for(t=0;t<this._NodePool.size();t++)this._NodePool.get().destroy()},e.prototype.update=function(){this._drawState&&this._drawElement()},e.prototype.changeWeathNum=function(){this.wheat.string=this._cmdMgr.wheat.toString()},e.prototype.onRetreatClick=function(){g.GCtrl.ES.emit(_.CMsg.client.fight_ui.onRetreatClick)},e.prototype._initConfigure=function(){this._mapSize=this._parser.mapSize,this._unitSize=this._parser.unitSize,this._gridSize=this._parser.gridSize;var t=cc.winSize;this._visitRect=cc.rect(.25*-t.width,.25*-t.height,1.5*cc.winSize.width,1.5*cc.winSize.height),this._convert=new y.default(this.objectLayer,cc.v2(this.gridSize.width/2,this.gridSize.height/2),this._mapSize,null,this._unitSize)},e.prototype.allReady=function(t){this._initFlag|=t,7==this._initFlag&&(this._initTouchEvent(),this._initEvent(),this._cmdMgr.btlCameraMap=this,this._cmdMgr.btlMapConverts=this.convert,this._cmdMgr._wave=this.wave,this._drawState=a.VSInit,this._cmdMgr.startCmd())},e.prototype._initEvent=function(){g.GCtrl.ES.on(_.CMsg.client.fight_ui.selectItem,this,this.setGridSelect.bind(this),f.PRIORITY_VIEW),g.GCtrl.ES.on(_.CMsg.client.fight_ui.hideAllItem,this,this.hideAll.bind(this),f.PRIORITY_VIEW),g.GCtrl.ES.on(_.CMsg.client.fight_ui.onWheatChange,this,this.changeWeathNum.bind(this))},e.prototype._initTouchEvent=function(){var t=this.touchLayer.addComponent(I.default);t.map=this,this._touchLayer=t},e.prototype.getNodeFromPool=function(t){switch(t){case h.MapLayer.MLMaterial:if(this._spritePool.size())return this._spritePool.get();var e=new cc.Node;return e.addComponent(cc.Sprite),e.scale=this._parser.itemsScale,e}},e.prototype.recoverNodeToPool=function(t){switch(t.removeFromParent(),Number(t.name)){case h.MapLayer.MLMaterial:t.scaleY=1,t.scaleX=1,t.zIndex=0,t.getComponent(cc.Sprite).spriteFrame=null,this._spritePool.put(t)}},e.prototype._drawElement=function(){this._drawState==a.VSInit?this._initVisited():this._drawState==a.VSUpdate&&(this._recoverVisited(),this._initVisited()),this._drawState=a.VSIdle},e.prototype._initVisited=function(){var t=this,e=this.getMVisitVerts();this._lastVerts=e,this.miniTcgPos=e[0],u.default.getViewRectangleCoods(e,function(e){if(!(e.x>t.mapSize.width-1||e.y>t.mapSize.height-1||e.x<0||e.y<0)){var o=t.static.getElementData(e);if(o){var i=t._elementComponents.get(o.id);if(i)return;(i=t.createElement(o.zIndex)).tcgPos=e,i.id=o.id,i.data=o,t._elementComponents.set(o.id,i),t._onElementActive(i)}}}),this._flags&&this._cmdMgr.jxBtlAns.setFalgs(this._flags)},e.prototype.createElement=function(t){var e=[h.MapLayer.MLGrid,h.MapLayer.MLMaterial,h.MapLayer.MLEffect_2],o=this._recoverComponents.pop();o||(o=new v.default(this.assetImpl)),o.cameraMap=this;for(var i=0;i<e.length;i++){var n=this._getLayerPool$Create(e[i]).pop();n.zIndex=t+i;var r=e[i];o.layerElements.set(r,n)}return o},e.prototype._recoverVisited=function(){var t=this;this._elementComponents.rforEach(function(e,o){var i=e.rect();t._visitRect.intersects(i)||t.recoverItem(e,o)})},e.prototype.recoverItem=function(t,e){var o=this;t.onRecover(),t.layerElements.forEach(function(t,e){o.getLayerPool(e).push(t)}),t.layerElements.clear(),this._recoverComponents.push(t),this._elementComponents.delete(e)},e.prototype._onElementActive=function(t){t.onActive()},e.prototype.getMVisitVerts=function(){return[this.n2m(cc.v2(this._visitRect.xMin,this._visitRect.yMax),!0),this.n2m(cc.v2(this._visitRect.xMin,this._visitRect.yMin),!0),this.n2m(cc.v2(this._visitRect.xMax,this._visitRect.yMin),!0),this.n2m(cc.v2(this._visitRect.xMax,this._visitRect.yMax),!0)]},e.prototype.n2m=function(t,e){return this._convert.converToMapPos(t,e)},e.prototype.m2w=function(t){var e=this.m2n(t);return this.node.convertToWorldSpaceAR(e)},e.prototype.m2n=function(t,e){return this._convert.converToCCPos(t,e)},e.prototype._getLayerPool$Create=function(t){if(t!=h.MapLayer.MLTouch&&t!=h.MapLayer.MElementUI&&t!=h.MapLayer.MLEffect_1){var e=this._layerPools.get(t);if(!e){switch(t){case h.MapLayer.MLEffect_2:case h.MapLayer.MLGrid:e=new S(this._getLayer$Create(t),{type:cc.Sprite.Type.SIMPLE,sizeMode:cc.Sprite.SizeMode.CUSTOM,trim:!0,size:new cc.Size(this.gridSize.width,this.gridSize.height),anchor:cc.v2(.5,.5)});break;case h.MapLayer.MLMaterial:e=new E(this._getLayer$Create(t),{size:new cc.Size(this.gridSize.width,this.gridSize.height),anchor:cc.v2(.5,.5)})}this._layerPools.set(t,e)}return e}},e.prototype.getLayerPool=function(t){return this._layerPools.get(t)},e.prototype._getLayer$Create=function(t){var e=this._layers.get(t);return e||((e=new cc.Node(h.MapLayer[t])).zIndex=t,e.anchorX=0,e.anchorY=0,e.position=cc.Vec2.ZERO,e.parent=this.objectLayer,this._layers.set(t,e)),e},e.prototype.getLayer=function(t){return t==h.MapLayer.MElementUI||h.MapLayer.MLEffect_1?this.UIRoot2d:this._getLayer$Create(t)},e.prototype.setGridSelect=function(t,e){var o=e.get(),i=this._elementComponents.get(d.default.mapMgr.encodeXxyy(o.pos));i&&i.data.gridInfo[_.INFO_TYPE.GRID]==_.GRID_TYPE.PLACE?this.setSelect(o.pos,o.heroId):this.hideAll()},e.prototype.selectGridByPos=function(t){return this._elementComponents.get(d.default.mapMgr.encodeXxyy(t))},e.prototype.setSelect=function(t,e){if(t){var o=d.default.heroData.getRaw(e),i=this._elementComponents.get(d.default.mapMgr.encodeXxyy(t));i&&(this._selected&&this._selected!=i&&(this._selected.onDisSelect(),this.toggoleIsAtk(d.default.mapMgr.decodeXxyy(this._selected.id),!1,o.scope)),this._selected=i,this._selected.onSelect(),this.toggoleIsAtk(t,!0,o.scope))}else cc.error("coord is null!")},e.prototype.hideAll=function(){this._selected&&(this._selected.onDisSelect(),this._elementComponents.forEach(function(t){t&&t.isAttack(!1)}))},e.prototype.toggoleIsAtk=function(t,e,o){var i=this;d.default.mapMgr.getAdjacent(o,t).forEach(function(t){var o=i._elementComponents.get(d.default.mapMgr.encodeXxyy(t));o&&o.isAttack(e)})},e.prototype.getSelectNode=function(){var t=this.getLayer(h.MapLayer.MLEffect_1).getChildByName("Efct");if(!t){var e=(t=new cc.Node).addComponent(cc.Sprite);this.assetImpl.spriteAtlasFrame(e,p.Res.texture.map.material,"select"),t.name="Efct",t.parent=this.getLayer(h.MapLayer.MLEffect_1),t.setContentSize(this.unitSize)}return t.scale=this._parser.itemsScale,t},r([w(cc.Camera)],e.prototype,"camera",void 0),r([w(cc.Node)],e.prototype,"objectLayer",void 0),r([w(cc.Node)],e.prototype,"UIRoot2d",void 0),r([w(cc.Node)],e.prototype,"mapLayer",void 0),r([w(cc.Node)],e.prototype,"touchLayer",void 0),r([w(cc.Node)],e.prototype,"fightLayer",void 0),r([w(cc.Sprite)],e.prototype,"ground",void 0),r([w(cc.Sprite)],e.prototype,"border",void 0),r([w(cc.Sprite)],e.prototype,"bottom",void 0),r([w()],e.prototype,"mapGridSize",void 0),r([w(cc.Node)],e.prototype,"heroLayer",void 0),r([w(cc.Label)],e.prototype,"wheat",void 0),r([w(cc.Label)],e.prototype,"level",void 0),r([w(cc.Label)],e.prototype,"bool",void 0),r([w(cc.Label)],e.prototype,"wave",void 0),r([w(cc.Node)],e.prototype,"close",void 0),r([b,A("View/Fight/BtlCameraMap")],e)}(c.default);o.default=T,cc._RF.pop()},{"../../../Core/FrameEx/ES5Ex":"ES5Ex","../../../Core/GView/GChild":"GChild","../../../Core/Manager/GNodePool":"GNodePool","../../../Core/Math/MathEx":"MathEx","../../Common/Define":"Define","../../Common/UIResources":"UIResources","../GameMgr":"GameMgr","./../../../Core/CoreDefine":"CoreDefine","./../../../Core/GCtrl":"GCtrl","./../../Common/Define":"Define","./BtlFighltLayer":"BtlFighltLayer","./BtlMapCanverts":"BtlMapCanverts","./BtlMapElement":"BtlMapElement","./BtlMapParser":"BtlMapParser","./BtlMapTouchLayer":"BtlMapTouchLayer"}],BtlFighltLayer:[function(t,e,o){"use strict";cc._RF.push(e,"11fa4rPEsBEGYQix4alJ6Ke","BtlFighltLayer");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/GView/GChild"),c=t("../../../Core/Manager/AudioMgr"),l=t("../../Common/Define"),u=t("../../Common/Language"),h=t("../../Common/UI"),p=t("../../Common/UIResources"),d=t("../../Common/Zh"),f=t("../../Views/Fight/BtlHeroHead"),g=t("../../Views/JXBattle/JXBattleDefine"),_=t("../../Views/JXBattle/JXBattleManager"),m=t("../../Views/JXBattle/JXRBCmdMgr"),y=t("../GameMgr"),v=t("./../../../Core/GCtrl"),C=t("./../../Common/Define"),I=cc._decorator,E=I.ccclass,S=I.property,R=(I.menu,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.wheatNode=null,e.heroContent=null,e.level=null,e.bool=null,e._secenId=null,e._btlReport=null,e._cbFun=null,e.winArgs=null,e._level=null,e.logicAni=null,e.mapRaw=null,e}return n(e,t),e.prototype.fightInit=function(t,e){var o=this;this._secenId=t.sceneId,this.winArgs=t,this._cbFun=e,1!==t.args.level&&2!==t.args.level&&3!==t.args.level||y.default.lUserData.isDoneGuide()?(Math.random(),y.default.jumpToMgr.jumpGoTo(h.VIEW_ID.heroTry,function(){o.loadEnv()})):this.loadEnv()},e.prototype.update=function(){this._cmdMgr&&this._cmdMgr.update()},e.prototype.loadEnv=function(){var t=this;switch(this._secenId){case C.PART_BTL_SCENE.GUANQIA:4==(e=this.winArgs).args.level&&y.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.level4,{msg:u.L(d.JXLocales.tower.level,e.args.level)}),this._level=y.default.storyData.getRaw(e.args.level),this.mapRaw=y.default.mapData.getRaw(this._level.mapld),this._btlReport=y.default.rHeroData.createRespWithRealData(this._level),this.level.string=u.L(d.JXLocales.tower.level,this._level.id);break;case C.PART_BTL_SCENE.ARENA:var e=this.winArgs;this._level=y.default.towerData.getRaw(e.args.level),this.mapRaw=y.default.mapData.getRaw(this._level.mapld),this._btlReport=y.default.rHeroData.createRespWithRealData(this._level),this.level.string=u.L(d.JXLocales.tower.level,this._level.id)}return this._btlReport.random=v.GCtrl.now.toString(),console.log("\u5b9e\u9645\u6218\u62a5\u8be6\u60c5",this._btlReport),this._cmdMgr=new m.default(this._secenId,"RBBattle",this._level.id),this._cmdMgr.initRDBtlLayer(this.node),this._cmdMgr.evtMgr.register(l.CMsg.client.fight_ui.end_fight,this,this.onEndFight.bind(this)),this._cmdMgr.jxBtlAns=_.default.ins.fight(this._btlReport.atker,this._btlReport.defer,this._cmdMgr),this._cmdMgr.jxBtlAns.setBarrackHps(this._level.hp,this.bool),this.bool.string=u.L(d.JXLocales.fight.bool,this._level.hp),this._cmdMgr.monsterCtrl=function(){t.setLogicAni(t.mapRaw.logic,function(){t._cmdMgr.monsterFactory.init(t._btlReport.atker.ext,t.mapRaw.logic,t._cmdMgr,t.logicAni),t._cmdMgr.monsterFactory.startProduce(),t._cmdMgr._wave.string=u.L(d.JXLocales.fight.wave,t._cmdMgr.monsterFactory.waveNum+1),t.scheduleOnce(function(){t._cmdMgr.monsterFactory.startRoadAni()},.5)})},this._cmdMgr.loadAllResources(this.onResLoaded.bind(this)),this._cmdMgr},e.prototype.setLogicAni=function(t,e){var o=this;this.assetImpl.prefab(p.Res.prefab.item.jxRoadPoint,function(i){o.logicAni=[],t.forEach(function(t){var e=cc.instantiate(i);e.parent=o.node;var n=y.default.mapMgr.decodeXxyy(t[0]),r=o._cmdMgr.btlMapConverts.converToCCPos(n);e.position=r;var a=cc.tween(e),s=cc.tween(e).call(function(){e.active=!0,a.start()});t.forEach(function(t){var e=y.default.mapMgr.decodeXxyy(t),i=o._cmdMgr.btlMapConverts.converToCCPos(e);a.to(.2,{position:i})}),a.call(function(){e.active=!1,e.position=r}),o.logicAni.push(s)}),e()})},e.prototype.onEndFight=function(){var t=this,e={sceneId:this._secenId,isWin:this._cmdMgr.jxBtlAns.isDefWin};e.isWin&&c.AudioMgr.Ins().playEffect(p.Res.audio.nextWave),this.scheduleOnce(function(){y.default.jumpToMgr.jumpGoTo(h.VIEW_ID.battleResult,t._secenId,t._level.id,t._cmdMgr.jxBtlAns,function(){v.GCtrl.ES.emit(l.CMsg.client.fight_ui.onFinishSettle,e)})},2)},e.prototype.onResLoaded=function(){this.isValid&&(this.initBattleHead(),this._cbFun(this._cmdMgr))},e.prototype.initBattleHead=function(){var t=this;this.heroContent.destroyAllChildren(),this.assetImpl.prefab(p.Res.prefab.vw.fight.head,function(e){for(var o=t._btlReport.defer,i=0;i<o.partnerData.length;i++){var n=o.partnerData[i];if(n.heroId!=g.JXBtlPs.InvalidString){var r=cc.instantiate(e),a=r.getComponent(f.default);a.init(n,t._cmdMgr),a.setSeatNode(t.node),t.heroContent.addChild(r)}}})},e.prototype.onGDestroy=function(){this._cmdMgr&&(this._cmdMgr.monsterFactory.destory(),this._cmdMgr.pause(),this._cmdMgr.destroy(),this._cmdMgr=null)},r([S(cc.Node)],e.prototype,"wheatNode",void 0),r([S(cc.Node)],e.prototype,"heroContent",void 0),r([S(cc.Label)],e.prototype,"level",void 0),r([S(cc.Label)],e.prototype,"bool",void 0),r([E],e)}(s.default));o.default=R,cc._RF.pop()},{"../../../Core/GView/GChild":"GChild","../../../Core/Manager/AudioMgr":"AudioMgr","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/Language":"Language","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Common/Zh":"Zh","../../Views/Fight/BtlHeroHead":"BtlHeroHead","../../Views/JXBattle/JXBattleDefine":"JXBattleDefine","../../Views/JXBattle/JXBattleManager":"JXBattleManager","../../Views/JXBattle/JXRBCmdMgr":"JXRBCmdMgr","../GameMgr":"GameMgr","./../../../Core/GCtrl":"GCtrl","./../../Common/Define":"Define"}],BtlHeroHead:[function(t,e,o){"use strict";cc._RF.push(e,"7f277vYtGdOua6ReFLT1NYo","BtlHeroHead");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/GEvent/GParam"),c=t("../../../Core/GView/GChild"),l=t("../../../Core/Manager/AudioMgr"),u=t("../../Common/Zh"),h=t("../../Logic/GameMgr"),p=t("../JXBattle/JXBattleManager"),d=t("./../../../Core/GCtrl"),f=t("./../../Common/Define"),g=t("./../../Common/UIResources"),_=t("./../JXBattle/JXBattleDefine"),m=cc._decorator,y=m.ccclass,v=m.property,C=m.menu,I=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.head=null,e.need=null,e.bg=null,e.type=null,e.mask=null,e._rHeroData=null,e._sHeroData=null,e._touchMove=!1,e._iconShowNode=null,e._touchBegin=!1,e._dragShowNode=null,e._isDraging=!1,e._canDraw=!1,e._seatNode=null,e._onSeat=!1,e._time=0,e._chess=[null,"\u5175","\u8f66","\u9a6c","\u70ae","\u76f8","\u58eb"],e._curPos=null,e._cmd=null,e}return n(e,t),e.prototype.onGLoad=function(){d.GCtrl.ES.on(d.GCtrl.GTimerSecondEventMsg,this,this.setMaskRank.bind(this))},e.prototype.init=function(t,e){this.node.name="btlHead_"+t.tableId,this._cmd=e,this._rHeroData=t,this._sHeroData=h.default.heroData.getRaw(t.tableId),this.setView()},e.prototype.setMaskRank=function(){var t=h.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.twoUp)*this._time,e=Math.round(this._sHeroData.food*(1+t)),o=this._cmd.wheat/e;o>1?(cc.tween(this.mask).to(.5,{fillRange:1}).start(),this.mask.node.active=!1):(this.mask.node.active=!0,cc.tween(this.mask).to(.5,{fillRange:1-o}).start())},e.prototype.setView=function(){this.updateExpend(),this.assetImpl.spriteAtlasFrame(this.bg,g.Res.texture.fight.ui,"trait_"+this._rHeroData.trait),this.assetImpl.spriteFrame(this.head,g.Res.texture.hero.hero+"hero_"+this._sHeroData.icon),this.type.string=this._chess[this._sHeroData.type]+""},e.prototype.initEvent=function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStar,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this)},e.prototype.checkStatus=function(){this._sHeroData?this._canDraw=!0:this._canDraw=!1},e.prototype.setSeatNode=function(t){this._seatNode=t},e.prototype.destroyDragNode=function(){cc.isValid(this._dragShowNode)&&(this._dragShowNode.destroy(),this._dragShowNode=null)},e.prototype._onTouchStar=function(t){var e=h.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.twoUp)*this._time,o=Math.round(this._sHeroData.food*(1+e));if(!(this._cmd.wheat>=o))return this._canDraw=!1,void h.default.uiMgr.showToast(u.JXLocales.fight.noWheat);this.checkStatus(),this._touchMove=!1,this.destroyDragNode(),this._touchBegin=!0,t.stopPropagation()},e.prototype._onTouchMove=function(t){if(this._canDraw){var e=t.getLocation().sub(t.getStartLocation());if(this._isDraging||(this._isDraging=!0),e.mag()>7&&this._isDraging){var o=this._seatNode;if(this._touchMove){var i=t.getLocation();c=o.convertToNodeSpaceAR(i),this._dragShowNode.setPosition(c);var n=this._seatNode.getBoundingBoxToWorld().contains(i),r=this._cmd.btlMapConverts.converToMapPos(c);if(!this._curPos||r.x!=this._curPos.x||r.y!=this._curPos.y){var a={heroId:this._sHeroData.id,pos:r};d.GCtrl.ES.emit(f.CMsg.client.fight_ui.selectItem,new s.default(a)),this._curPos=r}n?this._onSeat||(this._onSeat=!0):this._onSeat&&(this._onSeat=!1)}else{this._touchMove=!0,this._dragShowNode=cc.instantiate(this.head.node),this._dragShowNode.parent=this._seatNode;var c=o.convertToNodeSpaceAR(t.getLocation());this._dragShowNode.setPosition(c)}}}},e.prototype._onTouchEnd=function(t,e){void 0===e&&(e=!1);var o=t.getLocation();if(this.destroyDragNode(),this._touchMove){var i=this._seatNode.getBoundingBoxToWorld().contains(o),n=this._seatNode.convertToNodeSpaceAR(o),r=this._cmd.btlMapConverts.converToMapPos(n);i&&this.putOnHeroInBtl(r),d.GCtrl.ES.emit(f.CMsg.client.fight_ui.hideAllItem)}this._touchBegin=!1,this._touchMove=!1,this._onSeat=!1,this._isDraging=!1},e.prototype.updateExpend=function(){var t=h.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.twoUp)*this._time,e=Math.round(this._sHeroData.food*(1+t));this.need.string=e.toString()},e.prototype.putOnHeroInBtl=function(t){var e=h.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.twoUp)*this._time,o=Math.round(this._sHeroData.food*(1+e)),i=this._cmd.checkCanPutOn(_.JXBtlCamp.Defenser,t),n=this._cmd.wheat>=o,r=this._cmd.btlCameraMap.selectGridByPos(t).data.gridInfo[f.INFO_TYPE.GRID]===f.GRID_TYPE.PLACE;if(!i&&r)if(n){var s=p.default.ins.getTeamByCamp(_.JXBtlCamp.Defenser).goBattle(this._rHeroData.heroId);this._cmd.jxBtlAns.setDefToTeam(s),this._cmd.createRole(s.heroId,s.index,_.JXBtlCamp.Defenser,null,t),l.AudioMgr.Ins().playEffect(g.Res.audio.goBattle),this._cmd.expendWheat(o),this._time++,this.updateExpend()}else h.default.uiMgr.showToast(u.JXLocales.fight.noWheat);else h.default.uiMgr.showToast(u.JXLocales.fight.hasHero)},e.prototype._onTouchCancel=function(t){this._onTouchEnd(t,!0)},e.prototype.onEnable=function(){this.initEvent()},e.prototype.onDisable=function(){this.node.targetOff(this)},r([v(cc.Sprite)],e.prototype,"head",void 0),r([v(cc.Label)],e.prototype,"need",void 0),r([v(cc.Sprite)],e.prototype,"bg",void 0),r([v(cc.Label)],e.prototype,"type",void 0),r([v(cc.Sprite)],e.prototype,"mask",void 0),r([y,C("View/Fight/BtlHeroHead")],e)}(c.default);o.default=I,cc._RF.pop()},{"../../../Core/GEvent/GParam":"GParam","../../../Core/GView/GChild":"GChild","../../../Core/Manager/AudioMgr":"AudioMgr","../../../conventions/JXCommon":"JXCommon","../../Common/Zh":"Zh","../../Logic/GameMgr":"GameMgr","../JXBattle/JXBattleManager":"JXBattleManager","./../../../Core/GCtrl":"GCtrl","./../../Common/Define":"Define","./../../Common/UIResources":"UIResources","./../JXBattle/JXBattleDefine":"JXBattleDefine"}],BtlMapCanverts:[function(t,e,o){"use strict";cc._RF.push(e,"a27f5WWG4VD34Apwpr1xeeL","BtlMapCanverts"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(t,e,o,i,n,r){this._rootNode=null,this._zeroOffset=null,this._mapSize=null,this._viewSize=null,this._unitSize=null,this._mapStartPos=null,this._rootNode=t,this._zeroOffset=e,this._mapSize=o;var a=0;if(o&&a++,i&&a++,n&&a++,a<2&&console.error("\u81f3\u5c11\u9700\u8981\u5176\u4e2d\u4fe9\u4e2a\u53c2\u6570\uff0c\u624d\u80fd\u6b63\u5e38\u8fdb\u884c\u5750\u6807\u8f6c\u6362"),this._viewSize=i,this._unitSize=n,!this._viewSize){var s=this.unitSize.height*this._mapSize.height,c=this.unitSize.width*this._mapSize.width;this._viewSize=cc.size(c,s)}this._unitSize||(s=this.viewSize.height/o.height,c=this.viewSize.width/this._mapSize.width,this._unitSize=cc.size(c,s)),this._mapSize||(c=this.viewSize.width/this.unitSize.width,s=this.viewSize.height/n.height,this._mapSize=cc.size(c,s)),this.converToMapPos(cc.v2(0,0)),this._mapStartPos=r||cc.Vec2.ZERO}return Object.defineProperty(t.prototype,"mapSize",{get:function(){return this._mapSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewSize",{get:function(){return this._viewSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"unitSize",{get:function(){return this._unitSize},enumerable:!1,configurable:!0}),t.prototype.converToCCPos=function(t,e){var o,i=(o=t instanceof cc.Vec2?t:cc.v2(t,e)).x*this.unitSize.width+.5*this.unitSize.width,n=o.y*this.unitSize.height+.5*this.unitSize.width;return cc.v2(i,n)},t.prototype.converToMapPos=function(t,e){void 0===e&&(e=!0),t.x-=this._zeroOffset.x,t.y-=this._zeroOffset.x;var o=t.x/this.unitSize.width;e&&(o=Math.round(o));var i=t.y/this.unitSize.height;return e&&(i=Math.round(i)),cc.v2(o,i)},t.prototype.converNodePosToMapPos=function(t,e){var o=t.convertToWorldSpaceAR(e),i=this._rootNode.convertToNodeSpaceAR(o);return this.converToMapPos(i)},t.prototype.converMapPosToNodePos=function(t,e){var o=this.converToCCPos(e),i=this._rootNode.convertToWorldSpaceAR(o);return t.convertToNodeSpaceAR(i)},t}();o.default=i,cc._RF.pop()},{}],BtlMapElement:[function(t,e,o){"use strict";cc._RF.push(e,"f4475WLhnRJJoodWdgVOEzL","BtlMapElement"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../../../Core/FrameEx/ES5Ex"),n=t("../../../Core/Math/MathEx"),r=t("../../Common/Define"),a=t("../../Common/UIResources"),s=t("../../Views/JXBattle/JXRBFlags"),c=t("./../../Common/Define"),l=null,u=["","road","","surface","place",""],h=function(){function t(t){this.layerElements=null,this._cameraMap=null,this._assetImpl=null,this.flag=null,this._assetImpl=t,this.layerElements=new i.MapWrap}return Object.defineProperty(t.prototype,"cameraMap",{get:function(){return this._cameraMap},set:function(t){this._cameraMap!==t&&(this._cameraMap=t,l||(l=this._cameraMap.unitSize))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tcgPos",{get:function(){return this._tcgpos},set:function(t){this._tcgpos=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._sElementData},set:function(t){this._sElementData=t},enumerable:!1,configurable:!0}),t.prototype.onActive=function(){var t=this;if(this.data){var e=this.anchrpos();this.layerElements.forEach(function(o,i){switch(o.position=e,o.name=t.data.id+"_"+i,Number(i)){case r.MapLayer.MLGrid:t.setGridLayer(o);break;case r.MapLayer.MLMaterial:t.setMaterialLayer(o);break;case r.MapLayer.MLEffect_2:var n=o.getComponent(cc.Sprite);t._assetImpl.spriteAtlasFrame(n,a.Res.texture.map.material,"isAtk"),o.active=!1}})}},t.prototype.onSelect=function(){var t=this._cameraMap.getSelectNode();t.active=!0,t.position=this.anchrpos(),t.opacity=160,t.zIndex=1e3,t.active=!0},t.prototype.onDisSelect=function(){var t=this._cameraMap.getSelectNode();t.stopAllActions(),t.active=!1},t.prototype.isAttack=function(t){this.layerElements.get(r.MapLayer.MLEffect_2).active=t},t.prototype.setGridLayer=function(t){var e=(t=t||this.layerElements.get(r.MapLayer.MLGrid)).getComponent(cc.Sprite);if(e){if(this.data.gridInfo[c.INFO_TYPE.GRID]===c.GRID_TYPE.PLACE||this.data.gridInfo[c.INFO_TYPE.GRID]===c.GRID_TYPE.BARRACKS){var o=u[this.data.gridInfo[c.INFO_TYPE.GRID]],i=this.cameraMap.mapStyle.gridNum[this.data.gridInfo[c.INFO_TYPE.GRID]-1];this.data.gridInfo[c.INFO_TYPE.GRID]===c.GRID_TYPE.BARRACKS&&(o=u[c.GRID_TYPE.PLACE],i=this.cameraMap.mapStyle.gridNum[c.GRID_TYPE.PLACE-1]);var s=o+this.cameraMap.mapRaw.style+"_"+n.default.random(1,i);this._assetImpl.spriteAtlasFrame(e,a.Res.texture.map.grid,s)}else e.spriteFrame=null;e.node.setContentSize(this.cameraMap.unitSize),e.node.active=!0}},t.prototype.setMaterialLayer=function(t){var e=this,o=this.data.material;t.children.length&&t.children.forEach(function(t){e._cameraMap.recoverNodeToPool(t)}),o.forEach(function(o){if(4===o.type)e._assetImpl.prefab(a.Res.prefab.fight.fightFlags,function(i){var n=cc.instantiate(i);n.active=!0,n.position=o.position,n.name=r.MapLayer.MLMaterial+"",t.addChild(n),n.scaleY=o.scale.y,n.scaleX=o.scale.x,n.zIndex=100*o.zindex+t.parent.children.indexOf(t);var a=n.getComponent(s.default);e._cameraMap._flags=a});else{var i=e.cameraMap.getNodeFromPool(r.MapLayer.MLMaterial);i.active=!0,i.position=o.position,i.name=r.MapLayer.MLMaterial+"";var n=i.getComponent(cc.Sprite);n.spriteFrame=null,n.type=cc.Sprite.Type.SIMPLE,e._assetImpl.spriteAtlasFrame(n,a.Res.texture.map.material,"material_"+o.type),t.addChild(i),i.scaleY=o.scale.y,i.scaleX=o.scale.x,i.zIndex=100*o.zindex+t.parent.children.indexOf(t)}}),t.active=!0},t.prototype.anchrpos=function(){return this.npos()},t.prototype.npos=function(){return this._cameraMap.m2n(this.tcgPos)},t.prototype.rect=function(){var t=this.npos();return cc.rect(t.x,t.y-l.height/2,l.width,l.height)},t.prototype.onRecover=function(){var t=this;this.layerElements.forEach(function(e,o){Number(o)===r.MapLayer.MLMaterial&&e.children.forEach(function(e){t.cameraMap.recoverNodeToPool(e)}),e.name="null"})},t}();o.default=h,cc._RF.pop()},{"../../../Core/FrameEx/ES5Ex":"ES5Ex","../../../Core/Math/MathEx":"MathEx","../../Common/Define":"Define","../../Common/UIResources":"UIResources","../../Views/JXBattle/JXRBFlags":"JXRBFlags","./../../Common/Define":"Define"}],BtlMapParser:[function(t,e,o){"use strict";cc._RF.push(e,"9944enVz5VCHa4rPAdSAJBw","BtlMapParser"),Object.defineProperty(o,"__esModule",{value:!0}),o.BtlMapParser=o.MapParseStatus=o.MapParseProgress=void 0;var i,n,r=t("../../../Core/FrameEx/ES5Ex"),a=t("./../../Common/Define");(function(t){t[t.MPP_LoadMapData=0]="MPP_LoadMapData"})(i=o.MapParseProgress||(o.MapParseProgress={})),function(t){t[t.MPS_BeginLoad=0]="MPS_BeginLoad",t[t.MPS_Loading=1]="MPS_Loading",t[t.MPS_LoadSuccess=2]="MPS_LoadSuccess",t[t.MPS_LoadFailed=3]="MPS_LoadFailed"}(n=o.MapParseStatus||(o.MapParseStatus={}));var s=function(){function t(t,e,o){this._mapData=new r.MapWrap,this._unitSize=null,this._gridSize=null,this._mapSize=null,this._itemScale=0,this._progressCallBack=null,this._filePath="",this._assetImpl=null,this._filePath=t,this._assetImpl=o,this._progressCallBack=e}return Object.defineProperty(t.prototype,"unitSize",{get:function(){return this._unitSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gridSize",{get:function(){return this._gridSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mapSize",{get:function(){return this._mapSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"itemsScale",{get:function(){return this._itemScale},enumerable:!1,configurable:!0}),t.prototype.loadMapData=function(){var t=this;this.callProgress(i.MPP_LoadMapData,n.MPS_BeginLoad),this._assetImpl.json(this._filePath,function(e,o){e&&t.callProgress(i.MPP_LoadMapData,n.MPS_LoadFailed,e),t._worldAsseet=o,t._unitSize=t.arrToSize(t._worldAsseet.json.unitSize),t._mapSize=t.arrToSize(t._worldAsseet.json.size),t._gridSize=t.arrToSize(t._worldAsseet.json.gridSize),t._itemScale=t._gridSize.width/80;var r=t._worldAsseet.json.data;t.dealWithMapData(r),t.callProgress(i.MPP_LoadMapData,n.MPS_LoadSuccess,t)},!1)},t.prototype.dealWithMapData=function(t){var e=this;t.forEach(function(t){var o=t;if(!o)return null;var i={id:o[a.GRID_INFO.ID],coordinate:cc.v2(o[a.GRID_INFO.POSITION][0],o[a.GRID_INFO.POSITION][1]),gridInfo:o[a.GRID_INFO.INFO],zIndex:o[a.GRID_INFO.ZINDEX],material:[]};o[a.GRID_INFO.MATERIAL].forEach(function(t){var e={type:t[a.MATERIAL_INFO.TYPE],position:cc.v2(t[a.MATERIAL_INFO.POSITION][0],t[a.MATERIAL_INFO.POSITION][1]),scale:cc.v2(t[a.MATERIAL_INFO.SCALE][0],t[a.MATERIAL_INFO.SCALE][1]),zindex:t[a.MATERIAL_INFO.ZINDEX]};i.material.push(e)}),e._mapData.set(t[0],i)}),console.log("\u5730\u56fe\u6570\u636e\u89e3\u6790\u5b8c\u6210:",this._mapData)},t.prototype.getElementData=function(t,e){var o;return o=t instanceof cc.Vec2?t:cc.v2(t,e),this.checkInMapRange(o)?this._mapData.get(100*o.x+o.y):null},t.prototype.checkInMapRange=function(t,e){return"number"==typeof t&&(t=cc.v2(t,e)),!(t.x<0||t.x>=this._mapSize.width||t.y<0||t.y>=this._mapSize.height)},t.prototype.callProgress=function(t,e,o){void 0===o&&(o=null),this._progressCallBack&&this._progressCallBack(t,e,o)},t.prototype.arrToSize=function(t){var e=new cc.Size(0);return e.width=t[0],e.height=t[1],e},t}();o.BtlMapParser=s,cc._RF.pop()},{"../../../Core/FrameEx/ES5Ex":"ES5Ex","./../../Common/Define":"Define"}],BtlMapTouchLayer:[function(t,e,o){"use strict";cc._RF.push(e,"79287gw+G9Mqo1bfAinSFHc","BtlMapTouchLayer");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GView/GChild"),s=t("../../../Core/Math/MathEx"),c=cc._decorator,l=c.ccclass,u=(c.property,c.menu,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._isTouchBegin=!1,e._map=null,e}return n(e,t),Object.defineProperty(e.prototype,"map",{get:function(){return this._map},set:function(t){this._map=t},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this.node.position=cc.Vec2.ZERO,this.node.setContentSize(cc.winSize.width,cc.winSize.height),this._plane=new s.Plane,this._plane.p=new cc.Vec3(0,0,0),this._plane.n=new cc.Vec3(0,0,1),this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchBegin,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchCancel,this),this.node.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this)},e.prototype.onTouchBegin=function(){},e.prototype.onTouchMove=function(){},e.prototype.onTouchEnd=function(){},e.prototype.onTouchCancel=function(){},e.prototype.onMouseWheel=function(){},e.prototype.getTouchWorldPos=function(t){var e=this.map.camera.getRay(t);return s.default.rayPlaneIntersectPoint(e,this._plane)},e.prototype.onDestroy=function(){this.node.targetOff(this)},r([l],e)}(a.default));o.default=u,cc._RF.pop()},{"../../../Core/GView/GChild":"GChild","../../../Core/Math/MathEx":"MathEx"}],BtnCDTime:[function(t,e,o){"use strict";cc._RF.push(e,"16740uXtl5JfLPSUzXu4orB","BtnCDTime");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cd=100,e._runTime=0,e._isCdEnd=!1,e}return n(e,t),e.prototype.update=function(t){this._isCdEnd||(this._runTime<=this.cd?(this.node.getComponent(cc.Sprite).fillRange=1-this._runTime/this.cd,this._runTime+=1e3*t):(this.node.getComponent(cc.Sprite).fillRange=0,this._isCdEnd=!0))},e.prototype.ontouch=function(){this._runTime=0,this._isCdEnd=!1},e.prototype.isCDEnd=function(){return this._isCdEnd},r([c()],e.prototype,"cd",void 0),r([s("BtnCDTime")],e)}(cc.Component);o.default=l,cc._RF.pop()},{}],CCEx:[function(t,e,o){"use strict";cc._RF.push(e,"e0835f9ka9IH5Jo0pQ1MI93","CCEx"),Object.defineProperty(o,"__esModule",{value:!0}),o.UN_PRIERCE_SCROLLVIEW_TOUCHEVENT=o.PIERCE_SCROLLVIEW_TOUCHEVENT=void 0;var i=t("../Manager/AudioMgr");cc.Component.prototype.forcibleRender=function(t){var e=this._enabled,o=this.node._activeInHierarchy;e||(this._enabled=!0),o||(this.node._activeInHierarchy=!0),t(),this._enabled=e,this.node._activeInHierarchy=o},cc.Node.prototype.getChildComByName=function(t,e){var o=this.getChildByName(t);return o?o.getComponent(e):null},cc.Node.prototype.getChildByList=function(t){return cc.find(t,this)},cc.Node.prototype.getChildComByList=function(t,e){var o=this.getChildByList(t);if(o)return o.getComponent(e)},cc.Node.prototype.getUserData=function(){return this.userData||0},cc.Node.prototype.setUserData=function(t){this.userData=t},cc.Node.prototype.logPath=function(){var t=this.name,e=this;do{var o=e.parent;if(!o)break;if(t=o.name+"/"+t,"Canvas"==(e=o).name)break}while(e.parent);return t},cc.Node.prototype.getMinPostion=function(){return cc.v2(this.x-this.width*this.anchorX,this.y-this.height*this.anchorY)},cc.Node.prototype.getMaxPosition=function(){return this.getMinPostion().add(cc.v2(this.width,this.height))},cc.Node.prototype.worldActive=function(){for(var t=cc.director.getScene(),e=this;e;){if(!e||!e.active)return!1;if(e.parent==t)return e.active;e=e.parent}return!1},cc.Node.prototype.switchParent=function(t){for(var e=(this.parent||this).convertToWorldSpaceAR(this.getPosition()),o=t.convertToNodeSpaceAR(e),i=void 0===this.rotation?"angle":"rotation",n=1,r=1,a=0,s=0,c=this;c;c=c.parent)n*=c.scaleX,r*=c.scaleY,a+=c[i+"X"],s+=c[i+"Y"];var l=1,u=1,h=0,p=0;for(c=t;c;c=c.parent)l/=c.scaleX,u/=c.scaleY,h-=c[i+"X"],p-=c[i+"Y"];this.setParent(t),this[i+"X"]=a+h,this[i+"Y"]=s+p,this.setScale(n*l,r*u),this.setPosition(o)},cc.Node.prototype.snapshotCamera=function(t,e){var o=this.getComponent(cc.Camera);if(o||(o=this.addComponent(cc.Camera)),o.cullingMask=t||4294967295,o.clearFlags=cc.Camera.main.clearFlags,o.backgroundColor=cc.color(0,0,0,0),o.targetTexture)return o;var i=new cc.RenderTexture,n=cc.game._renderContext;return e?i.initWithSize(e.width,e.height,n.STENCIL_INDEX8):i.initWithSize(this.width,this.height,n.STENCIL_INDEX8),o.targetTexture=i,o.enabled=!1,o},cc.Node.prototype.snapshotNode=function(t,e){var o=this,i=this.snapshotCamera(t,e),n=new cc.Node;return n.addComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(i.targetTexture),n.scaleY=-1,cc.tween(n).repeatForever(cc.tween(n).delay(.01).call(function(){i.isValid&&(window.middleware&&window.middleware.MiddlewareManager.getInstance().update(0),i.render(o))})).start(),n},cc.Sprite.prototype.setBlend=function(t,e){this.srcBlendFactor=t,this.dstBlendFactor=e},cc.Button.comAudio=null,cc.Button.prototype.clickAudio=null,cc.Button.prototype._onTouchEnded=function(t){this.interactable&&this.enabledInHierarchy&&(this._pressed&&(this.clickAudio?i.AudioMgr.Ins().playEffect(this.clickAudio):cc.Button.comAudio&&i.AudioMgr.Ins().playEffect(cc.Button.comAudio),cc.Component.EventHandler.emitEvents(this.clickEvents,t),this.node.emit("click",this)),this._pressed=!1,this._updateState(),t.stopPropagation())},sp.Skeleton.prototype.getAnimationInfo=function(t){if(cc.sys.isNative)return this.findAnimation(t);for(var e=this._skeleton.data.animations,o=0;o<e.length;o++)if(e[o].name==t)return e[o];return null},dragonBones.ArmatureDisplay.prototype.getAnimationInfo=function(t,e){for(var o=this.dragonAsset._dragonBonesJsonData.armature,i=0,n=null,r=0;r<o.length;r++){var a=o[r];if(a.name===t){i=a.frameRate,n=a;break}}for(r=0;r<n.animation.length;r++){var s=n.animation[r];if(e==s.name)return s.duration=1/i*s.duration,s}return console.error("\u672a\u627e\u5230\u5bf9\u5e94\u7684\u52a8\u4f5c\u4fe1\u606f"),null},cc.Action.prototype.endCallback=function(t){return this.__endCallBack=t,this},cc.Component.EventHandler.prototype.emitWithBoolResult=function(t){var e=this.target;if(cc.isValid(e)){this._genCompIdIfNeeded();var o=cc.js._getClassById(this._componentId),i=e.getComponent(o);if(cc.isValid(i)){var n=i[this.handler];if("function"==typeof n)return null!=this.customEventData&&""!==this.customEventData&&(t=t.slice()).push(this.customEventData),n.apply(i,t)}}},o.PIERCE_SCROLLVIEW_TOUCHEVENT=function(t){t._onTouchBegan=function(e,o){cc.ScrollView.prototype._onTouchBegan.call(t,e,o),e._propagationStopped=!1,t.unStopped=!1},t._onTouchMoved=function(e,o){if(!t.unStopped)if(t.horizontal&&t.vertical)cc.ScrollView.prototype._onTouchMoved.call(t,e,o);else{var i=e.getStartLocation(),n=e.getLocation().sub(i);Math.abs(n.x)<3&&Math.abs(n.y)<3?cc.ScrollView.prototype._onTouchMoved.call(t,e,o):Math.abs(n.x)>Math.abs(n.y)&&t.vertical?(cc.ScrollView.prototype._onTouchCancelled.call(t,e,o),e._propagationStopped=!1,t.unStopped=!0):Math.abs(n.x)<Math.abs(n.y)&&t.horizontal?(cc.ScrollView.prototype._onTouchCancelled.call(t,e,o),e._propagationStopped=!1,t.unStopped=!0):(this._bTouchTypeCheck=2,cc.ScrollView.prototype._onTouchMoved.call(t,e,o),t.unStopped=!1)}},t._onTouchEnded=function(e,o){cc.ScrollView.prototype._onTouchCancelled.call(t,e,o),e._propagationStopped=!1,t.unStopped=!1},t._onTouchCancelled=function(e,o){cc.ScrollView.prototype._onTouchCancelled.call(t,e,o),e._propagationStopped=!1,t.unStopped=!1}},o.UN_PRIERCE_SCROLLVIEW_TOUCHEVENT=function(t){t.unStopped=!1,t._onTouchBegan=cc.ScrollView.prototype._onTouchBegan,t._onTouchMoved=cc.ScrollView.prototype._onTouchMoved,t._onTouchEnded=cc.ScrollView.prototype._onTouchEnded,t._onTouchCancelled=cc.ScrollView.prototype._onTouchCancelled},cc._RF.pop()},{"../Manager/AudioMgr":"AudioMgr"}],CCMaskProgressBar:[function(t,e,o){"use strict";cc._RF.push(e,"da1a888Gz9DV6hrcYntj+Do","CCMaskProgressBar");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.MaskProgressMode=void 0;var a,s=cc._decorator,c=s.ccclass,l=s.property,u=s.menu;(function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"})(a=o.MaskProgressMode||(o.MaskProgressMode={}));var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._maskBar=null,e._barSprite=null,e._mode=a.HORIZONTAL,e._totalLenth=100,e._progress=0,e._reverse=!1,e}return n(e,t),Object.defineProperty(e.prototype,"maskBar",{get:function(){return this._maskBar},set:function(t){this._maskBar!=t&&(this._maskBar=t,this._initStatus())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"barSprite",{get:function(){return this._barSprite},set:function(t){this._barSprite!=t&&(this._barSprite=t,this._initStatus())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(t){this._mode!=t&&(this._mode=t,this._initStatus())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"totalLenth",{get:function(){return this._totalLenth},set:function(t){this._totalLenth!=t&&(this._totalLenth=t,this._initStatus())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"progress",{get:function(){return this._progress},set:function(t){this._progress!=t&&(this._progress=cc.misc.clamp01(t),this._updateBarStatus())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"reverse",{get:function(){return this._reverse},set:function(t){this._reverse!=t&&(this._reverse=t,this._initStatus())},enumerable:!1,configurable:!0}),e.prototype._initStatus=function(){if(this.maskBar&&this.barSprite){switch(this._mode){case a.HORIZONTAL:this._barSprite.node.width=this._totalLenth;break;case a.VERTICAL:this._barSprite.node.height=this._totalLenth}this.maskBar.getComponent(cc.Mask).inverted=this._reverse,this._updateBarStatus()}},e.prototype._updateBarStatus=function(){if(this._maskBar)switch(this._mode){case a.HORIZONTAL:this._maskBar.width=this._totalLenth*this._progress;break;case a.VERTICAL:this.maskBar.height=this._totalLenth*this._progress}},r([l(cc.Node)],e.prototype,"_maskBar",void 0),r([l({type:cc.Node})],e.prototype,"maskBar",null),r([l(cc.Sprite)],e.prototype,"_barSprite",void 0),r([l({type:cc.Sprite})],e.prototype,"barSprite",null),r([l({type:cc.Enum(a)})],e.prototype,"_mode",void 0),r([l({type:cc.Enum(a)})],e.prototype,"mode",null),r([l],e.prototype,"_totalLenth",void 0),r([l],e.prototype,"totalLenth",null),r([l],e.prototype,"_progress",void 0),r([l({range:[0,1,.01],slide:!0})],e.prototype,"progress",null),r([l],e.prototype,"_reverse",void 0),r([l],e.prototype,"reverse",null),r([c,u("FrameEx/MaskProgressBar")],e)}(cc.Component);o.default=h,cc._RF.pop()},{}],CCMaskProgressMoreBar:[function(t,e,o){"use strict";cc._RF.push(e,"f2a1b5LO6xCVYo4mftLihFZ","CCMaskProgressMoreBar");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../GLoader/GLoader"),s=cc._decorator,c=s.ccclass,l=s.property,u=s.menu,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.allNum=null,e.proLabel=null,e._totalLenth=100,e._nTotal=1e4,e._barNum=1,e._progress=0,e._maskBars=[],e}return n(e,t),Object.defineProperty(e.prototype,"totalLenth",{get:function(){return this._totalLenth},set:function(t){this._totalLenth!=t&&(this._totalLenth=t,this._initStatus())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nTotal",{get:function(){return this._nTotal},set:function(t){this._nTotal!=t&&(this._nTotal=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"barNum",{get:function(){return this._barNum},set:function(t){this._barNum!=t&&(this._barNum=t,this._initStatus())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"progress",{get:function(){return this._progress},set:function(t){this._progress!=t&&(this._progress=cc.misc.clamp01(t),this._updateBarStatus())},enumerable:!1,configurable:!0}),e.prototype._initStatus=function(){var t=this;this.node.destroyAllChildren(),this._maskBars=[],this.allNum&&(this.allNum.string=this._barNum.toString());for(var e=function(e){var i=new cc.Node("maskNode_"+e);i.height=o.node.height-4,i.width=0,i.anchorX=0,i.addComponent(cc.Mask);var n=new cc.Node("bar").addComponent(cc.Sprite);n.type=cc.Sprite.Type.SLICED;var r=1!=o._barNum?e%7:e-1;a.GLoader.spriteAtlasFrame(n,"","bar_"+r,function(){n.node.height=t.node.height-4,n.node.width=t.totalLenth}),n.node.anchorX=0,i.addChild(n.node),o.node.addChild(i),i.position=cc.v2(-o.totalLenth/2,0),o._maskBars.push(i)},o=this,i=1;i<=this._barNum;i++)e(i);this.progress=0},e.prototype._updateBarStatus=function(){if(this._maskBars&&this._maskBars.length){for(var t=1/this._barNum,e=1,o=0;o<this._maskBars.length;o++){var i=this._maskBars[o],n=o+1;if(this._progress>=n*t)i.width=this._totalLenth;else{var r=this._progress-o*t;r>0?(e=r,this.allNum&&(this.allNum.node.parent.active=this._barNum>1,this.allNum.string=(n-1).toString())):r=0,i.width=this._totalLenth*(r/t)}}this.proLabel&&(this._barNum>1?this.proLabel.string=Math.floor(e*t*this._nTotal)+" /"+Math.floor(this._nTotal*t):this.proLabel.string=Math.floor(this._progress*this._nTotal)+" /"+Math.floor(this._nTotal))}},r([l(cc.Label)],e.prototype,"allNum",void 0),r([l(cc.Label)],e.prototype,"proLabel",void 0),r([l],e.prototype,"_totalLenth",void 0),r([l],e.prototype,"totalLenth",null),r([l],e.prototype,"_nTotal",void 0),r([l],e.prototype,"nTotal",null),r([l],e.prototype,"_barNum",void 0),r([l],e.prototype,"barNum",null),r([l],e.prototype,"_progress",void 0),r([l({range:[0,1,.001],slide:!0})],e.prototype,"progress",null),r([c,u("FrameEx/CCMaskProgressMoreBar")],e)}(cc.Component);o.default=h,cc._RF.pop()},{"../GLoader/GLoader":"GLoader"}],CCNodeImpl:[function(t,e,o){"use strict";cc._RF.push(e,"bbd00WGLUJARrwSnXgVGP/B","CCNodeImpl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.CCNodeImpl=void 0;var r=function(t){function e(e){var o=t.call(this)||this;return o.target=null,o.target=e,o}return n(e,t),Object.defineProperty(e.prototype,"groupIndex",{get:function(){return this.target.groupIndex},set:function(t){this.target.groupIndex=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"group",{get:function(){return this.target.group},set:function(t){this.target.group=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this.target.x},set:function(t){this.target.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.target.y},set:function(t){this.target.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.target.position},set:function(t){this.target.position=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.target.rotation},set:function(t){this.target.rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this.target.angle},set:function(t){this.target.angle=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.target.scale},set:function(t){this.target.scale=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{get:function(){return this.target.scaleX},set:function(t){this.target.scaleX=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this.target.scaleY},set:function(t){this.target.scaleY=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchorX",{get:function(){return this.target.anchorX},set:function(t){this.target.anchorX=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opacity",{get:function(){return this.target.opacity},set:function(t){this.target.opacity=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchorY",{get:function(){return this.target.anchorY},set:function(t){this.target.anchorY=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.target.width},set:function(t){this.target.width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this.target.zIndex},set:function(t){this.target.zIndex=Math.min(t,cc.macro.MAX_ZINDEX-1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.target.height},set:function(t){this.target.height=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"active",{get:function(){return this.target.active},set:function(t){this.target.active=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.target.parent},set:function(t){this.target.parent=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.target.name},enumerable:!1,configurable:!0}),e.prototype.convertToWorldSpaceAR=function(t){return this.target.convertToWorldSpaceAR(t)},e.prototype.convertToNodeSpaceAR=function(t){return this.target.convertToNodeSpaceAR(t)},e.prototype.getComponent=function(t){return this.target.getComponent(t)},e.prototype.setPosition=function(t,e){this.target.setPosition(t,e)},e}(t("./ES5Ex").ObjectWrap);o.CCNodeImpl=r,cc._RF.pop()},{"./ES5Ex":"ES5Ex"}],CCSliderEx:[function(t,e,o){"use strict";cc._RF.push(e,"68260UQw2RCTJqci4lB/GHm","CCSliderEx");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc.Enum({Horizontal:0,Vertical:1}),s=cc._decorator,c=s.ccclass,l=s.property,u=s.menu,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.proBar=null,e}return n(e,t),e.prototype._updateHandlePosition=function(){if(this.handle){var t;t=this.direction===a.Horizontal?cc.v2(-this.node.width*this.node.anchorX+this.progress*this.node.width,0):cc.v2(0,-this.node.height*this.node.anchorY+this.progress*this.node.height);var e=this.node.convertToWorldSpaceAR(t),o=this.handle.node.parent.convertToNodeSpaceAR(e);this.direction===a.Horizontal?this.handle.node.x=o.x:this.handle.node.y=o.y,this.proBar&&(this.proBar.fillRange=this.progress)}},r([l(cc.Sprite)],e.prototype,"proBar",void 0),r([c,u("FrameEx/SliderEx")],e)}(cc.Slider);o.default=h,cc._RF.pop()},{}],CanvasEx:[function(t,e,o){"use strict";cc._RF.push(e,"de04fZ/3HBNCaHO7VMPNMDz","CanvasEx");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../GCtrl"),s=cc._decorator,c=s.ccclass,l=(s.property,s.menu),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.onLoad=function(){a.GCtrl.designSize.width/a.GCtrl.designSize.height>cc.view.getVisibleSize().width/cc.view.getVisibleSize().height?(this.fitHeight=!1,this.fitWidth=!0):(this.fitHeight=!0,this.fitWidth=!1)},e.prototype.start=function(){},r([c,l("FrameEx/CanvasEx")],e)}(cc.Canvas);o.default=u,cc._RF.pop()},{"../GCtrl":"GCtrl"}],CeremonialGiftView:[function(t,e,o){"use strict";cc._RF.push(e,"910a8ndMRJO3bEkquW3978+","CeremonialGiftView");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GView/GViewBase"),s=t("../../../Core/GCtrl"),c=t("../../Logic/GameMgr"),l=t("../../Common/Define"),u=t("../../Common/UIResources"),h=t("../../Common/UI"),p=t("../../Data/RunTime/RunRaw/RJXItem"),d=t("../../../conventions/JXCommon"),f=cc._decorator,g=f.ccclass,_=f.property,m=f.menu,y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.items=[],e.item=null,e.costLabel=null,e._itemArr=[],e._curSelectGuess=-1,e._curSelectBet=-1,e._rewardArr={},e._cast={},e._index=0,e._dtTime=0,e._isStartRun=!1,e._endIndex=0,e}return n(e,t),e.prototype.onGStart=function(){var t=this,e=c.default.dialData.getDialByType(3);e.forEach(function(e,o){var i=cc.instantiate(t.item);i.parent=t.items[o],i.position=cc.v2(0,0),i.name="drawItem",t.initTextureWithData(i,e)}),this.initItems(),this._cast=c.default.systemConfig.value(d.JXDef.SYS_CONFIG_KEY.cerDrawCost),this.costLabel.string=this._cast[c.default.lUserData.CeremonialDrawTime],this._rewardArr=e},e.prototype.onViewClose=function(){this.onClose()},e.prototype.onGDestroy=function(){s.GCtrl.ES.off(this)},e.prototype.initItems=function(){for(var t=0;t<c.default.lUserData.CeremonialState.length&&t<this.items.length;t++){var e=this.items[t].getChildByName("drawItem");e.getChildByName("signBtn").active=1==c.default.lUserData.CeremonialState[t],e.getChildByName("light").active=!1}},e.prototype.initTextureWithData=function(t,e){var o=this,i=t.getChildByName("mask").getChildByName("icon").getComponent(cc.Sprite),n=e.award[0];switch(n[l.PART_ITEM.TYPE]){case l.ITEM_TYPE.HERO:var r=c.default.heroData.getRaw(n[l.PART_ITEM.ID]);t.getChildByName("lab").getComponent(cc.Label).string=r.name+"",this.assetImpl.spriteFrame(i,u.Res.texture.hero.hero+r.icon),i.node.setScale(.6),this.assetImpl.spriteAtlasFrame(t.getChildByName("ui_zk").getComponent(cc.Sprite),u.Res.texture.views.sign,"ui_jk"),t.getChildByName("lab").color=cc.color(255,255,255,255);break;case l.ITEM_TYPE.EQUIPDATA:this.assetImpl.spriteAtlasFrame(i,u.Res.texture.views.icon,"icon_201"),t.getChildByName("lab").getComponent(cc.Label).string=n[l.PART_ITEM.NUM]+"";break;case l.ITEM_TYPE.PROP:var a=c.default.itemData.getRaw(n[l.PART_ITEM.ID]);t.getChildByName("lab").getComponent(cc.Label).string="X "+n[l.PART_ITEM.NUM],t.getChildByName("ui_jlmb").active=!1;var s=t.getChildByName("mask");this.assetImpl.prefab(u.Res.prefab.item.jxItem,function(t){var e=o.assetImpl.addGChild(t);e.node.parent=s.getChildByName("icon");var i=new p.default(n);2==a.type?(e.node.scale=.8,e.setView(i,l.ITEM_DETAIL_FLAG.BAG|l.ITEM_DETAIL_FLAG.NO_BG|l.ITEM_DETAIL_FLAG.STOREHERO)):(s.width=60,s.height=60,s.y=10,s.getChildByName("icon").y=-5,e.setView(i,l.ITEM_DETAIL_FLAG.BAG|l.ITEM_DETAIL_FLAG.STOREHERO|l.ITEM_DETAIL_FLAG.SCALEICON|l.ITEM_DETAIL_FLAG.NO_BG))});break;case l.ITEM_TYPE.CURRENCY:}},e.prototype.update=function(t){if(this._isStartRun&&(this._dtTime+=t,this._dtTime>.1)){this._dtTime=0,this._index++;for(var e=0;e<10;e++)this.items[e].getChildByName("drawItem").getChildByName("light").active=!1;var o=this.getDrawIndex(this._index,this._index>=this._endIndex);this.items[o].getChildByName("drawItem").getChildByName("light").active=!0,this._index>=this._endIndex&&(c.default.jumpToMgr.jumpGoTo(h.VIEW_ID.rewardCtrl,this._rewardArr[o].award),this._isStartRun=!1,c.default.lUserData.setCeremonialState(o),c.default.lUserData.CeremonialDrawTime++,c.default.lUserData.CeremonialDrawTime>=10&&(c.default.lUserData.CeremonialDrawTime=0,c.default.lUserData.CeremonialState=[0,0,0,0,0,0,0,0,0,0]),this.initItems(),this.costLabel.string=this._cast[c.default.lUserData.CeremonialDrawTime])}},e.prototype.startDraw=function(){if(!this._isStartRun){var t=new p.default([l.CURRENCY.YUSHI,l.ITEM_TYPE.CURRENCY,this._cast[c.default.lUserData.CeremonialDrawTime]]);c.default.itemMgr.testCost(t,1,!0).enough?(s.GCtrl.ES.emit(l.CMsg.client.bag.onBagItemChange,[[l.CURRENCY.YUSHI,l.ITEM_TYPE.CURRENCY,0-this._cast[c.default.lUserData.CeremonialDrawTime]]]),this._isStartRun=!0,9==c.default.lUserData.CeremonialDrawTime?this._endIndex=10:this._endIndex=Math.floor(10*Math.random())+20,this._index=0):c.default.uiMgr.showToast("\u8d27\u5e01\u4e0d\u8db3")}},e.prototype.videoDraw=function(){var t=this;this._isStartRun||c.default.sdkMgr.watchAd(function(){t._isStartRun=!0,9==c.default.lUserData.CeremonialDrawTime?t._endIndex=10:t._endIndex=Math.floor(10*Math.random())+20,t._index=0})},e.prototype.getDrawIndex=function(t,e){if(9==c.default.lUserData.CeremonialDrawTime)return 0;for(var o=[],i=e?1:0;i<c.default.lUserData.CeremonialState.length;i++)0==c.default.lUserData.CeremonialState[i]&&o.push(i);return o[t%o.length]},r([_(cc.Node)],e.prototype,"items",void 0),r([_(cc.Node)],e.prototype,"item",void 0),r([_(cc.Label)],e.prototype,"costLabel",void 0),r([g,m("View/Fight/CeremonialGiftView")],e)}(a.default);o.default=y,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../../Core/GView/GViewBase":"GViewBase","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Data/RunTime/RunRaw/RJXItem":"RJXItem","../../Logic/GameMgr":"GameMgr"}],ChapterPage:[function(t,e,o){"use strict";cc._RF.push(e,"67224oUvOpEDIFh9IdWITgQ","ChapterPage");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GCtrl"),s=t("../../../Core/GView/GChild"),c=t("../../Common/Define"),l=t("../../Common/UIResources"),u=t("../../Logic/GameMgr"),h=cc._decorator,p=h.ccclass,d=h.property,f=h.menu,g=(h.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.progressBar=null,e.boxLay=null,e.boxNode=null,e.probox=null,e._storyData=null,e._index=null,e._curIsLock=c.CHAPTERBOX.unChapterLock,e}return n(e,t),e.prototype.setLoadProgress=function(t){this.progressBar&&(this.progressBar.progress=Math.min(t,1))},e.prototype.onGLoad=function(){a.GCtrl.ES.on(c.CMsg.client.home.onaddLevel,this,this.init.bind(this))},e.prototype.initData=function(t,e){this._index=e,this._storyData=t,this.init()},e.prototype.init=function(t,e){var o=this;void 0===t&&(t=null),void 0===e&&(e=this._storyData);var i=u.default.lUserData.level<=0?[u.default.lUserData.level+1,u.default.lUserData.level+2]:[u.default.lUserData.level,u.default.lUserData.level+1,u.default.lUserData.level+2];i.length<=2?(this.boxLay.width=350,this.probox.scaleX=.195,this.boxLay.x=0,this.boxNode.x=0,this.probox.x=0,this.boxLay.getComponent(cc.ProgressBar).progress=0):(this.boxLay.width=700,this.boxLay.x=-135,this.boxNode.x=-135,this.probox.scaleX=.39,this.probox.x=-135,this.boxLay.getComponent(cc.ProgressBar).progress=.5),this.boxNode.removeAllChildren(),i.forEach(function(t,e){o.assetImpl.prefab(l.Res.prefab.item.boxItem,function(i){var n=o.assetImpl.addGChild(i);n.node.parent=o.boxNode;var r=350*e;n.node.x=r,n.initBox2(t)})})},r([d(cc.ProgressBar)],e.prototype,"progressBar",void 0),r([d({type:cc.Node,tooltip:"\u5b9d\u7bb1\u56fe\u6807"})],e.prototype,"boxLay",void 0),r([d(cc.Node)],e.prototype,"boxNode",void 0),r([d(cc.Node)],e.prototype,"probox",void 0),r([p,f("Views/Home/ChapterPage")],e)}(s.default));o.default=g,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../../Core/GView/GChild":"GChild","../../Common/Define":"Define","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr"}],ColorAssembler2D:[function(t,e,o){"use strict";cc._RF.push(e,"44a1cxlY5pJiKtJg4XDkXLE","ColorAssembler2D");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.colors=[],e}return n(e,t),e.prototype.start=function(){},e.prototype.onEnable=function(){cc.director.once(cc.Director.EVENT_AFTER_DRAW,this._updateColors,this)},e.prototype.onDisable=function(){cc.director.off(cc.Director.EVENT_AFTER_DRAW,this._updateColors,this),this.node._renderFlag|=cc.RenderFlow.FLAG_COLOR},e.prototype._updateColors=function(){var t=this.getComponent(cc.RenderComponent);if(t){var e=t._assembler;if(e instanceof cc.Assembler2D){var o=e._renderData.uintVDatas[0];if(o)for(var i=this.node.color,n=e.floatsPerVert,r=0,a=e.colorOffset,s=o.length;a<s;a+=n)o[a]=(this.colors[r++]||i)._val}}},r([c({type:cc.Color,tooltip:"\u989c\u8272"})],e.prototype,"colors",void 0),r([s],e)}(cc.Component);o.default=l,cc._RF.pop()},{}],ConditionListener:[function(t,e,o){"use strict";cc._RF.push(e,"3af50x51kVPDLXsU0E9Xk88","ConditionListener");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.convertConditions=o.convertCondition=o.ConditionEmitter=o.ConditionListter=void 0;var r=t("../../Core/CoreDefine"),a=t("../../Core/FrameEx/ES5Ex"),s=t("../../Core/GCtrl"),c=function(t){function e(){var e=t.call(this)||this;return e._emitters=[],e._curState=!1,e._inited=!1,e._emitCbs=[],e}return n(e,t),e.prototype.addCallBack=function(t){this._emitCbs=this._emitCbs||[],this._emitCbs.push(t)},e.prototype.getInitedState=function(){return this._inited},e.prototype.inited=function(){this._inited=!0},e.prototype.addEmitter=function(t){this._curState=!1,this._emitters||(this._emitters=[]),this._emitters.push(t),t.start()},e.prototype.removeEmitter=function(t){if(this._emitters){var e=this._emitters.indexOf(t);e!=r.INVALID_VALUE&&(this._emitters.splice(e,1),this.onConditionChange(t,!0))}},Object.defineProperty(e.prototype,"cureState",{get:function(){return this._curState},enumerable:!1,configurable:!0}),e.prototype.onConditionChange=function(t,e){if(e&&!this._curState){for(var o=!0,i=0;i<this._emitters.length;i++)if(!(o=o&&this._emitters[i].curState)){o=!1;break}if(!o)return;if(this._curState=!0,!this._inited)return;this.emitConditionEnvChange(t)}else if(!e&&this._curState){if(this._curState=!1,!this._inited)return;this.emitConditionEnvChange(t)}},e.prototype.emitConditionEnvChange=function(t){for(var e=0,o=this._emitCbs||[];e<o.length;e++)this._emitCbs[e](t)},e.prototype.toast=function(){for(var t=0;t<this._emitters.length;t++){var e=this._emitters[t];if(!e.curState)return void e.toast()}},e.prototype.guide=function(){for(var t=0;t<this._emitters.length;t++){var e=this._emitters[t];if(!e.curState)return void e.guide()}},e.prototype.destroy=function(){for(;this._emitters.length>0;){var t=this._emitters.pop();t.destroy(),t=null}this._emitters=null,this._inited=!1},e}(a.ObjectWrap);o.ConditionListter=c;var l,u=function(t){function e(e){var o=t.call(this)||this;return o._curState=!1,o._listener=e,o}return n(e,t),e.prototype.initEvent=function(){},e.prototype.unEvent=function(){s.GCtrl.ES.off(this)},e.prototype.initState=function(){},e.prototype.start=function(){this.initState(),this.initEvent()},Object.defineProperty(e.prototype,"curState",{get:function(){return this._curState},enumerable:!1,configurable:!0}),e.prototype.toast=function(){return!1},e.prototype.guide=function(){return!1},e.prototype.destroy=function(){this.unEvent(),this._listener=null},e}(a.ObjectWrap);function h(t){return t[0],null}o.ConditionEmitter=u,function(t){t[t.NONE=0]="NONE"}(l||(l={})),o.convertCondition=h,o.convertConditions=function(t){for(var e=[],o=0;o<t.length;o++){var i=h(t[o]);i&&e.push(i)}return e},cc._RF.pop()},{"../../Core/CoreDefine":"CoreDefine","../../Core/FrameEx/ES5Ex":"ES5Ex","../../Core/GCtrl":"GCtrl"}],CoreDefine:[function(t,e,o){"use strict";cc._RF.push(e,"54cfe4hI6FIS61xCa+MIUda","CoreDefine"),Object.defineProperty(o,"__esModule",{value:!0}),o.PaySateNum=o.OBJECT_ROUTE=o.CONVERT_ATTRIBUTES=o.IS_EMPTY_ARRAY=o.IS_EMPTY_ZERO=o.IS_EMPTY_INVALID=o.OVER_WRITE=o.OBJECT_COPY=o.MaskSpriteType=o.WinPageType=o.WinPage=o.WinCloseMode=o.WinLayer=o.WinAddMode=o.WinMaskStatus=o.WinType=o.WinCreateEnv=o.NetCoreEvent=o.ConnectStates=o.PRIORITY_VIEW=o.PRIORITY_DATA=o.PRIORITY_LOCAL=o.GUIDE_TAG=o.MAX_TAG=o.INVALID_STRING_VALUE=o.INVALID_VALUE=o.INVALID_VALUE_ZERO=void 0,o.INVALID_VALUE_ZERO=0,o.INVALID_VALUE=-1,o.INVALID_STRING_VALUE="-1",o.MAX_TAG=Math.pow(2,15)-1,o.GUIDE_TAG=o.MAX_TAG-1e3,o.PRIORITY_LOCAL=1001,o.PRIORITY_DATA=2001,o.PRIORITY_VIEW=3001,function(t){t[t.ConNull=0]="ConNull",t[t.Connecting=1]="Connecting",t[t.Connected=2]="Connected",t[t.ConnectRe=3]="ConnectRe",t[t.ConnetctErr=4]="ConnetctErr",t[t.ConDis=5]="ConDis",t[t.ForceClose=6]="ForceClose",t[t.WaitConfirm=7]="WaitConfirm"}(o.ConnectStates||(o.ConnectStates={}));var i=function(){function t(){}return t.DIS_CONNECT="disconnect",t.IO_ERROR="io-error",t.CLOSE="close",t.RE_CONNECT="reconnect",t.CONNECTED="connected",t.HSHAKE_ERR="handshake-error",t.HEART_BEAT_TIMEOUT="heartbeat-timeout",t.KICK="onKick",t.WAIT_RECONECT="wait-reconnect",t.RECONECT_TIMES_OUT="reconnect-times-out",t.LOGIC_ERROR="LoginError",t}();o.NetCoreEvent=i,function(t){t[t.New=0]="New",t[t.lStack=1]="lStack",t[t.Heap=2]="Heap",t[t.Recycle=3]="Recycle"}(o.WinCreateEnv||(o.WinCreateEnv={})),function(t){t[t.FullView=0]="FullView",t[t.Navigator=1]="Navigator",t[t.Window=2]="Window",t[t.Fix=3]="Fix"}(o.WinType||(o.WinType={})),o.WinMaskStatus={kNone:1,kOnlyShow:2,kTouchClose:4,kOpacity156:8,kOpacity255:16,kUnBlockInput:32,kOpacity56:64},function(t){t[t.ReplaceLayer=0]="ReplaceLayer",t[t.ReplaceSelf=1]="ReplaceSelf",t[t.PushLower=2]="PushLower",t[t.PushHeigh=3]="PushHeigh",t[t.Stack=4]="Stack"}(o.WinAddMode||(o.WinAddMode={})),function(t){t[t.NONE=0]="NONE",t[t.FirstWindow=1]="FirstWindow",t[t.Navigator=2]="Navigator",t[t.SecondWindow=3]="SecondWindow",t[t.ThirdWindow=4]="ThirdWindow",t[t.UnCheckMutex=5]="UnCheckMutex",t[t.TouchShow=6]="TouchShow",t[t.WarnWindow=7]="WarnWindow",t[t.RollWindow=8]="RollWindow",t[t.TopWindow=9]="TopWindow",t[t.TopUpWindow=10]="TopUpWindow",t[t.ClickEffect=11]="ClickEffect"}(o.WinLayer||(o.WinLayer={})),o.WinCloseMode={PopAll:1,Hide:4,Recycle:16,OnlyDestroy:32},function(t){t[t.Page0=0]="Page0",t[t.Page1=1]="Page1",t[t.Page2=2]="Page2",t[t.Page3=3]="Page3",t[t.Page4=4]="Page4",t[t.Page5=5]="Page5",t[t.Page6=6]="Page6"}(o.WinPage||(o.WinPage={})),function(t){t[t.Node=0]="Node",t[t.GPage=1]="GPage",t[t.Content=2]="Content"}(o.WinPageType||(o.WinPageType={})),function(t){t[t.Square=0]="Square",t[t.Clire=1]="Clire",t[t.Octagon=2]="Octagon",t[t.CardClip=3]="CardClip"}(o.MaskSpriteType||(o.MaskSpriteType={})),o.OBJECT_COPY=function(t){return t?JSON.parse(JSON.stringify(t)):null},o.OVER_WRITE=function(t,e){for(var o in e)null!=e[o]&&(t[o]=e[o])},o.IS_EMPTY_INVALID=function(t){return null==t||t==o.INVALID_VALUE||t==o.INVALID_STRING_VALUE},o.IS_EMPTY_ZERO=function(t){return null==t||0==t||"0"==t},o.IS_EMPTY_ARRAY=function(t){if(!t)return!0;for(var e=0;e<t.length;e++)if(t[e])return!1;return!0},o.CONVERT_ATTRIBUTES=function(t){for(var e=[],o=0,i=t;o<i.length;o++){var n=i[o];e[n[0]]=n[1]}return e},o.OBJECT_ROUTE=function t(e,o){for(var i in o=o?o+".":"",e)"string"==typeof e[i]?e[i]=o+i:t(e[i],o+i)},function(t){t[t.NonPayment=0]="NonPayment",t[t.DisPayment=1]="DisPayment",t[t.DisPaymentTip=2]="DisPaymentTip"}(o.PaySateNum||(o.PaySateNum={})),cc._RF.pop()},{}],CurrencyFrame:[function(t,e,o){"use strict";cc._RF.push(e,"727acrQYeRA/ov9uMXi4EMx","CurrencyFrame");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/GCtrl"),c=t("../../../Core/GView/GViewBase"),l=t("../../../Core/Manager/AudioMgr"),u=t("../../Common/Define"),h=t("../../Common/Language"),p=t("../../Common/UI"),d=t("../../Common/UIResources"),f=t("../../Common/Zh"),g=t("../../Data/RunTime/RunRaw/RJXItem"),_=t("../../Logic/GameMgr"),m=cc._decorator,y=m.ccclass,v=m.property,C=m.menu,I=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lab=null,e.icon=null,e.btn=null,e.videoBtn=null,e.icon_plane=null,e.videoImg=null,e.videoLab=null,e.heroChip=null,e.text="hello",e._isWatch=!1,e._videoNum=null,e._equipId=null,e._del=!1,e}return n(e,t),e.prototype.onGStart=function(e,o,i,n){void 0===o&&(o=1),void 0===i&&(i=!1),t.prototype.onGStart.call(this),this._del=i,i?(this.del(e),this._equipId=n):e[0]==u.SPECIALWINDOW.VIDEO?(this.videoInit(),this.icon_plane.active=!1):e[0]==u.SPECIALWINDOW.HELP?this.helpInit(e):this.init(e)},e.prototype.helpInit=function(t){this.btn.active=!1,this.videoBtn.active=!1;var e=_.default.heroData.getRaw(t[1]).tale;this.lab.string=e},e.prototype.videoInit=function(){var t=h.L(f.JXLocales.currencyLab["info"+u.SPECIALWINDOW.VIDEO]);this.lab.string=t,this.assetImpl.spriteAtlasFrame(this.icon,d.Res.texture.views.vip,"vipBottom")},e.prototype.init=function(t){var e=t instanceof Array?g.default.tpl.apply(g.default,t):t,o=_.default.RBagData.getMegreItems(e.id,e.type),i=_.default.lUserData.officerLv;switch(this._data=o,this.icon_plane.active=!1,console.log("\u901a\u7528\u6846",o),this._data.type){case u.ITEM_TYPE.CURRENCY:switch(this._data.id){case u.CURRENCY.GOLD:var n=0;n=_.default.officerData.getTv(i,0),this._videoNum=_.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.videoAwardsGold),this._videoNum+=n,this.icon_plane.active=!1;break;case u.CURRENCY.YUSHI:n=0,n=_.default.officerData.getTv(i,1),this._videoNum=_.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.videoAwardsGem),this._videoNum+=n,this.icon_plane.active=!1;break;case u.CURRENCY.WHEAT:this._videoNum=_.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.forageUp),this.icon.node.scale=2,this.icon_plane.active=!1}var r=h.L(f.JXLocales.currencyLab["info"+this._data.id],this._videoNum);this.lab.string=r,this.assetImpl.spriteAtlasFrame(this.icon,d.Res.texture.views.icon,"icon_"+this._data.id);break;case u.ITEM_TYPE.PROP:this._data.id>=u.PILL.PILL0&&this._data.id<=u.PILL.PILL5&&(this.assetImpl.spriteAtlasFrame(this.icon,d.Res.texture.views.icon,"icon_201"),r=h.L(f.JXLocales.currencyLab.info201,1),this._videoNum=1,this.lab.string=r),this._data.id>=1001&&this._data.id<=2e3&&(this._videoNum=_.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.heroTv),r=h.L(f.JXLocales.currencyLab.info1001,this._videoNum),this.lab.string=r,this.assetImpl.spriteAtlasFrame(this.icon,d.Res.texture.views.icon,"icon_plane"),this.assetImpl.spriteFrame(this.heroChip,d.Res.texture.hero.hero+this._data.id),this.icon_plane.active=!0);break;case u.ITEM_TYPE.EQUIPDATA:case u.ITEM_TYPE.HERO:}},e.prototype.del=function(t){t instanceof Array&&g.default.tpl.apply(g.default,t),this._costData=t,this.videoImg.active=!1,this.videoLab.x=0;var e=_.default.lUserData.officerLv;_.default.officerData.getTv(e,1),this._videoNum=t[2];var o=h.L(f.JXLocales.currencyLab["del"+t[0]],this._videoNum);this.lab.string=o,this.assetImpl.spriteAtlasFrame(this.icon,d.Res.texture.views.icon,"icon_"+t[0])},e.prototype.start=function(){},e.prototype.adBtn=function(){var t=this;if(!this._isWatch)if(this.videoImg.active){this._isWatch=!0;var e="";if(!this._data)return void _.default.sdkMgr.watchAd(function(){t._isWatch=!1,t.close()},function(){t._isWatch=!1},"\u89c2\u770b\u89c6\u9891\u63d0\u5347vip\u7b49\u7ea7");this._data.id===u.CURRENCY.YUSHI?e="\u83b7\u53d6\u7389\u77f3":this._data.id===u.CURRENCY.GOLD?e="\u83b7\u53d6\u91d1\u5e01":this._data.id===u.CURRENCY.WHEAT&&(e="\u83b7\u53d6\u7cae\u8349"),_.default.sdkMgr.watchAd(function(){t._isWatch=!1,null!=t._videoNum?(t._data.id===u.CURRENCY.YUSHI?_.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.common,{msg:u.PointInfo.common_ad_yushi}):t._data.id===u.CURRENCY.GOLD&&_.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.common,{msg:u.PointInfo.common_ad_coin}),t._data.type==u.ITEM_TYPE.PROP&&t._data.id>=1001&&t._data.id<=2e3&&_.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.common,{msg:u.PointInfo.common_ad_chip}),t._data.type==u.ITEM_TYPE.PROP&&t._data.id>=u.PILL.PILL0&&t._data.id<=u.PILL.PILL5&&_.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.common,{msg:u.PointInfo.common_ad_pill}),t._data.id===u.CURRENCY.WHEAT&&_.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.common,{msg:u.PointInfo.common_ad_wheat}),_.default.jumpToMgr.jumpGoTo(p.VIEW_ID.rewardCtrl,[[t._data.id,t._data.type,t._videoNum]])):_.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.VipCtrl,{msg:u.PointInfo.vip_btn}),t.close()},function(){t._isWatch=!1},e)}else s.GCtrl.ES.emit(u.CMsg.client.equip.ondelEquip,this._equipId),_.default.jumpToMgr.jumpGoTo(p.VIEW_ID.rewardCtrl,[this._costData]),this.close()},e.prototype.close=function(){this._del&&l.AudioMgr.Ins().playEffect(d.Res.audio.coin),this.onClose()},r([v({type:cc.Label,tooltip:"\u6587\u6848"})],e.prototype,"lab",void 0),r([v({type:cc.Sprite,tooltip:"\u56fe\u6807"})],e.prototype,"icon",void 0),r([v({type:cc.Node,tooltip:"\u6309\u94ae"})],e.prototype,"btn",void 0),r([v({type:cc.Node,tooltip:"ad\u6309\u94ae"})],e.prototype,"videoBtn",void 0),r([v({type:cc.Node,tooltip:"zhezhao"})],e.prototype,"icon_plane",void 0),r([v({type:cc.Node,tooltip:"ad\u6309\u94ae\u56fe\u7247"})],e.prototype,"videoImg",void 0),r([v({type:cc.Node,tooltip:"ad\u6309\u94ae\u6587\u6848"})],e.prototype,"videoLab",void 0),r([v(cc.Sprite)],e.prototype,"heroChip",void 0),r([y,C("View/Common/CurrencyFrame")],e)}(c.default);o.default=I,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../../Core/GView/GViewBase":"GViewBase","../../../Core/Manager/AudioMgr":"AudioMgr","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/Language":"Language","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Common/Zh":"Zh","../../Data/RunTime/RunRaw/RJXItem":"RJXItem","../../Logic/GameMgr":"GameMgr"}],DailyView:[function(t,e,o){"use strict";cc._RF.push(e,"79cbaD5+S1CkLDHo9oVpvQD","DailyView");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GCtrl"),s=t("../../../Core/GView/GListView"),c=t("../../../Core/GView/GViewBase"),l=t("../../Common/Define"),u=t("../../Common/UI"),h=t("../../Common/UIResources"),p=t("../../Data/RunTime/RunRaw/RJXItem"),d=t("../../Entity/ArmRoleScript"),f=t("../../Logic/GameMgr"),g=t("../../Logic/UserMgr"),_=t("../Common/JXItem"),m=t("./../ViewUtil/VIewUtil"),y=cc._decorator,v=y.ccclass,C=y.property,I=y.menu,E=(y.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dailView=null,e.dailyItem=null,e.rewardItem=null,e.scrollView=null,e.boxLayout=null,e.view=null,e.progressbar=null,e.huoyueLabel=null,e._listView=null,e}return n(e,t),e.prototype.onGStart=function(){this.initEmbattle()},e.prototype.initList=function(){var t=f.default.dailyTaskData.data,e=[],o=[];t.forEach(function(t){e.push(t)});for(var i=0;i<e.length;i++)0==(n=g.default.ins().getDailyTaskState(e[i].id)).receive&&n.ftime>=e[i].needNum&&o.push(e[i]);for(i=0;i<e.length;i++)0==(n=g.default.ins().getDailyTaskState(e[i].id)).receive&&n.ftime<e[i].needNum&&o.push(e[i]);for(i=0;i<e.length;i++){var n;1==(n=g.default.ins().getDailyTaskState(e[i].id)).receive&&o.push(e[i])}this._listView.setData(o)},e.prototype.initItem=function(t,e){var o=t.node;o.getChildByName("infolabel").getComponent(cc.Label).string=e.txt;var i=g.default.ins().getDailyTaskState(e.id);o.getChildByName("barLabel").getComponent(cc.Label).string=Math.min(i.ftime,e.needNum)+"/"+e.needNum,o.getChildByName("ProgressBar").getComponent(cc.ProgressBar).progress=Math.min(i.ftime,e.needNum)/e.needNum;var n=o.getChildByName("Layout"),r=e.award;n.removeAllChildren();for(var a=0;a<r.length;a++){var s=cc.instantiate(this.rewardItem);n.addChild(s),s.position=cc.v2(0,0);var c=s.getChildByName("JXItem"),u=new p.default(r[a]);this.assetImpl.spriteAtlasFrame(s.getComponent(cc.Sprite),h.Res.texture.views.common,"equip_"+u.raw.quality),c.getComponent(_.default).setView(u,l.ITEM_DETAIL_FLAG.SHOWNUM|l.ITEM_DETAIL_FLAG.BAG|l.ITEM_DETAIL_FLAG.NO_BG|l.ITEM_DETAIL_FLAG.SCALEICON|l.ITEM_DETAIL_FLAG.STOREHERO)}var d=o.getChildByName("anjian2"),f=d.getChildByName("Label");1==i.receive?(this.assetImpl.spriteFrame(d.getComponent(cc.Sprite),"frames/common/anjian3"),f.getComponent(cc.Label).string="",d.removeComponent(cc.Button)):i.ftime>=e.needNum?(this.assetImpl.spriteFrame(d.getComponent(cc.Sprite),"frames/common/anjian1"),f.getComponent(cc.Label).string="",m.ViewUtil.addButtonHander(d,this.node,"DailyView","receiveDailyClick",e)):(this.assetImpl.spriteFrame(d.getComponent(cc.Sprite),"frames/common/anjian5"),f.getComponent(cc.Label).string=e.btnText,m.ViewUtil.addButtonHander(d,this.node,"DailyView","doDailyClick",e))},e.prototype.initEmbattle=function(){this._listView?this.initList():(this._listView=new s.GListView({scrollview:this.scrollView,mask:this.view,content:this.dailView,itemTpl:cc.instantiate(this.dailyItem),itemSetter:this.initItem.bind(this),column:1,gapY:20,gapX:0,padingY:0,padingX:0,isCbClass:!0,isWidget:!1}),this.initList()),this.initBoxState()},e.prototype.initBoxState=function(){var t=f.default.RBagData.getMegreItems(104,l.ITEM_TYPE.CURRENCY).num;this.progressbar.getComponent(cc.ProgressBar).progress=t/100,this.huoyueLabel.string=t+"";for(var e=function(e){var i=o.boxLayout.getChildByName("box"+e),n=i.getChildByName("boxIcon");cc.Tween.stopAllByTarget(n),t>=25*e?1==f.default.lUserData.getDailyBoxReceive(e)?(o.assetImpl.spriteFrame(n.getComponent(cc.Sprite),"frames/common/boxopen"),i.getChildByName("boxlight").active=!1,n.y=7):(i.getChildByName("boxlight").active=!0,cc.tween(n).call(function(){n.getComponent(cc.Animation).play("boxShake")}).delay(1).union().repeatForever().start(),o.assetImpl.spriteFrame(n.getComponent(cc.Sprite),"frames/common/boxclose")):(i.getChildByName("boxlight").active=!1,o.assetImpl.spriteFrame(n.getComponent(cc.Sprite),"frames/common/boxgrey"))},o=this,i=1;i<=4;i++)e(i)},e.prototype.doDailyClick=function(t,e){switch(e.type){case 2:this.onClose(),f.default.jumpToMgr.jumpGoTo(u.VIEW_ID.sginIn);break;case 3:f.default.jumpToMgr.jumpGoTo(u.VIEW_ID.rewardCtrl,[[l.CURRENCY.WHEAT,l.ITEM_TYPE.CURRENCY,d.default._addWheatNum]],null,!1,!0),g.default.ins().addDailyTaskState(3,1),this.initEmbattle();break;case 4:f.default.jumpToMgr.jumpGoTo(u.VIEW_ID.rewardCtrl,[[l.CURRENCY.GOLD,l.ITEM_TYPE.CURRENCY,d.default._addCoinNum]],null,!1,!0),g.default.ins().addDailyTaskState(4,1),this.initEmbattle();break;case 5:g.default.ins().drawCard(1),this.initEmbattle();break;case 6:this.onClose(),a.GCtrl.ES.emit("gotoStore");break;case 7:case 8:case 9:this.onClose(),a.GCtrl.ES.emit("gotoHeroView");break;default:this.onClose()}},e.prototype.receiveDailyClick=function(t,e){g.default.ins().setDailyTaskReceive(parseInt(e.id),1),f.default.jumpToMgr.jumpGoTo(u.VIEW_ID.rewardCtrl,e.award),this.initEmbattle()},e.prototype.openBox=function(t,e){var o=parseInt(e),i=f.default.RBagData.getMegreItems(104,l.ITEM_TYPE.CURRENCY).num;1!=f.default.lUserData.getDailyBoxReceive(o)&&i>=25*o&&(f.default.jumpToMgr.jumpGoTo(u.VIEW_ID.rewardCtrl,f.default.systemConfig.value("EOS"+o),null,!1,!0),f.default.lUserData.setDailyBoxReceive(o),this.initBoxState())},r([C({type:cc.Node,tooltip:"\u4efb\u52a1\u5217\u8868"})],e.prototype,"dailView",void 0),r([C({type:cc.Node,tooltip:"\u4efb\u52a1\u6a21\u677f"})],e.prototype,"dailyItem",void 0),r([C({type:cc.Node,tooltip:"\u5956\u52b1\u8282\u70b9"})],e.prototype,"rewardItem",void 0),r([C({type:cc.ScrollView,tooltip:"\u88c5\u5907\u89c6\u56fe"})],e.prototype,"scrollView",void 0),r([C({type:cc.Node,tooltip:"\u5b9d\u7bb1layout"})],e.prototype,"boxLayout",void 0),r([C({type:cc.Node,tooltip:"\u53ef\u89c6\u533a\u57df"})],e.prototype,"view",void 0),r([C({type:cc.Node})],e.prototype,"progressbar",void 0),r([C({type:cc.Label})],e.prototype,"huoyueLabel",void 0),r([v,I("View/Home/DailyView")],e)}(c.default));o.default=E,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../../Core/GView/GListView":"GListView","../../../Core/GView/GViewBase":"GViewBase","../../Common/Define":"Define","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Data/RunTime/RunRaw/RJXItem":"RJXItem","../../Entity/ArmRoleScript":"ArmRoleScript","../../Logic/GameMgr":"GameMgr","../../Logic/UserMgr":"UserMgr","../Common/JXItem":"JXItem","./../ViewUtil/VIewUtil":"VIewUtil"}],DataPool:[function(t,e,o){"use strict";cc._RF.push(e,"e993fptHARDjpYjK2L9w4Z5","DataPool");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.DataPool=o.GLocal=o.GRunTime=o.GStatic=o.GData=void 0;var r=t("../CoreDefine"),a=t("../FrameEx/ES5Ex"),s=t("../GCtrl"),c=t("../GLoader/GLoader"),l={getRaw:function(){return console.log("%cGetRaw Error! may the data configure unload.","color:red"),null}},u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.clear=function(){return!0},e}(cc.Component);o.GData=u;var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._data=new a.MapWrap,e}return n(e,t),e.prototype.parse=function(t){return!!t},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._data.size},enumerable:!1,configurable:!0}),e.prototype.getRaw=function(t){var e=this._data.get(t);return r.OBJECT_COPY(e)},e.prototype.tryGetRaw=function(t){return this._data.get(t)},e.prototype.getComRaw=function(t,e){return this._data.get(t).get(e)},e.prototype.hasRaw=function(t){return this._data.has(t)},e.prototype.clear=function(){var t=[];this._data.forEach(function(e,o){t.push(o)});for(var e=0;e<t.length;e++)this._data.has(t[e])&&this._data.delete(t[e]);return this._data.clear(),!0},e.addonRaw=function(t){return t},e}(u);o.GStatic=h;var p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.clear=function(){return s.GCtrl.ES.off(this),!0},e}(u);o.GRunTime=p;var d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.set=function(){var t=cc.js.createMap(!0);for(var e in this)e.indexOf("$")!=r.INVALID_VALUE&&(t[e]=this[e]);cc.sys.localStorage.setItem(this.$localKey,JSON.stringify(t))},e.prototype.remove=function(){cc.sys.localStorage.removeItem(this.$localKey),this.unscheduleAllCallbacks(),s.GCtrl.ES.off(this)},e.prototype.load=function(){var t=cc.sys.localStorage.getItem(this.$localKey);t&&cc.js.mixin(this,JSON.parse(t))},e}(u);o.GLocal=d;var f=function(){function t(){this.spools=new a.MapWrap,this.rpools=new a.MapWrap,this.lpools=new a.MapWrap,this.spools.clear(),this.rpools.clear()}return t.ins=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.getStatic=function(t){var e=cc.js.getClassName(t);return this.spools.get(e)||(cc.log("GStatic Data: '"+e+"' don't init, it where return a fix object with function getRaw!"),l)},t.prototype.getRunTime=function(t){var e=cc.js.getClassName(t),o=this.rpools.get(e);return o||((o=new t).onInit(),this.rpools.set(e,o)),o},t.prototype.getLocal=function(t){var e=cc.js.getClassName(t),o=this.lpools.get(e);return o||((o=new t).onInit(),this.lpools.set(e,o)),o},t.prototype.clearStatic=function(t){var e=cc.js.getClassName(t),o=this.spools.get(e);o&&(o.clear(),this.spools.delete(e),o=null)},t.prototype.clearRunTime=function(t){var e=cc.js.getClassName(t),o=this.rpools.get(e);o&&(o.clear(),this.rpools.delete(e),o=null)},t.prototype.clearStatics=function(){var t=this;this.spools.forEach(function(e,o){var i=cc.js.getClassByName(o);t.clearRunTime(i)})},t.prototype.clearRunTimes=function(){var t=this;this.rpools.forEach(function(e,o){var i=cc.js.getClassByName(o);t.clearRunTime(i)})},t.prototype.clearLocals=function(){var t=this;this.lpools.forEach(function(e,o){var i=cc.js.getClassByName(o);t.clearLocal(i)})},t.prototype.clearLocal=function(t){var e=cc.js.getClassName(t),o=this.lpools.get(e);o&&(o.remove(),this.lpools.delete(e),o=null)},t.prototype.createStaticPool=function(t,e){t.indexOf("SMulLangugeData")!=r.INVALID_VALUE&&(t="SMulLangugeData");var o=cc.js.getClassByName(t);if(o)if("function"==typeof o)if(cc.js.isChildClassOf(o,cc.Component)){var i=this.spools.get(t);i||(i=new o,this.spools.set(t,i)),i.parse(e)}else cc.error("constructor not child class of cc.Component!");else cc.error("Constructor not function\uff01");else cc.log("Class: '"+t+"' not find!")},t.prototype.cvtTbn2Clsn=function(t){return"S"+t[0].toUpperCase()+t.substring(1,t.length)},t.prototype.loadRTStatic=function(e,o){var i,n=this;void 0===o&&(o=null),i=c.GAssetImpl.loader.loadRes.bind(c.GAssetImpl.loader);var r=window.cdnPrifix||"",a=function(e){if(t.__enNames){var o=t.__enNames[e._id];e._name=o;for(var i=e.data,n=e.data=[],r=t.__enCloums[e._id],a=Object.keys(r),s=0;s<e._length;s++)for(var c=n[s]={},l=0;l<a.length;l++)c[r[a[l]]]=i[a[l]][s]}};i(r+e,cc.JsonAsset,function(t,i){if(t)cc.error("can't find statis file"+e);else{if(i.__merges)for(var r=i.__datas,s=0;s<r.length;s++){var c=r[s].json;a(c);var l=c._name,u=n.cvtTbn2Clsn(l);n.createStaticPool(u,c)}else c=i.json,a(c),l=c._name,u=n.cvtTbn2Clsn(l),n.createStaticPool(u,c);cc.assetManager.releaseAsset(i),o&&o(e)}})},t.prototype.loadRTStatics=function(t,e,o){void 0===e&&(e=null),void 0===o&&(o=null);var i=t.length,n=0;if(i>0)for(var r=0;r<t.length;r++)window.wdStatics.loadStatus[t[r]]?++n==i&&o&&o():this.loadRTStatic(t[r],function(t){n++,e&&e(t,n,i),n==i&&o&&o()});else o&&o()},t._instance=null,t}();o.DataPool=f,cc._RF.pop()},{"../CoreDefine":"CoreDefine","../FrameEx/ES5Ex":"ES5Ex","../GCtrl":"GCtrl","../GLoader/GLoader":"GLoader"}],Define:[function(t,e,o){"use strict";cc._RF.push(e,"4d3bbk7NUhFHq7Urt6847MN","Define"),Object.defineProperty(o,"__esModule",{value:!0}),o.PART_GOODS=o.HEROBUFF=o.BUFFINFO=o.RedpointEffect=o.getHeroLoad=o.showProptsInfo=o.LinearState=o.PointInfo=o.REWARD=o.FRONT=o.CHESS=o.GuidEnum=o.PART_BTL_SCENE=o.ToastType=o.BLESSEND_INFO=o.BLESS=o.CompareEnum=o.LoadingType=o.PART_EQUIP=o.MapLayer=o.MATERIAL_INFO=o.GRID_INFO=o.INFO_TYPE=o.GOODSTYPE=o.ITEM_DETAIL_FLAG=o.HEROCHIPINFO=o.PILL=o.STAR=o.RANGE=o.LISTENTTYPE=o.ITEM_TYPE=o.PART_ITEM=o.SQUAD_BUTTON=o.STOREBUYTYPE=o.STOREBTNTYPE=o.BOXPREVIEW=o.VIPBOXTYPE=o.VIPRECEIVE=o.OFFICERITEM=o.SELLSTORE=o.EQUIP_PART=o.PART_PROPTS=o.DETAILSBTN=o.SPECIALWINDOW=o.CURRENCY=o.HERO_TRAIT=o.GRID_TYPE=o.RPointMask=o.RedpointPos=o.Channel=void 0,o.KF=o.CMsg=o.TEXTURE_PREFIX=o.CHECK_TIME=o.SUIT=o.CHAPTERBOX=void 0;var i=t("./../../Core/CoreDefine");(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.WECHAT=1]="WECHAT",t[t.TT=2]="TT",t[t.KS=3]="KS",t[t.OPPO=4]="OPPO",t[t.VIVO=5]="VIVO",t[t.MEIZU=6]="MEIZU",t[t.XIAOMI=7]="XIAOMI",t[t.ANDROID233=8]="ANDROID233"})(o.Channel||(o.Channel={})),function(t){t[t.Main=0]="Main",t[t.right=1]="right"}(o.RedpointPos||(o.RedpointPos={})),function(t){t[t.RPM_Client=300]="RPM_Client",t[t.RPM_Vip_Frist=301]="RPM_Vip_Frist",t[t.RPM_Vip_Daily=302]="RPM_Vip_Daily",t[t.RPM_Office=303]="RPM_Office",t[t.RPM_Sign=304]="RPM_Sign",t[t.RPM_Tower=305]="RPM_Tower",t[t.RPM_Go_To_Battle=306]="RPM_Go_To_Battle",t[t.RPM_Hero_UnLock=307]="RPM_Hero_UnLock",t[t.RPM_Hero_LvUp=308]="RPM_Hero_LvUp",t[t.RPM_Hero_Tupo=309]="RPM_Hero_Tupo",t[t.RPM_Hero_AddStar=310]="RPM_Hero_AddStar",t[t.RPM_Have_Base=311]="RPM_Have_Base",t[t.RPM_Have_Sync=312]="RPM_Have_Sync",t[t.RPM_Have_LvUp=313]="RPM_Have_LvUp",t[t.RPM_Box_Baiyin=314]="RPM_Box_Baiyin",t[t.RPM_Box_Huangjin=315]="RPM_Box_Huangjin",t[t.RPM_Box_Zhuanshu=316]="RPM_Box_Zhuanshu",t[t.RPM_Box_Receive=317]="RPM_Box_Receive",t[t.RPM_Task_Receive=318]="RPM_Task_Receive"}(o.RPointMask||(o.RPointMask={})),function(t){t[t.VOID=0]="VOID",t[t.ROAD=1]="ROAD",t[t.PLAYSTART=2]="PLAYSTART",t[t.SURFACE=3]="SURFACE",t[t.PLACE=4]="PLACE",t[t.BARRACKS=5]="BARRACKS"}(o.GRID_TYPE||(o.GRID_TYPE={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.WHITE=1]="WHITE",t[t.GREEN=2]="GREEN",t[t.BLUE=3]="BLUE",t[t.PURPLE=4]="PURPLE",t[t.YELLOW=5]="YELLOW",t[t.RED=6]="RED"}(o.HERO_TRAIT||(o.HERO_TRAIT={})),function(t){t[t.YUSHI=100]="YUSHI",t[t.GOLD=101]="GOLD",t[t.FEATS=102]="FEATS",t[t.WHEAT=103]="WHEAT",t[t.ACTIVEVAL=104]="ACTIVEVAL"}(o.CURRENCY||(o.CURRENCY={})),function(t){t[t.HEROCHIP=77777]="HEROCHIP",t[t.HELP=88888]="HELP",t[t.VIDEO=99999]="VIDEO"}(o.SPECIALWINDOW||(o.SPECIALWINDOW={})),function(t){t[t.DETAILSBTN0=0]="DETAILSBTN0",t[t.DETAILSBTN1=1]="DETAILSBTN1",t[t.DETAILSBTN2=2]="DETAILSBTN2",t[t.DETAILSBTN3=3]="DETAILSBTN3"}(o.DETAILSBTN||(o.DETAILSBTN={})),function(t){t[t.GongJi=0]="GongJi",t[t.FangYu=1]="FangYu",t[t.XueLiang=2]="XueLiang",t[t.BaoJi=3]="BaoJi",t[t.ShanBi=4]="ShanBi",t[t.BaoShang=5]="BaoShang",t[t.BingGong=6]="BingGong",t[t.HuoGong=7]="HuoGong",t[t.BingKang=8]="BingKang",t[t.HuoKang=9]="HuoKang",t[t.FormulaMaxHp=24]="FormulaMaxHp"}(o.PART_PROPTS||(o.PART_PROPTS={})),function(t){t[t.CLOTHING=0]="CLOTHING",t[t.WUQI=1]="WUQI",t[t.HEAD=2]="HEAD",t[t.BINGSHU1=3]="BINGSHU1",t[t.BINGSHU2=4]="BINGSHU2",t[t.BINGSHU3=5]="BINGSHU3"}(o.EQUIP_PART||(o.EQUIP_PART={})),function(t){t[t.FREE=0]="FREE",t[t.COIN=1]="COIN",t[t.DIAMONDS=2]="DIAMONDS",t[t.VIDEO=3]="VIDEO"}(o.SELLSTORE||(o.SELLSTORE={})),function(t){t[t.NOT=0]="NOT",t[t.LOCK=1]="LOCK",t[t.RECEICE=2]="RECEICE"}(o.OFFICERITEM||(o.OFFICERITEM={})),function(t){t[t.No=0]="No",t[t.FIRSTNORECEIVE=1]="FIRSTNORECEIVE",t[t.DATNORECEIVE=2]="DATNORECEIVE",t[t.FIRSTRECEIVE=3]="FIRSTRECEIVE",t[t.DAYRECEIVE=4]="DAYRECEIVE"}(o.VIPRECEIVE||(o.VIPRECEIVE={})),function(t){t[t.DAYBOX=0]="DAYBOX",t[t.FIRSTBOX=1]="FIRSTBOX"}(o.VIPBOXTYPE||(o.VIPBOXTYPE={})),function(t){t[t.DAYBOX=0]="DAYBOX",t[t.FIRSTBOX=1]="FIRSTBOX",t[t.LEVELBOX=2]="LEVELBOX",t[t.OFFICEBOX=3]="OFFICEBOX"}(o.BOXPREVIEW||(o.BOXPREVIEW={})),function(t){t[t.boxL=0]="boxL",t[t.boxR=1]="boxR",t[t.silverBoxL=2]="silverBoxL",t[t.silverBoxR=3]="silverBoxR",t[t.goldBoxL=4]="goldBoxL",t[t.goldBoxR=5]="goldBoxR"}(o.STOREBTNTYPE||(o.STOREBTNTYPE={})),function(t){t[t.COIN=0]="COIN",t[t.YUSHI=1]="YUSHI",t[t.VIDEO=2]="VIDEO"}(o.STOREBUYTYPE||(o.STOREBUYTYPE={})),function(t){t[t.ALL=0]="ALL",t[t.SOLDIER=1]="SOLDIER",t[t.VEHICLE=2]="VEHICLE",t[t.HORSE=3]="HORSE",t[t.CANNON=4]="CANNON",t[t.MUTUALLY=5]="MUTUALLY",t[t.SCHOLAR=6]="SCHOLAR"}(o.SQUAD_BUTTON||(o.SQUAD_BUTTON={})),function(t){t[t.ID=0]="ID",t[t.TYPE=1]="TYPE",t[t.NUM=2]="NUM"}(o.PART_ITEM||(o.PART_ITEM={})),function(t){t[t.HERO=0]="HERO",t[t.EQUIPDATA=1]="EQUIPDATA",t[t.PROP=2]="PROP",t[t.CURRENCY=3]="CURRENCY"}(o.ITEM_TYPE||(o.ITEM_TYPE={})),function(t){t[t.listent1=0]="listent1",t[t.listent2=1]="listent2",t[t.listent3=2]="listent3"}(o.LISTENTTYPE||(o.LISTENTTYPE={})),function(t){t[t.RANGE1=0]="RANGE1",t[t.RANGE2=1]="RANGE2",t[t.RANGE3=2]="RANGE3"}(o.RANGE||(o.RANGE={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.star0=1]="star0",t[t.star1=2]="star1",t[t.star2=3]="star2",t[t.star3=4]="star3"}(o.STAR||(o.STAR={})),function(t){t[t.PILL0=201]="PILL0",t[t.PILL1=202]="PILL1",t[t.PILL2=203]="PILL2",t[t.PILL3=204]="PILL3",t[t.PILL4=205]="PILL4",t[t.PILL5=206]="PILL5"}(o.PILL||(o.PILL={})),function(t){t[t.HEROID=0]="HEROID",t[t.HEROCHIPNUM=1]="HEROCHIPNUM"}(o.HEROCHIPINFO||(o.HEROCHIPINFO={})),o.ITEM_DETAIL_FLAG={BAG:1,TPL:2,BUY:4,NOT_OP:8,NOT_TOUCH:16,NUMPOS_ITEM_BC:32,NO_NUM:64,SELECT:128,NO_BG:256,ICON_SCALE:512,MATERIAL_NO_HAVE:1024,NO_NUM_NODE:2048,MATERIAL:4096,NUM_SCALE:8192,MATERIAL_STYLE_LINE:4864,TOUCH:16384,BLESS:32768,NO_BG_SHOWSLV:65536,SCALEICON:1<<17,SCALEBLESSICON:1<<18,NULLICON:1<<19,SHOWLIGHT:1<<20,NO_SLV:1<<21,LIGHT:1<<22,FONTHECHENG:1<<23,LVFONTCHANGE:1<<24,STOREHERO:1<<25,STORECHIPHIDE:1<<26,SHOWNUM:1<<27},function(t){t[t.CHIP=1]="CHIP",t[t.PILL=2]="PILL"}(o.GOODSTYPE||(o.GOODSTYPE={})),function(t){t[t.GRID=0]="GRID"}(o.INFO_TYPE||(o.INFO_TYPE={})),function(t){t[t.ID=0]="ID",t[t.POSITION=1]="POSITION",t[t.INFO=2]="INFO",t[t.ZINDEX=3]="ZINDEX",t[t.MATERIAL=4]="MATERIAL"}(o.GRID_INFO||(o.GRID_INFO={})),function(t){t[t.TYPE=0]="TYPE",t[t.POSITION=1]="POSITION",t[t.SCALE=2]="SCALE",t[t.ZINDEX=3]="ZINDEX"}(o.MATERIAL_INFO||(o.MATERIAL_INFO={})),function(t){t[t.MLBase=0]="MLBase",t[t.MLGrid=1]="MLGrid",t[t.MLMaterial=2]="MLMaterial",t[t.MLTouch=3]="MLTouch",t[t.MLEffect_1=4]="MLEffect_1",t[t.MLEffect_2=5]="MLEffect_2",t[t.MElementUI=6]="MElementUI",t[t.TestLayer=7]="TestLayer"}(o.MapLayer||(o.MapLayer={})),function(t){t[t.INS_ID=0]="INS_ID",t[t.TPLT_ID=1]="TPLT_ID",t[t.SLV=2]="SLV",t[t.QUALITY=3]="QUALITY",t[t.ISFIRSTEXP=4]="ISFIRSTEXP",t[t.WEAR=5]="WEAR"}(o.PART_EQUIP||(o.PART_EQUIP={})),function(t){t[t.AppStart=0]="AppStart",t[t.PloatScene=1]="PloatScene",t[t.GameScene=2]="GameScene",t[t.InitRole=3]="InitRole",t[t.BattleScene=4]="BattleScene",t[t.Simulator=5]="Simulator"}(o.LoadingType||(o.LoadingType={})),function(t){t[t.CEQual=0]="CEQual",t[t.CGreater=-1]="CGreater",t[t.CLess=1]="CLess"}(o.CompareEnum||(o.CompareEnum={})),function(t){t[t.BLESS0=0]="BLESS0",t[t.BLESS1=1]="BLESS1",t[t.BLESS2=2]="BLESS2",t[t.BLESS3=3]="BLESS3",t[t.BLESS4=4]="BLESS4"}(o.BLESS||(o.BLESS={})),function(t){t[t.strSus=0]="strSus",t[t.strFail=1]="strFail",t[t.synthesis=2]="synthesis"}(o.BLESSEND_INFO||(o.BLESSEND_INFO={})),function(t){t[t.Null=0]="Null",t[t.WarnTip=1]="WarnTip",t[t.End=2]="End"}(o.ToastType||(o.ToastType={})),function(t){t[t.GUANQIA=0]="GUANQIA",t[t.ARENA=1]="ARENA"}(o.PART_BTL_SCENE||(o.PART_BTL_SCENE={})),function(t){t[t.IDD_000=0]="IDD_000",t[t.IDD_100=100]="IDD_100",t[t.IDD_101=101]="IDD_101",t[t.IDD_102=102]="IDD_102",t[t.WAIT_FIGHT=1100]="WAIT_FIGHT"}(o.GuidEnum||(o.GuidEnum={})),o.CHESS={SOLDIER:"\u5175",VEHICLE:"\u8f66",HORSE:"\u9a6c",CANNON:"\u70ae",MUTUALLY:"\u76f8",SCHOLAR:"\u58eb"},function(t){t[t.battle=0]="battle",t[t.Lower=1]="Lower"}(o.FRONT||(o.FRONT={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.ALL=1]="ALL",t[t.HERO=2]="HERO"}(o.REWARD||(o.REWARD={})),o.PointInfo={vip_btn:"\u89c2\u770b\u6fc0\u52b1\u89c6\u9891-\u89e3\u9501VIP",vip_frist:"VIP\u9996\u6b21\u793c\u5305",vip_daily:"Vip \u6bcf\u65e5\u793c\u5305",bless_ad:"\u5e7f\u544a\u5f3a\u5316",bless_gold:"\u91d1\u5e01\u5f3a\u5316",officer_ad:"\u89c2\u770b\u6fc0\u52b1\u89c6\u9891-\u5b98\u804c\u989d\u5916\u5956\u52b1",officer_norl:"\u5b98\u7235\u666e\u901a\u5b9d\u7bb1",sign_norl:"\u666e\u901a\u7b7e\u5230\u5956\u52b1",sign_ad:"\u89c2\u770b\u6fc0\u52b1\u89c6\u9891-\u53cc\u500d\u7b7e\u5230",store_buy_free:"\u514d\u8d39\u8d2d\u4e70\u88c5\u5907",store_buy_coin:"\u91d1\u5e01\u8d2d\u4e70\u88c5\u5907",store_buy_diamond:"\u7389\u77f3\u8d2d\u4e70\u88c5\u5907",store_buy_video:"\u89c2\u770b\u6fc0\u52b1\u89c6\u9891-\u9886\u53d6\u88c5\u5907",store_open_ybox_coin:"\u91d1\u5e01\u5f00\u542f\u94f6\u5b9d\u7bb1",store_open_ybox_video:"\u89c6\u9891\u5f00\u542f\u94f6\u5b9d\u7bb1",store_open_ybox_diamod:"\u7389\u77f3\u5f00\u542f\u94f6\u5b9d\u7bb1",store_open_jbox_coin:"\u91d1\u5e01\u5f00\u542f\u91d1\u5b9d\u7bb1",store_open_jbox_video:"\u89c2\u770b\u6fc0\u52b1\u89c6\u9891-\u9886\u53d6\u9ec4\u91d1\u5b9d\u7bb1",store_open_jbox_diamod:"\u7389\u77f3\u5f00\u542f\u91d1\u5b9d\u7bb1",store_open_zbox_coin:"\u89c2\u770b\u6fc0\u52b1\u89c6\u9891-\u9886\u53d6\u4e13\u5c5e\u5b9d\u7bb1",store_open_zbox_video:"\u89c6\u9891\u5f00\u542f\u4e13\u5c5e\u5b9d\u7bb1",store_open_zbox_diamod:"\u7389\u77f3\u5f00\u542f\u4e13\u5c5e\u5b9d\u7bb1",store_open_ybox:"\u88c5\u5907\u5b9d\u5e93-\u62bd\u91d1\u5e01\u7389\u77f3\u5b9d\u7bb1\u6b21\u6570",store_open_jbox:"\u88c5\u5907\u5b9d\u5e93-\u62bd\u7a81\u7834\u4e39\u5b9d\u7bb1\u6b21\u6570",store_open_zbox:"\u88c5\u5907\u5b9d\u5e93-\u62bd\u82f1\u96c4\u788e\u7247\u5b9d\u7bb1\u6b21\u6570",common_ad_coin:"\u89c2\u770b\u6fc0\u52b1\u89c6\u9891-\u91d1\u5e01\u4e0d\u8db3",common_ad_yushi:"\u89c2\u770b\u6fc0\u52b1\u89c6\u9891-\u7389\u77f3\u4e0d\u8db3",common_ad_chip:"\u89c2\u770b\u6fc0\u52b1\u89c6\u9891-\u788e\u7247\u4e0d\u8db3",common_ad_pill:"\u89c2\u770b\u6fc0\u52b1\u89c6\u9891-\u91d1\u4e39\u4e0d\u8db3",common_ad_wheat:"\u89c2\u770b\u6fc0\u52b1\u89c6\u9891-\u7cae\u8349\u589e\u76ca",tower:"\u91cd\u697c\u5f3a\u5f81",rewardCtrl_ad:"\u89c2\u770b\u6fc0\u52b1\u89c6\u9891-\u606d\u559c\u83b7\u5f97\u9886\u53d6",FeatureCtrl_ad:"\u89c2\u770b\u6fc0\u52b1\u89c6\u9891-\u53cc\u500d\u9886\u53d6\u788e\u7247",resultDouble:"\u89c2\u770b\u89c6\u9891\u9886\u53d6\u53cc\u500d\u7ed3\u7b97\u5956\u52b1",recruit_ad:"\u89c2\u770b\u6fc0\u52b1\u89c6\u9891-\u62bd\u5361\u62db\u52df10\u6b21",recruit_click:"\u62bd\u5361\u62db\u52df1\u6b21",rcruit_enter:"\u8fdb\u5165\u62bd\u5361\u754c\u9762"},function(t){t[t.Reward=0]="Reward",t[t.Pass=1]="Pass",t[t.Now=2]="Now",t[t.Future=3]="Future"}(o.LinearState||(o.LinearState={})),o.showProptsInfo={attack:"\u653b\u51fb",defense:"\u9632\u5fa1",life:"\u751f\u547d",hit:"\u66b4\u51fb",Dodge:"\u95ea\u907f",burst:"\u7206\u4f24",ice:"\u51b0\u5c5e\u6027\u653b\u51fb",fire:"\u706b\u5c5e\u6027\u653b\u51fb",iceResist:"\u51b0\u5c5e\u6027\u6297\u6027",fireResist:"\u706b\u5c5e\u6027\u6297\u6027"},o.getHeroLoad={unlock:"\u9ed8\u8ba4\u89e3\u9501\u83b7\u53d6",sign:"\u7b7e\u5230\u5956\u52b1\u83b7\u53d6",guanJue:"\u5b98\u7235\u5956\u52b1\u83b7\u53d6",vip:"vip\u83b7\u53d6",arena:"\u7ade\u6280\u573a\u83b7\u53d6",battle:"battle",chapter:"\u7ae0\u8282\u5b9d\u7bb1\u83b7\u53d6",treasury:"\u5b9d\u5e93\u5b9d\u7bb1\u5956\u52b1\u83b7\u53d6"},function(t){t[t.BLING=0]="BLING",t[t.RUNNING=1]="RUNNING",t[t.REDPOINT=2]="REDPOINT"}(o.RedpointEffect||(o.RedpointEffect={})),function(t){t[t.battlefieldAcceleration=0]="battlefieldAcceleration",t[t.InitBattlefieldRes=1]="InitBattlefieldRes",t[t.syntheticConsumptionRes=2]="syntheticConsumptionRes",t[t.strengthenResConsumption=3]="strengthenResConsumption",t[t.TowerFreeImpressNum=4]="TowerFreeImpressNum",t[t.storeDayFreeBuyNum=5]="storeDayFreeBuyNum"}(o.BUFFINFO||(o.BUFFINFO={})),function(t){t[t.id=0]="id",t[t.index=1]="index",t[t.num=2]="num"}(o.HEROBUFF||(o.HEROBUFF={})),function(t){t[t.id=0]="id",t[t.type=1]="type",t[t.num=2]="num"}(o.PART_GOODS||(o.PART_GOODS={})),function(t){t[t.unChapterLock=0]="unChapterLock",t[t.chapterLock=1]="chapterLock",t[t.unLock=2]="unLock",t[t.lock=3]="lock",t[t.receive=4]="receive"}(o.CHAPTERBOX||(o.CHAPTERBOX={})),function(t){t[t.SUIT0=0]="SUIT0",t[t.SUIT1=1]="SUIT1",t[t.SUIT2=2]="SUIT2",t[t.SUIT3=3]="SUIT3",t[t.SUIT4=4]="SUIT4",t[t.SUIT5=5]="SUIT5"}(o.SUIT||(o.SUIT={})),o.CHECK_TIME={TIME_CLOCK_CHECK:10},o.TEXTURE_PREFIX={type:"tyqe_",quality:"quality",head:"head_",item:"item_",equip:"equip_",hero:"hero_",name:"name_",skill:"skill_",suit:"suit_",buff:"buff_",grade:"grade_",notice:"notice_"},o.CMsg={client:{bag:{onBagItemChange:"CMsg.clint.bag.onGetOrUseItem",onCurrencyChange:"CMsg.client.bag.onCurrencyChange"},equip:{AddSynthesisEquip:"CMsg.clint.equip.adAddSynthesisEquip",onEquipPutOff:"CMsg.clint.equip.onEquipPutOff",onEquipPutOn:"CMsg.clint.equip.onEquipPutOn",onAddEquipSlv:"CMsg.clint.equip.onAddEquipSlv",onAddEquipQuality:"CMsg.clint.equip.onAddEquipQuality",ondelEquip:"CMsg.client.equip.ondelEquip",onBlessEquip:"CMsg.client.equip.onBlessEquip",onBlessClearPut:"CMsg.client.equip.onBlessClearPut"},office:{onGetAdReward:"CMsg.client,office.onGetAdReward",onGetReward:"CMsg.client,office.onGetReward"},game:{},view:{onViewChange:"CMsg.client,view.onViewChange"},guide:{},tower:{onStartFight:"CMsg.client.tower.onStartFight",onAddTowerReward:"CMsg.client.tower.onAddTowerReward"},home:{onSign:"CMsg.client.home.onSign",GOTO_NEW_DAY:"CMsg.client.home.GOTO_NEW_DAY",onVipLvUp:"CMsg.client.home.onVipLvUp",onCoinAnim:"CMsg.client.home.onCoinAnim",onBattleItem:"CMsg.client.home.onBattleItem",onMovePos:"CMsg.client.home.onMovePos",onHeroItem:"CMsg.client.home.onHeroItem",onheroBattleItem:"CMsg.client.home.onheroBattleItem",onaddLevel:"CMsg.client.home.onaddLevel",onFeature:"CMsg.client.home.onFeature",onChangeLevel:"CMsg.client.home.onChangeLevel",onRecruit:"CMsg.client.home.onRecruit"},hero:{onGetHeroZhangLi:"CMsg.client.hero.onGetHeroZhangLi",onSetSkill:"CMsg.client.hero.onSetSkill",onAddHero:"CMsg.client.hero,onAddHero",onHeroAddExp:"CMsg.client.hero.onHeroAddExp",onHeroLvUp:"CMsg.client.hero.onHeroLvUp",onHeroBreach:"CMsg.client.hero.onHeroBreach",onAddSuit:"CMsg.client.hero.onAddSuit",onHeroAddStar:"CMsg.client.hero.onHeroAddStar"},sdk:{onShareScreenSuc:"CMsg.client.sdk.onShareScreenSuc"},fight_ui:{selectItem:"CMsg.client.fightUI.selectItem",hideAllItem:"CMsg.client.fightUI.hideAllItem",onWheatChange:"CMsg.client.fightUI.onWheatChange",CMD_CHANGE:"CMsg.client.fightUI.cmdChange",end_fight:"CMsg.client.fightUI.endFight",onRetreatClick:"CMsg.client.fightUI.onRetreatClick",onFinishSettle:"CMsg.client.fightUI.onFinishSettle"},test:{export:"GMsg.client.test.export"}},rPoint:{valueSetting:"CMsg.rPoint.valueSetting",viewSetting:"CMsg.rPoint.viewSetting"},data:{onClientGuideChange:"CMsg.data.onClientGuideChange",setGuide:"CMsg.data.setGuide",onGuideEvent:"CMsg.data.onGuideEvent"},unlock:{}},o.KF={genItemKey:function(t,e){return t+"_"+e},deItemKey:function(t){if(!t||t==i.INVALID_STRING_VALUE)return[i.INVALID_VALUE,i.INVALID_VALUE];var e=t.split("_");return[parseInt(e[0]),parseInt(e[1])]},getLogKey:function(t,e){return 1e4*t+e},deLogKey:function(t){return[Math.floor(t/1e4),t%1e4]},posDecode:function(t){if(!t||t==i.INVALID_STRING_VALUE)return cc.Vec2.ZERO;var e=t.split("_");return 2!=e.length?(cc.error("army id format be error! "),null):cc.v2(parseInt(e[0]),parseInt(e[1]))},posEncode:function(t){return t.x+"_"+t.y},spliteArrays:function(t,e){for(var o=t.length,i=[],n=[],r=0;r<o;r++)n||(n=[]),n.push(t[r]),r==o-1?i.push(n):n.length==e&&(i.push(n),n=null);return i}},cc._RF.pop()},{"./../../Core/CoreDefine":"CoreDefine"}],DetailsCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"98c3ff35l5GiIt9L/yuI9tN","DetailsCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a},a=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0});var s=t("../../../conventions/JXCommon"),c=t("../../../Core/CoreDefine"),l=t("../../../Core/GEvent/GParam"),u=t("../../../Core/GView/GListView"),h=t("../../../Core/GView/GViewBase"),p=t("../../../Core/Manager/AudioMgr"),d=t("../../Common/Define"),f=t("../../Common/Language"),g=t("../../Common/UI"),_=t("../../Common/UICreate"),m=t("../../Common/UIResources"),y=t("../../Common/Zh"),v=t("../../Data/RunTime/RunRaw/RJXItem"),C=t("../../Guide/GuideLogic"),I=t("../../Logic/GameMgr"),E=t("../../Logic/HeroMgr"),S=t("../../Logic/SdkMgr"),R=t("../../Logic/UserMgr"),D=t("../Common/JXItem"),b=t("../Common/TopUiItem"),w=t("../Home/SkillItem"),A=t("../JXBattle/JXULDefine"),T=t("./../../../Core/GCtrl"),M=t("./../../Common/Define"),L=t("./HeroChange"),P=cc._decorator,B=P.ccclass,O=P.property,x=P.menu,N=(P.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sk_trait=null,e.sk_sengji=null,e.skill=null,e.heroGroup=null,e.heroName=null,e.heroStar=null,e.heroBatter=null,e.heroLvLab=null,e.heroLvVal=null,e.heroStarLab=null,e.heroLvBtn=null,e.expNum=null,e.lvCoinNum=null,e.lvCoinNode=null,e.starNum=null,e.heroStarVal=null,e.attribute=null,e.attribute2=null,e.powal=null,e.equipScrollView=null,e.attributeView=null,e.attributeMaskView=null,e.view=null,e.equipcontent=null,e.equipmentL=null,e.equipmentR=null,e.delEquip=null,e.HeroChange=null,e.lvUpBtn=null,e.addStarBtn=null,e.arrowLv=null,e.equipToggle=null,e.attributeToggle=null,e.synthesisToggle=null,e.detailsnewsBg=null,e.labelNode=null,e.richTextNode=null,e.backBtn=null,e._isFisrtShow=!1,e._IHeroData=null,e._SHeroData=null,e._Breach=!1,e._nextData=null,e._curData=null,e._listView=null,e.equipArr=[],e._carName=[],e._qhItem=null,e._zhangLi=0,e._isScrollViewPow=!0,e._bookRedNum=0,e}return n(e,t),e.prototype.onGLoad=function(){T.GCtrl.ES.on(M.CMsg.client.hero.onHeroAddStar,this,this.onHeroAddStar.bind(this),c.PRIORITY_VIEW),T.GCtrl.ES.on(M.CMsg.client.hero.onHeroLvUp,this,this.onHeroLvUp.bind(this),c.PRIORITY_VIEW),T.GCtrl.ES.on(M.CMsg.client.equip.onEquipPutOn,this,this.onEquipPutOn.bind(this),c.PRIORITY_VIEW),T.GCtrl.ES.on(M.CMsg.client.equip.onEquipPutOff,this,this.onEquipPutOff.bind(this),c.PRIORITY_VIEW),T.GCtrl.ES.on(M.CMsg.client.equip.ondelEquip,this,this.ondelEquip.bind(this),c.PRIORITY_VIEW),T.GCtrl.ES.on(M.CMsg.client.hero.onHeroBreach,this,this.onHeroBreach.bind(this),c.PRIORITY_VIEW),T.GCtrl.ES.on(M.CMsg.client.bag.onBagItemChange,this,this.onBagItemChange.bind(this),c.PRIORITY_VIEW);for(var t=0;t<this.equipmentL.children.length;t++)this.equipArr.push(this.equipmentL.children[t]);for(t=0;t<this.equipmentR.children.length;t++)this.equipArr.push(this.equipmentR.children[t]);this.initCarName()},e.prototype.onBagItemChange=function(){this.heroLvLab.getComponent(cc.Label).string="Lv."+this._IHeroData.lv,this.heroStarLab.getComponent(cc.Label).string=this._IHeroData.star+"",this.initStarVal(),this.initHeroLv()},e.prototype.bless=function(){var t=I.default.lUserData.level,e=I.default.systemConfig.value(s.JXDef.SYS_CONFIG_KEY.aidOpen);if(t>=e)I.default.jumpToMgr.jumpGoTo(g.VIEW_ID.blessCtrl,this._IHeroData,this._SHeroData);else{var o="\u901a\u8fc7\u7b2c"+e+"\u5173\u5f00\u542f\u5408\u6210\u5f3a\u5316\u754c\u9762";I.default.uiMgr.showToast(o)}},e.prototype.setRedPoint=function(){if(this._IHeroData){var t=I.default.heroMgr.checkHeroCanGrow(this._IHeroData.tableId,!1),e=I.default.heroMgr.checkHeroCanGrow(this._IHeroData.tableId,!0),o=I.default.heroMgr.checkHeroCanAddStar(this._IHeroData.tableId),i=I.default.heroMgr.checkHeorBastEquip(this._IHeroData)&&this.getEquipNum()>0;I.default.redMgr.setRPointView(this.lvUpBtn,this.lvUpBtn,t||e,d.RedpointEffect.REDPOINT),I.default.redMgr.setRPointView(this.equipToggle,this.equipToggle,i,d.RedpointEffect.REDPOINT),I.default.redMgr.setRPointView(this.addStarBtn,this.addStarBtn,o,d.RedpointEffect.REDPOINT);var n=this.checkCanSynthes();I.default.redMgr.setRPointView(this.synthesisToggle,this.synthesisToggle,n,d.RedpointEffect.REDPOINT)}},e.prototype.init=function(){this.heroLvLab.getComponent(cc.Label).string="Lv."+this._IHeroData.lv,this.heroStarLab.getComponent(cc.Label).string=this._IHeroData.star+"",this.initStarVal(),this.initHeroLv(),this.initEmbattle(),this.initEquipFrame(),this.showAttribute(),this.initSkill(),this.initTrait(),this.setRedPoint();var t=I.default.lUserData.herotarit(this._IHeroData.trait);I.default.sdkMgr.umaSetPoint(s.JXDef.umaPoint.detailsCtrl,{msg:this._SHeroData.name+y.JXLocales.tower.heroTrait+t}),I.default.sdkMgr.umaSetPoint(s.JXDef.umaPoint.detailsCtrl,{msg:this._SHeroData.name+f.L(y.JXLocales.tower.heroStar,this._IHeroData.star)})},e.prototype.helpBtn=function(){var t=[d.SPECIALWINDOW.HELP,this._IHeroData.tableId,1];I.default.jumpToMgr.jumpGoTo(g.VIEW_ID.currencyFrame,t,1)},e.prototype.initTrait=function(){switch(this._IHeroData.trait){case d.HERO_TRAIT.WHITE:this.sk_trait.setAnimation(0,A.JXEHeroBgAniNames.white,!0);break;case d.HERO_TRAIT.GREEN:this.sk_trait.setAnimation(0,A.JXEHeroBgAniNames.green,!0);break;case d.HERO_TRAIT.BLUE:this.sk_trait.setAnimation(0,A.JXEHeroBgAniNames.blue,!0);break;case d.HERO_TRAIT.PURPLE:this.sk_trait.setAnimation(0,A.JXEHeroBgAniNames.purple,!0);break;case d.HERO_TRAIT.YELLOW:this.sk_trait.setAnimation(0,A.JXEHeroBgAniNames.yellow,!0);break;case d.HERO_TRAIT.RED:this.sk_trait.setAnimation(0,A.JXEHeroBgAniNames.red,!0)}},e.prototype.onEquipPutOn=function(t,e){var o=e.get();this._IHeroData=I.default.rHeroData.getHero(o.heroId),p.AudioMgr.Ins().playEffect(m.Res.audio.wear),this.initEmbattle(),this.initHeroLv(),this.initEquipFrame(),this.showAttribute(!0),this.setRedPoint(),I.default.redMgr.sendValueSettingMsg(d.RPointMask.RPM_Have_Base,!1)},e.prototype.ondelEquip=function(){this.initEmbattle(),this.setRedPoint(),this.initEquipFrame(),I.default.redMgr.sendValueSettingMsg(d.RPointMask.RPM_Have_Base,!1)},e.prototype.onHeroBreach=function(t,e){this._IHeroData=I.default.rHeroData.getHero(e),this.initHeroLv(),this.showAttribute(!0),this.initSkill(e),this.initTrait(),this.setRedPoint(),this.initEquipFrame(),I.default.redMgr.sendValueSettingMsg(d.RPointMask.RPM_Hero_Tupo,!1)},e.prototype.onHeroLvUp=function(t,e){this._IHeroData=I.default.rHeroData.getHero(e),this.sk_sengji.setAnimation(0,A.JXEHeroBgAniNames.shengji,!1),this.initHeroLv(),this.showAttribute(!0),this.initSkill(e),this.initTrait(),this.setRedPoint(),this.initEquipFrame(),I.default.redMgr.sendValueSettingMsg(d.RPointMask.RPM_Hero_LvUp,!1),T.GCtrl.ES.emit("updateRedSeletBtn")},e.prototype.onEquipPutOff=function(t,e){var o=e.get();this.equipArr[o.site].destroyAllChildren(),this._IHeroData=I.default.rHeroData.getHero(o.heroId),this.initEmbattle(),this.initHeroLv(),this.initEquipFrame(),this.showAttribute(!0),this.setRedPoint(),I.default.redMgr.sendValueSettingMsg(d.RPointMask.RPM_Have_Base,!1),T.GCtrl.ES.emit("updateRedSeletBtn")},e.prototype.equipClick=function(){this.equipScrollView.node.active=!0,this.attributeView.active=!1},e.prototype.attributeClick=function(){this.equipScrollView.node.active=!1,this.attributeView.active=!0},e.prototype.onHeroAddStar=function(t,e){this._IHeroData=I.default.rHeroData.getHero(e),this.initStarVal(),this.showAttribute(!0),this.initTrait(),this.initHeroLv(),this.setRedPoint(),this.initEquipFrame(),this.sk_sengji.setAnimation(0,A.JXEHeroBgAniNames.shengji,!1),I.default.redMgr.sendValueSettingMsg(d.RPointMask.RPM_Hero_AddStar,!1)},e.prototype.nextHero=function(t,e){for(var o=I.default.rHeroData.getHaveHeros(0).have,i=0;i<o.length;i++)if(o[i].tableId==this._IHeroData.tableId){var n=i+parseInt(e);n>=o.length&&(n=0),n<0&&(n=o.length-1),this._IHeroData=o[n],this._SHeroData=I.default.heroData.getRaw(o[n].tableId);break}this.start()},e.prototype.onGStartInit=function(t,e,o){this._IHeroData=t;var i={heroId:this._IHeroData.tableId};T.GCtrl.ES.emit(M.CMsg.client.hero.onGetHeroZhangLi,new l.default(i)),this._SHeroData=e,this.backBtn.getComponent(b.default).onGStart(),this._isFisrtShow=o,o?this.equipClick():this.attributeClick()},e.prototype.start=function(){this.equipToggle.getComponent(cc.Toggle).check(),this.attributeToggle.getComponent(cc.Toggle).uncheck(),this.assetImpl.spriteAtlasFrame(this.heroGroup,m.Res.texture.map.quality,d.TEXTURE_PREFIX.type+this._SHeroData.type),this.assetImpl.spriteAtlasFrame(this.heroName.getChildByName("name").getComponent(cc.Sprite),"frames/views/squadImg","lname_"+this._SHeroData.icon),this.initHeroSpine(),this.init(),this._isFisrtShow?(this.equipToggle.getComponent(cc.Toggle).check(),this.attributeToggle.getComponent(cc.Toggle).uncheck(),this.equipScrollView.node.active=!0,this.attributeView.active=!1):(this.equipToggle.getComponent(cc.Toggle).uncheck(),this.attributeToggle.getComponent(cc.Toggle).check(),this.equipScrollView.node.active=!1,this.attributeView.active=!0);var t,e=cc.view.getFrameSize(),o=cc.view.getDesignResolutionSize();t=e.width/e.height<=.5625?e.width/o.width:e.height/o.height,this.equipcontent.parent.setContentSize(600,Math.min(480,e.height/t/2-568+320)),this.attributeMaskView.setContentSize(600,Math.min(320,e.height/t/2-568+170)),this.detailsnewsBg.y=-this.attributeMaskView.height-50},e.prototype.initEmbattle=function(){var t=this;this._isScrollViewPow?this._listView?this.dealWithData():this.assetImpl.prefab(m.Res.prefab.item.jxItem,function(e){t._listView=new u.GListView({scrollview:t.equipScrollView,mask:t.view,content:t.equipcontent,itemTpl:cc.instantiate(e),itemSetter:t.onItemSetter.bind(t),column:5,row:3,gapY:10,gapX:18,padingY:20,padingX:20,isCbClass:!0,isWidget:!1}),t.dealWithData()}):this.assetImpl.prefab(m.Res.prefab.item.jxItem,function(e){t.dealWithData(e)})},e.prototype.checkCanSynthes=function(){var t=I.default.RBagData.getHeroEquip(this._IHeroData.tableId),e=t.equip,o=t.book;e=this.isWear(e),o=this.isWear(o);for(var i=a(e,o),n=[],r=0;r<i.length;r++){var s=i[r],c=I.default.RBagData.getEquipDataById(s);n[c.equipId]||(n[c.equipId]=0),n[c.equipId]++}var l=!1;return n.forEach(function(t){if(t>=3)return l=!0,!0}),l},e.prototype.onItemSetter=function(t,e){var o=this;if(e){var i=I.default.RBagData.getEquipDataById(e),n=i.itemData,r=n,a={insId:i.insId,bool:t.equipUse,site:0},s=I.default.heroMgr.checkSeatEquipIsBast(this._IHeroData.equips,n.raw.seat,i.insId,this._IHeroData.lv);n.raw.seat>=3&&(s&&this._bookRedNum<3?this._bookRedNum++:s=!1),I.default.redMgr.setRPointView(t.node,t.node,s,d.RedpointEffect.REDPOINT,d.RedpointPos.Main),t.eqlv1.node.active=!1,t.setView(r,d.ITEM_DETAIL_FLAG.TOUCH,function(){I.default.jumpToMgr.jumpGoTo(g.VIEW_ID.EquipDetailsCtrl,i,a,o._IHeroData)},i.insId,!0)}else r=new v.default([0,0,0]),t.eqlv1.node.active=!1,I.default.redMgr.setRPointView(t.node,t.node,!1,d.RedpointEffect.REDPOINT,d.RedpointPos.Main),t.setView(r,d.ITEM_DETAIL_FLAG.NULLICON,null,null,!0)},e.prototype.dealWithData=function(t){void 0===t&&(t=null);var e=20,o=I.default.RBagData.getHeroEquip(this._IHeroData.tableId),i=o.equip,n=o.book;i=this.isWear(i),n=I.default.RBagData.getAllBook(),n=this.isWear(n),e-=i.length,(e-=n.length)<0&&(e=0);var r=new Array(e),s=[E.IHeroSort.sortEquipZhanli];i.sort(function(t,e){var o=I.default.RBagData.getEquipDataById(t),i=I.default.RBagData.getEquipDataById(e);return E.IHeroSort.sortsEquire(s,o,i)}),n.sort(function(t,e){var o=I.default.RBagData.getEquipDataById(t),i=I.default.RBagData.getEquipDataById(e);return E.IHeroSort.sortEquipZhanli(o,i)});var c=a(i,n,r);if(this._isScrollViewPow&&this._listView)this._listView.setData(c);else{this.equipcontent.removeAllChildren(),this._bookRedNum=0;for(var l=0;l<c.length;l++){var u=c[l],h=cc.instantiate(t);this.equipcontent.addChild(h),h.name="item_"+l,this.onItemSetter(h.getComponent(D.default),u,l)}}},e.prototype.getEquipNum=function(){var t=I.default.RBagData.getHeroEquip(this._IHeroData.tableId),e=t.equip,o=t.book;return e=this.isWear(e),o=I.default.RBagData.getAllBook(),o=this.isWear(o),e.length+o.length},e.prototype.isWear=function(t){var e=this,o=!1,i=[];return t.forEach(function(n,r){if(o=!1,e._IHeroData.equips.forEach(function(t){o||n==t&&(i.push(n),o=!0)}),r==t.length-1)for(var a=t.length,s=0;s<a;s++)for(var c=0;c<i.length;c++)i[c]==t[s]&&t.splice(s,1)}),t},e.prototype.isWearBookHero=function(){},e.prototype.initSkill=function(t){var e=this;this.assetImpl.prefab(m.Res.prefab.item.skillItem,function(o){e.skill.destroyAllChildren();var i=I.default.skillData.getHeroSkillData(e._IHeroData.tableId),n=I.default.skillData.getHeroUseSkill(e._IHeroData.tableId,e._IHeroData.lv),r=e._IHeroData.skillIds;t&&n.forEach(function(t,e){if(t!=r[e]){var o=I.default.skillData.getRaw(t);I.default.jumpToMgr.jumpGoTo(g.VIEW_ID.skillPage,o,1)}});var a={heroId:e._IHeroData.tableId,skill:n};T.GCtrl.ES.emit(M.CMsg.client.hero.onSetSkill,new l.default(a)),i.forEach(function(t,i){var r=!1,a=cc.instantiate(o),s=a.getComponent(w.default);a.parent=e.skill,n[i]&&(r=!0),s.setView(t,r)})})},e.prototype.initHeroSpine=function(){var t=I.default.heroData.getRaw(this._IHeroData.tableId);this.HeroChange.node.scale=1.3*t.roleScale,this.HeroChange.changeSpine(this._IHeroData)},e.prototype.initEquipFrame=function(){for(var t=this,e=this._IHeroData.equips,o=0;o<this.equipArr.length;o++){this.equipArr[o].destroyAllChildren();var i=new cc.Node("New Sprite"),n=i.addComponent(cc.Sprite);i.parent=this.equipArr[o],o<=2?this.assetImpl.spriteAtlasFrame(n,m.Res.texture.views.heroDetail,"img"+o):this.assetImpl.spriteAtlasFrame(n,m.Res.texture.views.heroDetail,"book"),this.assetImpl.spriteAtlasFrame(this.equipArr[o].getComponent(cc.Sprite),m.Res.texture.views.heroDetail,"equipIcon")}this.assetImpl.prefab(m.Res.prefab.item.jxItem,function(o){e.forEach(function(e,i){if(t.equipArr[i].destroyAllChildren(),"-1"==e||!e){var n=(s=new cc.Node("New Sprite")).addComponent(cc.Sprite);return s.parent=t.equipArr[i],i<=2?t.assetImpl.spriteAtlasFrame(n,m.Res.texture.views.heroDetail,"img"+i):t.assetImpl.spriteAtlasFrame(n,m.Res.texture.views.heroDetail,"book"),void t.assetImpl.spriteAtlasFrame(t.equipArr[i].getComponent(cc.Sprite),m.Res.texture.views.heroDetail,"equipIcon")}var r=t.assetImpl.addGChild(o);if(e){var a=I.default.RBagData.getEquipDataById(e);if(a){var s;n=(s=new cc.Node("New Sprite")).addComponent(cc.Sprite),s.parent=t.equipArr[i],t.assetImpl.spriteAtlasFrame(n,m.Res.texture.views.common,"quality_"+a.quality),s.setPosition(-5,-1);var c=a.itemData;r.equipUse=!0,r.node.parent=t.equipArr[i],r.node.setPosition(0,-1);var l={insId:a.insId,bool:r.equipUse,site:i};r.initOffEvent(),r.setView(c,d.ITEM_DETAIL_FLAG.NO_BG_SHOWSLV,function(){I.default.jumpToMgr.jumpGoTo(g.VIEW_ID.EquipDetailsCtrl,a,l,t._IHeroData)},a.insId,!1)}}})})},e.prototype.initCarName=function(){var t=I.default.systemConfig.value(s.JXDef.SYS_CONFIG_KEY.white);this._carName.push(t);var e=I.default.systemConfig.value(s.JXDef.SYS_CONFIG_KEY.green);this._carName.push(e);var o=I.default.systemConfig.value(s.JXDef.SYS_CONFIG_KEY.Blue);this._carName.push(o);var i=I.default.systemConfig.value(s.JXDef.SYS_CONFIG_KEY.purple);this._carName.push(i);var n=I.default.systemConfig.value(s.JXDef.SYS_CONFIG_KEY.orange);this._carName.push(n);var r=I.default.systemConfig.value(s.JXDef.SYS_CONFIG_KEY.red);this._carName.push(r)},e.prototype.initStarVal=function(){var t=this._IHeroData.star;t>=5*this._SHeroData.star.length&&(this.addStarBtn.children[0].children[0].getComponent(cc.Label).string="\u6ee1\u7ea7",this.addStarBtn.getComponent(cc.Button).interactable=!1);var e=I.default.heroMgr.getChipNeedByStar(t),o=I.default.RBagData.getMegreItems(this._IHeroData.tableId,d.ITEM_TYPE.PROP).num,i=this._SHeroData.star[e.lv],n=o/i;this.starNum.string=o+"/"+i,n>=1?this.setLoadProgress(1,this.heroStarVal):n<=0?this.setLoadProgress(0,this.heroStarVal):this.setLoadProgress(n,this.heroStarVal);for(var r=0;r<this.heroStar.children.length;r++)r>e.count-1?this.assetImpl.spriteAtlasFrame(this.heroStar.children[r].getComponent(cc.Sprite),m.Res.texture.views.icon,"icon_star"+(e.lv+1)+"grey"):(this.heroStar.children[r].color=cc.Color.WHITE,this.heroStar.children[r].active=!0,this.assetImpl.spriteAtlasFrame(this.heroStar.children[r].getComponent(cc.Sprite),m.Res.texture.views.icon,"icon_star"+(e.lv+1)));this.heroStarLab.getComponent(cc.Label).string=this._IHeroData.star+""},e.prototype.initHeroLv=function(){this.heroLvLab.getComponent(cc.Label).string="Lv."+this._IHeroData.lv;var t=this._IHeroData.lv,e=this._IHeroData.exp,o=I.default.lvData.getMaxlv(),i=null;this._curData=I.default.lvData.getRaw(t),t>=o.lv?this._nextData=I.default.lvData.getRaw(t):(this._nextData=I.default.lvData.getRaw(t+1),this._Breach=this._nextData.quality!=this._curData.quality&&e>=this._nextData.exp,i=this._Breach?"icon_201":"icon_101"),this.expNum.string=e+"/"+this._nextData.exp,this.assetImpl.spriteAtlasFrame(this.heroLvBtn,m.Res.texture.views.icon,i);var n=e/this._nextData.exp;n>=1?this.setLoadProgress(1,this.heroLvVal):n<=0?this.setLoadProgress(0,this.heroLvVal):this.setLoadProgress(n,this.heroLvVal);var r;this.heroLvLab.getComponent(cc.Label).string="Lv."+this._curData.lv,r=this._Breach?1:I.default.lvData.getRaw(Number(t+1)).gold,this.lvCoinNum.string=r+""},e.prototype.upgradeLv=function(){var t=I.default.lvData.getMaxlv(),e=this._IHeroData.lv;if(!(e>=t.lv)){if(this._Breach){var o=I.default.itemData.getRaw(Number(200+this._nextData.quality)),i=new v.default([o.id,d.ITEM_TYPE.PROP,1]);(n=I.default.itemMgr.testCost(i,1,!0)).enough?(this._Breach=!1,this.attribute.destroyAllChildren(),p.AudioMgr.Ins().playEffect(m.Res.audio.tupo),T.GCtrl.ES.emit(M.CMsg.client.hero.onHeroLvUp,this._IHeroData.tableId),T.GCtrl.ES.emit(M.CMsg.client.hero.onHeroBreach,this._IHeroData.tableId),T.GCtrl.ES.emit(M.CMsg.client.bag.onBagItemChange,[[o.id,d.ITEM_TYPE.PROP,-1]]),this.sk_sengji.setAnimation(0,A.JXEHeroBgAniNames.shengji,!1),R.default.ins().addDailyTaskState(7,1)):I.default.uiMgr.showToast(n.tip)}else if(this._IHeroData.exp>=this._nextData.exp||S.default.ins._isWhitePag){var n,r=I.default.lvData.getRaw(Number(e+1)).gold;i=new v.default([d.CURRENCY.GOLD,d.ITEM_TYPE.CURRENCY,r]),(n=I.default.itemMgr.testCost(i,1,!0)).enough?(T.GCtrl.ES.emit(M.CMsg.client.bag.onBagItemChange,[[d.CURRENCY.GOLD,d.ITEM_TYPE.CURRENCY,-r]]),this.attribute.destroyAllChildren(),p.AudioMgr.Ins().playEffect(m.Res.audio.lvUp),T.GCtrl.ES.emit(M.CMsg.client.hero.onHeroLvUp,this._IHeroData.tableId),this.sk_sengji.setAnimation(0,A.JXEHeroBgAniNames.shengji,!1),R.default.ins().addDailyTaskState(7,1)):I.default.uiMgr.showToast(n.tip)}else I.default.uiMgr.showToast(y.JXLocales.tip.lvExp);T.GCtrl.ES.emit("updateRedSeletBtn")}},e.prototype.upgradeStar=function(){var t=this._IHeroData.star;if(!(t>=5*this._SHeroData.star.length)){var e=I.default.heroMgr.getChipNeedByStar(t),o=this._SHeroData.star[e.lv],i=new v.default([this._SHeroData.id,d.ITEM_TYPE.PROP,o]),n=I.default.itemMgr.testCost(i,1,!0);n.enough?(T.GCtrl.ES.emit(M.CMsg.client.bag.onBagItemChange,[[this._IHeroData.tableId,d.ITEM_TYPE.PROP,-o]]),T.GCtrl.ES.emit(M.CMsg.client.hero.onHeroAddStar,this._IHeroData.tableId),R.default.ins().addDailyTaskState(8,1)):I.default.uiMgr.showToast(n.tip),T.GCtrl.ES.emit("updateRedSeletBtn")}},e.prototype.setLoadProgress=function(t,e){e&&(e.progress=Math.min(t,1))},e.prototype.showAttribute=function(t){var e=this;void 0===t&&(t=!1),this.attribute.destroyAllChildren();var o=I.default.lvData.getIdByInfo(this._IHeroData.lv),i=cc.instantiate(this.labelNode).getComponent(cc.Label);i.string=y.JXLocales.propts.info1000+this._carName[this._curData.quality-1]+o.showLv+"\u7ea7",i.node.x=i.node.y=0,this.attribute.addChild(i.node),this._IHeroData.propts.forEach(function(t,o){if(o<10){var i="0";0!=t&&(i=t<1?(100*t).toFixed(2)+"%":t.toString()),3==o?i=(t/100).toFixed(2)+"%":o>3&&(i=(100*t).toFixed(2)+"%");var n=cc.instantiate(e.labelNode).getComponent(cc.Label);n.string=y.JXLocales.equipPropts["info"+o]+i,n.node.x=n.node.y=0,e.attribute.addChild(n.node)}}),this.attribute2.removeAllChildren();var n=I.default.heroData.getRaw(this._IHeroData.tableId),r=I.default.lvData.getIdByInfo(this._IHeroData.lv+1),a=cc.instantiate(this.labelNode).getComponent(cc.Label);a.string=y.JXLocales.propts.info1000+this._carName[this._curData.quality-1]+r.showLv+"\u7ea7",a.node.x=a.node.y=0,this.attribute2.addChild(a.node),this._IHeroData.propts.forEach(function(t,o){if(o<10){var i="0";0!=(t+=n.growValue[o])&&(i=t<1?(100*t).toFixed(2)+"%":t.toString()),3==o?i=(t/100).toFixed(2)+"%":o>3&&(i=(100*t).toFixed(2)+"%");var r="<color=#ffffff>"+(y.JXLocales.equipPropts["info"+o]+i)+"</c>",a=cc.instantiate(e.richTextNode).getComponent(cc.RichText);e.attribute2.addChild(a.node),a.node.x=a.node.y=0,n.growValue[o]>0&&(r+="<color=#00ff00>  +"+n.growValue[o]+"</color>"),a.string=r}});var c={coin:s.JXMath.getZhanli(this._IHeroData.propts).toString(),add:(s.JXMath.getZhanli(this._IHeroData.propts)-this._zhangLi).toString()};if(this.onAddCoin(c,t),s.JXMath.getZhanli(this._IHeroData.propts)-this._zhangLi>0){var l=this.arrowLv.node.getComponent(cc.Animation);this.assetImpl.spriteAtlasFrame(this.arrowLv,m.Res.texture.views.heroDetail,"up"),l.play("arrow"),this.scheduleOnce(function(){e.arrowLv&&(e.arrowLv.spriteFrame=null,l.stop())},1.5)}else{var u=this.arrowLv.node.getComponent(cc.Animation);u.play("arrowDown"),this.assetImpl.spriteAtlasFrame(this.arrowLv,m.Res.texture.views.heroDetail,"down"),this.scheduleOnce(function(){e.arrowLv.spriteFrame=null,u.stop()},1.5)}this._zhangLi=parseInt(s.JXMath.getZhanli(this._IHeroData.propts).toString())},e.prototype.onAddCoin=function(t,e){var o=this,i=parseInt(t.coin)-parseInt(t.add);this.powal.string=""+t.coin,cc.tween({a:0}).to(.3,{a:100},{progress:function(e,n,r,a){o.node&&(o.powal.string=i+Math.floor(parseFloat(t.add)*a)+"")}}).start(),parseInt(t.add)>0&&e&&!C.GuideLogic.ins().isGuidding()&&I.default.jumpToMgr.jumpGoTo(g.VIEW_ID.PowerUp,t,this._IHeroData.tableId)},e.prototype.rangeImg=function(t,e){if(t==d.RANGE.RANGE1){var o=m.Res.texture.views.heroDetail;this.assetImpl.spriteAtlasFrame(e,o,"AttackBg"),(i=_.default.sprite()).node.parent=e.node,this.assetImpl.spriteAtlasFrame(i,o,"AttackBg")}else if(t==d.RANGE.RANGE2)o=m.Res.texture.views.heroDetail,this.assetImpl.spriteAtlasFrame(e,o,"hero"),(i=_.default.sprite()).node.parent=e.node,this.assetImpl.spriteAtlasFrame(i,o,"AttackBg");else if(t==d.RANGE.RANGE3){var i;o=m.Res.texture.views.heroDetail,this.assetImpl.spriteAtlasFrame(e,o,"Range"),(i=_.default.sprite()).node.parent=e.node,this.assetImpl.spriteAtlasFrame(i,o,"AttackBg")}},e.prototype.onClose1=function(){t.prototype.onClose.call(this),T.GCtrl.ES.emit("updateRedSeletBtn"),I.default.uiMgr.uiRoot.getChildByName("TopUiItem")&&(I.default.uiMgr.uiRoot.getChildByName("TopUiItem").active=!0),this.node.removeFromParent()},r([O({type:sp.Skeleton,tooltip:"\u82f1\u96c4\u54c1\u8d28\u5149\u8292"})],e.prototype,"sk_trait",void 0),r([O({type:sp.Skeleton,tooltip:"\u82f1\u96c4\u5347\u7ea7"})],e.prototype,"sk_sengji",void 0),r([O({type:cc.Node,tooltip:"\u82f1\u96c4\u6280\u80fd"})],e.prototype,"skill",void 0),r([O({type:cc.Sprite,tooltip:"\u82f1\u96c4\u804c\u4e1a"})],e.prototype,"heroGroup",void 0),r([O({type:cc.Node,tooltip:"\u82f1\u96c4\u540d\u5b57"})],e.prototype,"heroName",void 0),r([O({type:cc.Node,tooltip:"\u82f1\u96c4\u661f\u7ea7\u56fe\u793a"})],e.prototype,"heroStar",void 0),r([O({type:cc.Node,tooltip:"\u82f1\u96c4\u6218\u529b"})],e.prototype,"heroBatter",void 0),r([O({type:cc.Node,tooltip:"\u82f1\u96c4\u7b49\u7ea7"})],e.prototype,"heroLvLab",void 0),r([O({type:cc.ProgressBar,tooltip:"\u82f1\u96c4\u7b49\u7ea7\u8fdb\u5ea6\u6761"})],e.prototype,"heroLvVal",void 0),r([O({type:cc.Node,tooltip:"\u82f1\u96c4\u661f\u7ea7\u6570\u503c"})],e.prototype,"heroStarLab",void 0),r([O({type:cc.Sprite,tooltip:"\u82f1\u96c4\u7b49\u7ea7\u5347\u7ea7\u4e0e\u7a81\u7834"})],e.prototype,"heroLvBtn",void 0),r([O({type:cc.Label,tooltip:"\u82f1\u96c4\u7ecf\u9a8c\u503c"})],e.prototype,"expNum",void 0),r([O({type:cc.Label,tooltip:"\u82f1\u96c4\u5347\u7ea7\u91d1\u5e01\u6570\u91cf"})],e.prototype,"lvCoinNum",void 0),r([O({type:cc.Node,tooltip:"\u82f1\u96c4\u5347\u7ea7\u91d1\u5e01\u6309\u94ae"})],e.prototype,"lvCoinNode",void 0),r([O({type:cc.Label,tooltip:"\u661f\u7ea7\u5347\u7ea7\u788e\u7247\u6570"})],e.prototype,"starNum",void 0),r([O({type:cc.ProgressBar,tooltip:"\u82f1\u96c4\u661f\u7ea7\u8fdb\u5ea6\u6761"})],e.prototype,"heroStarVal",void 0),r([O({type:cc.Node,tooltip:"\u5c55\u793a\u5c5e\u6027\u6846"})],e.prototype,"attribute",void 0),r([O({type:cc.Node,tooltip:"\u5c55\u793a\u5c5e\u6027\u6846"})],e.prototype,"attribute2",void 0),r([O({type:cc.Label,tooltip:"\u6218\u529b"})],e.prototype,"powal",void 0),r([O({type:cc.ScrollView,tooltip:"\u88c5\u5907\u89c6\u56fe"})],e.prototype,"equipScrollView",void 0),r([O({type:cc.Node,tooltip:"\u5c5e\u6027\u89c6\u56fe"})],e.prototype,"attributeView",void 0),r([O({type:cc.Node,tooltip:"\u5c5e\u6027\u89c6\u56fe"})],e.prototype,"attributeMaskView",void 0),r([O({type:cc.Node,tooltip:"\u53ef\u89c6\u533a\u57df"})],e.prototype,"view",void 0),r([O({type:cc.Node,tooltip:"\u88c5\u5907\u5b58\u653e\u8282\u70b9"})],e.prototype,"equipcontent",void 0),r([O({type:cc.Node,tooltip:"\u88c5\u5907\u56fe\u6807\u7a7f\u6234\u6e32\u67d3\u8282\u70b9\u5de6\u8fb9"})],e.prototype,"equipmentL",void 0),r([O({type:cc.Node,tooltip:"\u88c5\u5907\u56fe\u6807\u7a7f\u6234\u6e32\u67d3\u8282\u70b9\u53f3\u8fb9"})],e.prototype,"equipmentR",void 0),r([O({type:cc.Node,tooltip:"\u88c5\u5907\u56de\u6536\u56fe\u6807"})],e.prototype,"delEquip",void 0),r([O({type:L.default,tooltip:"\u82f1\u96c4\u4eba\u7269"})],e.prototype,"HeroChange",void 0),r([O({type:cc.Node,tooltip:"\u5347\u7ea7"})],e.prototype,"lvUpBtn",void 0),r([O({type:cc.Node,tooltip:"\u5347\u661f"})],e.prototype,"addStarBtn",void 0),r([O({type:cc.Sprite,tooltip:"\u82f1\u96c4\u6218\u529b\u6da8\u8dcc\u5e45\u7bad\u5934"})],e.prototype,"arrowLv",void 0),r([O({type:cc.Node})],e.prototype,"equipToggle",void 0),r([O({type:cc.Node})],e.prototype,"attributeToggle",void 0),r([O({type:cc.Node})],e.prototype,"synthesisToggle",void 0),r([O({type:cc.Node})],e.prototype,"detailsnewsBg",void 0),r([O({type:cc.Node})],e.prototype,"labelNode",void 0),r([O({type:cc.Node})],e.prototype,"richTextNode",void 0),r([O({type:cc.Node})],e.prototype,"backBtn",void 0),r([B,x("View/Hero/DetailsCtrl")],e)}(h.default));o.default=N,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/GEvent/GParam":"GParam","../../../Core/GView/GListView":"GListView","../../../Core/GView/GViewBase":"GViewBase","../../../Core/Manager/AudioMgr":"AudioMgr","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/Language":"Language","../../Common/UI":"UI","../../Common/UICreate":"UICreate","../../Common/UIResources":"UIResources","../../Common/Zh":"Zh","../../Data/RunTime/RunRaw/RJXItem":"RJXItem","../../Guide/GuideLogic":"GuideLogic","../../Logic/GameMgr":"GameMgr","../../Logic/HeroMgr":"HeroMgr","../../Logic/SdkMgr":"SdkMgr","../../Logic/UserMgr":"UserMgr","../Common/JXItem":"JXItem","../Common/TopUiItem":"TopUiItem","../Home/SkillItem":"SkillItem","../JXBattle/JXULDefine":"JXULDefine","./../../../Core/GCtrl":"GCtrl","./../../Common/Define":"Define","./HeroChange":"HeroChange"}],DiaoCanView:[function(t,e,o){"use strict";cc._RF.push(e,"659c4zAnGFJTbP133rtHA9k","DiaoCanView");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GView/GViewBase"),s=t("../../Common/Define"),c=t("../../Common/UI"),l=t("../../Common/UIResources"),u=t("../../Data/RunTime/RunRaw/RItemAttach"),h=t("../../Data/RunTime/RunRaw/RJXItem"),p=t("../../Logic/GameMgr"),d=t("../Common/JXItem"),f=cc._decorator,g=f.ccclass,_=f.property,m=f.menu,y=(f.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.equipLayout=[],e.propNode=null,e.heroNode=null,e.sk_hero=null,e._equipArr=[],e._equipArr2=[],e}return n(e,t),e.prototype.onGLoad=function(){this.node.setContentSize(cc.winSize)},e.prototype.onGStart=function(){var e=this;if(t.prototype.onGStart.call(this),this.assetImpl.prefab(l.Res.prefab.item.jxItem,function(t){e.dealWithData(t)}),p.default.rHeroData.hasOwnHero(1029)){for(var o=p.default.RBagData.getHeroEquip(1029).equip,i=0,n=p.default.equipData.getJackpotJob(3,1029,0,1,4,1),r=0;r<n.length;r++)for(var a=n[r],s=0;s<o.length;s++)p.default.RBagData.getEquipDataById(o[s]).itemData.id==a.id&&i++;i<3?(this.heroNode.active=!1,this.propNode.active=!0):(this.heroNode.active=!0,this.propNode.active=!1,this.heroNode.getChildByName("Label").active=!0)}else this.heroNode.active=!0,this.propNode.active=!1,this.heroNode.getChildByName("Label").active=!1;var c=["toushi1","toushi2","wuqi"],u=["toushi1","toushi3","wuqi3"];for(s=0;s<c.length;s++)try{var h=u[s];h?this.sk_hero.setAttachment(c[s],h):this.sk_hero.findSlot(c[s]).setAttachment(null)}catch(d){console.error(d)}},e.prototype.dealWithData=function(t){var e=p.default.heroData.getRaw(1029),o=p.default.equipData.getJackpotJob(e.type,e.id,0,1,4,1),i=p.default.equipData.getJackpotJob(0,e.id,0,1,4,0);this._equipArr=o,this._equipArr2=i;for(var n=0;n<o.length&&n<3;n++)this.equipLayout[n].addChild(this.setItem(t,o[n])),this.equipLayout[n].addChild(this.setItem(t,i[n]))},e.prototype.setItem=function(t,e){var o=this.assetImpl.addGChild(t);o.node.setPosition(0,0),o.node.scale=.8;var i=[e.id,s.ITEM_TYPE.EQUIPDATA,1],n=new h.default(i),r={insId:"",bool:!1,site:0};return o.node.getComponent(d.default).setView(n,s.ITEM_DETAIL_FLAG.NO_NUM|s.ITEM_DETAIL_FLAG.TPL|s.ITEM_DETAIL_FLAG.SHOWLIGHT,function(){var t=["0",e.id,0],o=new u.REquireItem(t);p.default.jumpToMgr.jumpGoTo(c.VIEW_ID.EquipDetailsCtrl,o,r,null,null,null)}),o.node},e.prototype.getEquip=function(t,e){var o=this;p.default.sdkMgr.watchAd(function(){var t=[],i=[];i.push(o._equipArr[e].id),i.push(s.SELLSTORE.COIN),i.push(s.SELLSTORE.COIN),t.push(i),(i=[]).push(o._equipArr2[e].id),i.push(s.SELLSTORE.COIN),i.push(s.SELLSTORE.COIN),t.push(i),p.default.jumpToMgr.jumpGoTo(c.VIEW_ID.rewardCtrl,t)},function(){},"\u83b7\u5f97\u8c82\u8749\u5168\u5957\u88c5\u5907"+e)},e.prototype.getHero=function(){p.default.rHeroData.hasOwnHero(1029)?p.default.sdkMgr.watchAd(function(){var t=[[0,0,0]];t[0][0]=1029,t[0][1]=s.ITEM_TYPE.PROP,t[0][2]=40,p.default.jumpToMgr.jumpGoTo(c.VIEW_ID.rewardCtrl,t),p.default.redMgr.sendValueSettingMsg(s.RPointMask.RPM_Hero_UnLock,!1)},function(){},"\u7ea2\u5305\u83b7\u5f97\u8c82\u8749\u788e\u7247"):p.default.sdkMgr.watchAd(function(){var t=[[0,0,0]];t[0][0]=1029,t[0][1]=s.ITEM_TYPE.HERO,t[0][2]=1,p.default.jumpToMgr.jumpGoTo(c.VIEW_ID.rewardCtrl,t),p.default.redMgr.sendValueSettingMsg(s.RPointMask.RPM_Hero_UnLock,!1)},function(){},"\u7ea2\u5305\u83b7\u5f97\u8c82\u8749")},r([_({type:cc.Node,tooltip:"\u56fe\u6807\u81ea\u52a8\u6392\u5e8f"})],e.prototype,"equipLayout",void 0),r([_({type:cc.Node,tooltip:"\u56fe\u6807\u81ea\u52a8\u6392\u5e8f"})],e.prototype,"propNode",void 0),r([_({type:cc.Node,tooltip:"\u56fe\u6807\u81ea\u52a8\u6392\u5e8f"})],e.prototype,"heroNode",void 0),r([_({type:sp.Skeleton,tooltip:"\u56fe\u6807\u81ea\u52a8\u6392\u5e8f"})],e.prototype,"sk_hero",void 0),r([g,m("View/Tip/DiaoCanView")],e)}(a.default));o.default=y,cc._RF.pop()},{"../../../Core/GView/GViewBase":"GViewBase","../../Common/Define":"Define","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Data/RunTime/RunRaw/RItemAttach":"RItemAttach","../../Data/RunTime/RunRaw/RJXItem":"RJXItem","../../Logic/GameMgr":"GameMgr","../Common/JXItem":"JXItem"}],ES5Ex:[function(t,e,o){"use strict";cc._RF.push(e,"93168vsoJJBBqWKSjc5DeAx","ES5Ex");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.ObjectWrapArray=o.debounce=o.NewFillArray=o.SetWrap=o.MapWrap=o.ObjectWrap=void 0;var r=function(){function t(){this.wrapId=t.SGenWrapId++}return t.prototype.equal=function(t){return this.wrapId==t.wrapId},t.SGenWrapId=0,t}();o.ObjectWrap=r;var a=function(t){function e(e){var o=t.call(this)||this;if(o._size=0,o._objects=cc.js.createMap(!0),o._size=0,e)for(var i=0;i<e.length;i++)o.set(e[i][0],e[i][1]);return o}return n(e,t),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(t){this._size=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"objects",{set:function(t){this._objects=t},enumerable:!1,configurable:!0}),e.prototype.clear=function(){this._objects=cc.js.createMap(!0),this._size=0},e.prototype.has=function(t){return t in this._objects},e.prototype.set=function(t,e){this.has(t)||this._size++,this._objects[t]=e},e.prototype.get=function(t){return this.has(t)?this._objects[t]:null},e.prototype.delete=function(t){this.has(t)&&(delete this._objects[t],this._size--)},e.prototype.keys=function(){return Object.keys(this._objects)},e.prototype.values=function(){var t=this,e=this.keys(),o=[];return e.forEach(function(e){o.push(t.get(e))}),o},e.prototype.toArray=function(t){var e=this,o=[];return this.keys().forEach(function(i){o.push([t?parseInt(i):i,e.get(i)])}),o},e.prototype.forEach=function(t){for(var e=this.keys(),o=0;o<e.length;o++){var i=t(this._objects[e[o]],e[o]);if(i)return i}},e.prototype.rforEach=function(t){for(var e=this.keys(),o=e.length-1;o>=0;o--){var i=t(this._objects[e[o]],e[o]);if(i)return i}},e}(r);o.MapWrap=a;var s=function(t){function e(){var e=t.call(this)||this;return e.sets=new Array,e}return n(e,t),Object.defineProperty(e.prototype,"size",{get:function(){return this.sets.length},enumerable:!1,configurable:!0}),e.prototype.has=function(t){return this.sets.indexOf(t)>-1},e.prototype.add=function(t){this.has(t)||this.sets.push(t)},e.prototype.delete=function(t){var e=this.sets.indexOf(t);-1!=e&&this.sets.splice(e,1)},e.prototype.clear=function(){this.sets.length=0},e.prototype.toArray=function(){return this.sets},e}(r);o.SetWrap=s,o.NewFillArray=function(t,e){for(var o=[],i=0;i<t;i++)o.push(null==e?0:e);return o},o.debounce=function(t,e,o){var i;return function(){var n=this,r=arguments,a=function(){i=null,o||t.apply(n,r)},s=o&&!i;clearTimeout(i),i=setTimeout(a,e),s&&t.apply(n,r)}},o.ObjectWrapArray=function(){var t=new Array;return t.prototype.indexOf=function(t,e){for(var o=e=e||0;o<this.length;o++)if(this[o].wrapId===t.wrapId)return o;return-1},t},cc._RF.pop()},{}],EnumUtil:[function(t,e,o){"use strict";cc._RF.push(e,"1336b/Nn7NKaKGbfiRSaI58","EnumUtil"),Object.defineProperty(o,"__esModule",{value:!0}),o.EnumUtil=void 0;var i=function(){function t(){}return t.size=function(t){return Object.keys(t).length/2},t.newArray=function(e,o){for(var i=[],n=0,r=t.size(e);n<r;n++)i.push(o);return i},t}();o.EnumUtil=i,cc._RF.pop()},{}],EquipAddCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"d3cfb6GUdZEgIgw+vETc3bh","EquipAddCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a},a=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0});var s=t("../../../Core/CoreDefine"),c=t("../../../Core/GCtrl"),l=t("../../../Core/GView/GListView"),u=t("../../../Core/GView/GPage"),h=t("../../Common/Define"),p=t("../../Common/UIResources"),d=t("../../Logic/GameMgr"),f=t("../../Logic/HeroMgr"),g=cc._decorator,_=g.ccclass,m=g.property,y=g.menu,v=(g.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cardView=null,e.content=null,e.mask=null,e._listView=null,e._curListIndex=0,e}return n(e,t),e.prototype.onPageIn=function(){this.initEmbattle()},e.prototype.onGLoad=function(){c.GCtrl.ES.on(h.CMsg.client.bag.onBagItemChange,this,this.initEmbattle.bind(this),s.PRIORITY_VIEW),c.GCtrl.ES.on(h.CMsg.client.equip.AddSynthesisEquip,this,this.initEmbattle.bind(this),s.PRIORITY_VIEW),c.GCtrl.ES.on(h.CMsg.client.hero.onAddHero,this,this.initEmbattle.bind(this),s.PRIORITY_VIEW),c.GCtrl.ES.on(h.CMsg.client.hero.onHeroLvUp,this,this.initEmbattle.bind(this),s.PRIORITY_VIEW),c.GCtrl.ES.on(h.CMsg.client.hero.onHeroBreach,this,this.initEmbattle.bind(this),s.PRIORITY_VIEW),c.GCtrl.ES.on(h.CMsg.client.hero.onHeroAddStar,this,this.initEmbattle.bind(this),s.PRIORITY_VIEW)},e.prototype.initEmbattle=function(){var t=this;this._listView?this.dealWithData():this.assetImpl.prefab(p.Res.prefab.item.heroCardItem,function(e){t._listView=new l.GListView({scrollview:t.cardView,mask:t.mask,content:t.content,itemTpl:cc.instantiate(e),itemSetter:t.onItemSetter.bind(t),column:3,gapY:20,gapX:30,padingY:20,padingX:15,isCbClass:!0,isWidget:!0}),t.dealWithData()})},e.prototype.dealWithData=function(){var t=d.default.rHeroData.getHaveHeros(this._curListIndex).have,e=[f.IHeroSort.sortLvUp,f.IHeroSort.sortStart,f.IHeroSort.sortZhanli];t.sort(function(t,o){return f.IHeroSort.sorts(e,t,o)});var o=a(t);this._listView.setData(o)},e.prototype.btnOnce=function(t){this._curListIndex=Number(t.node._name),c.GCtrl.ES.emit(h.CMsg.client.home.onBattleItem,-1),this.dealWithData()},e.prototype.onItemSetter=function(t,e,o){t.init(e,o,h.LISTENTTYPE.listent3)},r([m(cc.ScrollView)],e.prototype,"cardView",void 0),r([m(cc.Node)],e.prototype,"content",void 0),r([m(cc.Node)],e.prototype,"mask",void 0),r([_,y("View/Hero/EquipAddCtrl")],e)}(u.default));o.default=v,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/GCtrl":"GCtrl","../../../Core/GView/GListView":"GListView","../../../Core/GView/GPage":"GPage","../../Common/Define":"Define","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr","../../Logic/HeroMgr":"HeroMgr"}],EquipDetailsCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"69b13180MhDrbd6HYvXrvyU","EquipDetailsCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/GCtrl"),c=t("../../../Core/GEvent/GParam"),l=t("../../../Core/GView/GViewBase"),u=t("../../../Core/Manager/AudioMgr"),h=t("../../Common/Define"),p=t("../../Common/JXColor"),d=t("../../Common/Language"),f=t("../../Common/UICreate"),g=t("../../Common/UIResources"),_=t("../../Common/Zh"),m=t("../../Logic/GameMgr"),y=cc._decorator,v=y.ccclass,C=y.property,I=y.menu,E=(y.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._data=null,e._equipName=null,e._sLv=null,e._jumpEquip=null,e._IHeroData=null,e._equipNameArr=[],e._equipArr=new Array(5),e._isEquip=!1,e._FireEquip=0,e._detailsbtn=h.DETAILSBTN.DETAILSBTN0,e.buyClick=null,e.equipInfo=null,e.icon=null,e.equipName=null,e.suitInfoParent=null,e.suitInfo=null,e.strongInfoParent=null,e.strongInfo=null,e.firstLv=null,e.firstExp=null,e.totalPower=null,e.equipIn=null,e}return n(e,t),e.prototype.onGStart=function(e,o,i,n,r){void 0===n&&(n=h.DETAILSBTN.DETAILSBTN0),void 0===r&&(r=null),t.prototype.onGStart.call(this),this._detailsbtn=n,this.buyClick=r,this._detailsbtn!=h.DETAILSBTN.DETAILSBTN0&&(this.equipIn.getComponent(cc.Button).interactable=!1,this.equipIn.active=!1),this._data=e,this._jumpEquip=o,this._IHeroData=i,this.initCarName(),this.initEquipInfo(),this._detailsbtn==h.DETAILSBTN.DETAILSBTN3?(this.equipIn.children[0].children[0].getComponent(cc.Label).string="\u8d2d  \u4e70",this.equipIn.getComponent(cc.Button).interactable=!0,this.equipIn.active=!0):this.equipIn.children[0].children[0].getComponent(cc.Label).string=0==this._jumpEquip.bool?"\u88c5  \u5907":"\u5378  \u4e0b"},e.prototype.initEquipInfo=function(){var t=this;this.totalPower.string=this._data.getZhanli()+"";var e;e=this._data.sLv>0?"  +"+this._data.sLv+"  "+this._data.itemData.raw.name:this._data.itemData.raw.name,this.equipName.string=e,this.assetImpl.prefab(g.Res.prefab.item.jxItem,function(e){var o=t.assetImpl.addGChild(e);o.node.parent=t.icon;var i,n=m.default.RBagData.getEquipDataById(t._data.insId);i=n?n.itemData:t._data.itemData,o.setView(i,h.ITEM_DETAIL_FLAG.NO_NUM_NODE|h.ITEM_DETAIL_FLAG.NO_SLV|h.ITEM_DETAIL_FLAG.ICON_SCALE)});var o=m.default.equipData.getRaw(this._data.equipId).property;o.forEach(function(e,o){0!=e&&t.assetImpl.font(g.Res.font.fzcy,function(i){var n=e<1?100*e+"%":e.toString();o>2&&(n=(100*e).toFixed(2)+"%");var r=d.L(_.JXLocales.propts["info"+o],n),a=f.default.label(r);a.fontSize=20,a.lineHeight=20,a.node.color=p.JXColor.Cffffff,a.horizontalAlign=cc.Label.HorizontalAlign.LEFT,a.node.anchorX=0,a.spacingX=5,a.node.x=25,t.equipInfo.addChild(a.node),a.node.addComponent(cc.LabelOutline);var s=a.node.getComponent(cc.LabelOutline);s.color=cc.color(8,89,152,255),s.width=2,a.font=i})}),m.default.suitData.data.values();var i=null;if(this._IHeroData)i=m.default.suitData.getAllHeroSuit(this._IHeroData.tableId);else{var n=m.default.equipData.getRaw(this._data.equipId).target[0];i=m.default.suitData.getAllHeroSuit(n)}var r=m.default.suitData.getHeroSuit(this._data.equipId,i),a=new Array;r?(this.suitInfoParent.active=!0,r.suit.forEach(function(e,o){if(1!=t._equipArr[o]){var i=m.default.equipData.getRaw(e).name;t.assetImpl.font(g.Res.font.fzcy,function(n){var r=f.default.label(i);r.fontSize=20,r.lineHeight=25,r.node.color=p.JXColor.Cffffff,r.horizontalAlign=cc.Label.HorizontalAlign.LEFT,r.node.anchorX=0,r.spacingX=5,r.node.x=25,t.suitInfo.addChild(r.node),r.node.zIndex=o-o,t._IHeroData&&t._IHeroData.equips.forEach(function(o,i){if("-1"!=o&&o){var n=m.default.RBagData.getEquipDataById(o);e==n.equipId&&(i>=3?a.length>0?a.forEach(function(e){e!=n.equipId&&(t._FireEquip++,r.node.color=cc.color(98,247,105,255),a.push(n.equipId))}):(t._FireEquip++,r.node.color=cc.color(98,247,105,255),a.push(n.equipId)):(t._FireEquip++,r.node.color=cc.color(98,247,105,255)))}}),r.node.addComponent(cc.LabelOutline);var s=r.node.getComponent(cc.LabelOutline);s.color=cc.color(8,89,152,255),s.width=2,r.font=n}),e==t._data.equipId&&(t._isEquip=!0),t._equipArr[o]=!0}t._isEquip&&o==r.suit.length-1&&(t._isEquip=!1,t.assetImpl.font(g.Res.font.fzcy,function(e){var o=r.name+"("+t._FireEquip+"/"+r.suit.length+")",i=f.default.label(o);i.fontSize=23,i.lineHeight=30,t._FireEquip>0?i.node.color=cc.color(98,247,105,255):i.node.color=p.JXColor.Cffffff,i.horizontalAlign=cc.Label.HorizontalAlign.LEFT,i.node.anchorX=0,i.node.x=25,i.spacingX=5,t.suitInfo.addChild(i.node),i.node.zIndex=-10,i.node.addComponent(cc.LabelOutline);var n=i.node.getComponent(cc.LabelOutline);n.color=cc.color(8,89,152,255),n.width=2,i.font=e}),r.up2&&r.up2.forEach(function(e,o){0!=e&&t.assetImpl.font(g.Res.font.fzcy,function(i){var n=e<1?100*e+"%":e.toString(),r="(2)"+d.L(_.JXLocales.propts["info"+o],n),a=f.default.label(r);a.fontSize=20,a.lineHeight=25,a.spacingX=5,a.node.color=p.JXColor.Cffffff,t._FireEquip>=h.SUIT.SUIT2&&(a.node.color=cc.color(98,247,105,255)),a.horizontalAlign=cc.Label.HorizontalAlign.LEFT,a.node.anchorX=0,a.node.x=25,t.suitInfo.addChild(a.node),a.node.addComponent(cc.LabelOutline);var s=a.node.getComponent(cc.LabelOutline);s.color=cc.color(8,89,152,255),s.width=2,a.font=i})}),r.up3&&r.up3.forEach(function(e,o){0!=e&&t.assetImpl.font(g.Res.font.fzcy,function(i){var n=e<1?100*e+"%":e.toString(),r="(3)"+d.L(_.JXLocales.propts["info"+o],n),a=f.default.label(r);a.fontSize=20,a.lineHeight=25,a.node.color=p.JXColor.Cffffff,t._FireEquip>=h.SUIT.SUIT3&&(a.node.color=cc.color(98,247,105,255)),a.horizontalAlign=cc.Label.HorizontalAlign.LEFT,a.node.anchorX=0,a.node.x=25,a.spacingX=5,t.suitInfo.addChild(a.node),a.node.addComponent(cc.LabelOutline);var s=a.node.getComponent(cc.LabelOutline);s.color=cc.color(8,89,152,255),s.width=2,a.font=i})}),r.up4&&r.up4.forEach(function(e,o){0!=e&&t.assetImpl.font(g.Res.font.fzcy,function(i){var n=e<1?100*e+"%":e.toString(),r="(4)"+d.L(_.JXLocales.propts["info"+o],n),a=f.default.label(r);a.fontSize=20,a.lineHeight=25,a.node.color=p.JXColor.Cffffff,t._FireEquip>=h.SUIT.SUIT4&&(a.node.color=cc.color(98,247,105,255)),a.horizontalAlign=cc.Label.HorizontalAlign.LEFT,a.node.anchorX=0,a.spacingX=5,a.node.x=25,t.suitInfo.addChild(a.node),a.node.addComponent(cc.LabelOutline);var s=a.node.getComponent(cc.LabelOutline);s.color=cc.color(8,89,152,255),s.width=2,a.font=i})}),r.up5&&r.up5.forEach(function(e,o){0!=e&&t.assetImpl.font(g.Res.font.fzcy,function(i){var n=e<1?100*e+"%":e.toString(),r="(5)"+d.L(_.JXLocales.propts["info"+o],n),a=f.default.label(r);a.fontSize=20,a.lineHeight=25,a.node.color=p.JXColor.Cffffff,t._FireEquip>=h.SUIT.SUIT5&&(a.node.color=cc.color(98,247,105,255)),a.horizontalAlign=cc.Label.HorizontalAlign.LEFT,a.node.anchorX=0,a.spacingX=5,a.node.x=25,t.suitInfo.addChild(a.node),a.node.addComponent(cc.LabelOutline);var s=a.node.getComponent(cc.LabelOutline);s.color=cc.color(8,89,152,255),s.width=2,a.font=i})}),r.allUp&&t.assetImpl.font(g.Res.font.fzcy,function(e){var o=f.default.label(r.txt);o.fontSize=20,o.lineHeight=25,o.horizontalAlign=cc.Label.HorizontalAlign.LEFT,o.node.anchorX=0,o.spacingX=5,o.node.x=25,o.node.color=p.JXColor.Cffffff,t._FireEquip>=h.SUIT.SUIT5&&(o.node.color=cc.color(98,247,105,255)),t.suitInfo.addChild(o.node),o.node.addComponent(cc.LabelOutline);var i=o.node.getComponent(cc.LabelOutline);i.color=cc.color(8,89,152,255),i.width=2,o.font=e}))})):this.suitInfoParent.active=!1,this._data.sLv>0?(this.strongInfoParent.active=!0,this.assetImpl.font(g.Res.font.fzcy,function(e){var o;o="+"+t._data.sLv+"\u5f3a\u5316";var i=f.default.label(o);i.fontSize=23,i.lineHeight=30,i.horizontalAlign=cc.Label.HorizontalAlign.LEFT,i.node.anchorX=0,i.spacingX=5,i.node.x=25,i.node.color=cc.color(255,180,34,255),t.strongInfo.addChild(i.node),i.node.addComponent(cc.LabelOutline);var n=i.node.getComponent(cc.LabelOutline);n.color=p.JXColor.C000000,n.width=2,i.font=e}),this._data.propts.forEach(function(e,i){0!=(e-=o[i])&&t.assetImpl.font(g.Res.font.fzcy,function(o){var n=e<1?100*e+"%":e.toString(),r=d.L(_.JXLocales.propts["info"+i],"+"+n),a=f.default.label(r);a.fontSize=20,a.lineHeight=25,a.horizontalAlign=cc.Label.HorizontalAlign.LEFT,a.node.anchorX=0,a.spacingX=5,a.node.x=25,a.node.color=cc.color(255,180,34,255),t.strongInfo.addChild(a.node),a.node.addComponent(cc.LabelOutline);var s=a.node.getComponent(cc.LabelOutline);s.color=p.JXColor.C000000,s.width=2,a.font=o})})):this.strongInfoParent.active=!1,this.assetImpl.font(g.Res.font.fzcy,function(e){t.firstExp.string="\u9996\u6b21\u7a7f\u6234\u83b7\u5f97\u7ecf\u9a8c\u503c: "+t._data.itemData.raw.exp,t._data.isFirstExp?t.firstExp.node.color=p.JXColor.C949494:t.firstExp.node.color=cc.color(98,247,105,255),t.firstExp.node.anchorX=0,t.firstExp.node.addComponent(cc.LabelOutline);var o=t.firstExp.node.getComponent(cc.LabelOutline);o.color=p.JXColor.C000000,o.width=2,t.firstExp.font=e}),this.assetImpl.font(g.Res.font.fzcy,function(e){0==t._data.itemData.raw.lv&&(t._data.itemData.raw.lv+=1);var o=m.default.lvData.getIdByInfo(t._data.itemData.raw.lv);t.firstLv.string="\u9700\u8981\u7b49\u7ea7:"+t._equipNameArr[o.quality-1]+o.showLv+"\u7ea7",t.firstLv.node.anchorX=0,t.firstLv.node.addComponent(cc.LabelOutline);var i=t.firstLv.node.getComponent(cc.LabelOutline);i.color=p.JXColor.C000000,i.width=2,t.firstLv.font=e})},e.prototype.wearEquip=function(){var t=this;if(this._detailsbtn!=h.DETAILSBTN.DETAILSBTN3){var e=m.default.RBagData.getEquipDataById(this._data.insId).itemData.raw.seat,o=m.default.RBagData.getEquipDataById(this._data.insId).itemData.raw.lv;if(this._jumpEquip.bool)this._IHeroData.equips.forEach(function(o,i){t._data.insId==o&&(e=i)}),n={heroId:this._IHeroData.tableId,site:e,equipId:this._data.insId},s.GCtrl.ES.emit(h.CMsg.client.equip.onEquipPutOff,new c.default(n));else if(this._IHeroData.lv>=o){if(e>2&&this._IHeroData.equips.length>e)if(6==this._IHeroData.equips.length){var i=!1;this._IHeroData.equips.forEach(function(t,o){i||(null==t||"-1"==t)&&o>2&&(e=o,i=!0)}),i||this._IHeroData.equips.forEach(function(o,n){i||(n==t._IHeroData.equips.length-1&&(e=n,i=!0),n>2&&m.default.heroMgr.checkEquipIsBast(t._IHeroData.equips[n],t._data.insId,t._IHeroData.lv)&&(e=n,i=!0))})}else e=this._IHeroData.equips.length;var n={heroId:this._IHeroData.tableId,site:e,equipId:this._data.insId};if(1!=this._data.isFirstExp){var r={heroId:this._IHeroData.tableId,exp:this._data.itemData.raw.exp};m.default.RBagData.setIsFirstExp(this._data.insId),s.GCtrl.ES.emit(h.CMsg.client.hero.onHeroAddExp,new c.default(r))}var a=m.default.suitData.getAllHeroSuit(this._IHeroData.tableId),l=m.default.suitData.getHeroSuit(this._data.equipId,a),p={IHeroData:this._IHeroData,suit:l};u.AudioMgr.Ins().playEffect(g.Res.audio.addEquip),s.GCtrl.ES.emit(h.CMsg.client.hero.onAddSuit,new c.default(p)),s.GCtrl.ES.emit(h.CMsg.client.equip.onEquipPutOn,new c.default(n))}else{var d=m.default.lvData.getIdByInfo(this._data.itemData.raw.lv),f="\u82f1\u96c4\u7b49\u7ea7\u4e0d\u8db3\uff0c\u9700\u8981\u82f1\u96c4\u8fbe\u5230"+this._equipNameArr[d.quality-1]+d.showLv+"\u7ea7";m.default.uiMgr.showToast(f)}this.onClose()}else this.buyClick&&this.buyClick()},e.prototype.initCarName=function(){var t=m.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.white);this._equipNameArr.push(t);var e=m.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.green);this._equipNameArr.push(e);var o=m.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.Blue);this._equipNameArr.push(o);var i=m.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.purple);this._equipNameArr.push(i);var n=m.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.orange);this._equipNameArr.push(n);var r=m.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.red);this._equipNameArr.push(r)},e.prototype.close=function(){this.onClose()},r([C({type:cc.Node,tooltip:"\u88c5\u5907\u4fe1\u606f"})],e.prototype,"equipInfo",void 0),r([C({type:cc.Node,tooltip:"\u56fe\u6807"})],e.prototype,"icon",void 0),r([C({type:cc.Label,tooltip:"\u88c5\u5907\u540d\u79f0"})],e.prototype,"equipName",void 0),r([C({type:cc.Node,tooltip:"\u5957\u88c5\u4fe1\u606f\u7236\u8282\u70b9"})],e.prototype,"suitInfoParent",void 0),r([C({type:cc.Node,tooltip:"\u5957\u88c5\u4fe1\u606f"})],e.prototype,"suitInfo",void 0),r([C({type:cc.Node,tooltip:"\u5f3a\u5316\u4fe1\u606f\u7236\u8282\u70b9"})],e.prototype,"strongInfoParent",void 0),r([C({type:cc.Node,tooltip:"\u5f3a\u5316\u4fe1\u606f"})],e.prototype,"strongInfo",void 0),r([C({type:cc.Label,tooltip:"\u7a7f\u6234\u7b49\u7ea7"})],e.prototype,"firstLv",void 0),r([C({type:cc.Label,tooltip:"\u7a7f\u6234\u7ecf\u9a8c"})],e.prototype,"firstExp",void 0),r([C({type:cc.Label,tooltip:"\u603b\u6218\u529b"})],e.prototype,"totalPower",void 0),r([C({type:cc.Node,tooltip:"\u7a7f\u6234\u6309\u94ae"})],e.prototype,"equipIn",void 0),r([v,I("View/Home/EquipDetailsCtrl")],e)}(l.default));o.default=E,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../../Core/GEvent/GParam":"GParam","../../../Core/GView/GViewBase":"GViewBase","../../../Core/Manager/AudioMgr":"AudioMgr","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/JXColor":"JXColor","../../Common/Language":"Language","../../Common/UICreate":"UICreate","../../Common/UIResources":"UIResources","../../Common/Zh":"Zh","../../Logic/GameMgr":"GameMgr"}],FeatureCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"fdb603FdRNIdJ1kifie/QwH","FeatureCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/GCtrl"),c=t("../../../Core/GView/GViewBase"),l=t("../../../Core/Manager/AudioMgr"),u=t("../../Common/Define"),h=t("../../Common/UIResources"),p=t("../../Common/Zh"),d=t("../../Data/RunTime/RunRaw/RJXItem"),f=t("../../Logic/GameMgr"),g=t("../JXBattle/JXULDefine"),_=t("./HeroChange"),m=cc._decorator,y=m.ccclass,v=m.property,C=m.menu,I=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.HeroChange=null,e.heroTxt=null,e.sk_trait=null,e.item=null,e.heroName=null,e.btnAd=null,e.btn1=null,e.herotype=null,e.herotypeSprite=[],e.value=null,e.index=null,e.heroData=null,e}return n(e,t),e.prototype.onGStart=function(e,o){void 0===o&&(o=!1),t.prototype.onGStart.call(this),this.value=e.reward,this.index=e.index,this.heroData=this.value[u.PART_ITEM.ID],this.value[u.PART_ITEM.TYPE]==u.ITEM_TYPE.HERO?this.initHeroSpine():this.initItem(),o?(this.btnAd.active=!0,this.btn1.x=-140):(this.btnAd.active=!1,this.btn1.x=0)},e.prototype.initHeroSpine=function(){var t=this;l.AudioMgr.Ins().playEffect(h.Res.audio.addHero),f.default.rHeroData.getHaveHeros(u.SQUAD_BUTTON.ALL).have.forEach(function(e){if(e.tableId==t.heroData){t.HeroChange.changeSpine(e);var o=f.default.heroData.getRaw(t.heroData);t.HeroChange.node.scale=1.3*o.roleScale,t.heroTxt.string=o.show,t.initTrait(o),t.sk_trait.setAnimation(0,g.JXEHeroBgAniNames.white,!0),t.assetImpl.spriteAtlasFrame(t.heroName.getComponent(cc.Sprite),"frames/views/squadImg","lname_"+o.icon),t.herotype.getComponent(cc.Sprite).spriteFrame=t.herotypeSprite[o.herotype-1]}})},e.prototype.initTrait=function(t){switch(t.trait){case u.HERO_TRAIT.WHITE:this.sk_trait.setAnimation(0,g.JXEHeroBgAniNames.white,!0);break;case u.HERO_TRAIT.GREEN:this.sk_trait.setAnimation(0,g.JXEHeroBgAniNames.green,!0);break;case u.HERO_TRAIT.BLUE:this.sk_trait.setAnimation(0,g.JXEHeroBgAniNames.blue,!0);break;case u.HERO_TRAIT.PURPLE:this.sk_trait.setAnimation(0,g.JXEHeroBgAniNames.purple,!0);break;case u.HERO_TRAIT.YELLOW:this.sk_trait.setAnimation(0,g.JXEHeroBgAniNames.yellow,!0);break;case u.HERO_TRAIT.RED:this.sk_trait.setAnimation(0,g.JXEHeroBgAniNames.red,!0)}},e.prototype.doubleClick=function(){var t=this;f.default.sdkMgr.watchAd(function(){s.GCtrl.ES.emit(u.CMsg.client.bag.onBagItemChange,[t.value]),f.default.uiMgr.showToast(p.JXLocales.tip.doubleClick),f.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.FeatureCtrl,{msg:u.PointInfo.FeatureCtrl_ad}),t.viewClose(null,!0)},function(){},"\u5f97\u5230\u82f1\u96c4\u53cc\u500d\u9886\u53d6")},e.prototype.initItem=function(){var t=this;this.sk_trait.node.active=!1,this.heroName.parent.active=!1,this.herotype.active=!1,this.assetImpl.prefab(h.Res.prefab.item.jxItem,function(e){var o=t.assetImpl.addGChild(e);o.node.parent=t.item;var i=new d.default(t.value),n=f.default.itemData.getRaw(t.heroData);t.heroTxt.string=n.txt,o.setView(i,u.ITEM_DETAIL_FLAG.BAG|u.ITEM_DETAIL_FLAG.NUMPOS_ITEM_BC|u.ITEM_DETAIL_FLAG.NOT_TOUCH|u.ITEM_DETAIL_FLAG.SHOWLIGHT|u.ITEM_DETAIL_FLAG.LIGHT)})},e.prototype.viewClose=function(t,e){if(void 0===e&&(e=!0),e){var o={bool:e,reward:this.value,index:this.index};s.GCtrl.ES.emit(u.CMsg.client.home.onFeature,o)}this.onClose()},e.prototype.onDouble=function(){s.GCtrl.ES.emit("doubleGet");var t={bool:!1,reward:[],index:this.index};s.GCtrl.ES.emit(u.CMsg.client.home.onFeature,t),this.onClose()},e.prototype.close=function(){var t={bool:!1,reward:[],index:this.index};s.GCtrl.ES.emit(u.CMsg.client.home.onFeature,t),this.onClose()},r([v({type:_.default,tooltip:"\u82f1\u96c4\u4eba\u7269"})],e.prototype,"HeroChange",void 0),r([v({type:cc.Label,tooltip:"\u82f1\u96c4\u4eba\u7269"})],e.prototype,"heroTxt",void 0),r([v({type:sp.Skeleton,tooltip:"\u82f1\u96c4\u54c1\u8d28\u5149\u8292"})],e.prototype,"sk_trait",void 0),r([v({type:cc.Node,tooltip:"\u82f1\u96c4\u788e\u7247\u8282\u70b9"})],e.prototype,"item",void 0),r([v({type:cc.Node,tooltip:"\u82f1\u96c4\u540d\u5b57"})],e.prototype,"heroName",void 0),r([v({type:cc.Node,tooltip:"\u53cc\u500d\u6309\u94ae"})],e.prototype,"btnAd",void 0),r([v({type:cc.Node,tooltip:"\u5355\u500d\u6309\u94ae"})],e.prototype,"btn1",void 0),r([v({type:cc.Node,tooltip:"\u82f1\u96c4\u54c1\u8d28"})],e.prototype,"herotype",void 0),r([v({type:cc.SpriteFrame,tooltip:"\u7ea7\u522b\u56fe\u7247"})],e.prototype,"herotypeSprite",void 0),r([y,C("View/Hero/FeatureCtrl")],e)}(c.default);o.default=I,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../../Core/GView/GViewBase":"GViewBase","../../../Core/Manager/AudioMgr":"AudioMgr","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/UIResources":"UIResources","../../Common/Zh":"Zh","../../Data/RunTime/RunRaw/RJXItem":"RJXItem","../../Logic/GameMgr":"GameMgr","../JXBattle/JXULDefine":"JXULDefine","./HeroChange":"HeroChange"}],FightDataItem:[function(t,e,o){"use strict";cc._RF.push(e,"f6e7f2RJCxN3rfUf7vdZFft","FightDataItem");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GView/GChild"),s=t("../../Common/UIResources"),c=t("../../Logic/GameMgr"),l=t("../../Manager/RoleManager"),u=cc._decorator,h=u.ccclass,p=u.property,d=u.menu,f=(u.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.heroName=null,e.heroImg=null,e.hpbar=null,e.hpLabe=null,e.lockNode=null,e.powerLabel=null,e._heroId=-1,e._sHeroData=null,e._maxHp=0,e._curHp=0,e}return n(e,t),e.prototype.onGLoad=function(){},e.prototype.init=function(t){this._heroId=t,this._sHeroData=c.default.heroData.getRaw(t),this.assetImpl.spriteFrame(this.heroImg,s.Res.texture.hero.hero+this._sHeroData.icon);var e=l.default.getInstance().getRolePowerProp(t)[2];this.powerLabel.string=e>=1e5?Math.floor(e/100)/10+"k":""+e,this.hpLabe.string="0%",this._maxHp=e,this._curHp=0,this.hpbar.progress=0,this.lockNode.active=!1},e.prototype.isCanGetPower=function(){return this._maxHp-this._curHp>5e4?3e4:this._maxHp-this._curHp>1e4?5e3:this._maxHp-this._curHp>1e3?200:this._maxHp-this._curHp>100?20:this._maxHp-this._curHp>10?10:this._maxHp-this._curHp>0?this._maxHp-this._curHp:0},e.prototype.addPower=function(t){this.lockNode.active=!1,this._curHp+=t,this.hpLabe.string=Math.floor(100*this._curHp/this._maxHp)+"%",this.hpbar.progress=this._curHp/this._maxHp},e.prototype.checkState=function(){return!(this._curHp<=0&&(this.lockNode.active=!0,1))},r([p({type:cc.Sprite,tooltip:"\u82f1\u96c4\u540d\u5b57"})],e.prototype,"heroName",void 0),r([p({type:cc.Sprite,tooltip:"\u82f1\u96c4\u56fe\u7247"})],e.prototype,"heroImg",void 0),r([p({type:cc.ProgressBar,tooltip:"\u8fdb\u5ea6\u6761"})],e.prototype,"hpbar",void 0),r([p({type:cc.Label,tooltip:"\u6218\u529b\u503c"})],e.prototype,"hpLabe",void 0),r([p({type:cc.Node,tooltip:"\u4e0d\u80fd\u4e0a\u9635"})],e.prototype,"lockNode",void 0),r([p({type:cc.Label})],e.prototype,"powerLabel",void 0),r([h,d("View/Hero/HeroCardItem")],e)}(a.default));o.default=f,cc._RF.pop()},{"../../../Core/GView/GChild":"GChild","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr","../../Manager/RoleManager":"RoleManager"}],FightDataPreView:[function(t,e,o){"use strict";cc._RF.push(e,"5fa3dYbEW5AFYB9gwR40w0f","FightDataPreView");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/GView/GViewBase"),c=t("../../../tyqSDK/tyqSDK"),l=t("../../Common/Define"),u=t("../../Common/UI"),h=t("../../Common/UIResources"),p=t("../../Logic/GameMgr"),d=t("../Hero/FightDataItem"),f=cc._decorator,g=f.ccclass,_=f.property,m=f.menu,y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curPower=null,e.curRoleList=null,e.curPowerLabel=null,e.tishiLabel=null,e.node1=null,e.node2=null,e.btnLayer=null,e.backBtn=null,e.bingliInfo=null,e._delay=30,e._totlaPower=0,e._fenpeiPower=[0,0,0,0,0],e._curHero=[],e._idFenpeiEnd=!1,e._isRewardAd=!1,e}return n(e,t),e.prototype.onGStart=function(){t.prototype.onGStart.call(this),this.initListView(),this.tishiLabel.node.active=!1,this.btnLayer.active=!1,this.closeInfo(),p.default.redMgr.setRPointView(this.bingliInfo,this.bingliInfo,!0,l.RedpointEffect.REDPOINT,l.RedpointPos.Main)},e.prototype.initListView=function(){var t=this,e=p.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.basicsWheat);e+=p.default.lUserData.getUserBuff(l.BUFFINFO.InitBattlefieldRes),this._totlaPower=e+p.default.RBagData.getMegreItems(l.CURRENCY.WHEAT,l.ITEM_TYPE.CURRENCY).num,this.curPowerLabel.string=e+p.default.RBagData.getMegreItems(l.CURRENCY.WHEAT,l.ITEM_TYPE.CURRENCY).num+"";for(var o=p.default.rHeroData.heroIdsInBattle,i=function(e){var i=o[e];i>0&&n.assetImpl.prefab(h.Res.prefab.item.FightDataItem,function(e){var o=cc.instantiate(e);t.curRoleList.addChild(o),o.getComponent(d.default).init(i),t._curHero.push(o)})},n=this,r=0;r<o.length;r++)i(r)},e.prototype.update=function(){var t=this;if(!this._idFenpeiEnd)if(this._delay>0)this._delay--;else if(this._isRewardAd){for(var e=!0,o=0;o<this._curHero.length;o++)(i=(a=this._curHero[o]).getComponent(d.default).isCanGetPower())>0?(a.scale=1,a.getComponent(d.default).addPower(i),e=!1):a.scale=1;e&&(this._idFenpeiEnd=!0,setTimeout(function(){t.noTryClick()},500))}else if(this._totlaPower>0)for(o=0;o<this._curHero.length;o++){var i;if((i=(a=this._curHero[o]).getComponent(d.default).isCanGetPower())>0){a.scale=1.2;var n=Math.min(this._totlaPower,i);a.getComponent(d.default).addPower(n),this._totlaPower-=n,this.curPowerLabel.string=this._totlaPower+"";break}a.scale=1}else{this._idFenpeiEnd=!0;var r=!1;for(o=0;o<this._curHero.length;o++){var a;(a=this._curHero[o]).scale=1,a.getComponent(d.default).checkState()||(r=!0)}r&&(this.tishiLabel.node.active=!0),this.btnLayer.active=!0}},e.prototype.noTryClick=function(){var t={sceneId:l.PART_BTL_SCENE.GUANQIA,args:{level:p.default.lUserData.level+1,isFullPower:this._isRewardAd}};c.tyqSDK.eventLevelStart(p.default.lUserData.level+1),p.default.jumpToMgr.jumpGoTo(u.VIEW_ID.fightLayerPut,t),this.onClose()},e.prototype.tryClick=function(){var t=this;p.default.sdkMgr.watchAd(function(){t._idFenpeiEnd=!1,t._isRewardAd=!0,t.btnLayer.active=!1},function(){},"\u5175\u529b\u4e0d\u8db3\u8865\u5145")},e.prototype.closeInfo=function(){this.node2.active=!1,this.node1.active=!0,this.backBtn.active=!0},e.prototype.openInfo=function(){this.node1.active=!1,this.node2.active=!0,this.backBtn.active=!1},e.prototype.onClose=function(){t.prototype.onClose.call(this)},r([_({type:cc.Node,tooltip:"\u5f53\u524d\u5175\u529b"})],e.prototype,"curPower",void 0),r([_({type:cc.Node,tooltip:"\u89d2\u8272\u5217\u8868"})],e.prototype,"curRoleList",void 0),r([_({type:cc.Label,tooltip:"\u5f53\u524d\u5175\u529b"})],e.prototype,"curPowerLabel",void 0),r([_({type:cc.Label,tooltip:"\u63d0\u793a"})],e.prototype,"tishiLabel",void 0),r([_({type:cc.Node,tooltip:"\u63d0\u793a"})],e.prototype,"node1",void 0),r([_({type:cc.Node,tooltip:"\u63d0\u793a"})],e.prototype,"node2",void 0),r([_({type:cc.Node,tooltip:"btnLayer"})],e.prototype,"btnLayer",void 0),r([_({type:cc.Node})],e.prototype,"backBtn",void 0),r([_({type:cc.Node})],e.prototype,"bingliInfo",void 0),r([g,m("View/Home/FightDataPreView")],e)}(s.default);o.default=y,cc._RF.pop()},{"../../../Core/GView/GViewBase":"GViewBase","../../../conventions/JXCommon":"JXCommon","../../../tyqSDK/tyqSDK":"tyqSDK","../../Common/Define":"Define","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr","../Hero/FightDataItem":"FightDataItem"}],FiniteStateMachine:[function(t,e,o){"use strict";cc._RF.push(e,"35a55Q0kU9GcIwwihlwYjtB","FiniteStateMachine"),Object.defineProperty(o,"__esModule",{value:!0}),o.FiniteStateMachine=o.FSMState=void 0;var i=t("../CoreDefine"),n=t("../FrameEx/ES5Ex"),r=function(){function t(){}return t.prototype.registerState=function(t){this.entity=t},Object.defineProperty(t.prototype,"stateID",{get:function(){throw new Error("State ID not spicified in child class")},enumerable:!1,configurable:!0}),t.prototype.enter=function(){this._curTime=0},t.prototype.execute=function(t){this._curTime+=t},t.prototype.exit=function(){this._curTime=0},t}();o.FSMState=r;var a=function(){function t(t){this._curState=null,this._previousState=null,this._globalState=null,this._owner=t,this._stateDic=new n.MapWrap}return t.prototype.FSMUpdate=function(t){null!=this._globalState&&this._globalState.execute(t),null!=this._curState&&this._curState.execute(t)},t.prototype.globalStateEnter=function(){this._globalState.enter()},t.prototype.setGlobalState=function(t){this._globalState=t,this._globalState.enter()},t.prototype.setCurState=function(t){this._curState=t,this._curState.enter()},t.prototype.getCurState=function(){return this._curState?this._curState.stateID:i.INVALID_VALUE},Object.defineProperty(t.prototype,"global",{get:function(){return this._globalState},enumerable:!1,configurable:!0}),t.prototype.getPerState=function(){return this._previousState?this._previousState.stateID:this.getCurState()},t.prototype.changeState=function(t,e){return void 0===e&&(e=!1),"object"==typeof t?!(!e&&this._curState==t||(this._previousState=this._curState,this._curState&&this._curState.exit(),this._curState=t,!this._curState)||(this._curState.enter(),0)):(t=this.getState(t),this.changeState(t,e))},t.prototype.revertToPreviousState=function(){this._previousState&&this.changeState(this._previousState)},t.prototype.getState=function(t){return this._stateDic.get(t)},t.prototype.registerState=function(t){return t?(t.registerState(this._owner),this._stateDic.set(t.stateID,t),t):t},t.prototype.unRegisterState=function(t){this._stateDic.delete(t.stateID)},t}();o.FiniteStateMachine=a,cc._RF.pop()},{"../CoreDefine":"CoreDefine","../FrameEx/ES5Ex":"ES5Ex"}],GChild:[function(t,e,o){"use strict";cc._RF.push(e,"3781fN+KnxMdKC1uHYVdlix","GChild");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../FrameEx/GComponent"),s=t("../GCtrl"),c=t("../GLoader/GLoader"),l=t("./GCustomData"),u=cc._decorator,h=u.ccclass,p=(u.property,u.menu),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._customData=null,e}return n(e,t),Object.defineProperty(e.prototype,"assetImpl",{get:function(){return this._assetImpl||(this._assetImpl=c.GAssetImpl.getAssetImpl(cc.js.getClassName(this)+this.uuid)),this._assetImpl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"customData",{get:function(){return this._customData},enumerable:!1,configurable:!0}),e.prototype.setCustomData=function(t){this._customData||(this._customData=this.node.addComponent(l.default)),this._customData.setData(t)},e.prototype.__onLoad=function(){this.onGLoad()},e.prototype.onGLoad=function(){},e.prototype.onGStart=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.__onDestroy=function(){s.GCtrl.ES.off(this),s.GCtrl.ES.off(this.node),s.GCtrl.ES.emit("ONGChildDestroy",s.GCtrl.param(this)),this.onGDestroy()},e.prototype.onGDestroy=function(){},r([h,p("View/GBase/GChild")],e)}(a.default);o.default=d,cc._RF.pop()},{"../FrameEx/GComponent":"GComponent","../GCtrl":"GCtrl","../GLoader/GLoader":"GLoader","./GCustomData":"GCustomData"}],GComponent:[function(t,e,o){"use strict";cc._RF.push(e,"a4881qeaLlOmbxyBPq7uykO","GComponent");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a},a=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0});var s=t("../GLoader/GLoader"),c=cc._decorator,l=c.ccclass,u=(c.property,c.menu),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"assetImpl",{get:function(){return this._assetImpl||(this._assetImpl=s.GAssetImpl.getAssetImpl(cc.js.getClassName(this))),this._assetImpl},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this.__onLoad()},e.prototype.__onLoad=function(){},e.prototype.__onGStart=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.onGStart.apply(this,t),this.emitEvent()},e.prototype.emitEvent=function(){},e.prototype.onGStart=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onDestroy=function(){this._assetImpl&&(this._assetImpl.release(),this._assetImpl=null),this.__onDestroy()},e.prototype.__onDestroy=function(){},e.prototype.addGChild=function(t,e){for(var o,i=this,n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return this.assetImpl.addGChild(t,function(t){i.isValid&&(e instanceof cc.Node?t.node.parent=e:e&&e(t),t.__onGStart.apply(t,n),o=t)}),o},e.prototype.nodeAddClip=function(t,e,o,i){this.loadJXAniClip(e,o.aniName,o.prefix,o.numberFix,function(e){if(cc.isValid(t)){var o=t.getComponent(cc.Animation);o||(o=t.addComponent(cc.Animation));var n=t.getComponent(cc.Sprite);n||(n=t.addComponent(cc.Sprite)),n.sizeMode=cc.Sprite.SizeMode.RAW,n.trim=!1,o.addClip(e),i(o)}})},e.prototype.loadJXAniClip=function(t,e,o,i,n){var r=this;this.assetImpl.loadJXAniClip(t,e,o,i,function(t){cc.isValid(r)&&n(t)})},e.prototype.loadJXAniClips=function(t,e){for(var o,i=this,n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];(o=this.assetImpl).loadJXAniClips.apply(o,a([t,function(t){cc.isValid(i)&&e(t)}],n))},r([l,u("View/GBase/GComponent")],e)}(cc.Component);o.default=h,cc._RF.pop()},{"../GLoader/GLoader":"GLoader"}],GCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"af3d4/tO/FHULYLN4RLF+LF","GCtrl");var i=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0}),o.GCtrl=void 0;var n=t("./GEvent/GEventSystem"),r=t("./GEvent/GParam"),a=t("./GLoader/GLoader"),s=t("./Manager/GTimerMgr"),c=function(){function t(){}return Object.defineProperty(t,"now",{get:function(){return this.serverSubTime+Date.now()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"deltaSecondTime",{get:function(){return s.default.secondDelta},enumerable:!1,configurable:!0}),Object.defineProperty(t,"deltaMilliTime",{get:function(){return s.default.mDelta},enumerable:!1,configurable:!0}),t.param=function(t){return new r.default(t)},Object.defineProperty(t,"canvase",{get:function(){return cc.director.getScene().getChildByName("Canvas").getComponent(cc.Canvas)},enumerable:!1,configurable:!0}),Object.defineProperty(t,"winSize",{get:function(){return cc.view.getVisibleSize()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"designSize",{get:function(){return cc.view.getDesignResolutionSize()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"actualSize",{get:function(){var t=cc.winSize;return cc.size(Math.min(t.width,1442),Math.min(t.height,640))},enumerable:!1,configurable:!0}),Object.defineProperty(t,"hRatio",{get:function(){return this.winSize.height/this.designSize.height},enumerable:!1,configurable:!0}),t.getGChild=function(t,e){var o=cc.js.getClassName(e);return t.getComponent(o)},t.findCom=function(t,e,o){var i=cc.find(t,e);return i?i.getComponent(o):null},t.preLoadRawAssets=function(t,e){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];0!=o.length?a.GLoader.preLoads.apply(a.GLoader,i([function(i,n,r,a,s){var c="\u52a0\u8f7d\u8d44\u6e90\u4e2d, \u5f53\u524d\u8fdb\u5ea6\uff1a"+i+"/"+n+", \u52a0\u8f7d\u8d44\u6e90\u540d\u79f0\uff1a"+r+", \u72b6\u6001:";a?cc.log(c+a.message):cc.log(c+"\u52a0\u8f7d\u6210\u529f"),t&&t(i,n,s),i==o.length&&e&&e()}],o)):e&&e()},t.afterFrames=function(t){cc.director.once(cc.Director.EVENT_AFTER_UPDATE,function(){cc.director.once(cc.Director.EVENT_BEFORE_DRAW,function(){t&&t()})})},t.playDragonAni=function(t,e,o,i){var n=this,r=o?0:1;e!=t.animationName&&t.playAnimation(e,r),r&&i&&t.once(dragonBones.EventObject.COMPLETE,function(){i.call(n)})},t.playFrameAni=function(t,e,o,i,n,r,a){void 0===i&&(i=!1),void 0===a&&(a=!1),t.loadJXAniClip(e.path,e.aniName,e.prefix,e.numberFix,function(t){if(cc.isValid(o)){var s=o.getComponent(cc.Animation);s||(s=o.addComponent(cc.Animation));var c=o.getComponent(cc.Sprite);c||(c=o.addComponent(cc.Sprite)),a&&c.setBlend(cc.macro.BlendFactor.SRC_ALPHA,cc.macro.BlendFactor.ONE),c.sizeMode=cc.Sprite.SizeMode.RAW,c.trim=!1,s.addClip(t),r&&(t.speed=r),o.active=!0,i?s.play(e.aniName).wrapMode=cc.WrapMode.Loop:(s.play(e.aniName).wrapMode=cc.WrapMode.Normal,s.once(cc.Animation.EventType.FINISHED,function(){o.active=!1,n&&n()}))}})},t.setDragonBoanesAni=function(e,o,i,n,r,a){var s=o.addComponent(dragonBones.ArmatureDisplay);s&&e.dragonBones(i,function(e,o){s.dragonAsset=e,s.dragonAtlasAsset=o,s.armatureName="Armature",t.playDragonAni(s,n,r,a)})},t.GTimerSecondEventMsg="GTimer.Event.GTimerSecondEventMsg",t.GTimerMilliEventMsg="GTimer.Event.GTimerMilliEventMsg",t.GClientWinDestroyEventMsg="UIMgr.Event.GClientWinDestroyEventMsg",t.GClientWinOpenEventMsg="UIMgr.Event.GClientWinOpenEventMsg",t.GClientWinOpenEventAfterMsg="UIMgr.Event.GClientWinOpenEventAfterMsg",t.serverSubTime=0,t.ES=n.default,t.CameraGroup={default:"default",gb:"gb",ui:"ui",xjmap:"xjmap",mnmap:"mnmap",map:"map"},t.ColliderGroup={default:"default",platform:"platform",player:"player",item:"item"},t._isWaitting=!1,t}();o.GCtrl=c,cc._RF.pop()},{"./GEvent/GEventSystem":"GEventSystem","./GEvent/GParam":"GParam","./GLoader/GLoader":"GLoader","./Manager/GTimerMgr":"GTimerMgr"}],GCustomData:[function(t,e,o){"use strict";cc._RF.push(e,"f8ab0DbAi1HM6Q3F4ABXoIG","GCustomData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._customData=null,e}return n(e,t),e.prototype.onLoad=function(){},e.prototype.setData=function(t){this._customData=t},e.prototype.getData=function(){return this._customData},e}(cc.Component);o.default=r,cc._RF.pop()},{}],GDrag:[function(t,e,o){"use strict";cc._RF.push(e,"4c843i9kGZEsLSEsz7iePjF","GDrag");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.DragEventType=void 0;var a=t("../CoreDefine"),s=t("../Manager/UIMgr"),c=t("./GComponent");o.DragEventType={DR_DragNodeSelect:"DR_DragNodeSelect",DR_EnterTarget:"DR_EnterTarget",DR_LeaveTarget:"DR_LeaveTarget",DR_DragEnd:"DR_DragEnd",CL_TargetNodeClick:"CL_TargetNodeClick",CL_DragNodeClick:"CL_DragNodeClick"};var l=cc._decorator,u=l.ccclass,h=l.property,p=l.menu,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.targetNodes=[],e.dragNodes=[],e.coustomSnapSize=null,e.dragEvents=[],e.targetNodeClickEvents=[],e.dragNodeClickEvents=[],e.dragNodeHitTest=null,e._touchMove=!1,e._touchBegin=!1,e._lastTargetNode=null,e._dragShowNode=null,e._curSelectDragNode=null,e}return n(e,t),Object.defineProperty(e.prototype,"lastTargetNode",{get:function(){return this._lastTargetNode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"curDragNode",{get:function(){return this._curSelectDragNode},enumerable:!1,configurable:!0}),e.prototype.__onLoad=function(){this.initEvent()},e.prototype.initEvent=function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this)},e.prototype._onTouchStart=function(t){this._touchMove=!1,cc.isValid(this._dragShowNode)&&(this._dragShowNode.destroy(),this._dragShowNode=null),this._touchBegin=!0,t.stopPropagation()},e.prototype.onEnable=function(){this.initEvent()},e.prototype.onDisable=function(){this.node.targetOff(this)},e.prototype._onTouchMove=function(t){if(this._touchBegin)if(this._touchMove){var e=t.getLocation();this.moveDragNodeToWorldPos(t.getLocation());var i=!1;for(a=0;a<this.targetNodes.length;a++){var n=this.targetNodes[a];if(n.active&&n.getBoundingBoxToWorld().contains(e)){this._lastTargetNode?this._lastTargetNode!=n&&(this.dispatchEvent(o.DragEventType.DR_LeaveTarget,this._lastTargetNode,this._curSelectDragNode),this._lastTargetNode=n,this.dispatchEvent(o.DragEventType.DR_EnterTarget,this._lastTargetNode,this._curSelectDragNode)):(this._lastTargetNode=n,this.dispatchEvent(o.DragEventType.DR_EnterTarget,this._lastTargetNode,this._curSelectDragNode)),i=!0;break}}i||(this._lastTargetNode&&this.dispatchEvent(o.DragEventType.DR_LeaveTarget,this._lastTargetNode,this._curSelectDragNode),this._lastTargetNode=null)}else{var r=t.getStartLocation();if(t.getLocation().sub(r).mag()<1)return;for(var a=0;a<this.dragNodes.length;a++){var s=this.dragNodes[a];if(s&&s.active&&s.getBoundingBoxToWorld().contains(r)&&this.checkMask(r,s)&&(!this.dragNodeHitTest||!cc.isValid(this.dragNodeHitTest.target)||this.dragNodeHitTest.emitWithBoolResult([this,s]))){this._dragShowNode=s.snapshotNode(null,this.coustomSnapSize.width>0?this.coustomSnapSize:null),this._dragShowNode.parent=this.node,this._curSelectDragNode=s,this.moveDragNodeToWorldPos(t.getLocation()),this._touchMove=!0,this.dispatchEvent(o.DragEventType.DR_DragNodeSelect,this._lastTargetNode,s);break}}if(!this._touchMove)return void this.resetTouchEvent()}},e.prototype._onTouchEnd=function(t){if(this._touchMove)this.dispatchEvent(o.DragEventType.DR_DragEnd,this._lastTargetNode,this._curSelectDragNode);else if(this._touchBegin){var e=t.getLocation(),i=t.getStartLocation().sub(e);if(Math.abs(i.x)>5||Math.abs(i.y)>5)return void this.resetTouchEvent();for(var n=!1,r=0;r<this.dragNodes.length;r++)if((a=this.dragNodes[r])&&a.active&&a.getBoundingBoxToWorld().contains(e)&&this.checkMask(e,a)){cc.Component.EventHandler.emitEvents(this.dragNodeClickEvents,a),this.dispatchEvent(o.DragEventType.CL_DragNodeClick,a),a.emit("click",this),n=!0;break}if(!n)for(r=0;r<this.targetNodes.length;r++){var a;if((a=this.targetNodes[r]).active&&a.getBoundingBoxToWorld().contains(e)){cc.Component.EventHandler.emitEvents(this.targetNodeClickEvents,a),this.dispatchEvent(o.DragEventType.CL_TargetNodeClick,a),a.emit("click",this),n=!0;break}}n||s.UIMgr.invalidAudio}this.resetTouchEvent()},e.prototype.checkMask=function(t,e){for(var o=e.parent;o&&o.parent;)if(o.getComponent(cc.Mask)){if(!o.getBoundingBoxToWorld().contains(t))return!1;o=o.parent}else o=o.parent;return!0},e.prototype._onTouchCancel=function(t){this._onTouchEnd(t)},e.prototype.resetTouchEvent=function(){this._touchBegin=!1,this._touchMove=!1,this._touchBeginPos=null,this._dragShowNode&&(this._dragShowNode.destroy(),this._dragShowNode=null),this._curSelectDragNode&&(this._curSelectDragNode=null),this._lastTargetNode=null},e.prototype.moveDragNodeToWorldPos=function(t){if(this._dragShowNode){var e=this.node.convertToNodeSpaceAR(t);this._dragShowNode.position=e}},e.prototype.dispatchEvent=function(t,e,o){cc.Component.EventHandler.emitEvents(this.dragEvents,t,this,e,o)},e.prototype.addTarget=function(t){this.targetNodes.push(t)},e.prototype.removeTarget=function(t){var e=this.targetNodes.indexOf(t);e!=a.INVALID_VALUE&&(cc.js.array.fastRemoveAt(this.targetNodes,e),this._lastTargetNode==t&&this.resetTouchEvent())},e.prototype.addDragNode=function(t,e){if(void 0===e&&(e=null),null==e){if(this.dragNodes.indexOf(t)!=a.INVALID_VALUE)return;this.dragNodes.push(t)}else{if(null!=this.dragNodes[e])return;this.dragNodes[e]=t}},e.prototype.removeDragNode=function(t,e){void 0===e&&(e=!1);var o=this.dragNodes.indexOf(t);o!=a.INVALID_VALUE&&(e?this.dragNodes[o]=null:this.dragNodes.splice(o,1),this._curSelectDragNode==t&&this.resetTouchEvent())},r([h([cc.Node])],e.prototype,"targetNodes",void 0),r([h([cc.Node])],e.prototype,"dragNodes",void 0),r([h(cc.Size)],e.prototype,"coustomSnapSize",void 0),r([h([cc.Component.EventHandler])],e.prototype,"dragEvents",void 0),r([h([cc.Component.EventHandler])],e.prototype,"targetNodeClickEvents",void 0),r([h([cc.Component.EventHandler])],e.prototype,"dragNodeClickEvents",void 0),r([h(cc.Component.EventHandler)],e.prototype,"dragNodeHitTest",void 0),r([u,p("FrameEx/GDrag")],e)}(c.default);o.default=d,cc._RF.pop()},{"../CoreDefine":"CoreDefine","../Manager/UIMgr":"UIMgr","./GComponent":"GComponent"}],GEventSystem:[function(t,e,o){"use strict";cc._RF.push(e,"8f825nx5/ZMCanCTPg19K3J","GEventSystem");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var r=t("../FrameEx/ES5Ex"),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.eventMap=new r.MapWrap,e._objectMap=new r.MapWrap,e.objectMap=new r.MapWrap,e}return n(e,t),e.ins=function(){return this._instance||(this._instance=new e),this._instance},e.createNew=function(){return new e},e.on=function(t,o,i,n){e.ins().register(t,o,i,n)},e.emit=function(t,o){e.ins().post(t,o)},e.off=function(t,o){e.ins().unRegister(t,o)},e.prototype.checkEvent=function(t,e){if(!this.eventMap.get(t))return!1;for(var o=this.eventMap.get(t),i=0;i<o.length;i++)if(o[i].target==e)return!0;return!1},e.prototype.wrapKey=function(t){return t instanceof r.ObjectWrap?t.wrapId:t.uuid},e.prototype.removeByEventMap=function(t,e){var o=this.eventMap.get(t);if(!o)return!0;for(var i=null,n=0;n<o.length;n++)if(o[n].target==e){i=o[n];break}if(!i)return cc.warn("Trying to remove non - existent events by events map"),!1;if(o.splice(n,1),!(o=this.objectMap.get(this.wrapKey(e))))return cc.warn("Trying to remove non - existent events by objects map"),!1;for(var r=0;r<o.length;r++)if(o[r].msgID==t){o.splice(r,1);break}return!0},e.prototype.removeByObjectMap=function(t){var e=this.wrapKey(t),o=this.objectMap.get(e);if(o){for(var i=o.length-1;o.length>0;i--){var n=o[i];if(this.eventMap.get(n.msgID)){for(var r=this.eventMap.get(n.msgID),a=0;a<r.length;a++)if(r[a].target==t){r.splice(a,1);break}o.splice(i,1)}}return this._objectMap.delete(e),this.objectMap.delete(e),!0}},e.prototype.register=function(t,e,o,i){if(this.checkEvent(t,e))return cc.warn("the object and msgID has beed registered!"+this.wrapKey(e)),!1;var n={target:e,handler:o,msgID:t,priority:i||99999},r=null;null==(r=this.eventMap.get(t))&&(r=new Array,this.eventMap.set(t,r)),r.push(n),r.sort(function(t,e){return t.priority-e.priority});var a=this.wrapKey(e);return(r=this.objectMap.get(a))||(r=new Array,this.objectMap.set(a,r),this._objectMap.set(a,e)),r.push(n),!0},e.prototype.unRegister=function(t,e){return e?this.removeByEventMap(e,t):this.removeByObjectMap(t)},e.prototype.post=function(t,e){var o=this.eventMap.get(t);o&&o.forEach(function(t){t.handler(t.target,e)})},e._instance=null,e}(r.ObjectWrap);o.default=a,cc._RF.pop()},{"../FrameEx/ES5Ex":"ES5Ex"}],GHttpClient:[function(t,e,o){"use strict";cc._RF.push(e,"ff4feD8bIRMHrb9OKVN/+um","GHttpClient");var i=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator.ccclass,r=function(){function t(){}var e;return e=t,t.get=function(t,o,i,n){var r=new XMLHttpRequest;r.timeout=5e3;var a="?";for(var s in o)"?"!=a&&(a+="&"),a+=s+"="+o[s];null==n&&(n=e.url);var c=n+t+a;return cc.log("RequestURL:"+c),r.open("GET",c,!0),r.onreadystatechange=function(){if(4===r.readyState&&r.status>=200&&r.status<300){cc.log("http res("+r.responseText.length+"):"+r.responseText);try{var t=JSON.parse(r.responseText);null!==i&&i(null,t)}catch(e){null!==i&&i(e)}}},r.send(),r},t.post=function(t,o,i,n){var r=new XMLHttpRequest;r.timeout=5e3,null==n&&(n=e.url);var a=n+t;return cc.log("RequestURL:"+a),r.open("POST",a,!0),r.onreadystatechange=function(){if(4===r.readyState&&r.status>=200&&r.status<300){cc.log("http res("+r.responseText.length+"):"+r.responseText);try{var t=JSON.parse(r.responseText);null!==i&&i(t)}catch(e){cc.log("err:"+e)}}},r.send(JSON.stringify(o)),r},t.url="",e=i([n],t)}();o.default=r,cc._RF.pop()},{}],GListView:[function(t,e,o){"use strict";cc._RF.push(e,"ac068zWOFVOqabHv8hmCHNU","GListView");var i=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0}),o.GListViewDir=o.GListView=void 0;var n,r=t("../CoreDefine"),a=t("../Manager/AudioMgr"),s=t("./GChild"),c=t("./GViewDestory"),l=function(){function t(t){if(this._selectedIndex=-1,this._isTouchPress=!1,this._touchChildNode=null,this._childLongTouchDeltaTime=0,this._childLongTouchTimer=-1,this._childLongTouchTimes=0,this._scrollview=t.scrollview,this._scrollview.node._list=this,this._mask=t.mask,this._content=t.content,this._itemTpl=t.itemTpl,this._itemTpl.active=!1,this._itemWidth=this._itemTpl.width,this._itemHeight=this._itemTpl.height,this._itemAnchorX=this._itemTpl.anchorX,this._itemAnchorY=this._itemTpl.anchorY,this._dir=t.direction||n.Vertical,this._width=t.width||this._mask.width,this._height=t.height||this._mask.height,this._gapX=t.gapX||0,this._gapY=t.gapY||0,this._padingX=t.padingX||0,this._padingY=t.padingY||0,this._row=t.row||1,this._col=t.column||1,this._cbHost=t.cbHost,this._itemSetter=t.itemSetter,this._scrollingCb=t.scrollingCb,this._recycleCb=t.recycleCb,this._selectSetter=t.selectSetter,this._scrollToEndCb=t.scrollToEndCb,this._childClickCb=t.childClick,this._autoScrolling=t.autoScrolling||!1,this._nodePool=[],this._isCbClass=!!t.isCbClass,this._isWidget=t.isWidget||!1,this._childLongTouch=t.childLongTouch,this._childLongTouchFristTime=t.childLongTouchFristTime,this._childLongTouchUpdateTime=t.childLongTouchUpdateTime,this._childLongTouchTimer=-1,this._childLongTouchTimes=0,this._dir==n.Horizontal){var e=(this._itemWidth+this._gapX)*this._col-this._gapX;e>this._width&&(console.info("real width > width, resize scrollview to realwidth,",this._width,"->",e),this._width=e),this._content.width=this._width}else{var o=(this._itemHeight+this._gapY)*this._row-this._gapY;o>this._height&&(console.info("real height > height, resize scrollview to realheight,",this._height,"->",o),this._height=o),this._content.height=this._height}this._mask.setContentSize(this._width,this._height),this._scrollview.node.setContentSize(this._width,this._height),this._scrollview.vertical=this._dir==n.Vertical,this._scrollview.horizontal=this._dir==n.Horizontal,this._scrollview.inertia=!0,this._scrollview.node.on("scrolling",this.onScrolling,this),this._scrollview.node.on("scroll-to-bottom",this.onScrollToEnd,this),this._scrollview.node.on("scroll-to-right",this.onScrollToEnd,this),this._scrollview.node.on(cc.Node.EventType.TOUCH_END,this.onToucEnd,this),this._scrollview.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this._scrollview.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this._scrollview.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchCancel,this),this._isWidget&&this._scrollview.node.on(cc.Node.EventType.SIZE_CHANGED,this.onSizeChange,this);var i=this._scrollview.node.getComponent(c.default);i||(i=this._scrollview.node.addComponent(c.default)),i.otherDestroyCb=this.destroy.bind(this)}return Object.defineProperty(t.prototype,"scrollview",{get:function(){return this._scrollview},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return this._content},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),t.prototype.onSizeChange=function(){this._width=this.scrollview.node.width,this._height=this.scrollview.node.height,this.mask.setContentSize(this.scrollview.node.getContentSize()),this._datas&&this.setData(this._datas)},t.prototype.onScrollToEnd=function(){this._scrollToEndCb&&this._scrollToEndCb.call(this._cbHost)},t.prototype.closeTimer=function(){-1!=this._childLongTouchTimer&&clearInterval(this._childLongTouchTimer),this._childLongTouchTimer=-1,this._childLongTouchDeltaTime=0,this._childLongTouchTimes=0},t.prototype.startTimer=function(){var t=this;this._childLongTouchDeltaTime=0,this._childLongTouchTimes=0;var e=parseInt(this._touchChildNode.name.replace("item_",""));this._childLongTouchTimer=setInterval(function(){if(t._childLongTouchDeltaTime+=.1,0==t._childLongTouchTimes&&t._childLongTouchDeltaTime>t._childLongTouchFristTime&&t._isTouchPress&&t._touchChildNode){if(cc.Button.comAudio&&a.AudioMgr.Ins().playEffect(cc.Button.comAudio),t._childLongTouch.call(t._cbHost,t._isCbClass?t._touchChildNode.getComponent(s.default):t._touchChildNode,t._items[e].data,e,++t._childLongTouchTimes),t._childLongTouchDeltaTime=0,!t._childLongTouchUpdateTime)return t.closeTimer(),void(t._isTouchPress=!1)}else t._childLongTouchUpdateTime&&t._childLongTouchTimes>0&&t._childLongTouchDeltaTime>t._childLongTouchUpdateTime&&t._touchChildNode&&(cc.Button.comAudio&&a.AudioMgr.Ins().playEffect(cc.Button.comAudio),t._childLongTouch.call(t._cbHost,t._isCbClass?t._touchChildNode.getComponent(s.default):t._touchChildNode,t._items[e].data,e,++t._childLongTouchTimes),t._childLongTouchDeltaTime=0,t._isTouchPress=!1)},100)},t.prototype.onTouchStart=function(t){this._isTouchPress=!0,this._touchChildNode=null;for(var e=t.getLocation(),o=this._content.children,i=0;i<o.length;i++){var n=o[i];if(n.active&&n.getBoundingBoxToWorld().contains(e)){this._touchChildNode=n;break}}this._childLongTouch&&this._touchChildNode&&this.startTimer()},t.prototype.onTouchMove=function(t){t.getStartLocation().sub(t.getLocation()).mag()<4||(this._isTouchPress=!1,this.closeTimer(),this._touchChildNode=null)},t.prototype.onToucEnd=function(){this.closeTimer(),this._childLongTouchTimes>0?this._touchChildNode=null:this._isTouchPress&&this._touchChildNode&&this.onItemTouchEnd(this._touchChildNode)},t.prototype.onTouchCancel=function(t){this.onToucEnd(t)},t.prototype.cancelTouchEvent=function(){this.closeTimer(),this._touchChildNode=null,this._isTouchPress=!1,this._childLongTouchTimes=0},t.prototype.onScrolling=function(){if(this._items&&this._items.length){if(this._dir==n.Vertical){var t=this._content.y;t<(1-this.mask.anchorY)*this.mask.height&&(t=(1-this.mask.anchorY)*this.mask.height),t>this.content.height+(1-this.mask.anchorY)*this.mask.height&&(t=this.content.height+(1-this.mask.anchorY)*this.mask.height);var e=this.verticalRange(t),o=e[0],i=e[1];o=Math.max(o,0),i=Math.min(i,this._items.length-1),o==this._startIndex&&i==this._stopIndex||(this._startIndex=o,this._stopIndex=i,this.renderItems())}else{var r=this._content.x;r>-this._width/2&&(r=-this._width/2),r<-this._content.width+this._height/2&&(r=-this._content.width+this._height/2);var a=this.horizontalRange(r,this._width,this._itemWidth,this._row,this._gapX);o=a[0],i=a[1],o=Math.max(o,0),i=Math.min(i,this._items.length-1),o!=this._startIndex&&i!=this._stopIndex&&(this._startIndex=o,this._stopIndex=i,this.renderItems())}this._scrollingCb&&this._scrollingCb.call(this._cbHost)}},t.prototype.onItemTouchEnd=function(t){cc.Button.comAudio&&a.AudioMgr.Ins().playEffect(cc.Button.comAudio);var e=parseInt(t.name.replace("item_",""));this._childClickCb&&this._childClickCb.call(this._cbHost,this._isCbClass?t.getComponent(s.default):t,this._items[e].data,e),e!=this._selectedIndex&&(-1!=this._selectedIndex&&this.innerSelectItem(this._selectedIndex,!1),this.innerSelectItem(e,!0))},t.prototype.innerSelectItem=function(t,e){var o=this._items[t];o?(o.isSelect=e,o.node&&this._selectSetter&&this._selectSetter.call(this._cbHost,this._isCbClass?o.node.getComponent(s.default):o.node,o.data,e,t)):cc.warn("inner_select_item index is out of range{",0,this._items.length-1,"}",t)},t.prototype.spawnNode=function(t){var e=this._nodePool.pop();return e||((e=cc.instantiate(this._itemTpl)).parent=this._content),e.active=!0,e.name="item_"+t,e},t.prototype.recycleItem=function(t){t.node&&cc.isValid(t.node)&&(this._recycleCb&&this._recycleCb.call(this._cbHost,this._isCbClass?t.node.getComponent(s.default):t.node),t.node.name="item_null",t.node.active=!1,this._nodePool.push(t.node),t.node=null)},t.prototype.clearItems=function(){var t=this;this._items=[],cc.isValid(this._content)&&this._content.children.forEach(function(e){e.active&&(e.name="item_null",e.active=!1,t._nodePool.push(e))})},t.prototype.renderItems=function(t){var e,o=this;if(this._content.children.forEach(function(t){if(t.active){var e=parseInt(t.name.replace("item_",""));(e<o._startIndex||e>o._stopIndex)&&o.recycleItem(o._items[e])}}),this._startIndex!==r.INVALID_VALUE)for(var i=this._startIndex;i<=this._stopIndex;i++)(e=this._items[i]).node?t&&this._itemSetter.call(this._cbHost,this._isCbClass?e.node.getComponent(s.default):e.node,e.data,i):(e.node=this.spawnNode(i),this._itemSetter.call(this._cbHost,this._isCbClass?e.node.getComponent(s.default):e.node,e.data,i)),e.node.setPosition(e.x,e.y)},t.prototype.packItem=function(t){return{x:0,y:0,data:t,node:null,isSelect:!1}},t.prototype.layoutItems=function(t){for(var e,o,i=t,r=this._items.length;i<r;i++){var a=this._items[i];this._dir==n.Vertical?(e=this.verticalLayout(i),a.x=e[0],a.y=e[1]):(o=this.horizontalLayout(i),a.x=o[0],a.y=o[1])}},t.prototype.resizeContent=function(){if(this._items.length<=0)return this._content.width=0,void(this._content.height=0);var t=this._items[this._items.length-1];this._dir==n.Vertical?this._content.height=Math.max(0,this._itemHeight*(1-this._itemAnchorY)-t.y):this._content.width=Math.max(0,t.x+this._itemWidth/2)},t.prototype.destroy=function(){this.clearItems(),this._nodePool.forEach(function(t){cc.isValid(t)&&t.destroy()}),this._nodePool=null,this._items=null,this._datas=null,cc.isValid(this._scrollview.node)&&(this._scrollview.node.off("scrolling",this.onScrolling,this),this._scrollview.node.off("scroll-to-bottom",this.onScrollToEnd,this),this._scrollview.node.off("scroll-to-right",this.onScrollToEnd,this),this._scrollview.node._list=null)},t.prototype.verticalLayout=function(t){return[this._padingX+t%this._col*(this._itemWidth+this._gapX)+this._itemWidth*this._itemAnchorX,-Math.floor(t/this._col)*(this._itemHeight+this._gapY)-this._itemHeight*(1-this._itemAnchorY)-this._padingY]},t.prototype.verticalRange=function(t){var e=t-(1-this.mask.anchorY)*this.mask.height+(1-this._itemAnchorY)*this._itemHeight+this._padingY,o=Math.floor(e/(this._itemHeight+this._gapY)),i=Math.ceil((e+this.mask.height+this._gapY)/(this._itemHeight+this._gapY));return[(o-1)*this._col,i*this._col]},t.prototype.horizontalLayout=function(t){return[Math.floor(t/this._row)*(this._itemWidth+this._gapX)+this._itemWidth*this._itemAnchorX,-t%this._row*(this._itemHeight+this._gapY)-this._itemHeight/2]},t.prototype.horizontalRange=function(t,e,o,i,n){void 0===i&&(i=1),void 0===n&&(n=0);var r=-(t+e/2),a=Math.ceil(r/(o+n)),s=(Math.ceil((r+e)/(o+n))+1)*i-1;return[(a-1)*i,s=s===this._stopIndex?this._stopIndex+1:s]},Object.defineProperty(t.prototype,"datas",{get:function(){return this._datas||[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectedIndex",{get:function(){return this._selectedIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectdData",{get:function(){var t=this._items[this._selectedIndex];return t?t.data:null},enumerable:!1,configurable:!0}),t.prototype.setData=function(t){var e=this;this.clearItems(),this._datas=t,t.forEach(function(t){e._items.push(e.packItem(t))}),this.layoutItems(0),this.resizeContent(),this._startIndex=-1,this._stopIndex=-1,this._dir==n.Vertical?this._content.y=this._height*(1-this._mask.anchorY):this._content.x=this._width*(this._mask.anchorX-1),this._items.length>0&&this.onScrolling(),this._scrollview._calculateBoundary()},t.prototype.tryGetItemByIndex=function(t){if(t<this._startIndex||t>this._stopIndex)return null;var e=this._items[t];return e?this._isCbClass?e.node.getComponent(s.default):e.node:null},t.prototype.refreshData=function(t){var e=this;t?(this.clearItems(),this._datas=t,t.forEach(function(t){e._items.push(e.packItem(t))}),this.layoutItems(0),this.resizeContent(),this.renderItems(!0)):this._datas&&this.renderItems(!0)},t.prototype.insertData=function(t){for(var e,o,n=this,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];if(0!=r.length)if(this._items||(this._items=[]),this._datas||(this._datas=[]),t<0||t>this._items.length)cc.warn("invalid index",t);else{var s=t==this._items.length,c=[];r.forEach(function(t){c.push(n.packItem(t))}),(e=this._datas).splice.apply(e,i([t,0],r)),(o=this._items).splice.apply(o,i([t,0],c)),this.layoutItems(t),this.resizeContent(),this._startIndex=-1,this._stopIndex=-1,this._autoScrolling&&s&&this.scrollToEnd(),this.onScrolling()}else console.info("nothing to insert")},t.prototype.removeData=function(t,e){var o=this;if(void 0===e&&(e=1),this._items)if(t<0||t>=this._items.length)cc.warn("invalid index",t);else if(e<1)console.info("nothing to remove");else{var i=this._items.length,n=this._items.splice(t,e);this._datas.splice(t,e),n.forEach(function(t){o.recycleItem(t)});for(var r=t+1;r<i;r++){var a=this._content.getChildByName("item_"+r);a&&(a.name="item_"+(r-e))}t+e<i&&this.layoutItems(t),this.resizeContent(),this._items.length>0&&(this._startIndex=-1,this._stopIndex=-1,this.onScrolling())}else console.info("call set_data before call this method")},t.prototype.appendData=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._items||(this._items=[]),this.insertData.apply(this,i([this._items.length],t))},t.prototype.scrollTo=function(t,e){if(void 0===e&&(e=0),this._scrollview.stopAutoScroll(),this._dir==n.Vertical){if((r=this._scrollview.getMaxScrollOffset()).y<=0)return void cc.log("no need to scroll");var o=this.verticalLayout(t),i=(o[0],o[1]);(i=-(i+this._itemHeight*(1-this._itemAnchorY)+this._padingY))>r.y&&(i=r.y,cc.log("content reach bottom")),i<0&&(i=0,cc.log("content reach top")),this._scrollview.scrollToOffset(cc.v2(0,i),e),e||this.onScrolling()}else{var r;if((r=this._scrollview.getMaxScrollOffset()).x<=0)return void cc.log("no need to scroll");var a=this.horizontalLayout(t),s=a[0];a[1],(s+=this._padingX)>r.x&&(s=r.x,cc.log("content reach right")),s<0&&(s=0,cc.log("content reach left")),this._scrollview.scrollToOffset(cc.v2(s,this._content.y),e),e||this.onScrolling()}},t.prototype.scrollToEnd=function(){this._dir==n.Vertical?this._scrollview.scrollToBottom():this._scrollview.scrollToRight()},t.prototype.refreshItem=function(t,e){if(this._items)if(t<0||t>=this._items.length)cc.warn("invalid index",t);else{var o=this._items[t];o.data=e,this._datas[t]=e,o.node&&(this._recycleCb&&this._recycleCb.call(this._cbHost,o.node.getComponent(s.default)),this._itemSetter.call(this._cbHost,o.node.getComponent(s.default),o.data,t))}else cc.log("call set_data before call this method")},t.prototype.reLayOut=function(t){if(this._width=null!=t.width?t.width:this._width,this._height=null!=t.height?t.height:this._height,this._gapX=null!=t.gapX?t.gapX:this._gapX,this._gapY=null!=t.gapY?t.gapY:this._gapY,this._padingX=null!=t.padingX?t.padingX:this._padingX,this._padingY=null!=t.padingY?t.padingY:this._padingY,this._row=null!=t.row?t.row:this._row,this._col=null!=t.column?t.column:this._col,this._dir==n.Horizontal){var e=(this._itemWidth+this._gapX)*this._col-this._gapX;e>this._width&&(console.info("real width > width, resize scrollview to realwidth,",this._width,"->",e),this._width=e),this._content.width=this._width}else{var o=(this._itemHeight+this._gapY)*this._row-this._gapY;o>this._height&&(console.info("real height > height, resize scrollview to realheight,",this._height,"->",o),this._height=o),this._content.height=this._height}this._mask.setContentSize(this._width,this._height),this._scrollview.node.setContentSize(this._width,this._height)},t.prototype.resetParams=function(t){this.clearItems(),this._nodePool.forEach(function(t){return t.destroy()}),this._nodePool.length=0,this._itemTpl&&this._itemTpl.destroy(),this._datas=[],this._itemTpl=t.itemTpl,this._itemTpl.active=!1,this._itemWidth=this._itemTpl.width,this._itemHeight=this._itemTpl.height,this._itemAnchorX=this._itemTpl.anchorX,this._itemAnchorY=this._itemTpl.anchorY,this.reLayOut(t),this._cbHost=t.cbHost||this._cbHost,this._itemSetter=t.itemSetter||this._itemSetter,this._recycleCb=t.recycleCb||this._recycleCb,this._selectSetter=t.selectSetter||this._selectSetter,this._scrollToEndCb=t.scrollToEndCb||this._scrollToEndCb,this._childClickCb=t.childClick||this._childClickCb,this._autoScrolling=t.autoScrolling||this._autoScrolling,this._isCbClass=t.isCbClass||!!this._isCbClass,this._isWidget=t.isWidget||this._isWidget,this._childLongTouch=t.childLongTouch||this._childLongTouch,this._childLongTouchFristTime=t.childLongTouchFristTime||this._childLongTouchFristTime,this._childLongTouchUpdateTime=t.childLongTouchUpdateTime||this._childLongTouchUpdateTime,this._childLongTouchTimer=-1,this._childLongTouchTimes=0},t}();o.GListView=l,function(t){t[t.Vertical=1]="Vertical",t[t.Horizontal=2]="Horizontal"}(n=o.GListViewDir||(o.GListViewDir={})),cc._RF.pop()},{"../CoreDefine":"CoreDefine","../Manager/AudioMgr":"AudioMgr","./GChild":"GChild","./GViewDestory":"GViewDestory"}],GLoader:[function(t,e,o){"use strict";cc._RF.push(e,"c581ehxi51MJ6dtEfaINQ2n","GLoader");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0}),o.GLoader=o.GAssetsAsyncHanlder=o.GAssetImpl=void 0;var a=t("../../conventions/JXCommon"),s=t("../CoreDefine"),c=t("../FrameEx/ES5Ex"),l=t("../Math/MathEx"),u=cc.assetManager,h=cc.js.isChildClassOf;function p(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}h||(h=cc.isChildClassOf);var d=function(){function t(){var t=this;this._resMap=new c.MapWrap,this._assetTypes={},this.__nLoadRef=0,this._allAssetImps=new c.MapWrap,this._waitReleaseUseKeys=[],this._waitReleaseAssets=new c.MapWrap,this._lastGCCheckTime=0,this._tempResMaps={},cc.director.on(cc.Director.EVENT_AFTER_UPDATE,function(){t.checkReleaseAssets()})}return t.prototype.getAssetImpl=function(t){var e=this._allAssetImps.get(t);if(e){var o=this._waitReleaseUseKeys.indexOf(t);o!=s.INVALID_VALUE&&cc.js.array.fastRemoveAt(this._waitReleaseUseKeys,o)}else e=new f(t),this._allAssetImps.set(t,e);return e.retain(),e},t.prototype.popAssetImp=function(t,e){this._allAssetImps.get(t)==e?this._waitReleaseUseKeys.indexOf(t)==s.INVALID_VALUE?this._waitReleaseUseKeys.push(t):p("the will release assetImp is always int the waitReleaseUserkeys"):p("the apl don't in the allAssetImps!")},t.prototype.checkReleaseAssets=function(){if(!this.isLoading()){if(this._waitReleaseAssets.size>0){var t=Date.now();if(t-this._lastGCCheckTime>5e3){this._lastGCCheckTime=t;var e=[];this._waitReleaseAssets.forEach(function(o,i){t-o>6e4&&e.push(i)});for(var o=0;o<e.length;o++)cc.resources.release(e[o]),this._waitReleaseAssets.delete(e[o]);e=null}}if(this._waitReleaseUseKeys.length>0){var i=this._waitReleaseUseKeys.pop(),n=this._allAssetImps.get(i);0!=n.refCount&&cc.error("apl.refCount  is not zero!"),this._allAssetImps.delete(i),n.destroy()}}},t.prototype.rightNowGC=function(){this._waitReleaseAssets.forEach(function(t,e){var o=u.utils.getUrlWithUuid(e);cc.resources.getInfoWithPath(o),cc.resources.release(e)}),this._waitReleaseAssets.clear()},t.prototype.testCanReleaseInfo=function(){this._resMap.forEach(function(t,e){0==t.uses.size&&t.refs.size>0&&cc.log(e)})},t.prototype.isLoading=function(){return this.__nLoadRef>0},t.prototype._getResItem=function(t,e){return this.getResInfoByPath(t,e)},t.prototype._makeLoadResArgs=function(){if(arguments.length<1||"string"!=typeof arguments[0])return console.error("_makeLoadResArgs error "+arguments),null;for(var t={url:arguments[0]},e=1;e<arguments.length;++e)1==e&&h(arguments[e],cc.Asset)?t.type=arguments[e]:e==arguments.length-1&&"string"==typeof arguments[e]?t.use=arguments[e]:"function"==typeof arguments[e]&&(arguments.length>e+1&&"function"==typeof arguments[e+1]?t.onProgess=arguments[e]:t.onCompleted=arguments[e]);return t},t.prototype._makeReleaseResArgs=function(){if(arguments.length<1||"string"!=typeof arguments[0])return console.error("_makeReleaseResArgs error "+arguments),null;for(var t={url:arguments[0]},e=1;e<arguments.length;++e)"string"==typeof arguments[e]?t.use=arguments[e]:t.type=arguments[e];return t},t.makeUseKey=function(t,e,o){return void 0===e&&(e="none"),void 0===o&&(o=""),"use_"+t+"_by_"+e+"_for_"+o},t.prototype.getCacheInfo=function(t){return this._resMap.has(t)||this._resMap.set(t,{refs:new c.SetWrap,uses:new c.SetWrap}),this._resMap.get(t)},t.prototype.getUrlByAsset=function(t){var e=t;return e&&e._uuid?u.utils.getUrlWithUuid(e._uuid):(console.error("getUrlByAssets error "+t),null)},t.prototype.addUse=function(t,e){if(this._resMap.has(t)){var o=this._resMap.get(t).uses;return o.has(e)?(console.warn("addUse "+t+" by "+e+" faile, repeating use key"),!1):(o.add(e),!0)}return console.warn("addUse "+t+" faile, key nofound, make sure you load with resloader"),!1},t.prototype._buildDepend=function(t,e){if(t&&t.dependKeys&&Array.isArray(t.dependKeys))for(var o=0,i=t.dependKeys;o<i.length;o++){var n=i[o],r=this.getCacheInfo(n);if(!r.refs.has(e)){r.refs.add(e);var a=u.assets.get(n);if(a){var s=a.uuid||a.id;this._waitReleaseAssets.has(s)&&this._waitReleaseAssets.delete(s),this._buildDepend(a,a.id)}}}},t.prototype._releaseDepend=function(t,e){if(t&&t.dependKeys&&Array.isArray(t.dependKeys))for(var o=0,i=t.dependKeys;o<i.length;o++){var n=i[o],r=this._resMap.get(n);if(r&&r.refs.has(e)){r.refs.delete(e);var a=u.assets.get(n);a&&this._releaseDepend(a,a._uuid)}}},t.prototype._cacheItem=function(t,e){if(t&&t.uuid){var o=this.getCacheInfo(t.uuid);if(e&&o.uses.add(e),!o.refs.has(t.id)){o.refs.add(t.id);var i=t.uuid||t.id;this._waitReleaseAssets.has(i)&&this._waitReleaseAssets.delete(i),this._buildDepend(t,t.id)}return!0}return!1},t.prototype._finishItem=function(t,e,o){var i=this._getResItem(t,e);this._cacheItem(i,o)||cc.warn("addDependKey item error! for "+t)},t.prototype.addDependKey=function(t,e){if(t&&t.dependKeys&&Array.isArray(t.dependKeys))for(var o=0,i=t.dependKeys;o<i.length;o++){var n=i[o];this.getCacheInfo(n).refs.add(e);var r=cc.assetManager.assets.get(n);this.addDependKey(r,e)}},t.prototype.finishCallback=function(t,e,o){e||this._finishItem(t.url,t.type,t.use),t.onCompleted&&t.onCompleted(e,o)},t.prototype.loadRes=function(){var t=this,e=this._makeLoadResArgs.apply(this,arguments),o=this.getRes(e);o||this.getBundle(e.type,function(o){t.__nLoadRef++,o.load(e.url,e.type,e.onProgess,function(o,i){o||(t._assetTypes[e.url]=e.type),t.__nLoadRef--,t.finishCallback(e,o,i)})})},t.prototype.getRes=function(t,e){var o,i;if("string"==typeof t)return(i=this._assetTypes[t]||e)?((o=this.getResByPath(t,i))&&(this._assetTypes[t]||(this._assetTypes[t]=i),this.finishCallback({url:t,type:i},null,o)),o):null;var n=t;return i=this._assetTypes[n.url]||n.type,o=this.getResByPath(n.url,i),i?(o&&(this._assetTypes[t]||(this._assetTypes[t]=i),this.finishCallback(n,null,o)),o):null},t.prototype.getResByPath=function(t,e){var o=null;return cc.assetManager.bundles.forEach(function(i){var n=i.get(t,e);n&&(o=n)}),o},t.prototype.getResInfoByPath=function(t,e){var o=null;return cc.assetManager.bundles.forEach(function(i){var n=i.getInfoWithPath(t,e);n&&(o=n)}),o},t.prototype.getBundle=function(t,e){var o="";if(t==cc.SpriteAtlas||t==cc.SpriteFrame)o=a.JXDef.bundle.texture;else if(t==sp.SkeletonData)o=a.JXDef.bundle.spine;else if(t==cc.JsonAsset||t==cc.TextAsset)o=a.JXDef.bundle.data;else if(t==cc.Prefab)o=a.JXDef.bundle.prefab;else if(t==cc.AudioClip)o=a.JXDef.bundle.audio;else{if(t!=dragonBones.DragonBonesAsset&&t!=dragonBones.DragonBonesAtlasAsset)return void e(cc.resources);o=a.JXDef.bundle.spine}var i=cc.assetManager.getBundle(o);if(i)return e(i);cc.assetManager.loadBundle(o,function(t,i){t?(cc.error("\u6ca1\u6709\u627e\u5230\u5206\u5305:",o),e(cc.resources)):e(i)})},t.prototype.hasRes=function(t){return!!this._assetTypes[t]},t.prototype.releaseRes=function(){var t=this._makeReleaseResArgs.apply(this,arguments);t.type||(t.type=this._assetTypes[t.url]);var e=this._getResItem(t.url,t.type);if(e){var o=this.getCacheInfo(e.id);t.use&&o.uses.delete(t.use),0==o.uses.size&&this._tagRelease(e,e.id)}else console.warn("releaseRes item is null "+t.url+" "+t.type)},t.prototype._tagRelease=function(t,e){var o=this.getCacheInfo(t.id);if(o.refs.has(e))if(o.refs.delete(e),0==o.uses.size&&0==o.refs.size){if(t.dependKeys&&Array.isArray(t.dependKeys))for(var i=0,n=t.dependKeys;i<n.length;i++){var r=n[i],a=cc.assetManager.assets.get(r);a&&this._tagRelease(a,t.id)}t.uuid?this._waitReleaseAssets.set(t.uuid,Date.now()):this._waitReleaseAssets.set(t.id,Date.now()),this._resMap.delete(t.id)}else p("resloader can't release item by url:"+t.id+"="+(t.content&&t.content.name?t.content.name:t._owner&&t._owner.name?t._owner.name:"")+", why: the uses.size = "+o.uses.size+", ref.size = "+o.refs.size);else p("resloader jump release item by uuid :"+t.id+"="+(t.content&&t.content.name?t.content.name:t._owner&&t._owner.name?t._owner.name:""))},t.prototype.canRelease=function(t,e){var o=this.getCacheInfo(t);return!(o.refs.size>1||!o.refs.has(t)||o.uses.size>1||!o.uses.has(e))},t.prototype.checkReleaseUse=function(){var t=this._makeReleaseResArgs.apply(this,arguments);t.type=t.type||this._assetTypes[t.url];var e=this._getResItem(t.url,t.type);if(!e)return console.log("cant release,item is null "+t.url+" "+t.type),!0;var o=this.getCacheInfo(e.id),i=!1,n=!1;return i=!(t.use&&o.uses.size>0&&(1!=o.uses.size||!o.uses.has(t.use))),n=!!(1==o.refs.size&&o.refs.has(e.url)||0==o.refs.size),i&&n},t.prototype.getResKeyByResMap=function(t){var e=[];return this._resMap.forEach(function(o,i){i.indexOf(t)!=s.INVALID_VALUE&&e.push(i)}),e},t.prototype.getResKeyByCCCache=function(t){var e=[];return cc.assetManager.assets.forEach(function(o,i){i.indexOf(t)!=s.INVALID_VALUE&&e.push(i)}),e},t.prototype.compareKeys=function(t,e,o,i){e.forEach(function(e){t.indexOf(e)==s.INVALID_VALUE&&console.log(i+" res path "+cc.AssetManager.Pipeline._debugGetAssetInfo(e)+" key "+e+" don't in "+o+".")})},t.prototype.compareResMapWithCCCache=function(t){var e=this.getResKeyByResMap(t),o=this.getResKeyByCCCache(t);console.log("_resMap.size = "+e.length+", cc_cache.size = "+o.length),this.compareKeys(e,o,"ResMap","CCCache")},t.prototype.getResPaths=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var o=[],i=0;i<t.length;i++)o.push(cc.AssetManager.Pipeline._debugGetAssetInfo(t[i]));return o},t.prototype.setRecordResMap=function(){var t=Date.now();this._tempResMaps[t]=this._resMap.keys()},t.prototype.clearRecordResMap=function(){this._tempResMaps={}},t.prototype.compareRecordResMap=function(){for(var t=Object.keys(this._tempResMaps),e=1;e<t.length;e++)console.log("compare time stamp left: "+t[e-1]+", file count "+this._tempResMaps[t[e-1]].length+", right: "+t[e]+", file count "+this._tempResMaps[t[e]].length+" "),this.compareKeys(this._tempResMaps[t[e-1]],this._tempResMaps[t[e]],"befor","after")},t.prototype.findAllLostInfos=function(){var t=this,e={};return this._resMap.forEach(function(o,i){t.findLostInfo(i,o,e)}),e},t.prototype.findLostInfo=function(t,e,o){var i=this;e.refs.size>0&&e.refs.toArray().forEach(function(e){if(e!=t){var n=i._resMap.get(e);i.findLostInfo(e,n,o)}}),e.uses.size>0&&e.uses.toArray().forEach(function(e){i._allAssetImps.has(e)||(o[e]=o[e]||[],o[e].indexOf(t)==s.INVALID_VALUE&&o[e].push(t))})},t}(),f=function(){function t(t){this.__nRef=0,this._refKey=t,this.__nRef=0,this._tempAssts=new c.SetWrap}return t.isLoading=function(){return this.loader.isLoading()},t.getAssetImpl=function(t){return this.loader.getAssetImpl(t)},t.initLoadRules=function(t,e){this._assetMaskInfo=t,this._unpackPaths=e},t.checkDyPack=function(e,o){if(t._unpackPaths&&!o.__unpack)for(var i=0,n=t._unpackPaths.length;i<n;i++)if(e.indexOf(t._unpackPaths[i])!=s.INVALID_VALUE){o.__unpack=!0;break}},t.checkAtlasDyPack=function(e,o){if(t._unpackPaths&&!o.__unpack)for(var i=0,n=t._unpackPaths.length;i<n;i++)if(e.indexOf(t._unpackPaths[i])!=s.INVALID_VALUE){o.__unpack=!0;for(var r=0,a=o.getSpriteFrames(),c=a.length;r<c;r++)a[r].__unpack=!0;break}},t.routeConvert=function(e){if(e&&e.indexOf("/")==s.INVALID_VALUE){for(var o=e.split("."),i=t.loader.textureRes,n=0;n<o.length&&i;n++)i=i[o[n]];if("string"==typeof i)return i}return e},t.realUrl=function(t){return t},t.prototype.retain=function(){this.__nRef++},t.prototype.release=function(){this.__nRef--,0==this.__nRef&&t.loader.popAssetImp(this._refKey,this)},Object.defineProperty(t.prototype,"refCount",{get:function(){return this.__nRef},enumerable:!1,configurable:!0}),t.prototype.preLoads=function(e){for(var o=this,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var r=i.length,a=0;i.forEach(function(i){var n=t.realUrl(i.path);n?(o._tempAssts.add(n),t.loader.loadRes(n,i.type,function(t,s){if(i.type==cc.SpriteAtlas&&s){var c=s;o.loadAtlasTexture(c,function(){e&&e(++a,r,n,t,s)})}else e&&e(++a,r,n,t,s)},o._refKey)):e(++a,r,i.path,new Error("not uuid!"),null)})},t.prototype.getPreLoadAsset=function(e){if(e=t.realUrl(e))return this._tempAssts.add(e),t.loader.getRes(e,null,this._refKey)},t.prototype.hasPreLoadAsset=function(e){if(e=t.realUrl(e))return t.loader.hasRes(e)},t.prototype.releaseAsset=function(e){(e=t.realUrl(e))&&(this._tempAssts.delete(e),t.loader.releaseRes(e,this._refKey))},t.prototype.spriteFrame=function(e,o,i){if(e&&o&&(o=t.realUrl(o))){var n=function(n,r){if(n)return cc.warn(n.message),void(e.spriteFrame=null);if(e.node&&e.node.isValid){if(e._curloadAssetPath==o){if(t.checkDyPack(o,r),null!=e._maskType&&e._maskType<3){var a=t._assetMaskInfo[o]||t.DEFAULT_MASK_SPRITE;e.setSprite(r,null,a.c,a.r,a.min,a.max)}else e.spriteFrame=r;if(i){if("boolean"==typeof i)return void(i&&(e.sizeMode=cc.Sprite.SizeMode.CUSTOM));i(e)}}}else cc.warn("the sprite.node is destory")}.bind(this);e._curloadAssetPath=o,this._tempAssts.add(o),t.loader.loadRes(o,cc.SpriteFrame,n,this._refKey)}},t.prototype.spriteFrameByResources=function(t,e,o){cc.resources.load(e,cc.SpriteFrame,function(e,i){e?cc.error(e):(t.spriteFrame=i,o&&o(e,i))})},t.prototype.spriteFrameAsset=function(e,o){(e=t.realUrl(e))&&t.loader.loadRes(e,cc.SpriteFrame,function(i,n){i?cc.warn(i.message):(t.checkDyPack(e,n),o&&o(n))},this._refKey)},t.prototype.spriteAtlas=function(e,o){var i=this;(e=t.realUrl(e))&&(this._tempAssts.add(e),t.loader.loadRes(e,cc.SpriteAtlas,function(n,r){t.checkAtlasDyPack(e,r),i.loadAtlasTexture(r,function(){o&&o(r)})},this._refKey))},t.prototype.loadAtlasTexture=function(t,e){var o=t.getTexture();if(!o){var i=t.getSpriteFrames();o=i.length>0?i[0].getTexture():null}return o?o.loaded?void(e&&e()):(o.once("load",function(){e&&e()},this),void cc.textureUtil.postLoadTexture(o)):e&&e()},t.prototype.font=function(e,o){(e=t.realUrl(e))&&(this._tempAssts.add(e),t.loader.loadRes(e,cc.TTFFont,function(t,e){t?cc.warn(t.message):o&&o(e)}))},t.prototype.spriteAtlasFrame=function(e,o,i,n){if(e&&o&&(o=t.realUrl(o))){var r=function(r,a){if(r)return cc.warn(r.message),void(e.spriteFrame=null);if(e.isValid&&e._curloadAssetPath==o+"."+i&&(t.checkAtlasDyPack(o,a),e.spriteFrame=a.getSpriteFrame(i),n)){if("boolean"==typeof n)return void(n&&(e.sizeMode=cc.Sprite.SizeMode.CUSTOM));n(e)}}.bind(this);e._curloadAssetPath=o+"."+i,this._tempAssts.add(o),t.loader.loadRes(o,cc.SpriteAtlas,r,this._refKey)}},t.prototype.json=function(e,o,i){var n=this;void 0===i&&(i=!0),(e=t.realUrl(e))&&t.loader.loadRes(e,cc.JsonAsset,function(t,r){o(t,r),!t&&i&&n.releaseAsset(e)},this._refKey)},t.prototype.prefab=function(e,o){(e=t.realUrl(e))&&(this._tempAssts.add(e),t.loader.loadRes(e,cc.Prefab,function(t,e){t?cc.error(t.message):o&&o(e)},this._refKey))},t.prototype.material=function(e,o){(e=t.realUrl(e))&&(this._tempAssts.add(e),t.loader.loadRes(e,cc.Material,function(t,e){t?cc.error(t.message):o&&o(e)},this._refKey))},t.prototype.spine=function(e,o){(e=t.realUrl(e))&&(this._tempAssts.add(e),t.loader.loadRes(e,sp.SkeletonData,function(t,e){t?cc.error(t.message):o&&o(e)},this._refKey))},t.prototype.dragonBones=function(e,o){var i=this,n=t.realUrl(e+"ske"),r=t.realUrl(e+"tex");r&&n&&(this._tempAssts.add(n),t.loader.loadRes(n,dragonBones.DragonBonesAsset,function(e,n){if(e)cc.error(e.message);else{var a=n;i._tempAssts.add(r),t.loader.loadRes(r,dragonBones.DragonBonesAtlasAsset,function(t,e){t?cc.error(t.message):o&&o(a,e)},i._refKey)}},this._refKey))},t.prototype.audioClip=function(e,o){(e=t.realUrl(e))&&t.loader.loadRes(e,cc.AudioClip,function(t,e){t?cc.error(t.message):o&&o(e)},this._refKey)},t.prototype.destroy=function(){for(var t=this._tempAssts.toArray(),e=t.length-1;e>=0;e--)this.releaseAsset(t[e]);this._tempAssts.clear(),this._tempAssts=null,this.__nRef=null},t.prototype.tagReleaseTempAssets=function(){this.__nRef>1&&p("There are at least 2 references to the resource loader!");for(var t=this._tempAssts.toArray(),e=t.length-1;e>=0;e--)this.releaseAsset(t[e]);this._tempAssts.clear()},t.prototype.addGChild=function(t,e){var o;if("string"==typeof t)this.prefab(t,function(t){var i=cc.instantiate(t);o=i.getComponent("GChild"),e&&e(o)});else{var i=cc.instantiate(t);o=i.getComponent("GChild"),e&&e(o)}return o},t.prototype.loadJXAniClips=function(e,o){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];var r=[],a=[],s=function(t,e,o){var i=cc.AnimationClip.createWithSpriteFrames(o,10);i.name=e,i.wrapMode=cc.WrapMode.Normal,r.push(i),a.push(e)};this.spriteAtlas(e,function(n){if(n){t.checkAtlasDyPack(e,n);for(var a=0;a<i.length;a++){var c=i[a];c.minIdx=c.minIdx||0,c.maxIdx=c.maxIdx||1e3;for(var u=[],h=c.minIdx;h<=c.maxIdx;h++){var p=c.prefix+l.default.prefixInteger(h,c.numberFix),d=n.getSpriteFrame(p);if(!d&&0!=h)break;u.push(d)}null==u[0]&&u.splice(0,1),s(e,c.aniName,u)}o(r)}})},t.prototype.atlasJXLoadClips=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var i=[],n=[],r=function(t,e){var o=cc.AnimationClip.createWithSpriteFrames(e,10);o.name=t,o.wrapMode=cc.WrapMode.Normal,i.push(o),n.push(t)};if(t){for(var a=0;a<e.length;a++){var s=e[a];s.minIdx=s.minIdx||0,s.maxIdx=s.maxIdx||1e3;for(var c=[],u=s.minIdx;u<=s.maxIdx;u++){var h=s.prefix+l.default.prefixInteger(u,s.numberFix),p=t.getSpriteFrame(h);if(!p&&0!=u)break;c.push(p)}null==c[0]&&c.splice(0,1),c.length>0&&r(s.aniName,c)}return i}},t.prototype.loadJXAniClip=function(t,e,i,n,r){o.GLoader.spriteAtlas(t,function(t){if(t){for(var o=[],a=0;a<1e3;a++){var s=i+l.default.prefixInteger(a,n),c=t.getSpriteFrame(s);if(!c&&0!=a)break;o.push(c)}o[0]||o.splice(0,1);var u=cc.AnimationClip.createWithSpriteFrames(o,10);u.name=e,u.wrapMode=cc.WrapMode.Normal,r(u)}})},t.loader=new d,t.DEFAULT_MASK_SPRITE={c:cc.Vec2.ZERO,r:46,min:13,max:34},t._assetMaskInfo={},t._unpackPaths=[],t}();o.GAssetImpl=f;var g=function(t){function e(o){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var r=t.call(this)||this;return r._apl=null,r._state=e.STATE.Null,r._resultCallBacks=[],r._apl=o,r._assets=i,r}return n(e,t),e.prototype.load=function(){var t,o=this;if(this._state==e.STATE.Null){if(0!=this._assets.length)return(t=this._apl).preLoads.apply(t,r([function(t,i,n,r){return(r?cc.warn:cc.log)("\u52a0\u8f7d\u8d44\u6e90\u4e2d\uff0c\u5f53\u524d\u8fdb\u5ea6"+t+"/"+i+",\u52a0\u8f7d\u8d44\u6e90\u8def\u5f84\uff1a"+n+"\uff0c\u72b6\u6001 "+(r?"\u52a0\u8f7d\u5931\u8d25":"\u52a0\u8f7d\u6210\u529f")),r?(o._state=e.STATE.Error,o.endCallbacks()):t==i?(o._state=e.STATE.Completed,o.endCallbacks()):void 0}],this._assets)),this;cc.warn("GassetAsyncHandler assets.length == 0!")}},e.prototype.work=function(t){return this._state==e.STATE.Completed||this._state==e.STATE.Error?t(this._state):(this._resultCallBacks.push(t),this._state==e.STATE.Null&&this.load(),this)},e.prototype.endCallbacks=function(){for(;this._resultCallBacks.length>0;)this._resultCallBacks.shift()(this._state)},e.STATE={Null:0,Loading:1,Completed:2,Error:3},e}(c.ObjectWrap);o.GAssetsAsyncHanlder=g,o.GLoader=f.getAssetImpl("GLOBAL-ASSETIMPL"),cc._RF.pop()},{"../../conventions/JXCommon":"JXCommon","../CoreDefine":"CoreDefine","../FrameEx/ES5Ex":"ES5Ex","../Math/MathEx":"MathEx"}],GLongTouch:[function(t,e,o){"use strict";cc._RF.push(e,"fab2fjeTVVEF4gggiW0Uzb/","GLongTouch");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../Manager/AudioMgr"),s=cc._decorator,c=s.ccclass,l=s.property,u=s.menu,h=(s.inspector,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.longTouchEvents=[],e.longTouchInterval=.5,e._intervalAct=0,e._intervalActMax=0,e._delta=0,e._hoverTime=0,e._beginTimes=1,e.originalInterval=.5,e._canLongTouchCb=function(){return 0},e._endTouchCb=function(){return 0},e}var o;return n(e,t),o=e,Object.defineProperty(e.prototype,"canLongTouchCb",{get:function(){return this._canLongTouchCb},set:function(t){this._canLongTouchCb=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"intervalAct",{set:function(t){this._intervalAct=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endTouchCb",{set:function(t){this._endTouchCb=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"intervalActMax",{set:function(t){this._intervalActMax=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hoverTime",{set:function(t){this._hoverTime=t},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this.originalInterval=this.longTouchInterval},e.prototype._onTouchBegan=function(t){if(this.interactable&&this.enabledInHierarchy){if(this._pressed=!0,this._updateState(),this._canLongTouchCb){var e=this._canLongTouchCb(!0);if(e>o.ContinuteState.Normal)return e==o.ContinuteState.Cancel&&(this._pressed=!1,this._updateState(),this.hoverTime=0,this.longTouchInterval=this.originalInterval),void t.stopPropagation()}this.emitLongTouchEvent(),t.stopPropagation()}},e.prototype._onTouchEnded=function(e){cc.Button.comAudio&&a.AudioMgr.Ins().playEffect(cc.Button.comAudio),t.prototype._onTouchEnded.call(this,e),this.hoverTime=0,this.longTouchInterval=this.originalInterval,this._endTouchCb&&this._endTouchCb()},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._pressed&&(this._intervalAct&&(this.longTouchInterval==this._intervalActMax?this.longTouchInterval=this._intervalActMax:this.longTouchInterval-=this._intervalAct),!(this._beginTimes&&(this._hoverTime+=e,this._hoverTime<this._beginTimes))))if(this._delta<this.longTouchInterval)this._delta+=e;else{if(this._canLongTouchCb){var i=this._canLongTouchCb(!1);if(i>o.ContinuteState.Normal)return void(i==o.ContinuteState.Cancel&&(this._pressed=!1,this._updateState(),this.hoverTime=0,this.longTouchInterval=this.originalInterval,this._endTouchCb&&this._endTouchCb()))}this._delta=0,this.emitLongTouchEvent()}},e.prototype.emitLongTouchEvent=function(){var t=new cc.Event.EventCustom("touching",!0);t.setUserData(this.node),cc.Button.comAudio&&a.AudioMgr.Ins().playEffect(cc.Button.comAudio),cc.Component.EventHandler.emitEvents(this.longTouchEvents,t)},e.ContinuteState={Null:0,Normal:1,Wait:2,Cancel:3},r([l([cc.Component.EventHandler])],e.prototype,"longTouchEvents",void 0),r([l],e.prototype,"longTouchInterval",void 0),o=r([c,u("FrameEx/GLongTouch")],e)}(cc.Button));o.default=h,cc._RF.pop()},{"../Manager/AudioMgr":"AudioMgr"}],GMCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"75aaduu4FlI4oZtLL4DHpNW","GMCtrl"),Object.defineProperty(o,"__esModule",{value:!0}),t("../../Core/GEvent/GParam"),t("../Common/Define"),t("../Logic/GameMgr"),t("./../../Core/GCtrl"),cc._RF.pop()},{"../../Core/GEvent/GParam":"GParam","../Common/Define":"Define","../Logic/GameMgr":"GameMgr","./../../Core/GCtrl":"GCtrl"}],GNodePool:[function(t,e,o){"use strict";cc._RF.push(e,"6b099vxK35EPZXbRGEiwX+x","GNodePool");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.GNodePool=void 0;var r=function(t){function e(e){var o=t.call(this)||this;return o._actives=[],o._recoves=[],o.init(e),o}return n(e,t),Object.defineProperty(e.prototype,"actives",{get:function(){return this._actives},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"recovers",{get:function(){return this._recoves},enumerable:!1,configurable:!0}),e.prototype.checkInit=function(){return!!this._parent},e.prototype.init=function(t){t&&(this._parent=t)},e.prototype.pop=function(){if(this.checkInit()){if(0==this._recoves.length){var t=this.syncCreate();return t?(this._actives.push(t),t.name=++e._tag+"",this._parent.addChild(t),t):null}var o=this._recoves.pop();return this._actives.push(o),o.active=!0,console.log(this._recoves.length),o}},e.prototype.asyncPop=function(t){var o=this;if(!this.checkInit())return t(null);if(0==this._recoves.length)return this.asyncCreate(function(i){if(!i)return t(null);o._actives.push(i),i.setUserData(++e._tag),o._parent.addChild(i),t(i)});var i=this._recoves.pop();this._actives.push(i),i.active=!0,t(i)},e.prototype.push=function(t){if(this.checkInit()){t.active=!1;for(var e=0;e<this._actives.length;e++)if(this._actives[e].getUserData()==t.getUserData()){this._actives.splice(e,1);break}t.stopAllActions(),this._recoves.push(t)}},e.prototype.destory=function(){if(this.checkInit()){for(var t=0,e=this._actives;t<e.length;t++)e[t].destroy();for(var o=0,i=this._recoves;o<i.length;o++)i[o].destroy();this._actives.splice(0,this._actives.length),this._recoves.splice(0,this._recoves.length),this.onDestroy()}},e.prototype.onDestroy=function(){},e._tag=0,e}(t("../FrameEx/ES5Ex").ObjectWrap);o.GNodePool=r,cc._RF.pop()},{"../FrameEx/ES5Ex":"ES5Ex"}],GPageView:[function(t,e,o){"use strict";cc._RF.push(e,"df43eZyjpBONbdmTEcR+dQG","GPageView");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../CoreDefine"),s=t("./GViewBase"),c=cc._decorator,l=c.ccclass,u=c.property,h=(c.executionOrder,c.menu),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.toggles=[],e.pageRoot=null,e.pagePrefabs=[],e.parallelTween=!1,e.forceToggleEvent=!1,e.unCachePages=[],e.curPage=a.INVALID_VALUE,e._pages=[],e._inTween=null,e._outTween=null,e}return n(e,t),e.prototype.getPage=function(t){return this._pages[t]},e.prototype.onGLoad=function(){this.setStatus()},e.prototype.setStatus=function(){},e.prototype.setToggleCanSwitch=function(t,e){t.interactable=e},e.prototype.onGStart=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o]},e.prototype.checkReGStart=function(){return!0},e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.stopTween();for(var e=0;e<this._pages.length;e++){var o=this._pages[e];o&&(o.node&&!o.node.parent?o.node.destroy():o.isValid&&o.destroy())}this._pages.length=0},e.prototype.onToggleClick=function(){},e.prototype.onSelected=function(){},e.prototype.onUnSelected=function(){},e.prototype.isCanSwitch=function(t,e){return void 0===e&&(e=!0),!0},e.prototype.onSwitch=function(t,e){var o=this;this.stopTween();var i=function(i){i.node.parent||o.pageRoot.addChild(i.node),o._inTween=o.inAction(i.node,t,e),o._inTween?(o._inTween.call(function(){o._inTween=null}).start(),o.onPageIned(i)):o.onPageIned(i)},n=function(){var t=o._pages[e];if(t)i(t);else{if(!o.pagePrefabs[e])return void cc.warn("the new Page res is not stteing.");var n=cc.instantiate(o.pagePrefabs[e]).getComponent("GChild");o._pages[e]=n,o.onPageLoad(n,e),i(n)}},r=function(e){o._outTween=null,o.onPageOuted(e),o.unCachePages.indexOf(t)!=a.INVALID_VALUE?(e.node.destroy(),o._pages[t]=null):e.node.removeFromParent(!1),!o.parallelTween&&n()},s=this._pages[t];s?(this._outTween=this.outAction(s.node,t,e),this._outTween?this._outTween.call(function(){return r(s)}).start():r(s)):!this.parallelTween&&n(),this.parallelTween&&n()},e.prototype.onCoustomSwitch=function(){},e.prototype.onPageLoad=function(){},e.prototype.onPageIned=function(t){t.onPageIn()},e.prototype.onPageOuted=function(t){t.onPageOut()},e.prototype.outAction=function(){return null},e.prototype.inAction=function(){return null},e.prototype.stopTween=function(){this._inTween&&this._inTween.stop(),this._outTween&&this._outTween.stop(),this._inTween=null,this._outTween=null},r([u([cc.Node])],e.prototype,"toggles",void 0),r([u(cc.Node)],e.prototype,"pageRoot",void 0),r([u([cc.Prefab])],e.prototype,"pagePrefabs",void 0),r([u(cc.Boolean)],e.prototype,"parallelTween",void 0),r([u(cc.Boolean)],e.prototype,"forceToggleEvent",void 0),r([u([cc.Integer])],e.prototype,"unCachePages",void 0),r([l,h("View/GBase/GPageView")],e)}(s.default);o.default=p,cc._RF.pop()},{"../CoreDefine":"CoreDefine","./GViewBase":"GViewBase"}],GPage:[function(t,e,o){"use strict";cc._RF.push(e,"dbee3fN/8BIRpSU/TGKOQQF","GPage");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("./GChild"),s=cc._decorator,c=s.ccclass,l=(s.property,s.menu),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._isPageShow=!1,e}return n(e,t),e.prototype.onPageActive=function(){this.node.active=!0},e.prototype.onPageDisable=function(){this.node.active=!1},e.prototype.onPageOut=function(){this._isPageShow=!1},e.prototype.onPageIn=function(){this._isPageShow=!0},r([c,l("View/Base/GPage")],e)}(a.default);o.default=u,cc._RF.pop()},{"./GChild":"GChild"}],GParam:[function(t,e,o){"use strict";cc._RF.push(e,"4eb17WNxhtGFIV8iNkU9si5","GParam");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var r=t("../FrameEx/ES5Ex"),a=function(t){function e(e){var o=t.call(this)||this;return o.arguments=new r.MapWrap,o._onlyArgument=e,o}return n(e,t),e.prototype.push=function(t,e){t&&this.arguments.set(t,e)},e.prototype.get=function(t){return t?this.arguments.get(t):this._onlyArgument},e.prototype.clear=function(){this.arguments.clear()},e.prototype.toList=function(){return 0==this.arguments.size?null:this.arguments.values()},e.prototype.toString=function(){for(var t=this.arguments.keys(),e="",o=0;o<t.length;o++)e+=t[o]+"="+this.get(t[o])+"/t";return e},e}(r.ObjectWrap);o.default=a,cc._RF.pop()},{"../FrameEx/ES5Ex":"ES5Ex"}],GScrollView:[function(t,e,o){"use strict";cc._RF.push(e,"84ab61qaCZFAbL8CP3Eh38c","GScrollView");var i=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0}),o.ScrollDirection=o.GScrollView=void 0;var n,r=t("../FrameEx/ES5Ex"),a=t("./GViewDestory"),s=function(){function t(t){this.dynamicSize=!1,this.wdRender=null,this.scrollview=t.scrollview,this.mask=t.mask,this.content=t.content,this.wdRender=this.content.getComponent(cc.Component),this.node_pools=new r.MapWrap,this.item_templates=t.item_templates,this.tpl_select=t.tpl_select,this.item_templates.forEach(function(t){t.active=!1}),this.dir=t.direction||n.Vertical,this.width=t.width||this.mask.width,this.height=t.height||this.mask.height,this.gap_x=t.gap_x||0,this.gap_y=t.gap_y||0,this.cb_host=t.cb_host,this.item_setter=t.item_setter,this.recycle_cb=t.recycle_cb,this.scroll_to_end_cb=t.scroll_to_end_cb,this.scroll_to_top=t.scroll_to_top,this.auto_scrolling=t.auto_scrolling||!1,this.dynamicSize=t.dynamicSize||!1,this.dir==n.Vertical?this.content.width=this.width:this.content.height=this.height,this.scrollview.vertical=this.dir==n.Vertical,this.scrollview.horizontal=this.dir==n.Horizontal,this.scrollview.inertia=!0,this.scrollview.node.on("scrolling",this.on_scrolling,this),this.scrollview.node.on("scroll-to-bottom",this.on_scroll_to_end,this),this.scrollview.node.on("scroll-to-right",this.on_scroll_to_end,this),this.scrollview.node.on("scroll-to-top",this.on_scroll_to_top,this),t.isWidget&&this.scrollview.node.on(cc.Node.EventType.SIZE_CHANGED,this.on_size_change,this);var e=this.scrollview.node.getComponent(a.default);e||(e=this.scrollview.node.addComponent(a.default)),e.otherDestroyCb=this.destroy.bind(this)}return Object.defineProperty(t.prototype,"dataSize",{get:function(){return this.items?this.items.length:0},enumerable:!1,configurable:!0}),t.prototype.getItems=function(){return this.items||[]},t.prototype.on_scroll_to_end=function(){this.scroll_to_end_cb&&this.scroll_to_end_cb.call(this.cb_host)},t.prototype.on_scroll_to_top=function(){this.scroll_to_top&&this.scroll_to_top.call(this.cb_host)},t.prototype.on_size_change=function(){this.width=this.scrollview.node.width,this.height=this.scrollview.node.height,this.mask.setContentSize(this.scrollview.node.getContentSize()),this.layout_items(0),this.resize_content(),this.start_index=-1,this.stop_index=-1,this.dir==n.Vertical?this.content.y=this.mask.height*(1-this.mask.anchorY):this.content.x=0,this.items.length>0&&this.on_scrolling()},t.prototype.on_scrolling=function(){if(this.items&&this.items.length)if(this.dir==n.Vertical){var t=this.content.y;t<(1-this.mask.anchorY)*this.mask.height&&(t=(1-this.mask.anchorY)*this.mask.height),t>this.content.height+(1-this.mask.anchorY)*this.mask.height&&(t=this.content.height+(1-this.mask.anchorY)*this.mask.height);for(var e=0,o=this.items.length-1,i=(r=this.height*(1-this.mask.anchorY)-t)-this.height;this.items[e].y-this.items[e].anchorY*this.items[e].height>r&&(e++,this.items[e]););for(;this.items[o].y+(1-this.items[o].anchorY)*this.items[o].height<i&&(o--,this.items[o]););e==this.start_index&&o==this.stop_index||(this.start_index=e,this.stop_index=o,this.render_items())}else{var r,a=this.content.x;for(a>0&&(a=0),a<this.width-this.content.width&&(a=this.width-this.content.width),e=0,o=this.items.length-1,i=(r=-a)+this.width;this.items[e].x+this.items[e].width<r;)e++;for(;this.items[o].x>i;)o--;e!=this.start_index&&o!=this.stop_index&&(this.start_index=e,this.stop_index=o,this.render_items())}},t.prototype.spawn_node=function(t,e){var o,i=this.tpl_select.call(this.cb_host,e||this.items[t].data,t),n=this.node_pools.get(i);return n&&n.length>0?o=n.pop():(o=cc.instantiate(this.item_templates[i])).parent=this.content,o.name="tpl_"+i+"_"+t,o.active=!0,o},t.prototype.recycle_item=function(t){if(t.node){var e=this.node_pools.get(t.data.key);e||(e=[],this.node_pools.set(t.data.key,e)),e.push(t.node),this.recycle_cb&&this.recycle_cb.call(this.cb_host,t.node,t.data.key),t.node.name="recycle",t.node.active=!1,t.node=null}},t.prototype.clear_items=function(){var t=this;this.items&&this.items.forEach(function(e){t.recycle_item(e)})},t.prototype.render_items=function(){for(var t,e=0;e<this.start_index;e++)(t=this.items[e]).node&&this.recycle_item(t);for(e=this.items.length-1;e>this.stop_index;e--)(t=this.items[e]).node&&this.recycle_item(t);for(e=this.start_index;e<=this.stop_index;e++)(t=this.items[e])&&(t.node||(t.node=this.spawn_node(e),this.item_setter.call(this.cb_host,t.node,t.data,e)),t.node.setPosition(t.x,t.y))},t.prototype.pack_item=function(t,e){if(this.dynamicSize){var o=this.spawn_node(t,e),i=this.item_setter.call(this.cb_host,o,e,t),n={x:0,y:0,width:i[0],height:i[1],anchorX:o.anchorX,anchorY:o.anchorY,data:e,node:o};return this.recycle_item(n),n}var r=this.tpl_select.call(this.cb_host,e,t);return{x:0,y:0,width:(o=this.item_templates[r]).width*o.scaleX,height:o.height*o.scaleY,anchorX:o.anchorX,anchorY:o.anchorY,data:e,node:null}},t.prototype.layout_items=function(t){if(!(this.items.length<=0)){var e=0;if(t>0){var o=this.items[t-1];this.dir==n.Vertical?(e=o.y-o.height*(1-o.anchorY)-this.gap_y,e-=o.height+this.gap_y):(e=o.x+o.width+this.gap_x,e+=o.width+this.gap_x)}for(var i=t,r=this.items.length;i<r;i++){var a=this.items[i];this.dir==n.Vertical?(a.x=a.width*a.anchorX,a.y=e-a.height*(1-a.anchorY),e-=a.height+this.gap_y):(a.y=a.height*(a.anchorY-1),a.x=e+a.width*a.anchorX,e+=a.width+this.gap_x)}}},t.prototype.resize_content=function(){if(this.items.length<=0)return this.content.width=0,void(this.content.height=0);var t=this.items[this.items.length-1];this.dir==n.Vertical?this.content.height=Math.max(this.height,-t.y+t.anchorY*t.height):this.content.width=Math.max(this.width,t.x*(1-t.anchorX)+t.width)},t.prototype.set_data=function(t){var e=this;this.clear_items(),this.items=[],t.forEach(function(t,o){var i=e.pack_item(o,t);e.items.push(i)}),this.layout_items(0),this.resize_content(),this.start_index=-1,this.stop_index=-1,this.dir==n.Vertical?this.content.y=this.mask.height*(1-this.mask.anchorY):this.content.x=0,this.items.length>0&&this.on_scrolling()},t.prototype.insert_data=function(t){for(var e,o=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(0!=n.length)if(this.items||(this.items=[]),t<0||t>this.items.length)cc.warn("invalid index",t);else{var a=t==this.items.length,s=[];n.forEach(function(t,e){var i=o.pack_item(e,t);s.push(i)}),(e=this.items).splice.apply(e,i([t,0],s)),this.layout_items(t),this.resize_content(),this.start_index=-1,this.stop_index=-1,this.auto_scrolling&&a&&this.scroll_to_end(),this.on_scrolling()}},t.prototype.append_data=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.items||(this.items=[]),this.insert_data.apply(this,i([this.items.length],t))},t.prototype.remove_data=function(t){this.items&&(this.items.length<=t||(this.items.splice(t,1),this.layout_items(t),this.resize_content(),this.start_index=-1,this.stop_index=-1,this.auto_scrolling&&this.scroll_to_end(),this.on_scrolling()))},t.prototype.scroll_to_end=function(){this.dir==n.Vertical?this.scrollview.scrollToBottom():this.scrollview.scrollToRight(),this.on_scrolling()},t.prototype.render_active=function(){for(var t=this.start_index;t<=this.stop_index;t++){var e=this.items[t];e.node&&this.item_setter.call(this.cb_host,e.node,e.data,t)}},t.prototype.destroy=function(){this.clear_items(),this.node_pools&&this.node_pools.forEach(function(t){t.forEach(function(t){cc.isValid(t)&&t.destroy()})}),this.node_pools=null,this.items=null,this.item_templates&&(this.item_templates=null,this.item_templates=null),cc.isValid(this.scrollview.node)&&(this.scrollview.node.off("scrolling",this.on_scrolling,this),this.scrollview.node.off("scroll-to-bottom",this.on_scroll_to_end,this),this.scrollview.node.off("scroll-to-right",this.on_scroll_to_end,this))},t}();o.GScrollView=s,function(t){t[t.Vertical=1]="Vertical",t[t.Horizontal=2]="Horizontal"}(n=o.ScrollDirection||(o.ScrollDirection={})),cc._RF.pop()},{"../FrameEx/ES5Ex":"ES5Ex","./GViewDestory":"GViewDestory"}],GTimerComponent:[function(t,e,o){"use strict";cc._RF.push(e,"37fe7cIpqJP7IpJaX8nW2Sh","GTimerComponent");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../Game/Common/UICreate"),s=t("../GCtrl"),c=cc._decorator,l=c.ccclass,u=c.property,h=c.executionOrder,p=c.menu,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.timeLb=null,e.totalTime=0,e.startTime=0,e.endTime=0,e.stargetTime=1,e._delta=0,e._bStart=!1,e}return n(e,t),e.prototype.onLoad=function(){this.timeLb||(this.timeLb=a.default.addLabelCom(this.node))},e.prototype.start=function(){},e.prototype.onDestroy=function(){s.GCtrl.ES.off(this)},e.prototype.onTimerEvent=function(){this._delta+=s.GCtrl.deltaSecondTime,this._delta<1||(this._delta=0)},e.prototype.onTimeEnd=function(){},e.prototype.startCD=function(){this._bStart||(s.GCtrl.ES.on(s.GCtrl.GTimerSecondEventMsg,this,this.onTimerEvent.bind(this)),this._bStart=!1)},r([u(cc.Label)],e.prototype,"timeLb",void 0),r([u],e.prototype,"totalTime",void 0),r([u],e.prototype,"startTime",void 0),r([u],e.prototype,"endTime",void 0),r([u],e.prototype,"stargetTime",void 0),r([l,p("View/GBase/GTimerComponent"),h(1)],e)}(cc.Component);o.default=d,cc._RF.pop()},{"../../Game/Common/UICreate":"UICreate","../GCtrl":"GCtrl"}],GTimerMgr:[function(t,e,o){"use strict";cc._RF.push(e,"80435vD+CFEfKGdumauP98x","GTimerMgr"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../GCtrl"),n=function(){function t(){this._timerHandler=-1,this._lastTimeStamp=0}return t.ins=function(){return this._ins||(this._ins=new t),this._ins},t.prototype.start=function(){this._lastTimeStamp=Date.now(),this._timerHandler=setInterval(this.onTimer.bind(this),100)},t.prototype.stop=function(){this._timerHandler&&clearInterval(this._timerHandler),this._lastTimeStamp=0,t.secondDelta=0},t.prototype.onTimer=function(){var e=this._lastTimeStamp,o=Date.now(),n=t.secondDelta;t.secondDelta=(o-e)/1e3,t.mDelta=t.secondDelta-n,t.mDelta=t.mDelta>0?t.mDelta:t.secondDelta,i.GCtrl.ES.emit(i.GCtrl.GTimerMilliEventMsg),t.secondDelta<1||(this._lastTimeStamp=o,i.GCtrl.ES.emit(i.GCtrl.GTimerSecondEventMsg))},t._ins=null,t.secondDelta=0,t.mDelta=0,t}();o.default=n,cc._RF.pop()},{"../GCtrl":"GCtrl"}],GViewBase:[function(t,e,o){"use strict";cc._RF.push(e,"1748aoYG0FJiZyLwTmAQmAA","GViewBase");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.WidgetInfo=o.HangOnType=o.ViewAction=o.SizeModel=void 0;var a,s,c=t("../../tyqSDK/tyqSDK"),l=t("../FrameEx/GComponent"),u=t("../GCtrl");(function(t){t[t.Normal=0]="Normal",t[t.ReWidth=1]="ReWidth",t[t.ReHeight=2]="ReHeight",t[t.ReSizeAll=3]="ReSizeAll"})(a=o.SizeModel||(o.SizeModel={})),function(t){t[t.NONE=0]="NONE",t[t.SCALE=1]="SCALE",t[t.YMove=2]="YMove",t[t.Fade=3]="Fade"}(o.ViewAction||(o.ViewAction={})),function(t){t[t.Nomal=0]="Nomal",t[t.LeftCenter=1]="LeftCenter",t[t.LeftTop=2]="LeftTop",t[t.LeftBtm=3]="LeftBtm",t[t.RightCenter=4]="RightCenter",t[t.RightTop=5]="RightTop",t[t.RightBtm=6]="RightBtm",t[t.TopCenter=7]="TopCenter",t[t.BtmCenter=8]="BtmCenter"}(s=o.HangOnType||(o.HangOnType={}));var h=cc._decorator,p=h.ccclass,d=h.property,f=h.executionOrder,g=h.menu,_=function(){function t(){this.node=null,this.handOnType=s.Nomal,this.sizeModel=a.Normal}return r([d(cc.Node)],t.prototype,"node",void 0),r([d({type:cc.Enum(s)})],t.prototype,"handOnType",void 0),r([d({type:cc.Enum(a)})],t.prototype,"sizeModel",void 0),r([p("WidgetInfo")],t)}();o.WidgetInfo=_;var m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isShowBanner=!1,e.bgImage=null,e.widgetNodes=[],e._custom=null,e._win=null,e.preDestroy=!1,e}return n(e,t),Object.defineProperty(e.prototype,"Custom",{get:function(){return this._custom},set:function(t){this._custom=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"win",{get:function(){return this._win},set:function(t){this._win&&this._win!=t?cc.warn("exists win binder by this view"):this._win=t},enumerable:!1,configurable:!0}),e.prototype.__onLoad=function(){if(this.preDestroy=!1,this.widgetNodes.length>0)for(var t=u.GCtrl.winSize,e=0;e<this.widgetNodes.length;e++){var o=this.widgetNodes[e];if(null!=o.node){switch(o.handOnType){case s.Nomal:break;case s.LeftCenter:o.node.x=-t.width/2;break;case s.LeftTop:o.node.x=-t.width/2,o.node.y=t.height/2;break;case s.LeftBtm:o.node.x=-t.width/2,o.node.y=-t.height/2;break;case s.RightCenter:o.node.x=t.width/2;break;case s.RightTop:o.node.x=t.width/2,o.node.y=t.height/2;break;case s.RightBtm:o.node.x=t.width/2,o.node.y=-t.height/2;break;case s.TopCenter:o.node.y=t.height/2;break;case s.BtmCenter:o.node.y=-t.height/2}switch(o.sizeModel){case a.Normal:break;case a.ReWidth:o.node.width=t.width;break;case a.ReHeight:o.node.height=t.height;break;case a.ReSizeAll:o.node.setContentSize(t)}}}this.onGLoad()},e.prototype.__onDestroy=function(){u.GCtrl.ES.off(this),u.GCtrl.ES.off(this.node),this.onGDestroy(),this.win&&this.win.onDestroy()},e.prototype.onGDestroy=function(){},e.prototype.onGLoad=function(){},e.prototype.onGStart=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.isShowBanner&&c.tyqSDK.showBannerAd()},e.prototype.emitEvent=function(){u.GCtrl.ES.emit(u.GCtrl.GClientWinOpenEventAfterMsg,this.win.winId)},e.prototype.onGActive=function(){},e.prototype.checkReGStart=function(){return!1},e.prototype.onClose=function(){if(c.tyqSDK.hideBannerAd(),this.win)this.win.isDestroy||this.win.onClose();else if(!this.win){if(!cc.isValid(this))return;this.node.destroy()}},e.prototype.onAnimationLoaded=function(){},e.prototype.runNodeTimer=function(t,e,o){t.stopAllActions();var i=cc.callFunc(o),n=cc.delayTime(e),r=cc.sequence(i,n),a=cc.repeatForever(r);t.runAction(a),o()},r([d({type:Boolean,tooltip:!1})],e.prototype,"isShowBanner",void 0),r([d({type:cc.Sprite,tooltip:!1})],e.prototype,"bgImage",void 0),r([d({type:[_],visible:!1})],e.prototype,"widgetNodes",void 0),r([p,g("View/GBase/GViewBase"),f(1)],e)}(l.default);o.default=m,cc._RF.pop()},{"../../tyqSDK/tyqSDK":"tyqSDK","../FrameEx/GComponent":"GComponent","../GCtrl":"GCtrl"}],GViewDestory:[function(t,e,o){"use strict";cc._RF.push(e,"715c3mK8btA4pnLxzJ8mwC5","GViewDestory");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../GCtrl"),s=cc._decorator,c=s.ccclass,l=(s.property,s.menu),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.onDestroy=function(){a.GCtrl.ES.off(this.node),this.otherDestroyCb&&this.otherDestroyCb(),this.otherDestroyCb=null},r([c,l("View/GBase/GViewDestory")],e)}(cc.Component);o.default=u,cc._RF.pop()},{"../GCtrl":"GCtrl"}],GameMgr:[function(t,e,o){"use strict";cc._RF.push(e,"f4b7apJGVlByIv54+GpXUGY","GameMgr");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var r=t("../../conventions/JXCommon"),a=t("../../Core/CoreDefine"),s=t("../../Core/FrameEx/ES5Ex"),c=t("../../Core/Manager/GTimerMgr"),l=t("../../Core/Manager/RedPointLogicMgr"),u=t("../../Core/Manager/UIMgr"),h=t("../Common/Define"),p=t("../Common/UI"),d=t("../Data/Locals/LHeroData"),f=t("../Data/Locals/LOwnEquips"),g=t("../Data/Locals/LOwnItems"),_=t("../Data/Locals/LUserData"),m=t("../Data/RunTime/RBagData"),y=t("../Data/RunTime/RUserData"),v=t("../Data/Static/SAction"),C=t("../Data/Static/SActionCollision"),I=t("../Data/Static/SAddDialData"),E=t("../Data/Static/SBuffData"),S=t("../Data/Static/SCallData"),R=t("../Data/Static/SDailyTaskData"),D=t("../Data/Static/SDialData"),b=t("../Data/Static/SEffectAnim"),w=t("../Data/Static/SEquipData"),A=t("../Data/Static/SGuideChainData"),T=t("../Data/Static/SGuideStepData"),M=t("../Data/Static/SHeroData"),L=t("../Data/Static/SHeroTryData"),P=t("../Data/Static/SItemData"),B=t("../Data/Static/SLvData"),O=t("../Data/Static/SNoticeData"),x=t("../Data/Static/SNpcTeamData"),N=t("../Data/Static/SOfficerData"),k=t("../Data/Static/SOnLineAwardData"),G=t("../Data/Static/SScopeData"),H=t("../Data/Static/SSignInData"),X=t("../Data/Static/SSkillData"),F=t("../Data/Static/SSkillEffect"),J=t("../Data/Static/SStarLvData"),U=t("../Data/Static/SStoryData"),V=t("../Data/Static/SSuitData"),j=t("../Data/Static/STowerData"),q=t("../Data/Static/SUnitData"),W=t("../Data/Static/SVipData"),Y=t("../Views/ViewUtil/JumpUtil"),z=t("./../../Core/GCtrl"),K=t("./../../Core/Manager/DataPool"),Z=t("./../Data/RunTime/RHeroData"),$=t("./../Data/Static/SLvUpData"),Q=t("./../Data/Static/SMapData"),tt=t("./../Data/Static/SMapStyleData"),et=t("./../Data/Static/SSystemConfig"),ot=t("./../Guide/GuideLogic"),it=t("./HeroMgr"),nt=t("./ItemMgr"),rt=t("./MapMgr"),at=t("./SdkMgr"),st=t("./UserMgr"),ct=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._timeCounters=[],e._timeColocks=[],e._lastEndTaskId=null,e.lastEndArmyTaskId=null,e}return n(e,t),e.ins=function(){return this._ins||(this._ins=new e),this._ins},e.__STATIC_CONFIG_INIT=function(){window.wdStatics={locales:[],launchFiles:[],allFiles:["vipData","mapData","mapStyleData","equipData","action","actionCollision","buffData","bullet","effectAnim","heroData","itemData","suitData","npcTeamData","signInData","skillEffect","storyData","unitData","skillData","systemConfig","officerData","scopeData","lvData","lvUpData","starLvData","dialData","towerData","guideChainData","guideStepData","onLineAwardData","noticeData","heroTryData","callData","addDialData","dailyTaskData"]},window.wdStatics.locales=window.wdStatics.locales.map(function(t){return""+t}),window.wdStatics.launchFiles=window.wdStatics.launchFiles.map(function(t){return""+t}),window.wdStatics.allFiles=window.wdStatics.allFiles.map(function(t){return""+t}),window.wdStatics.loadStatus=window.wdStatics.loadStatus||{}},e.initLoginStatic=function(t,e){this.__STATIC_CONFIG_INIT();var o=window.wdStatics.launchFiles;K.DataPool.ins().loadRTStatics(o,function(e,i){window.wdStatics.loadStatus[e]=!0,t&&t(i,o.length)},function(){e()})},e.onInitLoginRunTime=function(){},e._commonStaticsLoadEnd=function(){this.vipData=K.DataPool.ins().getStatic(W.SVipData),this.mapData=K.DataPool.ins().getStatic(Q.SMapData),this.mapStyle=K.DataPool.ins().getStatic(tt.SMapStyleData),this.lvUpData=K.DataPool.ins().getStatic($.SLvUpData),this.starLvData=K.DataPool.ins().getStatic(J.SStarLvData),this.towerData=K.DataPool.ins().getStatic(j.STowerData),this.equipData=K.DataPool.ins().getStatic(w.SEquipData),this.suitData=K.DataPool.ins().getStatic(V.SSuitData),this.noticeData=K.DataPool.ins().getStatic(O.SNoticeData),this.action=K.DataPool.ins().getStatic(v.SAction),this.actionCollision=K.DataPool.ins().getStatic(C.SActionCollision),this.buffData=K.DataPool.ins().getStatic(E.SBuffData),this.dialData=K.DataPool.ins().getStatic(D.SDialData),this.effectAnim=K.DataPool.ins().getStatic(b.SEffectAnim),this.heroData=K.DataPool.ins().getStatic(M.SHeroData),this.itemData=K.DataPool.ins().getStatic(P.SItemData),this.npcTeamData=K.DataPool.ins().getStatic(x.SNpcTeamData),this.signInData=K.DataPool.ins().getStatic(H.SSignInData),this.skillEffect=K.DataPool.ins().getStatic(F.SSkillEffect),this.storyData=K.DataPool.ins().getStatic(U.SStoryData),this.unitData=K.DataPool.ins().getStatic(q.SUnitData),this.skillData=K.DataPool.ins().getStatic(X.SSkillData),this.systemConfig=K.DataPool.ins().getStatic(et.SSystemConfig),this.officerData=K.DataPool.ins().getStatic(N.SOfficerData),this.scopeData=K.DataPool.ins().getStatic(G.SScopeData),this.lvData=K.DataPool.ins().getStatic(B.SLvData),this.guideChainData=K.DataPool.ins().getStatic(A.SGuideChainData),this.guideStepData=K.DataPool.ins().getStatic(T.SGuideStepData),this.onLineAwardData=K.DataPool.ins().getStatic(k.SOnLineAwardData),this.heroTryData=K.DataPool.ins().getStatic(L.SHeroTryData),this.callData=K.DataPool.ins().getStatic(S.SCallData),this.addDialData=K.DataPool.ins().getStatic(I.SAddDialData),this.dailyTaskData=K.DataPool.ins().getStatic(R.SDailyTaskData)},e.initFristGameStatics=function(t,o){var i=this;K.DataPool.ins().loadRTStatics(window.wdStatics.allFiles,function(e,o){window.wdStatics.loadStatus[e]=!0,t&&t(o,window.wdStatics.allFiles.length)},function(){i._commonStaticsLoadEnd(),e.initLocalData(),e.initGameRunTime(),o()})},e.initAllStatics=function(t,o){var i=this;this.__STATIC_CONFIG_INIT();for(var n=window.wdStatics.allFiles,r=0;r<window.wdStatics.launchFiles.length;r++)n.indexOf(window.wdStatics.launchFiles[r])==a.INVALID_VALUE&&n.push.apply(n,window.wdStatics.launchFiles);K.DataPool.ins().loadRTStatics(n,function(e,o){window.wdStatics.loadStatus[e]=!0,t&&t(o,n.length)},function(){i._commonStaticsLoadEnd(),e.initLocalData(),e.initGameRunTime(),o()})},e.initGameRunTime=function(){this.RBagData=K.DataPool.ins().getRunTime(m.default),this.rHeroData=K.DataPool.ins().getRunTime(Z.RHeroData),this.rUserData=K.DataPool.ins().getRunTime(y.RUserData)},e.initLocalData=function(){this.lUserData=K.DataPool.ins().getLocal(_.LUserData),this.lHeroData=K.DataPool.ins().getLocal(d.default),this.lOwnEquips=K.DataPool.ins().getLocal(f.default),this.lOwnItems=K.DataPool.ins().getLocal(g.default)},e.initLogicManager=function(){this.redMgr=l.RedPointLogicMgr.ins(),this.guideMgr=ot.GuideLogic.ins(),this.userMgr=st.default.ins(),this.heroMgr=it.HeroMgr.ins(),this.itemMgr=nt.default.ins,this.sdkMgr=at.default.ins,this.mapMgr=rt.default.ins},e.initSimulator=function(){this.jumpToMgr=Y.default.ins},e.prototype.initReConnectEvent=function(){},e.prototype.initGame=function(){z.GCtrl.ES.on(z.GCtrl.GTimerSecondEventMsg,this,this.onTimeCalculat.bind(this)),z.GCtrl.now,this._timeCounters=[{delta:0,checkTime:h.CHECK_TIME.TIME_CLOCK_CHECK,outTimeHandler:e.redMgr.timingCheck.bind(e.redMgr)}],c.default.ins().start(),e.jumpToMgr.initGame(),e.sdkMgr.initGame(),e.guideMgr.initGame(),e.redMgr.initGame()},e.prototype.onReconnect=function(){},e.clearRunTime=function(){K.DataPool.ins().clearRunTimes()},e.clearLoacalData=function(){K.DataPool.ins().clearLocals()},e.prototype.restart=function(){for(var t in z.GCtrl.ES.off(this),z.GCtrl.ES.off(this),e.jumpToMgr.loginOut(),e.sdkMgr.loginOut(),e.guideMgr.loginOut(),e.redMgr.loginOut(),r.JXDef.LOCAL_KEY)cc.sys.localStorage.removeItem(r.JXDef.LOCAL_KEY[t]);e.clearRunTime(),e.clearLoacalData();var o=e.uiMgr.uiRoot.parent.getChildByName("GudieRoot");o&&o.destroy();var i=e.uiMgr.uiRoot.getChildByName("TopUiItem");i&&i.destroy(),u.UIMgr.removeAllActiveWin(),u.UIMgr.showWin(p.VIEW_ID.load,h.LoadingType.AppStart)},e.prototype.onTimeCalculat=function(){this._timeCounters.forEach(function(t){return t.delta+=z.GCtrl.deltaSecondTime}),this._timeIndex=this._timeIndex||0,this._timeIndex>=this._timeCounters.length&&(this._lastEndTaskId=null,this.lastEndArmyTaskId=null,this._timeIndex=0);var t=this._timeCounters[this._timeIndex];t.delta>=t.checkTime&&(t.outTimeHandler(t.delta),t.delta=0),this._timeIndex++},e.rHeroData=null,e.rUserData=null,e.vipData=null,e.mapData=null,e.mapStyle=null,e.onLineAwardData=null,e.noticeData=null,e.suitData=null,e.equipData=null,e.action=null,e.actionCollision=null,e.buffData=null,e.bullet=null,e.dialData=null,e.effectAnim=null,e.heroData=null,e.itemData=null,e.npcTeamData=null,e.signInData=null,e.skillEffect=null,e.storyData=null,e.unitData=null,e.skillData=null,e.systemConfig=null,e.officerData=null,e.scopeData=null,e.lvData=null,e.lvUpData=null,e.starLvData=null,e.towerData=null,e.guideChainData=null,e.guideStepData=null,e.heroTryData=null,e.callData=null,e.addDialData=null,e.dailyTaskData=null,e.lUserData=null,e.lHeroData=null,e.guideMgr=null,e.jumpToMgr=null,e.sdkMgr=null,e.mapMgr=null,e.userMgr=null,e.heroMgr=null,e.itemMgr=null,e.uiMgr=u.UIMgr,e.redMgr=null,e}(s.ObjectWrap);o.default=ct,cc._RF.pop()},{"../../Core/CoreDefine":"CoreDefine","../../Core/FrameEx/ES5Ex":"ES5Ex","../../Core/Manager/GTimerMgr":"GTimerMgr","../../Core/Manager/RedPointLogicMgr":"RedPointLogicMgr","../../Core/Manager/UIMgr":"UIMgr","../../conventions/JXCommon":"JXCommon","../Common/Define":"Define","../Common/UI":"UI","../Data/Locals/LHeroData":"LHeroData","../Data/Locals/LOwnEquips":"LOwnEquips","../Data/Locals/LOwnItems":"LOwnItems","../Data/Locals/LUserData":"LUserData","../Data/RunTime/RBagData":"RBagData","../Data/RunTime/RUserData":"RUserData","../Data/Static/SAction":"SAction","../Data/Static/SActionCollision":"SActionCollision","../Data/Static/SAddDialData":"SAddDialData","../Data/Static/SBuffData":"SBuffData","../Data/Static/SCallData":"SCallData","../Data/Static/SDailyTaskData":"SDailyTaskData","../Data/Static/SDialData":"SDialData","../Data/Static/SEffectAnim":"SEffectAnim","../Data/Static/SEquipData":"SEquipData","../Data/Static/SGuideChainData":"SGuideChainData","../Data/Static/SGuideStepData":"SGuideStepData","../Data/Static/SHeroData":"SHeroData","../Data/Static/SHeroTryData":"SHeroTryData","../Data/Static/SItemData":"SItemData","../Data/Static/SLvData":"SLvData","../Data/Static/SNoticeData":"SNoticeData","../Data/Static/SNpcTeamData":"SNpcTeamData","../Data/Static/SOfficerData":"SOfficerData","../Data/Static/SOnLineAwardData":"SOnLineAwardData","../Data/Static/SScopeData":"SScopeData","../Data/Static/SSignInData":"SSignInData","../Data/Static/SSkillData":"SSkillData","../Data/Static/SSkillEffect":"SSkillEffect","../Data/Static/SStarLvData":"SStarLvData","../Data/Static/SStoryData":"SStoryData","../Data/Static/SSuitData":"SSuitData","../Data/Static/STowerData":"STowerData","../Data/Static/SUnitData":"SUnitData","../Data/Static/SVipData":"SVipData","../Views/ViewUtil/JumpUtil":"JumpUtil","./../../Core/GCtrl":"GCtrl","./../../Core/Manager/DataPool":"DataPool","./../Data/RunTime/RHeroData":"RHeroData","./../Data/Static/SLvUpData":"SLvUpData","./../Data/Static/SMapData":"SMapData","./../Data/Static/SMapStyleData":"SMapStyleData","./../Data/Static/SSystemConfig":"SSystemConfig","./../Guide/GuideLogic":"GuideLogic","./HeroMgr":"HeroMgr","./ItemMgr":"ItemMgr","./MapMgr":"MapMgr","./SdkMgr":"SdkMgr","./UserMgr":"UserMgr"}],GuessResultView:[function(t,e,o){"use strict";cc._RF.push(e,"97af7X4yiJD24A2RypoLXgR","GuessResultView");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../Logic/GameMgr"),c=t("./RewardCrtl"),l=cc._decorator,u=l.ccclass,h=l.property,p=l.menu,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.guesslayout=null,e.result_sk=null,e.guessSprite=[],e.guessItem1=null,e.guessItem2=null,e}return n(e,t),e.prototype.onGStart=function(e,o,i,n){t.prototype.onGStart.call(this,e);var r=s.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.stoneDraw);o==r[0]?this.result_sk.animation="1":o==r[1]?this.result_sk.animation="2":o==r[2]&&(this.result_sk.animation="3"),this.guessItem1.spriteFrame=this.guessSprite[parseInt(i)],this.guessItem2.spriteFrame=this.guessSprite[parseInt(n)]},r([h({type:cc.Node})],e.prototype,"guesslayout",void 0),r([h({type:sp.Skeleton})],e.prototype,"result_sk",void 0),r([h(cc.SpriteFrame)],e.prototype,"guessSprite",void 0),r([h(cc.Sprite)],e.prototype,"guessItem1",void 0),r([h(cc.Sprite)],e.prototype,"guessItem2",void 0),r([u,p("View/Tip/GuessResultView")],e)}(c.default);o.default=d,cc._RF.pop()},{"../../../conventions/JXCommon":"JXCommon","../../Logic/GameMgr":"GameMgr","./RewardCrtl":"RewardCrtl"}],GuessView:[function(t,e,o){"use strict";cc._RF.push(e,"1b10aMt6zpHzL7SUyWp9clX","GuessView");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GView/GViewBase"),s=t("../../../Core/GCtrl"),c=t("../../../conventions/JXCommon"),l=t("../../Logic/GameMgr"),u=t("../../Common/UI"),h=t("../Hero/HeroChange"),p=t("../../Data/RunTime/RunRaw/RJXItem"),d=t("../../Common/Define"),f=t("../Common/TopUiItem"),g=t("../../Guide/GuideLogic"),_=cc._decorator,m=_.ccclass,y=_.property,v=_.menu,C=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemLayer=null,e.guessLayer=null,e.infoLabel=null,e.tipLabel=null,e.selectBetNode=null,e.selectGuessNode=null,e.armNodeGuess=null,e.guessLinde=null,e.guessMask=null,e.heroNode=null,e.armNode=null,e.items=[],e.guessItems=[],e.topUiItem=null,e.sk_hero=null,e.guessSprite=[],e._curSelectGuess=-1,e._curSelectBet=-1,e._guessStep=0,e._heroId=1001,e._armId=1002,e._isGuide=!1,e._allBet={},e._index=0,e._dtTime=0,e._isStartRun=!1,e}return n(e,t),e.prototype.onGStart=function(){this.infoLabel.string="\u80dc\u3001\u5e73\u3001\u8d1f\u5206\u522b\u83b7\u5f972.5\u30011.5\u30010.5\u500d\u5956\u52b1  \n \uff08\u5305\u62ec\u4e0b\u6ce8\u91d1\u989d\uff09";var t=l.default.systemConfig.value(c.JXDef.SYS_CONFIG_KEY.stone1);this._allBet=t;for(var e=0;e<6;e++)t[e]&&this.items[e]&&(this.items[e].getChildByName("Label").getComponent(cc.Label).string=""+t[e][2],this.items[e].getChildByName("gou").active=!1);this.armNodeGuess.active=!1,this.armNode.color=cc.color(100,100,100,255),this.topUiItem.getComponent(f.default).initPositiony();for(var o=["tou","wuqi"],i=["tou1","wuqi1"],n=0;n<o.length;n++)try{var r=i[n];r?this.sk_hero.setAttachment(o[n],r):this.sk_hero.findSlot(o[n]).setAttachment(null)}catch(a){console.error(a)}this._isGuide=g.GuideLogic.ins().isGuidding()},e.prototype.initGuess=function(){this.guessMask.active=!1,this.itemLayer.active=!0,this.selectBetNode.removeAllChildren(),this.guessLayer.active=!0,this.armNodeGuess.active=!1;var t=this.selectGuessNode.getChildByName("selectGuess");if(t&&t.removeFromParent(),this._guessStep=0,this._index=0,this._dtTime=0,this._isStartRun=!1,this._curSelectGuess=-1,this.heroNode.x=-633,this.armNode.x=633,this.tipLabel.node.active=!0,this.guessLinde.active=!0,this.tipLabel.string="\u9ed8\u8ba4\u4e0a\u6b21\u9009\u62e9\u91d1\u989d\uff0c\u53ef\u91cd\u65b0\u9009\u62e9",this._curSelectBet>-1)for(var e=0;e<6;e++)this.items[e]&&(this.items[e].getChildByName("gou").active=this._curSelectBet==e)},e.prototype.onViewClose=function(){this.onClose()},e.prototype.onGDestroy=function(){s.GCtrl.ES.off(this)},e.prototype.onResLoaded=function(){},e.prototype.onSelectBet=function(t,e){if(this._curSelectBet==e&&this.selectBetNode.childrenCount>0){this.itemLayer.active=!0,this.selectBetNode.removeAllChildren(),this._curSelectBet=-1;for(var o=0;o<6;o++)this.items[o]&&(this.items[o].getChildByName("gou").active=this._curSelectBet==o);return this.guessMask.active=!0,void(this.tipLabel.string="\u8bf7\u9009\u62e9\u4e0b\u6ce8\u91d1\u989d")}this._curSelectBet=e,console.log("select bet = ",e),this.itemLayer.active=!1;var i=cc.instantiate(this.items[this._curSelectBet]);i.getChildByName("gou").active=!1,this.selectBetNode.addChild(i),cc.tween(i).to(.5,{x:0,y:20}).start(),this._guessStep=1,this.guessMask.active=!1,this.tipLabel.string="\u8bf7\u731c\u62f3"},e.prototype.onSelectBtn=function(t,e){if(!(this._curSelectGuess>=0)){var o=new p.default([this._allBet[this._curSelectBet][0],d.ITEM_TYPE.CURRENCY,this._allBet[this._curSelectBet][2]]);if(l.default.itemMgr.testCost(o,1,!0).enough){if(s.GCtrl.ES.emit(d.CMsg.client.bag.onBagItemChange,[[this._allBet[this._curSelectBet][0],this._allBet[this._curSelectBet][1],0-this._allBet[this._curSelectBet][2]]]),this.itemLayer.active){this.itemLayer.active=!1;var i=cc.instantiate(this.items[this._curSelectBet]);this.selectBetNode.addChild(i),cc.tween(i).to(.5,{x:0,y:20}).start(),this._guessStep=1}this._curSelectGuess=e,console.log("\u6211\u65b9\uff1a",["\u77f3\u5934","\u526a\u5200","\u5e03"][this._curSelectGuess]),this.guessLayer.active=!1;var n=cc.instantiate(this.guessItems[this._curSelectGuess]);n.name="selectGuess",this.selectGuessNode.addChild(n),this._guessStep=2,this.tipLabel.node.active=!1,this.guessLinde.active=!1,cc.tween(n).to(.6,{x:-176,y:766}).call(function(){this._isStartRun=!0,this.armNodeGuess.active=!0},this).start();var r=l.default.rHeroData.getHaveHeros(0).have;this._heroId=r[Math.floor(Math.random()*r.length)].tableId,this._armId=Math.floor(29*Math.random())+1001,this.initHeroChange(this.heroNode,this._heroId,!0),this.initHeroChange(this.armNode,this._armId,!1);var a=l.default.heroData.getRaw(this._heroId),c=l.default.heroData.getRaw(this._armId);cc.tween(this.heroNode).to(.6,{x:-120}).call(function(){this.heroNode.getComponent(sp.Skeleton).setAnimation(0,a.ani[1],!0),this.armNode.getComponent(sp.Skeleton).setAnimation(0,c.ani[1],!0)},this).start(),cc.tween(this.armNode).to(.6,{x:120}).start()}else l.default.uiMgr.showToast("\u8d27\u5e01\u4e0d\u8db3")}},e.prototype.initHeroChange=function(t,e,o,i){void 0===i&&(i=0);var n=t.getComponent(h.default);n.changeSpine(e,!0,i);var r=l.default.heroData.getRaw(e);n.node.scaleX=o?0-r.roleScale:r.roleScale,n.node.scaleY=r.roleScale},e.prototype.update=function(t){this._isStartRun&&(this._dtTime+=t,this._dtTime>.1&&(this._dtTime=0,this.armNodeGuess.getChildByName("icon").getComponent(cc.Sprite).spriteFrame=this.guessSprite[this._index%3],this._index++,this._index>20&&(this._isStartRun=!1,this.openResult())))},e.prototype.openResult=function(){var t=this._isGuide?1:Math.floor(3*Math.random());this._isGuide=!1,this.armNodeGuess.getChildByName("icon").getComponent(cc.Sprite).spriteFrame=this.guessSprite[t];var e=l.default.systemConfig.value(c.JXDef.SYS_CONFIG_KEY.stoneDraw),o=1;this._curSelectGuess-t==-1||this._curSelectGuess-t==2?(o=e[0],cc.tween(this.armNode).to(.6,{x:633}).start()):this._curSelectGuess==t?(o=e[1],cc.tween(this.armNode).to(.6,{x:633}).start(),cc.tween(this.heroNode).to(.6,{x:-633}).start()):(o=e[2],cc.tween(this.heroNode).to(.6,{x:-633}).start());var i=l.default.heroData.getRaw(this._heroId),n=l.default.heroData.getRaw(this._armId);this.heroNode.getComponent(sp.Skeleton).setAnimation(0,i.ani[0],!0),this.armNode.getComponent(sp.Skeleton).setAnimation(0,n.ani[0],!0),this.scheduleOnce(function(){l.default.jumpToMgr.jumpGoTo(u.VIEW_ID.guessResultView,[[this._allBet[this._curSelectBet][0],this._allBet[this._curSelectBet][1],this._allBet[this._curSelectBet][2]*o]],o,this._curSelectGuess,t),this.initGuess()},1)},r([y(cc.Node)],e.prototype,"itemLayer",void 0),r([y(cc.Node)],e.prototype,"guessLayer",void 0),r([y(cc.Label)],e.prototype,"infoLabel",void 0),r([y(cc.Label)],e.prototype,"tipLabel",void 0),r([y(cc.Node)],e.prototype,"selectBetNode",void 0),r([y(cc.Node)],e.prototype,"selectGuessNode",void 0),r([y(cc.Node)],e.prototype,"armNodeGuess",void 0),r([y(cc.Node)],e.prototype,"guessLinde",void 0),r([y(cc.Node)],e.prototype,"guessMask",void 0),r([y(cc.Node)],e.prototype,"heroNode",void 0),r([y(cc.Node)],e.prototype,"armNode",void 0),r([y(cc.Node)],e.prototype,"items",void 0),r([y(cc.Node)],e.prototype,"guessItems",void 0),r([y(cc.Node)],e.prototype,"topUiItem",void 0),r([y(sp.Skeleton)],e.prototype,"sk_hero",void 0),r([y(cc.SpriteFrame)],e.prototype,"guessSprite",void 0),r([m,v("View/Fight/GuessView")],e)}(a.default);o.default=C,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../../Core/GView/GViewBase":"GViewBase","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/UI":"UI","../../Data/RunTime/RunRaw/RJXItem":"RJXItem","../../Guide/GuideLogic":"GuideLogic","../../Logic/GameMgr":"GameMgr","../Common/TopUiItem":"TopUiItem","../Hero/HeroChange":"HeroChange"}],GuideComponent:[function(t,e,o){"use strict";cc._RF.push(e,"1e4b3mFCHlPFp5Ep/zRa+H5","GuideComponent");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../Core/CoreDefine"),s=t("../../Core/FrameEx/GComponent"),c=t("../../Core/FrameEx/GDrag"),l=t("../../Core/FrameEx/GLongTouch"),u=t("../../Core/GLoader/GLoader"),h=t("../../Core/GView/IrregularTrigger"),p=t("../../Core/Manager/AudioMgr"),d=t("../Common/UIResources"),f=t("./../../Core/GCtrl"),g=t("./GuideLogic"),_=cc._decorator,m=_.ccclass,y=_.property,v=_.menu,C=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.chipNode=null,e.teachNode=null,e.touchNode=null,e.text=null,e.talkNode=null,e.maskShader=null,e._handSk=null,e._jiantouNode=null,e._handlerMoveEnd=!1,e.nextCallBack=null,e._configure=null,e._target=null,e._touchStart=!1,e._inMove=!1,e._waitLoadTimes=0,e._fixPoint=null,e._startPoint=null,e}return n(e,t),e.prototype.onLoad=function(){this.touchNode.on(cc.Node.EventType.TOUCH_START,this.onMaskTouchStart,this),this.touchNode.on(cc.Node.EventType.TOUCH_MOVE,this.onMaskTouchMove,this),this.touchNode.on(cc.Node.EventType.TOUCH_END,this.onMaskTouchEnd,this),this.touchNode.on(cc.Node.EventType.TOUCH_CANCEL,this.onMaskTouchCancel,this)},e.prototype.onDestroy=function(){this.touchNode.targetOff(this.touchNode)},e.prototype.setTarget=function(t){if(cc.isValid(t)){var e,o;if(this._target=t,this._configure.type==g.GuidType.Drag){var i=t.getComponent(c.default);if(!i)return;var n=i.dragNodes[this._configure.drags[0]],r=i.targetNodes[this._configure.drags[1]];if(!n||!r)return;var a=cc.v2(n.width*(.5-n.anchorX),n.height*(.5-n.anchorY)),s=o=n.convertToWorldSpaceAR(a);e=this.node.convertToNodeSpaceAR(s),this._configure.offset.length>0&&(e.x+=this._configure.offset[0],e.y+=this._configure.offset[1],o.x+=this._configure.offset[0],o.y+=this._configure.offset[1]);var l=cc.v2(r.width*(.5-r.anchorX),r.height*(.5-r.anchorY)),u=r.convertToWorldSpaceAR(l);this.displayMoveAnimation(e,this.maskShader.convertToNodeSpaceAR(u))}else if(this._configure.type==g.GuidType.ListItemClick){var h=t._list,p=null;if(r=null,h){if(!(p=h._items[this._configure.listIndex])||!p.node)return;r=p.node}else r=t;a=cc.v2(r.width*(.5-r.anchorX),r.height*(.5-r.anchorY)),s=o=r.convertToWorldSpaceAR(a),e=this.node.convertToNodeSpaceAR(s),this._configure.offset.length>0&&(e.x+=this._configure.offset[0],e.y+=this._configure.offset[1],o.x+=this._configure.offset[0],o.y+=this._configure.offset[1]),this._target=r}else if(this._configure.type==g.GuidType.NodeMove){a=cc.v2(t.width*(.5-t.anchorX),t.height*(.5-t.anchorY)),s=t.convertToWorldSpaceAR(a),e=this.node.convertToNodeSpaceAR(s),this._configure.offset.length>0&&(e.x+=this._configure.offset[0],e.y+=this._configure.offset[1],o.x+=this._configure.offset[0],o.y+=this._configure.offset[1]);var f=cc.v2(this._configure.drags[1],this._configure.drags[3]);(f=cc.v2(e.x+f.x,e.y+f.y)).addSelf(cc.v2(t.width*(.5-t.anchorX),t.height*(.5-t.anchorY))),this._configure.fixed&&!this._fixPoint&&(this._fixPoint=f),this._configure.fixed&&this._fixPoint?this.displayMoveAnimation(e,this._fixPoint):this.displayMoveAnimation(e,f)}else a=cc.v2(t.width*(.5-t.anchorX),t.height*(.5-t.anchorY)),d.Res.positionOffset[this._configure.path]&&a.addSelf(d.Res.positionOffset[this._configure.path]),s=o=t.convertToWorldSpaceAR(a),e=this.node.convertToNodeSpaceAR(s),this._configure.offset&&this._configure.offset.length>0&&(e.x+=this._configure.offset[0],e.y+=this._configure.offset[1],o.x+=this._configure.offset[0],o.y+=this._configure.offset[1]);if(this._configure.type!=g.GuidType.Drag&&this._configure.type!=g.GuidType.NodeMove){this._handSk||this.displayClickAnimation();var _=cc.Vec2.ZERO;this._configure.aniOffset.length>0&&(_=cc.v2(this._configure.aniOffset[0],this._configure.aniOffset[1])),this._configure.aniRotate&&(this._handSk.angle=-this._configure.aniRotate);var m=e.add(_),y=this._target.getComponent(cc.Sprite);y||(y=this._target.getChildComByName("Background",cc.Sprite)),(v=this.maskShader.getComponent(cc.Mask)).node.width!=this._target.width&&v.node.width!=this.talkNode.height&&(y&&y.spriteFrame?(v.type=cc.Mask.Type.IMAGE_STENCIL,v.spriteFrame=y.spriteFrame,v.alphaThreshold=0):v.type=cc.Mask.Type.RECT,v.node.width=this._target.width,v.node.height=this._target.height),this.maskShader.position=m,this._handSk.position=cc.v2(m.x,m.y)}else if(this._configure.type===g.GuidType.NodeMove)f=null,this._configure.fixed&&this._fixPoint?f=this._fixPoint:(f=cc.v2(this._configure.drags[1],this._configure.drags[3]),(f=cc.v2(e.x+f.x,e.y+f.y)).addSelf(cc.v2(t.width*(.5-t.anchorX),t.height*(.5-t.anchorY)))),(v=this.maskShader.getComponent(cc.Mask)).type=cc.Mask.Type.RECT,v.node.width=2*Math.abs(this._configure.drags[0]),v.node.height=2*Math.abs(this._configure.drags[2]),this.maskShader.position=f;else{var v;(v=this.maskShader.getComponent(cc.Mask)).node.width=0,v.node.height=0,this.maskShader.position=cc.v2(0)}}},e.prototype.setConfigure=function(t){this._configure=t,this._configure&&(this._configure.type,g.GuidType.Dialog),this.maskShader.setContentSize(f.GCtrl.winSize),this._waitLoadTimes=0},e.prototype.showMessage=function(t){t||this._configure.msgkey?(this.showMask(),this.talkNode.active=!0,this.talkNode.position=cc.v2(this._configure.talkPos[0],this._configure.talkPos[1]),this.text.string="   <color=#5B4848>"+this._configure.msgkey+"<color=#00ff00>  "):this.talkNode.active=!1},e.prototype.hidMask=function(){this.chipNode.active=!1},e.prototype.showMask=function(t){void 0===t&&(t=0),this.chipNode.active=!0},e.prototype.onMaskTouchStart=function(t){if(!this._inMove&&null!=this._configure){var e=this.chipNode.convertToNodeSpaceAR(t.getLocation());if(this._startPoint=t.getLocation(),!(e.x<-this.chipNode.width/2||e.x>this.chipNode.width/2||e.y<-this.chipNode.height/2||e.y>this.chipNode.height/2)&&this._target)if(this._touchStart=!0,this._configure.type==g.GuidType.Slide){var o=this._target.getComponent(cc.Slider);o&&o._onTouchBegan(t)}else if(this._configure.type==g.GuidType.Drag){var i=this._target.getComponent(c.default);i&&i._onTouchStart(t)}else if(this._configure.type==g.GuidType.ListItemClick){var n=this._target.parent.parent.parent._list;if(n){if(!n._items[this._configure.listIndex])return void(this._touchStart=!1);n&&n.onTouchStart(t)}}else this._configure.type==g.GuidType.NodeMove&&this._target&&this._target.emit(cc.Node.EventType.TOUCH_START,t)}},e.prototype.onMaskTouchMove=function(t){if(this._touchStart&&this._configure)if(this._configure.type==g.GuidType.Slide){var e=this._target.getComponent(cc.Slider);e&&e._onTouchMoved(t)}else if(this._configure.type==g.GuidType.Drag){var o=this._target.getComponent(c.default);o&&o._onTouchMove(t)}else if(this._configure.type==g.GuidType.ListItemClick){var i=this._target.parent.parent.parent._list;i&&i.onTouchMove(t)}else this._configure.type==g.GuidType.NodeMove&&this._target&&this._target.emit(cc.Node.EventType.TOUCH_MOVE,t)},e.prototype.onMaskTouchEnd=function(t){if(null!=this._configure)if(this._configure.type!=g.GuidType.Dialog){if(this._touchStart){if(this._touchStart=!1,this._configure.type==g.GuidType.Slide)return this.next();if(this._configure.type!=g.GuidType.Drag)if(this._configure.type!=g.GuidType.ListItemClick)if(this._configure.type!=g.GuidType.NodeMove){var e=this.chipNode.convertToNodeSpaceAR(t.getLocation());if(e.x<-this.chipNode.width/2||e.x>this.chipNode.width/2||e.y<-this.chipNode.height/2||e.y>this.chipNode.height/2)this._touchStart=!1;else if(this._target){var o=cc.v2(this._target.width*(.5-this._target.anchorX),this._target.height*(.5-this._target.anchorY)),i=this._target.convertToWorldSpaceAR(o);if(!cc.rect(i.x-this._target.width/2,i.y-this._target.height/2,this._target.width,this._target.height).contains(t.getLocation()))return console.log(" ---------- \u6ca1\u70b9\u5230\u4f4d\u7f6e"),void(this._touchStart=!1);t.target=this._target;var n=this._target.getComponent(cc.Toggle);if(n)return p.AudioMgr.Ins().playEffect(n.clickAudio||cc.Button.comAudio),cc.Component.EventHandler.emitEvents(n.checkEvents,n),this._target&&this._target.emit("toggle",n),this._target&&this._target.emit("click",n),n.check(),void this.next();var r=this._target.getComponent(l.default);if(r)return this.next(),p.AudioMgr.Ins().playEffect(cc.Button.comAudio),void r.emitLongTouchEvent();var a=this._target.getComponent(cc.Button);if(a&&a.enabled&&a.interactable)return this.next(),p.AudioMgr.Ins().playEffect(a.clickAudio||cc.Button.comAudio),cc.Component.EventHandler.emitEvents(a.clickEvents,t),void(this._target&&this._target.emit("click",this));var s=this._target.getComponent(h.default);s?(this.next(),p.AudioMgr.Ins().playEffect(cc.Button.comAudio),cc.Component.EventHandler.emitEvents(s.events,t)):(this._target&&this._target.emit(cc.Node.EventType.TOUCH_END,this),this.next())}}else this.onNodeMoveEnd(t);else{var u=this._target.parent.parent.parent._list;if(u)this.onListViewTouchEnd(u,t);else{var d=this._target.getComponent(this._target.name);this.next(),d._onTouchEnd(t)}}else{var f=this._target.getComponent(c.default);f&&this.onGragTouchEnd(f,t)}}}else this.next()},e.prototype.onMaskTouchCancel=function(t){if(this._touchStart=!1,null!=this._configure)if(this._configure.type==g.GuidType.Slide)this._target.getComponent(cc.Slider)&&this.next();else{if(this._configure.type==g.GuidType.Drag){var e=this._target.getComponent(c.default);return void(e&&this.onGragTouchEnd(e,t))}if(this._configure.type==g.GuidType.ListItemClick){var o=this._target.parent.parent.parent._list;return void(o&&this.onListViewTouchEnd(o,t))}this._configure.type==g.GuidType.NodeMove&&this.onNodeMoveEnd(t)}},e.prototype.onGragTouchEnd=function(t,e){var o=!1;if(t._touchMove){var i=t._lastTargetNode,n=t._curSelectDragNode,r=t.targetNodes.indexOf(i);t.dragNodes.indexOf(n)==this._configure.drags[0]&&r==this._configure.drags[1]&&(o=!0)}o?(this.next(),t._onTouchEnd(e)):t.resetTouchEvent()},e.prototype.onListViewTouchEnd=function(t,e){var o=!1;this._configure.type==g.GuidType.ListItemClick&&(t._childLongTouchTimes>0||!t._isTouchPress||!t._touchChildNode?o=!1:parseInt(t._touchChildNode.name.replace("item_",""))!=this._configure.listIndex?o=!1:(o=!0,p.AudioMgr.Ins().playEffect(cc.Button.comAudio))),o?(this.next(),t.onToucEnd(e)):t.cancelTouchEvent()},e.prototype.onNodeMoveEnd=function(t){var e=cc.v2(this._configure.drags[1],this._configure.drags[3]);if(this._configure.fixed&&this._fixPoint)e=this._fixPoint;else{var o=cc.v2(this._target.width*(.5-this._target.anchorX),this._target.height*(.5-this._target.anchorY)),i=this._target.convertToWorldSpaceAR(o),n=this.node.convertToNodeSpaceAR(i);(e=cc.v2(n.x+e.x,n.y+e.y)).addSelf(cc.v2(this._target.width*(.5-this._target.anchorX),this._target.height*(.5-this._target.anchorY)))}var r=t.getLocation();if(this._startPoint){var a=this.node.convertToNodeSpaceAR(this._startPoint),s=Math.abs(Math.abs(a.x)-Math.abs(e.x)),c=Math.abs(Math.abs(a.y)-Math.abs(e.y));if(s<this._configure.drags[0]&&c<this._configure.drags[2])return void(this._target&&this._target.emit(cc.Node.EventType.TOUCH_CANCEL,t))}var l=this.node.convertToNodeSpaceAR(r),u=Math.abs(Math.abs(l.x)-Math.abs(e.x)),h=Math.abs(Math.abs(l.y)-Math.abs(e.y));u<this._configure.drags[0]&&h<this._configure.drags[2]?(this._target&&this._target.emit(cc.Node.EventType.TOUCH_END,t),this.next()):this._target&&this._target.emit(cc.Node.EventType.TOUCH_CANCEL,t)},e.prototype.posCompare=function(t,e,o){if(!t||"null"==t)return!0;if(">"==t)return o>=e;if("<"==t)return o<=e;if(t){var i=Number(t);return Math.abs(e-o)<i}},e.prototype.next=function(){this._target=null;var t=this._configure.time;this.talkNode.active=!1,this._configure=null,this._waitLoadTimes=a.INVALID_VALUE,this._handSk&&(this._handSk.destroy(),this._handSk=null),this._jiantouNode&&(this._jiantouNode.destroy(),this._jiantouNode=null),this._fixPoint&&(this._fixPoint=null),this._handlerMoveEnd=!1,this.hidMask(),this.nextCallBack&&this.nextCallBack(t||0)},e.prototype.update=function(){if(this._configure){if(this._waitLoadTimes>a.INVALID_VALUE){if(u.GAssetImpl.isLoading())return;if(this._waitLoadTimes++,10!=this._waitLoadTimes)return;this._waitLoadTimes=a.INVALID_VALUE,this._configure.path&&"null"!=this._configure.path||this.showMessage()}if(this._configure.path&&"null"!=this._configure.path)if(this._target)this.setTarget(this._target);else{var t=cc.find(this._configure.path);t&&t.active?(this._configure.time>0?cc.tween(this.node).set({x:-1e4}).delay(this._configure.time/1e3).set({x:0}).start():this.node.x=0,this.showMask(this._configure.time),this.setTarget(t),this.showMessage()):this.node.x=-1e4}}},e.prototype.cteateTextureNode=function(){var t=new cc.Node("texuture_node"),e=new cc.Node("jiantou");e.y=41.9,e.angle=-180;var o=new cc.Node("wenzi");o.y=83.2;var i=e.addComponent(cc.Sprite);this.assetImpl.spriteFrame(i,"Views/Guide/5"),o.addComponent(cc.Sprite),e.parent=t,o.parent=t,t.parent=this.node},e.prototype.setTexture=function(){},e.prototype.displayClickAnimation=function(){if(!this._handSk){var t=new cc.Node("hand");t.parent=this.node,t.setContentSize(100.8,100.6),this._handSk=t}var e=this;u.GLoader.spine("dragon/yd",function(t){var o=new cc.Node;o.y=12.5,o.setAnchorPoint(cc.v2(.5,.5));var i=o.addComponent(sp.Skeleton);i.skeletonData=t,i.premultipliedAlpha=!1,e._handSk.addChild(o),o.scale=1,i.setAnimation(0,"animation",!0)})},e.prototype.displayMoveAnimation=function(){},r([y(cc.Node)],e.prototype,"chipNode",void 0),r([y(cc.Node)],e.prototype,"teachNode",void 0),r([y(cc.Node)],e.prototype,"touchNode",void 0),r([y(cc.RichText)],e.prototype,"text",void 0),r([y(cc.Node)],e.prototype,"talkNode",void 0),r([y(cc.Node)],e.prototype,"maskShader",void 0),r([m,v("View/Guide/GuideCtrl")],e)}(s.default);o.default=C,cc._RF.pop()},{"../../Core/CoreDefine":"CoreDefine","../../Core/FrameEx/GComponent":"GComponent","../../Core/FrameEx/GDrag":"GDrag","../../Core/FrameEx/GLongTouch":"GLongTouch","../../Core/GLoader/GLoader":"GLoader","../../Core/GView/IrregularTrigger":"IrregularTrigger","../../Core/Manager/AudioMgr":"AudioMgr","../Common/UIResources":"UIResources","./../../Core/GCtrl":"GCtrl","./GuideLogic":"GuideLogic"}],GuideLogic:[function(t,e,o){"use strict";cc._RF.push(e,"3d3a61E3jpIAq7xT4SNxl0E","GuideLogic");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.GuideLogic=o.GuidType=void 0;var r=t("../../Core/CoreDefine"),a=t("../../Core/FrameEx/ES5Ex"),s=t("../../Core/GLoader/GLoader"),c=t("../../tyqSDK/tyqSDK"),l=t("../Common/UIAction"),u=t("../Common/UIResources"),h=t("../Logic/GameMgr"),p=t("./../../Core/GCtrl"),d=t("./../Common/Define"),f=t("./../Logic/ConditionListener"),g=t("./GuideComponent");(function(t){t[t.Dialog=0]="Dialog",t[t.JiaoXue=1]="JiaoXue",t[t.Click=2]="Click",t[t.Slide=3]="Slide",t[t.Drag=4]="Drag",t[t.ListItemClick=5]="ListItemClick",t[t.NodeMove=6]="NodeMove",t[t.SCrollViewClick=7]="SCrollViewClick",t[t.TeachPrefab=8]="TeachPrefab"})(o.GuidType||(o.GuidType={}));var _=function(t){function e(e,o){var i=t.call(this)||this;return i.guideId=e.guideId,i.viewId=e.viewId,i.closeId=e.closeId,i._logic=o,i.inited(),1==i._curState&&i.emitConditionEnvChange(null),i}return n(e,t),e.prototype.emitConditionEnvChange=function(){},e}(f.ConditionListter),m=function(t){function e(){var e=t.call(this)||this;return e._guide=null,e._step=0,e._guidId=null,e._curAudioId=r.INVALID_VALUE,e._param=null,e._unForcesGuide=new a.SetWrap,e._guideTriggers=[],e._unForceGuideCheckTime=0,p.GCtrl.ES.on(p.GCtrl.GClientWinOpenEventAfterMsg,e,e.onWinOpen.bind(e),r.PRIORITY_DATA),p.GCtrl.ES.on(p.GCtrl.GClientWinDestroyEventMsg,e,e.onWinClose.bind(e),r.PRIORITY_DATA),p.GCtrl.ES.on(d.CMsg.data.onGuideEvent,e,e.onCMSGGuideEvent.bind(e),r.PRIORITY_DATA),p.GCtrl.ES.on(d.CMsg.data.setGuide,e,e._onRPCSetGuide.bind(e),r.PRIORITY_VIEW),e._logicApl||(e._logicApl=s.GAssetImpl.getAssetImpl(cc.js.getClassName(e))),e}return n(e,t),e.ins=function(){return this._ins||(this._ins=new e),this._ins},e.prototype.onWinOpen=function(t,e){this.startGuideLine(e,!1)},e.prototype.onWinClose=function(t,e){this.startGuideLine(e.winId,!0)},e.prototype.isGuidding=function(){return 1==c.tyqSDK.getSwitchValue("tyq_openHero")&&(this.isForceGuidding()||this.isUnforceGuide())},e.prototype.isForceGuidding=function(){return null!=this._guidId},e.prototype.isUnforceGuide=function(t){return t?this._unForcesGuide.has(t):this._unForcesGuide.size>0},e.prototype.initGame=function(){this.initForceGuide()},e.prototype.initForceGuide=function(){var t=h.default.guideChainData.data.values();this._guideTriggers=[];for(var e=0;e<t.length;e++){var o=t[e];if(!h.default.lUserData.isGuidseExits(o.guideId)){var i=new _(o,this);i.getInitedState()&&this._guideTriggers.push(i)}}},e.prototype.startGuideLine=function(t,e){for(var o=0;o<this._guideTriggers.length;o++){var i=this._guideTriggers[o],n=i.guideId-1,r=!0;n>0&&(r=h.default.lUserData.isGuidseExits(n)),r&&(i.viewId!==t||e?i.closeId===t&&e&&(console.log(t+"\u7a97\u53e3\u5173\u95ed\uff0cid:"+i.guideId+"\u5f15\u5bfc\u89e6\u53d1}"),this._onGuideTriggerOn(i.guideId)):(console.log(t+"\u7a97\u53e3\u5f00\u542f\uff0cid:"+i.guideId+"\u5f15\u5bfc\u89e6\u53d1}"),this._onGuideTriggerOn(i.guideId)))}},e.prototype._onGuideTriggerOn=function(t){if(!this._guidId){for(var e=0;e<this._guideTriggers.length;e++)this._guideTriggers[e].guideId==t&&(this._guideTriggers[e].destroy(),this._guideTriggers.splice(e,1));this.onCMSGGuideEvent(this,p.GCtrl.param(t))}},e.prototype.onCMSGGuideEvent=function(t,e){if(null==this._guidId){var o=e.get();this.startGuide(o)}},e.prototype.startGuide=function(t){this.getGuideNode().active=!0,this._param=null,this._guidId=t,p.GCtrl.ES.emit(d.CMsg.data.onClientGuideChange),this._step=0;var e=h.default.guideChainData.getRaw(this._guidId);e?this.doStep(e.chain[this._step]):this._guide.node.active=!1},e.prototype.onEndGuide=function(){h.default.lUserData.isGuidseExits(this._guidId)||this.onSetGuide(this._guidId),this._guide&&(this._guide.node.active=!1),this._guidId=null,p.GCtrl.ES.emit(d.CMsg.data.onClientGuideChange)},e.prototype.onSetGuide=function(t){h.default.lUserData.setGuides(t)},e.prototype._onRPCSetGuide=function(){for(var t=0;t<this._guideTriggers.length;t++)if(1==this._guideTriggers[t].cureState)return void this._onGuideTriggerOn(this._guideTriggers[t].guideId)},e.prototype.onNextStep=function(t){var e=this,o=h.default.guideChainData.getRaw(this._guidId),i=function(){if(e._step++,!(e._step>=o.chain.length)){var t=o.chain[e._step];e.doStep(t),e._param&&(e._param.chacheSetp--,e._param.chacheSetp<0&&(e._param=null))}};this._step>=o.chain.length-1?this.onEndGuide():(this._step===o.keyStep&&this.onSetGuide(this._guidId),t?l.delayAction(this._guide.node,t/1e3,i):i())},e.prototype.doStep=function(t){var e=h.default.guideStepData.tryGetRaw(t);if(!e)return null;var o=null;this._param&&0==this._param.chacheSetp&&(o=this._param.param);var i=r.OBJECT_COPY(e);i.path+=o?o.pathAppend:"",this._guide.setConfigure(i),101==t?c.tyqSDK.eventSendCustomEvent("\u65b0\u624b\u5f15\u5bfc1"):120==t?c.tyqSDK.eventSendCustomEvent("\u65b0\u624b\u5f15\u5bfc2"):133==t&&c.tyqSDK.eventSendCustomEvent("\u65b0\u624b\u5f15\u5bfc3")},e.prototype.loginOut=function(){p.GCtrl.ES.off(this,p.GCtrl.GTimerMilliEventMsg);for(var t=0;t<this._guideTriggers.length;t++)this._guideTriggers[t].destroy();this._guideTriggers=[],this._unForcesGuide.clear(),this._guide&&this._guide.node.destroy();var e=h.default.uiMgr.uiRoot.getChildByName("StoryRoot");e&&(e.destroy(),e=null),this._guide=null},e.prototype.getGuideNode=function(){var t=this;if(!this._guide){var e=this._logicApl.getPreLoadAsset(u.Res.prefab.item.guide_item),o=cc.instantiate(e);o.name="GudieRoot",o.setContentSize(cc.winSize);var i=o.getComponent(g.default);i.nextCallBack=function(e){t.onNextStep(e)},p.GCtrl.canvase.node.addChild(o,r.MAX_TAG-1e3),this._guide=i}return this._guide.node.active=!0,this._guide.node},e.prototype.singleWaitAsyncFunc=function(t,e){var o=this;this._waitAsyncFunc=function(){t()&&(o._waitAsyncFunc=null,e&&e())}},e}(a.ObjectWrap);o.GuideLogic=m,cc._RF.pop()},{"../../Core/CoreDefine":"CoreDefine","../../Core/FrameEx/ES5Ex":"ES5Ex","../../Core/GLoader/GLoader":"GLoader","../../tyqSDK/tyqSDK":"tyqSDK","../Common/UIAction":"UIAction","../Common/UIResources":"UIResources","../Logic/GameMgr":"GameMgr","./../../Core/GCtrl":"GCtrl","./../Common/Define":"Define","./../Logic/ConditionListener":"ConditionListener","./GuideComponent":"GuideComponent"}],H5AdSdk4399:[function(t,e,o){"use strict";cc._RF.push(e,"a2fd1w1RJ9B+rAH8HxGqkNP","H5AdSdk4399"),Object.defineProperty(o,"__esModule",{value:!0}),o.H5AdSdk4399=void 0;var i=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!1,configurable:!0}),t.prototype.showRewardedAd=function(t){if(window.h5api)return console.log("\u5f00\u59cb\u64ad\u653e h5api"),void window.h5api.playAd(function(e){console.log("\u4ee3\u7801:"+e.code+",\u6d88\u606f:"+e.message),1e4===e.code?console.log("\u5f00\u59cb\u64ad\u653e"):10001===e.code?(console.log("\u64ad\u653e\u7ed3\u675f"),t&&t(1)):(console.log("\u5e7f\u544a\u5f02\u5e38"),t&&t(0))})},t.prototype.checkDownUrl=function(){window.h5api&&function(){assetManager.transformPipeline.append(function(t){for(var e=t.output=t.input,o=0;o<e.length;o++){var i=e[o];if(i.url){var n=i.url.split(".");if(n.length>=2&&"cconb"==n[n.length-1]){i.url="";for(var r=0;r<n.length-1;r++){var a=n[r];i.url+=a+"."}i.url+="_cconb.dbbin"}if(n.length>=2&&"bin"==n[n.length-1]){for(i.url="",r=0;r<n.length-1;r++)a=n[r],i.url+=a+".";i.url+="dbbin"}}}return null});var t=assetManager.downloader._downloaders,e=t[".dbbin"];cc.assetManager.downloader.register("dbbin",function(o){o.includes("_cconb")?t[".cconb"]():e()})}()},t}();o.H5AdSdk4399=i,cc._RF.pop()},{}],HangPage:[function(t,e,o){"use strict";cc._RF.push(e,"67c53T2tyRKe5AgHoViKLs9","HangPage");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var r=t("../../../Core/GCtrl"),a=t("../../Common/Define"),s=t("../../Common/UI"),c=t("../../Logic/GameMgr"),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.listenClosePage=[],e.listenOpenPage=[],e}return n(e,t),e.prototype.onLoad=function(){r.GCtrl.ES.on(r.GCtrl.GClientWinOpenEventMsg,this,this.onWinOpen.bind(this)),r.GCtrl.ES.on(r.GCtrl.GClientWinDestroyEventMsg,this,this.onWinClose.bind(this)),this.setOrder(!1)},e.prototype.addListenPage=function(t,e){for(var o=0;o<t.length;o++)-1==this.listenOpenPage.indexOf(t[o])&&this.listenOpenPage.push(t[o]);for(o=0;o<e.length;o++)-1==this.listenClosePage.indexOf(e[o])&&this.listenClosePage.push(e[o])},e.prototype.getCurWin=function(){return this.curWin},e.prototype.onWinOpen=function(t,e){if(e!=s.VIEW_ID.fightLayer){for(var o=this.listenOpenPage,i=0;i<o.length;i++)if(e==o[i])return this.setOrder(!0),this.curWin=e,void r.GCtrl.ES.emit(a.CMsg.client.view.onViewChange)}else this.node.parent=null},e.prototype.onWinClose=function(t,e){for(var o=this.listenClosePage,i=0;i<o.length;i++)if(e.winId==o[i])return this.curWin=null,void this.setOrder(!1)},e.prototype.setOrder=function(t){if(this.node.active=!0,t){var e=c.default.uiMgr.getActiveTopWin();this.node.zIndex=e.sortOrder+1}else{var o=c.default.uiMgr.getActiveTopWin(s.VIEW_ID.home);o?(this.node.zIndex=o.sortOrder+1,this.node.parent=o.viewBinder.node.parent):this.node.parent=null}},e.prototype.onDestroy=function(){r.GCtrl.ES.off(this),r.GCtrl.ES.off(this.node)},e}(cc.Component);o.default=l,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../Common/Define":"Define","../../Common/UI":"UI","../../Logic/GameMgr":"GameMgr"}],HeroCardItem:[function(t,e,o){"use strict";cc._RF.push(e,"4a1103bFspIapMznGpVCx9x","HeroCardItem");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/CoreDefine"),c=t("../../../Core/GCtrl"),l=t("../../../Core/GView/GChild"),u=t("../../Common/Define"),h=t("../../Common/UI"),p=t("../../Common/UIResources"),d=t("../../Logic/GameMgr"),f=t("../../Logic/SdkMgr"),g=cc._decorator,_=g.ccclass,m=g.property,y=g.menu,v=(g.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.heroName=null,e.star=null,e.heroImg=null,e.heroGrade=null,e.setting=null,e.quality=null,e.lab=null,e.labImg=null,e.isBattleImg=null,e.fragment=null,e.lockBtn=null,e.herotype=null,e.herotypeSprite=[],e.spt_icon=null,e._touchMove=!1,e._iconShowNode=null,e._touchBegin=!1,e._dragShowNode=null,e._sHeroData=null,e._rHeroData=null,e._isDraging=!1,e._canPutOn=!1,e._seatNode=[],e._onSeat=!1,e._index=0,e._heroInBattle=[],e._chess=[null,"\u5175","\u8f66","\u9a6c","\u70ae","\u76f8","\u58eb"],e._isListent=u.LISTENTTYPE.listent1,e}return n(e,t),e.prototype.onGLoad=function(){c.GCtrl.ES.on(u.CMsg.client.home.onBattleItem,this,this.settingIsShow.bind(this)),c.GCtrl.ES.on(u.CMsg.client.home.onHeroItem,this,this.render.bind(this)),c.GCtrl.ES.on(u.CMsg.client.hero.onHeroLvUp,this,this.setRedPoint.bind(this),s.PRIORITY_VIEW),c.GCtrl.ES.on(u.CMsg.client.hero.onHeroBreach,this,this.setRedPoint.bind(this),s.PRIORITY_VIEW),c.GCtrl.ES.on(u.CMsg.client.hero.onHeroAddStar,this,this.setRedPoint.bind(this),s.PRIORITY_VIEW),c.GCtrl.ES.on(u.CMsg.client.equip.onEquipPutOn,this,this.setRedPoint.bind(this),s.PRIORITY_VIEW),c.GCtrl.ES.on(u.CMsg.client.equip.onEquipPutOff,this,this.setRedPoint.bind(this),s.PRIORITY_VIEW),c.GCtrl.ES.on(u.CMsg.client.equip.ondelEquip,this,this.setRedPoint.bind(this),s.PRIORITY_VIEW)},e.prototype.onDisable=function(){this.node.targetOff(this)},e.prototype.init=function(t,e,o){if(void 0===o&&(o=u.LISTENTTYPE.listent1),this._isListent=o,this._isListent,u.LISTENTTYPE.listent3,this._index=e,this.setting.active=!0,t.tableId){this._rHeroData=t,this._sHeroData=d.default.heroData.getRaw(this._rHeroData.tableId);var i=d.default.rHeroData.checkHeroIsInBattle(this._rHeroData.tableId);this._isListent==u.LISTENTTYPE.listent2||(this.isBattleImg.active=i),this.setting.active=i,this.addStar()}else this._sHeroData=t,this._rHeroData=null,this.star.active=!1,this.isBattleImg.active=!1;o==u.LISTENTTYPE.listent1&&this.initEvent(),this.checkStatus(),this.setView(),this.Unlock(),this.assetImpl.spriteFrame(this.heroImg,p.Res.texture.hero.hero+this._sHeroData.icon),this.setRedPoint()},e.prototype.setRedPoint=function(){if(this._rHeroData){if(this.node.parent&&"heroLayout"===this.node.parent.name){var t=d.default.heroMgr.checkHeroCanGrow(this._rHeroData.tableId,!1),e=d.default.heroMgr.checkHeroCanGrow(this._rHeroData.tableId,!0),o=d.default.heroMgr.checkHeroCanAddStar(this._rHeroData.tableId),i=d.default.heroMgr.checkHeorBastEquip(this._rHeroData);d.default.redMgr.setRPointView(this.node,this.node,t||e||o||i,u.RedpointEffect.REDPOINT)}else if(this.node.parent&&"blessPage"===this.node.parent.name){var n=d.default.itemMgr.checkEquipCanSync(this._rHeroData),r=d.default.itemMgr.checkHeroEquipCanLvUp(this._rHeroData);d.default.redMgr.setRPointView(this.node,this.node,n||r,u.RedpointEffect.REDPOINT)}}else{if(this.node.parent&&"heroLayout"===this.node.parent.name){var a=d.default.heroMgr.checkHeroCanUnlockByChip(this._sHeroData.id);d.default.redMgr.setRPointView(this.lockBtn.node,this.lockBtn.node,a,u.RedpointEffect.REDPOINT)}d.default.redMgr.setRPointView(this.node,this.node,!1,u.RedpointEffect.REDPOINT)}},e.prototype.addStar=function(){this.star.active=!0;for(var t=this._rHeroData.star,e=d.default.heroMgr.getChipNeedByStar(t),o=0;o<this.star.children.length;o++)o<=e.count-1?(this.star.children[o].color=cc.Color.WHITE,this.star.children[o].active=!0):this.star.children[o].active=!1},e.prototype.setView=function(){this.assetImpl.spriteAtlasFrame(this.heroName,"frames/views/squadImg","name_"+(this._rHeroData?this._rHeroData.tableId:this._sHeroData.icon)),this.lab.string=this._chess[this._sHeroData.type]+"";var t=p.Res.texture.map.quality,e=this._rHeroData?this._rHeroData.trait:this._sHeroData.trait;this.assetImpl.spriteAtlasFrame(this.labImg,t,u.TEXTURE_PREFIX.type+this._sHeroData.type),this.assetImpl.spriteAtlasFrame(this.quality,t,u.TEXTURE_PREFIX.quality+e),this.herotype.getComponent(cc.Sprite).spriteFrame=this.herotypeSprite[this._sHeroData.herotype-1]},e.prototype.lock=function(){var t=[[0,0,0]];t[0][0]=this._sHeroData.id,t[0][1]=u.ITEM_TYPE.HERO,t[0][2]=1;var e=d.default.heroData.getRaw(this._sHeroData.id).unlockStar;d.default.jumpToMgr.jumpGoTo(h.VIEW_ID.rewardCtrl,t),c.GCtrl.ES.emit(u.CMsg.client.bag.onBagItemChange,[[this._sHeroData.id,u.ITEM_TYPE.PROP,-e]]),d.default.redMgr.sendValueSettingMsg(u.RPointMask.RPM_Hero_UnLock,!1)},e.prototype.childClick=function(){if(this._isListent==u.LISTENTTYPE.listent2)if(this._rHeroData)d.default.jumpToMgr.jumpGoTo(h.VIEW_ID.detailsCtrl,this._rHeroData,this._sHeroData);else if(d.default.RBagData.getMegreItems(this._sHeroData.id,u.ITEM_TYPE.PROP).num>=this._sHeroData.unlockStar)this.lock();else{var t=[this._sHeroData.id,u.ITEM_TYPE.PROP,1];d.default.jumpToMgr.jumpGoTo(h.VIEW_ID.currencyFrame,t,1)}if(this._isListent==u.LISTENTTYPE.listent3&&this._rHeroData){var e=d.default.lUserData.level,o=d.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.aidOpen);if(e>=o)d.default.jumpToMgr.jumpGoTo(h.VIEW_ID.blessCtrl,this._rHeroData,this._sHeroData);else{var i="\u901a\u8fc7\u7b2c"+o+"\u5173\u5f00\u542f\u5408\u6210\u5f3a\u5316\u754c\u9762";d.default.uiMgr.showToast(i)}}},e.prototype.Unlock=function(){var t=d.default.RBagData.getMegreItems(this._sHeroData.id,u.ITEM_TYPE.PROP).num;if(this._rHeroData)this.lockBtn.node.parent.active=!1,this.fragment.active=!1,this._isListent,u.LISTENTTYPE.listent2;else{this.lockBtn.node.parent.active=!0;var e=t>=this._sHeroData.unlockStar;this.lockBtn.node.getComponent(cc.Button).interactable=e;var o=e?"lock":"unlock";this.lockBtn.node.height=e?180:0,this.assetImpl.spriteAtlasFrame(this.lockBtn.node.getChildByName("Sprite").getComponent(cc.Sprite),p.Res.texture.views.heroDetail,o),this.fragment.active=!0,this.fragment.getChildByName("lab").getComponent(cc.Label).string=t+"/"+this._sHeroData.unlockStar}},e.prototype.initEvent=function(){this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this)},e.prototype.checkStatus=function(){this._sHeroData?this._canPutOn=!0:this._canPutOn=!1},e.prototype.setSeatNode=function(t){var e=this;t.children.forEach(function(t){e._seatNode.push(t)})},e.prototype.destroyDragNode=function(){cc.isValid(this._dragShowNode)&&(this._dragShowNode.destroy(),this._dragShowNode=null)},e.prototype._onTouchStar=function(t){c.GCtrl.ES.emit(u.CMsg.client.home.onBattleItem,this._index),this._touchMove=!1,this.destroyDragNode(),this._touchBegin=!0,t.stopPropagation()},e.prototype._onTouchMove=function(t){if(this._canPutOn){var e=t.getLocation().sub(t.getStartLocation());if(this._isDraging||(this._isDraging=!0),e.mag()>7&&this._isDraging){var o=this._seatNode[0].parent;if(this._touchMove){var i=t.getLocation();n=o.convertToNodeSpaceAR(i),this._dragShowNode.setPosition(n),this.node.parent.parent.parent.getComponent(cc.ScrollView).enabled=!1,this.checkIsEnter(i,this._sHeroData).isEnter?this._onSeat||(this._onSeat=!0):this._onSeat&&(this._onSeat=!1)}else{this._touchMove=!0,this._dragShowNode=cc.instantiate(this.spt_icon.node),this._dragShowNode.getComponent(cc.Sprite).spriteFrame=this.heroImg.spriteFrame,this._dragShowNode.active=!0,this._dragShowNode.parent=this._seatNode[0].parent;var n=o.convertToNodeSpaceAR(t.getLocation());this._dragShowNode.setPosition(n)}}}},e.prototype.checkIsEnter=function(t,e){for(var o=null,i=!1,n=0;n<this._seatNode.length;n++)if(i=this._seatNode[n].getBoundingBoxToWorld().contains(t)){o=n;break}return{isEnter:i,index:o,itemData:e}},e.prototype._onTouchEnd=function(t,e){void 0===e&&(e=!1),this.destroyDragNode();for(var o=!1,i=d.default.rHeroData.heroIdsInBattle,n=0;n<i.length;n++)if(this._sHeroData.id==i[n]){o=!0;break}if(o)0==e&&(console.log("\u70b9\u51fb"),this.settingBtn());else{for(n=0;n<i.length;n++)if(-1==i[n])return void this.replaceData(Number(this._sHeroData.id),n);d.default.uiMgr.showToast("\u4e0a\u9635\u4f4d\u7f6e\u5df2\u6ee1")}},e.prototype.showUnHave=function(){f.default.ins._isWhitePag?this.lock():d.default.uiMgr.showToast("\u5341\u8fde\u62bd\u53ef\u4ee5\u83b7\u5f97\u65b0\u82f1\u96c4")},e.prototype.replaceData=function(t,e){var o=this;this._heroInBattle=d.default.rHeroData.heroIdsInBattle,this._heroInBattle.forEach(function(i,n){if(e==n){o._heroInBattle[n]=t;var r=d.default.lUserData.heroNames(t);d.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.heroBattle,{msg:r}),d.default.rHeroData.heroIdsInBattle=o._heroInBattle,o.settingBtn(),c.GCtrl.ES.emit(u.CMsg.client.home.onHeroItem,[u.FRONT.battle,o._rHeroData.tableId]),c.GCtrl.ES.emit(u.CMsg.client.home.onheroBattleItem),o._isListent==u.LISTENTTYPE.listent2||(o.isBattleImg.active=!0)}else i==t&&(o._heroInBattle[n]=-1,d.default.rHeroData.heroIdsInBattle=o._heroInBattle,c.GCtrl.ES.emit(u.CMsg.client.home.onheroBattleItem))})},e.prototype._onTouchCancel=function(t){this._onTouchEnd(t,!0)},e.prototype.render=function(t,e){var o=e[0],i=e[1];this.Unlock(),this._rHeroData&&(this._rHeroData.tableId==i&&o==u.FRONT.Lower?(this.setting.active=!1,this.isBattleImg.active=!1):this._rHeroData.tableId==i&&o==u.FRONT.battle&&(this._isListent==u.LISTENTTYPE.listent2||(this.isBattleImg.active=!0)))},e.prototype.settingIsShow=function(t){this._index!=t&&(this.setting.active=!1)},e.prototype.settingBtn=function(){var t;t=this.existence(),this.setting.active=t},e.prototype.isBattle=function(){var t;t=this.existence(),this.brush(Number(this._sHeroData.id),t)},e.prototype.existence=function(){var t=this,e=!1;return d.default.rHeroData.heroIdsInBattle.forEach(function(o){e||e||(e=o==Number(t._sHeroData.id))}),e},e.prototype.brush=function(t,e){var o=this,i=!1,n=d.default.rHeroData.heroIdsInBattle;n.forEach(function(t,r){if(e&&!i&&t==Number(o._sHeroData.id))return n[r]=-1,o.setting.active=!1,o.isBattleImg.active=!1,c.GCtrl.ES.emit(u.CMsg.client.home.onHeroItem,[u.FRONT.Lower,o._rHeroData.tableId]),c.GCtrl.ES.emit(u.CMsg.client.home.onheroBattleItem),void(i=!0)}),d.default.rHeroData.heroIdsInBattle=n},r([m({type:cc.Sprite,tooltip:"\u82f1\u96c4\u540d\u5b57"})],e.prototype,"heroName",void 0),r([m({type:cc.Node,tooltip:"\u661f\u7ea7"})],e.prototype,"star",void 0),r([m({type:cc.Sprite,tooltip:"\u82f1\u96c4\u56fe\u7247"})],e.prototype,"heroImg",void 0),r([m({type:cc.Sprite,tooltip:"\u82f1\u96c4\u54c1\u7ea7"})],e.prototype,"heroGrade",void 0),r([m({type:cc.Node,tooltip:"\u4e0a\u4e0b\u9635"})],e.prototype,"setting",void 0),r([m({type:cc.Sprite,tooltip:"\u82f1\u96c4\u54c1\u7ea7"})],e.prototype,"quality",void 0),r([m({type:cc.Label,tooltip:"\u804c\u4e1a"})],e.prototype,"lab",void 0),r([m({type:cc.Sprite,tooltip:"\u804c\u4e1a1"})],e.prototype,"labImg",void 0),r([m({type:cc.Node,tooltip:"\u5df2\u4e0a\u9635"})],e.prototype,"isBattleImg",void 0),r([m({type:cc.Node,tooltip:"\u788e\u7247\u6570\u91cf"})],e.prototype,"fragment",void 0),r([m({type:cc.Sprite,tooltip:"\u662f\u5426\u5df2\u89e3\u9501"})],e.prototype,"lockBtn",void 0),r([m({type:cc.Node,tooltip:"\u7ea7\u522b"})],e.prototype,"herotype",void 0),r([m({type:cc.SpriteFrame,tooltip:"\u7ea7\u522b\u56fe\u7247"})],e.prototype,"herotypeSprite",void 0),r([m(cc.Sprite)],e.prototype,"spt_icon",void 0),r([_,y("View/Hero/HeroCardItem")],e)}(l.default));o.default=v,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/GCtrl":"GCtrl","../../../Core/GView/GChild":"GChild","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr","../../Logic/SdkMgr":"SdkMgr"}],HeroChange:[function(t,e,o){"use strict";cc._RF.push(e,"f65a66JFrRA9IYORiwRWXK4","HeroChange");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/CoreDefine"),s=t("../../../Core/GView/GChild"),c=t("../../Common/UIResources"),l=t("../../Logic/GameMgr"),u=t("../JXBattle/JXULDefine"),h=t("./../../../Core/GCtrl"),p=t("./../../Common/Define"),d=cc._decorator,f=d.property,g=d.ccclass,_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.heroNode=null,e.sk_hero=null,e._heroId=null,e._heroData=null,e._heroInfo=null,e.skillPostfix=!1,e}return n(e,t),e.prototype.onGLoad=function(){h.GCtrl.ES.on(p.CMsg.client.equip.onEquipPutOff,this,this.onPutOffEquip.bind(this),a.PRIORITY_VIEW),h.GCtrl.ES.on(p.CMsg.client.equip.onEquipPutOn,this,this.onPutOnEquip.bind(this),a.PRIORITY_VIEW);var t=this.heroNode.getComponent(sp.Skeleton);t||(t=this.addComponent(sp.Skeleton)),this.sk_hero=t},e.prototype.init=function(){},e.prototype.changeSpine=function(t,e,o){var i=this;if(void 0===e&&(e=!0),void 0===o&&(o=0),"number"==typeof t){var n=t;if(!n||n==a.INVALID_VALUE)return this.node.active=!1,void(this._heroId=null);if(this._heroId==n)return;this._heroId=n}else{if(!t)return this.node.active=!1,void(this._heroId=null);this._heroData=t,this._heroId=t.tableId}this.node.active=!0;var r=l.default.heroData.getRaw(this._heroId);if(this._heroInfo=r,this.sk_hero||"number"==typeof t){var s=c.Res.model+r.animation+"/"+r.animation,u=this;this.assetImpl.spine(s,function(t){u.sk_hero.skeletonData=t,u.sk_hero.setSkin(r.aniSkin),u.sk_hero.setAnimation(0,r.ani[o],e),(i._heroId<=1007||1030==i._heroId)&&(i.initModelDefaul(e),i.initModelByEquip(e))})}else(this._heroId<=1007||1030==this._heroId)&&(this.initModelDefaul(e),this.initModelByEquip(e))},e.prototype.initModelDefaul=function(t){var e;if(void 0===t&&(t=!0),e=this._heroData?this._heroData.equips:l.default.RBagData.getOwnerAllEquip(this._heroId),this.sk_hero&&(this.sk_hero.setSkin("skin1"),this.sk_hero.setAnimation(0,u.JXEAniNames.idle,t)),e.length>0)for(var o=0;o<e.length;o++){var i=e[o];if(i&&"-1"!=e[o])if("number"==typeof i)this.changeModuleBuId(i,!1,t);else{var n=l.default.RBagData.getEquipDataById(i);this.changeModuleBuId(n.itemData.id,!1,t)}}else{var r=l.default.heroData.getRaw(this._heroId);if(r.slots&&this.sk_hero)for(o=0;o<r.slots.length;o++)try{this.sk_hero.setAttachment(r.slots[o],r.defaultAttach[o])}catch(a){cc.error(a)}}},e.prototype.initModelByEquip=function(t){if(this.sk_hero){var e=this._heroData?this._heroData:l.default.rHeroData.getHero(this._heroId);if(e)for(var o=e.equips,i=0;i<o.length;i++)if("-1"!=o[i]&&null!=o[i]){var n=null;"number"==typeof o[i]?this.changeModuleBuId(o[i],!0,t):(n=l.default.RBagData.getEquipDataById(o[i]),this.changeModuleBuId(n.itemData.id,!0,t))}}},e.prototype.onPutOnEquip=function(t,e){var o=e.get();if(o.heroId==this._heroId){var i=o.equipId,n=l.default.RBagData.getEquipDataById(i).itemData.raw;n.seat===p.EQUIP_PART.CLOTHING?this.initModelByEquip(!0):this.changeModuleBuId(n.id,!0)}},e.prototype.onPutOffEquip=function(t,e){var o=e.get();if(o.heroId==this._heroId){var i=o.equipId,n=l.default.RBagData.getEquipDataById(i).itemData.raw;n.seat===p.EQUIP_PART.CLOTHING?(this.initModelDefaul(),this.initModelByEquip(!0)):this.changeModuleBuId(n.id,!1)}},e.prototype.onDelHero=function(t,e){e.get()==this._heroId&&this.changeSpine(null)},e.prototype.changeModuleBuId=function(t,e,o){void 0===o&&(o=!0);var i=l.default.equipData.getRaw(t);if(i&&i.skin&&(e?(this.sk_hero.setSkin(i.skin[0]),this.skillPostfix=!!i.skin[1]):(this._heroInfo?this.sk_hero.setSkin(this._heroInfo.aniSkin):this.sk_hero.setSkin("skin1"),this.skillPostfix=!1),this.sk_hero.setAnimation(0,u.JXEAniNames.idle,o)),i&&i.slots)for(var n=0;n<i.slots.length;n++)try{var r=e?i.showAttach[n]:i.hideAttach[n];r?this.sk_hero.setAttachment(i.slots[n],r):this.sk_hero.findSlot(i.slots[n]).setAttachment(null)}catch(a){console.error(a)}},r([f(cc.Node)],e.prototype,"heroNode",void 0),r([g],e)}(s.default);o.default=_,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/GView/GChild":"GChild","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr","../JXBattle/JXULDefine":"JXULDefine","./../../../Core/GCtrl":"GCtrl","./../../Common/Define":"Define"}],HeroCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"93124hjJnpH06Z+McLiLGUi","HeroCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/CoreDefine"),c=t("../../../Core/GCtrl"),l=t("../../../Core/GEvent/GParam"),u=t("../../../Core/GView/GListView"),h=t("../../../Core/GView/GPage"),p=t("../../Common/Define"),d=t("../../Common/UI"),f=t("../../Common/UIResources"),g=t("../../Entity/HeroItem"),_=t("../../Logic/GameMgr"),m=t("../Home/SkillItem"),y=t("./../../Logic/HeroMgr"),v=t("./DetailsCtrl"),C=t("./HeroChange"),I=cc._decorator,E=I.ccclass,S=I.property,R=I.menu,D=(I.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cardView=null,e.content=null,e.power=null,e.mask=null,e.skill=null,e.HeroChange=null,e.HeroChange1=null,e.HeroChange2=null,e.detailroot=null,e.selectBtn=null,e.scrolllayer=null,e._listView=null,e._curListIndex=0,e._selectItem=null,e._isShowZhuangbei=!1,e._touchPos=null,e._hero1Id=0,e._hero2Id=0,e._lastId=0,e}return n(e,t),e.prototype.onPageIn=function(){this.detailroot.removeAllChildren(),this.dealWithData();var t,e=cc.view.getFrameSize(),o=cc.view.getDesignResolutionSize();t=e.width/e.height<=.5625?e.width/o.width:e.height/o.height,this.mask.height=Math.min(480,e.height/t/2-568+350)},e.prototype.onGStart=function(){this.detailroot.removeAllChildren()},e.prototype.onGLoad=function(){c.GCtrl.ES.on(p.CMsg.client.bag.onBagItemChange,this,this.initEmbattle.bind(this),s.PRIORITY_VIEW),c.GCtrl.ES.on(p.CMsg.client.hero.onHeroLvUp,this,this.initEmbattle.bind(this),s.PRIORITY_VIEW),c.GCtrl.ES.on(p.CMsg.client.hero.onHeroBreach,this,this.initEmbattle.bind(this),s.PRIORITY_VIEW),c.GCtrl.ES.on(p.CMsg.client.hero.onAddHero,this,this.initEmbattle.bind(this),s.PRIORITY_VIEW),c.GCtrl.ES.on("updateRedSeletBtn",this,this.setRedPoint.bind(this),s.PRIORITY_VIEW),this.scrolllayer.on(cc.Node.EventType.TOUCH_START,this.onTouchStar,this),this.scrolllayer.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},e.prototype.onTouchStar=function(t){this._touchPos=t.getLocation()},e.prototype.onTouchEnd=function(t){var e=t.getLocation();if(e.x<this._touchPos.x-50)this.scrolleItem(this._hero2Id,!0,!1),this.setSelectHero(this._hero2Id);else if(e.x>this._touchPos.x+50)this.scrolleItem(this._hero1Id,!1,!0),this.setSelectHero(this._hero1Id);else{var o=this.HeroChange.convertToNodeSpaceAR(e),i=this.HeroChange1.convertToNodeSpaceAR(e),n=this.HeroChange2.convertToNodeSpaceAR(e);o.x>-this.HeroChange.width/2&&o.x<this.HeroChange.width/2&&o.y>0&&o.y<this.HeroChange.height?this.touchHero(null,0):i.x>-this.HeroChange1.width/2&&i.x<+this.HeroChange1.width/2&&i.y>0&&i.y<+this.HeroChange1.height?this.touchHero(null,1):n.x>-this.HeroChange2.width/2&&n.x<+this.HeroChange2.width/2&&n.y>0&&n.y<+this.HeroChange2.height&&this.touchHero(null,2)}},e.prototype.initEmbattle=function(){var t=this;this.cardView&&(this._listView?this.dealWithData():this.assetImpl.prefab(f.Res.prefab.item.HeroItem,function(e){t._listView=new u.GListView({scrollview:t.cardView,mask:t.mask,content:t.content,itemTpl:cc.instantiate(e),itemSetter:t.onItemSetter.bind(t),column:3,gapY:20,gapX:30,padingY:20,padingX:15,isCbClass:!0,isWidget:!0}),t.dealWithData()}))},e.prototype.dealWithData=function(){var t=this,e=_.default.rHeroData.getHaveHeros(this._curListIndex),o=e.have,i=e.notHave;y.IHeroSort.sortLvUp,y.IHeroSort.sortStart,y.IHeroSort.sortZhanli,y.SHeroSort.sortChip,y.SHeroSort.sortTrait,y.SHeroSort.sortStart,y.SHeroSort.sortZhanli,this.content.removeAllChildren();var n=this;this.assetImpl.prefab(f.Res.prefab.item.HeroItem,function(e){o.forEach(function(t){var o=cc.instantiate(e);o.parent=n.content,o.on(cc.Node.EventType.TOUCH_END,n.touchHeroItem,n),o.getComponent(g.default).setRoleId(t.tableId,!0,t),o.name=""+t.tableId,o.getComponent(g.default).setRedPoint()}),i.forEach(function(t){var o=cc.instantiate(e);o.parent=n.content,o.on(cc.Node.EventType.TOUCH_END,n.touchHeroItem,n),o.getComponent(g.default).setRoleId(t.id,!1,t),o.name=""+t.id}),t.setSelectHero("1001")})},e.prototype.touchHeroItem=function(t){var e="number"==typeof t?t:t.target.name;_.default.rHeroData.hasOwnHero(parseInt(e))?parseInt(e)!=this._lastId?(this.scrolleItem(e),this.setSelectHero(e)):this.onSelect():_.default.uiMgr.showToast("\u8bf7\u62bd\u5361\u83b7\u5f97\u82f1\u96c4")},e.prototype.scrolleItem=function(t,e,o){void 0===e&&(e=!1),void 0===o&&(o=!1);var i=e;if(i||(i=!o)&&(i=parseInt(t)>this._lastId),i){var n=this.HeroChange.position,r=this.HeroChange1.position,a=this.HeroChange2.position;this.HeroChange.position=a,this.HeroChange.scale=1,cc.tween(this.HeroChange).to(.2,{x:n.x,y:n.y,scale:1.2}).start(),this.HeroChange1.position=n,cc.tween(this.HeroChange1).to(.2,{x:r.x,y:r.y}).start(),this.HeroChange2.position=r,cc.tween(this.HeroChange2).to(.1,{x:r.x-100,y:r.y}).set({x:a.x+100,y:a.y}).to(.1,{x:a.x,y:a.y}).start()}else n=this.HeroChange.position,r=this.HeroChange1.position,a=this.HeroChange2.position,this.HeroChange.scale=1,this.HeroChange.position=r,cc.tween(this.HeroChange).to(.2,{x:n.x,y:n.y,scale:1.2}).start(),this.HeroChange2.position=n,cc.tween(this.HeroChange2).to(.2,{x:a.x,y:a.y}).start(),this.HeroChange1.position=a,cc.tween(this.HeroChange1).to(.1,{x:a.x+100,y:a.y}).set({x:r.x-100,y:r.y}).to(.1,{x:r.x,y:r.y}).start()},e.prototype.setSelectHero=function(t){var e=this,o=this.content.children,i=null,n=0;if(o.forEach(function(o,r){t==o.name&&o.getComponent(g.default).getRHeroData()&&(e._selectItem&&e._selectItem.getComponent(g.default).setSelect(!1),i=o,o.getComponent(g.default).setSelect(!0),n=r)}),this._lastId=parseInt(t),i){var r=i.getComponent(g.default).getRHeroData();this.power.string=parseInt(a.JXMath.getZhanli(r.propts).toString())+"",this.initSkill(r),this._selectItem=i,this.initHero(this.HeroChange,r,i.getComponent(g.default).getSHeroData(),!0),this.setRedPoint(r)}var s=n-1;if(s<0){for(s=o.length-1;!o[s].getComponent(g.default).getRHeroData();)s--;var c=o[s];this._hero1Id=parseInt(c.name),this.initHero(this.HeroChange1,c.getComponent(g.default).getRHeroData(),c.getComponent(g.default).getSHeroData(),!1)}else c=o[s],this._hero1Id=parseInt(c.name),this.initHero(this.HeroChange1,c.getComponent(g.default).getRHeroData(),c.getComponent(g.default).getSHeroData(),!1);var l=n+1;if(l>o.length-1||!o[l].getComponent(g.default).getRHeroData())c=o[l=0],this._hero2Id=parseInt(c.name),this.initHero(this.HeroChange2,c.getComponent(g.default).getRHeroData(),c.getComponent(g.default).getSHeroData(),!1);else{var u=o[l];this._hero2Id=parseInt(u.name),this.initHero(this.HeroChange2,u.getComponent(g.default).getRHeroData(),u.getComponent(g.default).getSHeroData(),!1)}this._isShowZhuangbei&&this.onSelect()},e.prototype.setRedPoint=function(t){var e=t||this._selectItem.getComponent(g.default).getRHeroData();if(e){var o=_.default.heroMgr.checkHeroCanGrow(e.tableId,!1),i=_.default.heroMgr.checkHeroCanGrow(e.tableId,!0),n=_.default.heroMgr.checkHeroCanAddStar(e.tableId),r=_.default.heroMgr.checkHeorBastEquip(e);_.default.redMgr.setRPointView(this.selectBtn,this.selectBtn,o||i||n||r,p.RedpointEffect.REDPOINT,p.RedpointPos.Main)}},e.prototype.initHero=function(t,e,o,i){var n=t.getChildByName("skelNode").getComponent(C.default);n.changeSpine(e?e.tableId:o.id,i);var r=e?_.default.heroData.getRaw(e.tableId):o;n.node.scale=r.roleScale,this.assetImpl.spriteAtlasFrame(t.getChildByName("heroName").getChildByName("name").getComponent(cc.Sprite),"frames/views/squadImg","lname_"+r.icon)},e.prototype.touchHero=function(t,e){2==e?(this.scrolleItem(this._hero2Id,!0,!1),this.setSelectHero(this._hero2Id)):1==e?(this.scrolleItem(this._hero1Id,!1,!0),this.setSelectHero(this._hero1Id)):0==e&&this.onSelect()},e.prototype.onSelect=function(){var t=this;if(this._selectItem){this.detailroot.removeAllChildren();var e=this._isShowZhuangbei;this.assetImpl.prefab("hero/DetailsCtrl",function(o){var i=cc.instantiate(o);i.getComponent(v.default).onGStartInit(t._selectItem.getComponent(g.default).getRHeroData(),t._selectItem.getComponent(g.default).getSHeroData(),e),t.detailroot.addChild(i)}),this._isShowZhuangbei=!1}},e.prototype.btnOnce=function(t){this._curListIndex=Number(t.node._name),c.GCtrl.ES.emit(p.CMsg.client.home.onBattleItem,-1),this.dealWithData()},e.prototype.onItemSetter=function(t,e,o){t.init(e,o,p.LISTENTTYPE.listent2)},e.prototype.initSkill=function(t,e){var o=this;this.assetImpl.prefab(f.Res.prefab.item.skillItem,function(i){o.skill.destroyAllChildren();var n=_.default.skillData.getHeroSkillData(t.tableId),r=_.default.skillData.getHeroUseSkill(t.tableId,t.lv),a=t.skillIds;e&&r.forEach(function(t,e){if(t!=a[e]){var o=_.default.skillData.getRaw(t);_.default.jumpToMgr.jumpGoTo(d.VIEW_ID.skillPage,o,1)}});var s={heroId:t.tableId,skill:r};c.GCtrl.ES.emit(p.CMsg.client.hero.onSetSkill,new l.default(s)),n.forEach(function(t,e){var n=!1,a=cc.instantiate(i),s=a.getComponent(m.default);a.parent=o.skill,r[e]&&(n=!0),s.setView(t,n)})})},r([S(cc.ScrollView)],e.prototype,"cardView",void 0),r([S(cc.Node)],e.prototype,"content",void 0),r([S(cc.Label)],e.prototype,"power",void 0),r([S(cc.Node)],e.prototype,"mask",void 0),r([S(cc.Node)],e.prototype,"skill",void 0),r([S({type:cc.Node,tooltip:"\u82f1\u96c4\u4eba\u7269"})],e.prototype,"HeroChange",void 0),r([S({type:cc.Node,tooltip:"\u82f1\u96c4\u4eba\u7269"})],e.prototype,"HeroChange1",void 0),r([S({type:cc.Node,tooltip:"\u82f1\u96c4\u4eba\u7269"})],e.prototype,"HeroChange2",void 0),r([S({type:cc.Node,tooltip:"\u8be6\u60c5"})],e.prototype,"detailroot",void 0),r([S({type:cc.Node,tooltip:"\u82f1\u96c4\u8be6\u60c5"})],e.prototype,"selectBtn",void 0),r([S(cc.Node)],e.prototype,"scrolllayer",void 0),r([E,R("View/Hero/HeroCtrl")],e)}(h.default));o.default=D,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/GCtrl":"GCtrl","../../../Core/GEvent/GParam":"GParam","../../../Core/GView/GListView":"GListView","../../../Core/GView/GPage":"GPage","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Entity/HeroItem":"HeroItem","../../Logic/GameMgr":"GameMgr","../Home/SkillItem":"SkillItem","./../../Logic/HeroMgr":"HeroMgr","./DetailsCtrl":"DetailsCtrl","./HeroChange":"HeroChange"}],HeroItem:[function(t,e,o){"use strict";cc._RF.push(e,"75247QKnTtEjoPg17Rp9cXy","HeroItem");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../Core/CoreDefine"),s=t("../../Core/GCtrl"),c=t("../../Core/GView/GChild"),l=t("../Common/Define"),u=t("../Common/UIResources"),h=t("../Logic/GameMgr"),p=cc._decorator,d=p.ccclass,f=p.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._roleId=0,e.icon=null,e.headbg=null,e.selectbg=null,e.mask=null,e._sHeroData=null,e._rHeroData=null,e}return n(e,t),e.prototype.start=function(){},e.prototype.setRoleId=function(t,e,o){this._roleId=t;var i=h.default.heroData.getRaw(this._roleId);this.assetImpl.spriteFrame(this.icon.getComponent(cc.Sprite),u.Res.texture.hero.hero+"head_"+i.icon),this.mask.active=!e,this.selectbg.active=!1,o.tableId?(this._rHeroData=o,this._sHeroData=h.default.heroData.getRaw(this._rHeroData.tableId)):(this._sHeroData=o,this._rHeroData=null),s.GCtrl.ES.on("updateRedSeletBtn",this,this.setRedPoint.bind(this),a.PRIORITY_VIEW)},e.prototype.setRedPoint=function(){if(!this.mask.active){var t=this.getRHeroData();if(t){var e=h.default.heroMgr.checkHeroCanGrow(t.tableId,!1),o=h.default.heroMgr.checkHeroCanGrow(t.tableId,!0),i=h.default.heroMgr.checkHeroCanAddStar(t.tableId),n=h.default.heroMgr.checkHeorBastEquip(t),r=h.default.itemMgr.checkEquipCanSync(t);h.default.redMgr.setRPointView(this.node,this.node,e||o||i||n||r,l.RedpointEffect.REDPOINT,l.RedpointPos.Main)}}},e.prototype.getRHeroData=function(){return this._rHeroData},e.prototype.getSHeroData=function(){return this._sHeroData},e.prototype.setSelect=function(t){this.selectbg.active=t},r([f(cc.Node)],e.prototype,"icon",void 0),r([f(cc.Node)],e.prototype,"headbg",void 0),r([f(cc.Node)],e.prototype,"selectbg",void 0),r([f(cc.Node)],e.prototype,"mask",void 0),r([d],e)}(c.default);o.default=g,cc._RF.pop()},{"../../Core/CoreDefine":"CoreDefine","../../Core/GCtrl":"GCtrl","../../Core/GView/GChild":"GChild","../Common/Define":"Define","../Common/UIResources":"UIResources","../Logic/GameMgr":"GameMgr"}],HeroMgr:[function(t,e,o){"use strict";cc._RF.push(e,"d1aeaEQ97hDNY1ksvGIsmH+","HeroMgr");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0}),o.HeroMgr=o.SHeroSort=o.IHeroSort=void 0;var a=t("../../Core/CoreDefine"),s=t("../../Core/FrameEx/ES5Ex"),c=t("../Data/RunTime/RunRaw/RJXItem"),l=t("./../../conventions/JXCommon"),u=t("./../Common/Define"),h=t("./GameMgr"),p=function(){function t(){}return t.sortStart=function(t,e){var o=h.default.heroData.getRaw(t.tableId),i=h.default.heroData.getRaw(e.tableId);return o.birthStar>i.birthStar?u.CompareEnum.CGreater:o.birthStar<i.birthStar?u.CompareEnum.CLess:u.CompareEnum.CEQual},t.sortLvUp=function(t,e){return t.lv>e.lv?u.CompareEnum.CGreater:t.lv<e.lv?u.CompareEnum.CLess:u.CompareEnum.CEQual},t.sortZhanli=function(t,e){var o=l.JXMath.getZhanli(t.propts),i=l.JXMath.getZhanli(e.propts);return o>i?u.CompareEnum.CGreater:o<i?u.CompareEnum.CLess:u.CompareEnum.CEQual},t.sorts=function(t,e,o){for(var i=0,n=t;i<n.length;i++){var r=(0,n[i])(e,o);if(r!=u.CompareEnum.CEQual)return r}return u.CompareEnum.CEQual},t.sortEquipZhanli=function(t,e){var o=l.JXMath.getEquipZhanli(t.propts.values()),i=l.JXMath.getEquipZhanli(e.propts.values());return o>i?u.CompareEnum.CGreater:o<i?u.CompareEnum.CLess:u.CompareEnum.CEQual},t.sortsEquire=function(t,e,o){for(var i=0,n=t;i<n.length;i++){var r=(0,n[i])(e,o);if(r!=u.CompareEnum.CEQual)return r}return u.CompareEnum.CEQual},t}();o.IHeroSort=p;var d=function(){function t(){}return t.sortStart=function(t,e){var o=t,i=e;return o.birthStar>i.birthStar?u.CompareEnum.CGreater:o.birthStar<i.birthStar?u.CompareEnum.CLess:u.CompareEnum.CEQual},t.sortTrait=function(t,e){return t.trait>e.trait?u.CompareEnum.CGreater:t.trait<e.trait?u.CompareEnum.CLess:u.CompareEnum.CEQual},t.sortZhanli=function(t,e){var o=l.JXMath.getZhanli(t.property),i=l.JXMath.getZhanli(e.property);return o>i?u.CompareEnum.CGreater:o<i?u.CompareEnum.CLess:u.CompareEnum.CEQual},t.sortChip=function(t,e){var o=h.default.RBagData.getMegreItems(t.id,u.ITEM_TYPE.PROP),i=h.default.RBagData.getMegreItems(e.id,u.ITEM_TYPE.PROP);return o>i?u.CompareEnum.CGreater:o<i?u.CompareEnum.CLess:u.CompareEnum.CEQual},t.sorts=function(t,e,o){for(var i=0,n=t;i<n.length;i++){var r=(0,n[i])(e,o);if(r!=u.CompareEnum.CEQual)return r}return u.CompareEnum.CEQual},t}();o.SHeroSort=d;var f=function(t){function e(){return t.call(this)||this}return n(e,t),e.ins=function(){return null==this._instance&&(this._instance=new e),this._instance},e.prototype.checkHaveHeroCanGotoBattle=function(){if(h.default.rHeroData.checkInNoHero())return!0;if(h.default.rHeroData.checkBattleTeamisFull())return!1;for(var t=h.default.rHeroData.heroDatas.values(),e=0;e<t.length;e++){var o=t[e];if(!h.default.rHeroData.checkHeroIsInBattle(o.tableId))return!0}},e.prototype.getChipNeedByStar=function(t){var e={lv:0,count:t},o=t/5,i=null;if(o+e.lv>1){e.lv=parseInt(o.toString()),o%1==0&&(e.lv=o-1);var n=(o%1).toFixed(1);i="0.0"==n?5:Number(n)/.2,e.count=Math.ceil(i)}return e},e.prototype.checkHeroCanGrow=function(t,e){void 0===e&&(e=!1);var o=h.default.rHeroData.getHero(t);if(!o)return!1;var i=h.default.lvData.getRaw(o.lv),n=h.default.lvData.getRaw(o.lv+1);if(!n)return!1;if(n.quality!=i.quality&&o.exp>=n.exp&&e){var r=new c.default([201,u.ITEM_TYPE.PROP,1]);return h.default.itemMgr.testCost(r).enough}if(o.exp>=n.exp){var a=new c.default([u.CURRENCY.GOLD,u.ITEM_TYPE.CURRENCY,n.gold]);return h.default.itemMgr.testCost(a).enough}return!1},e.prototype.checkHavaHeroCanGrow=function(t){void 0===t&&(t=!1);for(var e=h.default.rHeroData.getAllHeros().values(),o=!1,i=0;i<e.length;i++){var n=e[i];if(o=this.checkHeroCanGrow(n.tableId,t))break}return o},e.prototype.checkHavaHeroCanAddStar=function(){for(var t=h.default.rHeroData.getAllHeros().values(),e=!1,o=0;o<t.length;o++){var i=t[o];if(e=this.checkHeroCanAddStar(i.tableId))break}return e},e.prototype.checkHaveHeroUnlockByChip=function(){for(var t=h.default.heroData.getHeroTrue(),e=!1,o=0;o<t.length;o++){var i=t[o];if(e=this.checkHeroCanUnlockByChip(i.id))break}return e},e.prototype.checkHeroCanUnlockByChip=function(t){if(h.default.rHeroData.getHero(t))return!1;var e=h.default.heroData.getRaw(t).unlockStar,o=new c.default([t,u.ITEM_TYPE.PROP,e]);return h.default.itemMgr.testCost(o).enough},e.prototype.checkHeroCanAddStar=function(t){var e=h.default.rHeroData.getHero(t);if(!e)return!1;var o=h.default.heroData.getRaw(e.tableId);if(e.star>=5*o.star.length)return!1;var i=this.getChipNeedByStar(e.star),n=o.star[i.lv],r=new c.default([e.tableId,u.ITEM_TYPE.PROP,n]);return h.default.itemMgr.testCost(r).enough},e.prototype.checkHavaHeroCanWear=function(){for(var t=h.default.rHeroData.getAllHeros().values(),e=0;e<t.length;e++){var o=t[e],i=this.checkHeorBastEquip(o);if(i)return i}return!1},e.prototype.checkHeorBastEquip=function(t){for(var e=h.default.RBagData.getHeroEquip(t.tableId),o=r(e.book,e.equip),i=!1,n=0;n<o.length;n++){var s=o[n];if(t.equips&&t.equips.indexOf(s)==a.INVALID_VALUE){var c=h.default.RBagData.getEquipDataById(o[n]);if(c.wear==a.INVALID_VALUE){var l=c.itemData.raw.seat;if(l>2?((i=this.checkEquipIsBast(t.equips[3],o[n],t.lv))||(i=this.checkEquipIsBast(t.equips[4],o[n],t.lv)),i||(i=this.checkEquipIsBast(t.equips[5],o[n],t.lv))):i=this.checkEquipIsBast(t.equips[l],o[n],t.lv),i)break}}}return i},e.prototype.checkSeatEquipIsBast=function(t,e,o,i){if(e<=2)return this.checkEquipIsBast(t[e],o,i);var n=this.checkEquipIsBast(t[3],o,i);return n||(n=this.checkEquipIsBast(t[4],o,i)),n||(n=this.checkEquipIsBast(t[5],o,i)),n},e.prototype.checkEquipIsBast=function(t,e,o){if(o<h.default.RBagData.getEquipDataById(e).itemData.raw.lv)return!1;if("-1"!==t&&t){var i=h.default.RBagData.getEquipDataById(e);return h.default.RBagData.getEquipDataById(t).getZhanli()<i.getZhanli()}return!0},e._instance=null,e}(s.ObjectWrap);o.HeroMgr=f,cc._RF.pop()},{"../../Core/CoreDefine":"CoreDefine","../../Core/FrameEx/ES5Ex":"ES5Ex","../Data/RunTime/RunRaw/RJXItem":"RJXItem","./../../conventions/JXCommon":"JXCommon","./../Common/Define":"Define","./GameMgr":"GameMgr"}],HeroTryCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"b64330ntPJENab8VRGhcqDk","HeroTryCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/CoreDefine"),c=t("../../../Core/GView/GViewBase"),l=t("../../../Core/Math/MathEx"),u=t("../../Common/UIResources"),h=t("../../Logic/GameMgr"),p=cc._decorator,d=p.ccclass,f=p.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.heroDraw=null,e.heroName=null,e._cb=null,e}return n(e,t),e.prototype.onGStart=function(t){this._cb=t,this.setTryHeroId()},e.prototype.setTryHeroId=function(){for(var t=h.default.heroTryData.data.values(),e=[],o=0;o<t.length;o++){var i=t[o];i&&(h.default.rHeroData.getHero(i.heroId)||e.push(i))}if(e.length||(e=s.OBJECT_COPY(t)),e.length){var n=l.default.random(0,e.length-1);this._tryHeroData=e[n],this._sHeroData=h.default.heroData.getRaw(this._tryHeroData.heroId),this.heroName.string=this._sHeroData.name,this.assetImpl.spriteFrame(this.heroDraw,u.Res.texture.hero.hero+"hero_"+this._sHeroData.icon)}},e.prototype.noTryClick=function(){h.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.heroTry,{msg:"\u82f1\u96c4\u8bd5\u7528\u4e0d\u8bd5"}),h.default.rHeroData.tryHeroData=null,this.onClose()},e.prototype.tryClick=function(){var t=this;h.default.sdkMgr.watchAd(function(){h.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.heroTry,{msg:"\u82f1\u96c4\u8bd5\u7528"}),h.default.rHeroData.tryHeroData=t._tryHeroData,t.onClose()})},e.prototype.onClose=function(){t.prototype.onClose.call(this),this._cb()},r([f(cc.Sprite)],e.prototype,"heroDraw",void 0),r([f(cc.Label)],e.prototype,"heroName",void 0),r([d],e)}(c.default);o.default=g,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/GView/GViewBase":"GViewBase","../../../Core/Math/MathEx":"MathEx","../../../conventions/JXCommon":"JXCommon","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr"}],HomeCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"b6862bECzZEKqoJdWDEK1tI","HomeCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/CoreDefine"),c=t("../../../Core/GCtrl"),l=t("../../../Core/GView/GPageView"),u=t("../../../Core/Manager/AudioMgr"),h=t("../../../tyqSDK/tyqAdManager"),p=t("../../../tyqSDK/tyqSDK"),d=t("../../Common/Define"),f=t("../../Common/UI"),g=t("../../Common/UIResources"),_=t("../../Guide/GuideLogic"),m=t("../../Logic/GameMgr"),y=t("../Hero/HeroCtrl"),v=cc._decorator,C=v.ccclass,I=v.property,E=v.menu,S=(v.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.light=[],e._curIndex=0,e.isRecruit=!0,e.oldPage=2,e}var o;return n(e,t),o=e,e.prototype.onGStart=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];u.AudioMgr.Ins().playMusic(g.Res.audio.main),this.initEvent(),this.setPageIndex(null,2),m.default.redMgr.sendValueSettingMsg(d.RPointMask.RPM_Box_Receive,!0),c.GCtrl.ES.on("gotozhuangbei",this,this.gotozhuangbei.bind(this),s.PRIORITY_VIEW),c.GCtrl.ES.on("gotoStore",this,this.gotoStore.bind(this),s.PRIORITY_VIEW),c.GCtrl.ES.on("gotoHeroView",this,this.gotoHeroView.bind(this),s.PRIORITY_VIEW),2!=p.tyqSDK.getSwitchValue("tyq_gameType")&&(this.bgImage.node.getChildByName("bottomNode").active=!1),p.tyqSDK.getSwitchValue("tyq_openHero"),h.tyqAdManager.preloadAds2()},e.prototype.gotozhuangbei=function(){this.setPageIndex(null,1);var t=cc.find("Canvas/uiRoot/HomeCtrl/bgNode/pageRoot/HeroCtrl");t&&(t.getComponent(y.default)._isShowZhuangbei=!0,t.getComponent(y.default).onSelect())},e.prototype.gotoStore=function(){this.setPageIndex(null,0)},e.prototype.gotoHeroView=function(){this.setPageIndex(null,1)},e.prototype.initEvent=function(){m.default.redMgr.on(this.node,[{mask:[d.RPointMask.RPM_Hero_LvUp,d.RPointMask.RPM_Hero_Tupo,d.RPointMask.RPM_Hero_AddStar,d.RPointMask.RPM_Have_Base],subPath:"bgNode/bottomNode/toggles/typeBtn1",effectType:d.RedpointEffect.REDPOINT,posType:d.RedpointPos.Main},{mask:[d.RPointMask.RPM_Go_To_Battle],subPath:"bgNode/bottomNode/toggles/typeBtn3",effectType:d.RedpointEffect.REDPOINT,posType:d.RedpointPos.Main},{mask:[d.RPointMask.RPM_Box_Receive],subPath:"bgNode/bottomNode/toggles/typeBtn4",effectType:d.RedpointEffect.REDPOINT,posType:d.RedpointPos.Main}])},e.prototype.setPageIndex=function(t,e){for(var o=0;o<5;o++)this.assetImpl.spriteAtlasFrame(this.toggles[o].getChildByName("icon").getComponent(cc.Sprite),g.Res.texture.views.mainUi,"toggles"+o+(o==e?1:0)),this.toggles[o].width=this.toggles[o].getChildByName("icon").width;this.scheduleOnce(function(){this.light[0].x=this.toggles[e].x,this.light[1].x=this.toggles[e].x},.1);var i=f.VIEW_PageNumByID[e]?f.VIEW_PageNumByID[e]:null;if(i&&i.id){var n=i.view;if(!this.isRecruit)return;c.GCtrl.ES.emit(c.GCtrl.GClientWinOpenEventMsg,n),this.emitEvent()}this.onSwitch(this.oldPage,e),this.oldPage=e,4==e?m.default.redMgr.sendValueSettingMsg(d.RPointMask.RPM_Box_Receive,!1):2==e&&2==p.tyqSDK.getSwitchValue("tyq_gameType")&&this.showDialog()},e.prototype.showDialog=function(){o.isShowDialog&&setTimeout(function(){if(!_.GuideLogic.ins().isGuidding()){if(!m.default.lUserData.todayIsSignIn())return m.default.jumpToMgr.jumpGoTo(f.VIEW_ID.sginIn),void(o.isShowDialog=!1);for(var t=parseInt(m.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.guideHero)),e=m.default.heroData.getRaw(t),i=m.default.RBagData.getHeroEquip(t).equip,n=0,r=m.default.equipData.getJackpotJob(e.type,e.id,0,1,4,1),s=0;s<r.length;s++)for(var c=r[s],l=0;l<i.length;l++)m.default.RBagData.getEquipDataById(i[l]).itemData.id==c.id&&n++;n<3&&(o.isShowDialog=!1,m.default.jumpToMgr.jumpGoTo(f.VIEW_ID.TimeLimitGift))}},400)},e.prototype.onSelected=function(t){if(cc.js.isNumber(t)){this.toggles[t].zIndex=9,this.toggles[t].width=188;var e=f.VIEW_PageNumByID[t]?f.VIEW_PageNumByID[t]:null;if(e&&e.id){var o=e.view;if(!this.isRecruit)return;c.GCtrl.ES.emit(c.GCtrl.GClientWinOpenEventMsg,o)}}},e.prototype.onUnSelected=function(t){cc.js.isNumber(t)},e.isShowDialog=!0,r([I([cc.Node])],e.prototype,"light",void 0),o=r([C,E("View/Home/HomeCtrl")],e)}(l.default));o.default=S,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/GCtrl":"GCtrl","../../../Core/GView/GPageView":"GPageView","../../../Core/Manager/AudioMgr":"AudioMgr","../../../conventions/JXCommon":"JXCommon","../../../tyqSDK/tyqAdManager":"tyqAdManager","../../../tyqSDK/tyqSDK":"tyqSDK","../../Common/Define":"Define","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Guide/GuideLogic":"GuideLogic","../../Logic/GameMgr":"GameMgr","../Hero/HeroCtrl":"HeroCtrl"}],HtmlTextParser:[function(t,e,o){"use strict";cc._RF.push(e,"38165MEgopO264Gw0SwcJxH","HtmlTextParser"),Object.defineProperty(o,"__esModule",{value:!0}),o.HtmlTextParser=void 0;var i=/^(click)(\s)*=|(param)(\s)*=/,n=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,r=function(){function t(){this._parsedObject={},this._specialSymbolArray=[],this._resultObjectArray=[],this._stack=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"]),this._specialSymbolArray.push([/&nbsp;/g," "])}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t),this._ins},enumerable:!1,configurable:!0}),t.prototype.parse=function(t){this._resultObjectArray=[],this._stack=[];for(var e=0,o=t.length;e<o;){var i=t.indexOf(">",e),n=-1;if(i>=0&&(n=t.lastIndexOf("<",i))<e-1&&(n=t.indexOf("<",i+1),i=t.indexOf(">",n+1)),n<0)this._stack.pop(),this._processResult(t.substring(e)),e=o;else{var r=t.substring(e,n),a=t.substring(n+1,i);""===a&&(r=t.substring(e,i+1)),this._processResult(r),-1===i?i=n:"/"===t.charAt(n+1)?this._stack.pop():this._addToStack(a),e=i+1}}return this._resultObjectArray},t.prototype._processResult=function(t){""!==t&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},t.prototype._escapeSpecialSymbol=function(t){for(var e=0;e<this._specialSymbolArray.length;++e){var o=this._specialSymbolArray[e][0],i=this._specialSymbolArray[e][1];t=t.replace(o,i)}return t},t.prototype._addToStack=function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var o=this._stack[this._stack.length-1];for(var i in o)e[i]||(e[i]=o[i]);this._stack.push(e)}},t.prototype._attributeToObject=function(t){var e,o,i,r,a={},s=(t=t.trim()).match(/^(color|size)(\s)*=/);if(s){if(e=s[0],""===(t=t.substring(e.length).trim()))return a;switch(o=t.indexOf(" "),e[0]){case"c":a.color=o>-1?t.substring(0,o).trim():t;break;case"s":a.size=parseInt(t)}return o>-1&&(r=t.substring(o+1).trim(),i=this._processEventHandler(r),a.event=i),a}if((s=t.match(/^(br(\s)*\/)/))&&s[0].length>0&&(e=s[0].trim()).startsWith("br")&&"/"===e[e.length-1])return a.isNewLine=!0,this._resultObjectArray.push({text:"",style:{newline:!0}}),a;if((s=t.match(/^(img(\s)*src(\s)*=[^>]+\/)/))&&s[0].length>0&&(e=s[0].trim()).startsWith("img")&&"/"===e[e.length-1]){var c;s=t.match(n);for(var l=!1;s;){if(e=(t=t.substring(t.indexOf(s[0]))).substr(0,s[0].length),h=(o=(c=t.substring(e.length).trim()).indexOf(" "))>-1?c.substr(0,o):c,e=(e=e.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=c.substring(o).trim(),h.endsWith("/")&&(h=h.slice(0,-1)),"src"===e){switch(h.charCodeAt(0)){case 34:case 39:l=!0,h=h.slice(1,-1)}a.isImage=!0,a.src=h}else if("height"===e)a.imageHeight=parseInt(h);else if("width"===e)a.imageWidth=parseInt(h);else if("align"===e){switch(h.charCodeAt(0)){case 34:case 39:h=h.slice(1,-1)}a.imageAlign=h.toLocaleLowerCase()}else"offset"===e?a.imageOffset=h:"click"===e&&(a.event=this._processEventHandler(e+"="+h));a.event&&"param"===e&&(a.event.param=h.replace(/^\"|\"$/g,"")),s=t.match(n)}return l&&a.isImage&&this._resultObjectArray.push({text:"",style:a}),{}}if(s=t.match(/^(outline(\s)*[^>]*)/)){var u={color:"#ffffff",width:1};if(t=s[0].substring("outline".length).trim()){var h,p=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(s=t.match(p);s;)e=(t=t.substring(t.indexOf(s[0]))).substr(0,s[0].length),h=(o=(c=t.substring(e.length).trim()).indexOf(" "))>-1?c.substr(0,o):c,e=(e=e.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=c.substring(o).trim(),"click"===e?a.event=this._processEventHandler(e+"="+h):"color"===e?u.color=h:"width"===e&&(u.width=parseInt(h)),a.event&&"param"===e&&(a.event.param=h.replace(/^\"|\"$/g,"")),s=t.match(p)}a.outline=u}if((s=t.match(/^(on|u|b|i)(\s)*/))&&s[0].length>0){switch(e=s[0],t=t.substring(e.length).trim(),e[0]){case"u":a.underline=!0;break;case"i":a.italic=!0;break;case"b":a.bold=!0}if(""===t)return a;i=this._processEventHandler(t),a.event=i}return a},t.prototype._processEventHandler=function(t){for(var e=0,o={},n=t.match(i),r=!1;n;){var a=n[0],s="";if(r=!1,'"'===(t=t.substring(a.length).trim()).charAt(0))(e=t.indexOf('"',1))>-1&&(s=t.substring(1,e).trim(),r=!0),e++;else if("'"===t.charAt(0))(e=t.indexOf("'",1))>-1&&(s=t.substring(1,e).trim(),r=!0),e++;else{var c=t.match(/(\S)+/);e=(s=c?c[0]:"").length}r&&(o[a=a.substring(0,a.length-1).trim()]=s),n=(t=t.substring(e).trim()).match(i)}return o},t}();o.HtmlTextParser=r,cc._RF.pop()},{}],IrregularTrigger:[function(t,e,o){"use strict";cc._RF.push(e,"b27e4bp1tdMwblYZzaCGxXp","IrregularTrigger");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=a.executionOrder,u=a.menu,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.points=[],e.events=[],e}return n(e,t),e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchBegin,this)},e.prototype.onDestroy=function(){this.node.targetOff(this)},e.prototype.onTouchBegin=function(t){var e=t.getLocation();this.check(e)?(cc.Component.EventHandler.emitEvents(this.events,t),this.node._touchListener.setSwallowTouches(!0)):this.node._touchListener.setSwallowTouches(!1)},e.prototype.check=function(t){var e=this.node,o=e.convertToNodeSpaceAR(t);return!(o.x<-e.width/2||o.x>e.width/2||o.y>e.height/2||o.y<-e.height/2)&&this.PointInPoly(o,this.points)},e.prototype.PointInPoly=function(t,e){for(var o=!1,i=-1,n=e.length,r=n-1;++i<n;r=i)(e[i].y<=t.y&&t.y<e[r].y||e[r].y<=t.y&&t.y<e[i].y)&&t.x<(e[r].x-e[i].x)*(t.y-e[i].y)/(e[r].y-e[i].y)+e[i].x&&(o=!o);return o},r([c({type:[cc.Vec2],tooltip:!1})],e.prototype,"points",void 0),r([c({type:cc.Component.EventHandler,tooltip:!1})],e.prototype,"events",void 0),r([s,u("FrameEx/IrregularTriggero"),l(1)],e)}(cc.Component);o.default=h,cc._RF.pop()},{}],ItemMgr:[function(t,e,o){"use strict";cc._RF.push(e,"e87a2HDcwBCGrxNdSyIRXS2","ItemMgr");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../conventions/JXCommon"),s=t("../../Core/CoreDefine"),c=t("../Common/Define"),l=t("../Common/Language"),u=t("../Common/UI"),h=t("../Common/Zh"),p=t("../Data/RunTime/RunRaw/RJXItem"),d=t("./../../Core/FrameEx/ES5Ex"),f=t("./GameMgr"),g=function(t){function e(){return t.call(this)||this}return n(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!1,configurable:!0}),e.prototype.getEquipLvUpGrowArgs=function(t,e){return t*f.default.lvUpData.getRaw(e).grow},e.prototype.getEquipLvUpExpend=function(t,e){return t*f.default.lvUpData.getRaw(e).moneyUp},e.prototype.getEquipLvUpSale=function(t,e){return t*f.default.lvUpData.getRaw(e).moneySale},e.prototype.testCost=function(t,e,o){void 0===e&&(e=1),void 0===o&&(o=!1);var i={},n=t instanceof Array?p.default.tpl.apply(p.default,t):t,r=f.default.RBagData.getMegreItems(n.id,n.type);if(i.cur=r.num,i.raw=n.raw,n.num>0){var a=Math.floor(i.cur/n.num);return i.enough=a>=e,i.need=n.num*e,i.ext={enoughTimes:Math.max(0,a),enoughCost:Math.max(0,Math.min(a,e)*n.num)},i.enough||(o&&f.default.jumpToMgr.jumpGoTo(u.VIEW_ID.currencyFrame,t,e),i.tip=n.raw.name+l.L(h.JXLocales.currency.not_enough)),i}return i.enough=!0,i.need=0,i.ext={enoughTimes:NaN,enoughCost:NaN},i},e.prototype.checkHavaHeroCanSync=function(){for(var t=f.default.rHeroData.getAllHeros().values(),e=0;e<t.length;e++){var o=t[e],i=this.checkEquipCanSync(o);if(i)return i}return!1},e.prototype.checkEquipCanSync=function(t){for(var e=f.default.RBagData.getHeroEquip(t.tableId),o=r(e.book,e.equip),i=[0,0,0,0,0,0,0,0,0],n=0;n<o.length;n++){var a=f.default.RBagData.getEquipDataById(o[n]);if(a.wear==s.INVALID_VALUE&&a.quality<6&&t.equips.indexOf(o[n])===s.INVALID_VALUE){var c=s.OBJECT_COPY(i[a.quality]);c++,i[a.quality]=c}}for(n=0;n<i.length;n++)if(i[n]&&i[n]>=3)return!0;return!1},e.prototype.checkHaveBoxCanOpen=function(t){var e=this,o=[],i=null;switch(t){case 1:i=f.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.silverBoxOpen);break;case 2:i=f.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.GoldBoxOpen);break;case 3:i=f.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.dearBoxOpen)}i.forEach(function(t,i){if(t!=s.INVALID_VALUE){var n=e.drawType(t,i);n&&o.push(n)}});for(var n=0;n<o.length;n++){var r=new p.default(o[n]),c=f.default.itemMgr.testCost(r);if(c.enough)return c.enough}return!1},e.prototype.drawType=function(t,e){var o=null;return e==c.STOREBUYTYPE.COIN?o=[c.CURRENCY.GOLD,c.ITEM_TYPE.CURRENCY,t]:e==c.STOREBUYTYPE.YUSHI&&(o=[c.CURRENCY.YUSHI,c.ITEM_TYPE.CURRENCY,t]),o},e.prototype.checkHaveEquipCanLv=function(){for(var t=f.default.rHeroData.getAllHeros().values(),e=0;e<t.length;e++){var o=t[e],i=this.checkHeroEquipCanLvUp(o);if(i)return i}return!1},e.prototype.checkHeroEquipCanLvUp=function(t){for(var e=f.default.RBagData.getHeroEquip(t.tableId),o=r(e.book,e.equip),i=0;i<o.length;i++)if(f.default.RBagData.getEquipDataById(o[i]).itemData.raw.quality>=5)return!0;return!1},e}(d.ObjectWrap);o.default=g,cc._RF.pop()},{"../../Core/CoreDefine":"CoreDefine","../../conventions/JXCommon":"JXCommon","../Common/Define":"Define","../Common/Language":"Language","../Common/UI":"UI","../Common/Zh":"Zh","../Data/RunTime/RunRaw/RJXItem":"RJXItem","./../../Core/FrameEx/ES5Ex":"ES5Ex","./GameMgr":"GameMgr"}],ItemSignIn:[function(t,e,o){"use strict";cc._RF.push(e,"f25d4OSfXJLvaCQIVGgpbRp","ItemSignIn");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GView/GChild"),s=t("../../Common/Define"),c=t("../../Common/UIResources"),l=t("../../Logic/GameMgr"),u=cc._decorator,h=u.ccclass,p=u.property,d=u.menu,f=(u.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.icon=null,e.signBtn=null,e.reward=null,e.light=null,e.siginIndata=null,e}return n(e,t),e.prototype.init=function(){},e.prototype.initTextureWithData=function(t,e,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1),this.siginIndata=t;var n=this.siginIndata.award[0];switch(this.assetImpl.spriteAtlasFrame(this.icon,c.Res.texture.views.icon,"icon_100"),n[s.PART_ITEM.TYPE]){case s.ITEM_TYPE.HERO:var r=l.default.heroData.getRaw(n[s.PART_ITEM.ID]);this.reward.string=r.name+"",this.assetImpl.spriteFrame(this.icon,c.Res.texture.hero.hero+this.siginIndata.icon),this.icon.node.setScale(.6),this.light.active=!0,this.assetImpl.spriteAtlasFrame(this.light.getComponent(cc.Sprite),c.Res.texture.views.sign,"ui_jk");break;case s.ITEM_TYPE.PROP:break;case s.ITEM_TYPE.EQUIPDATA:var a=l.default.equipData.getRaw(n[s.PART_ITEM.ID]);this.reward.string=a.name+"",this.assetImpl.spriteAtlasFrame(this.icon,c.Res.texture.views.icon,"icon_"+a.icon),this.assetImpl.spriteAtlasFrame(this.light.getComponent(cc.Sprite),c.Res.texture.views.sign,"ui_zk");break;case s.ITEM_TYPE.CURRENCY:this.assetImpl.spriteAtlasFrame(this.icon,c.Res.texture.views.icon,"icon_"+this.siginIndata.icon),this.reward.string=n[s.PART_ITEM.NUM]+"",this.light.active=!1}},e.prototype.haveSigned=function(){this.signBtn.getComponent(cc.Button).enableAutoGrayEffect=!0,this.signBtn.getComponent(cc.Button).interactable=!1,this.signBtn.getChildByName("recrive").active=!0,this.node.getChildByName("light").active=!1},e.prototype.hideSigned=function(){this.signBtn.getChildByName("recrive").active=!1,this.signBtn.getComponent(cc.Button).enableAutoGrayEffect=!1,this.signBtn.getComponent(cc.Button).interactable=!1,this.node.getChildByName("light").active=!1},e.prototype.recoverySigned=function(){this.signBtn.getChildByName("recrive").active=!1,this.signBtn.getComponent(cc.Button).interactable=!0,this.node.getChildByName("light").active=!0},e.prototype.showTodayToday=function(t){t&&this.hideSigned()},r([p(cc.Sprite)],e.prototype,"icon",void 0),r([p(cc.Node)],e.prototype,"signBtn",void 0),r([p(cc.Label)],e.prototype,"reward",void 0),r([p(cc.Node)],e.prototype,"light",void 0),r([h,d("View/Home/ItemSignIn")],e)}(a.default));o.default=f,cc._RF.pop()},{"../../../Core/GView/GChild":"GChild","../../Common/Define":"Define","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr"}],JXBattleAnalysis:[function(t,e,o){"use strict";cc._RF.push(e,"37ce8kpumdMRapeTqosAZ5q","JXBattleAnalysis");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.JXBattleAnalysis=o.JXBattleStorage=void 0;var r=t("../../Common/Language"),a=t("../../Common/Zh"),s=t("./../../../Core/CoreDefine"),c=(t("./BattleTextParse"),t("./JXBattleDefine")),l=t("./JXBattleUtility"),u=function(){};o.JXBattleStorage=u;var h=function(t){function e(e,o){var i=t.call(this)||this;return i._bool=null,i.insIdGentor=new l.JXIdGenerater("JXAns"),i.iBtlTeams=e,i.defTPL=o,i.record=new l.JXBattleMap,i.maxHps={},i.startHps={},i.endHps={},i.extras={},i.skillInfos={},i.buffInfos={},i.hurtInfos={},i.allHurt=0,i.addHpInfos={},i.addMaxHpInfos={},i.bracksHurtInfos={},i.barrackHps=1e6,i.maxBarrackHps=0,i._DPL_curPlayerID=new l.JXBattleMap,i.heroHurdInfo=new l.JXBattleMap,i}return n(e,t),e.prototype.setFalgs=function(t){this._flags||(this._flags=t,this._flags.setHp(this.maxBarrackHps,this.barrackHps))},e.prototype.setDefToTeam=function(t){var e=this.iBtlTeams[c.JXBtlCamp.Defenser].heroIds.indexOf(t.heroId),o=this.iBtlTeams[c.JXBtlCamp.Defenser];e==s.INVALID_VALUE&&(o.tableIds.push(t.tableId),o.heroIds.push(t.heroId),o.partnerData.push(t))},e.prototype.Get_DPL_curPlayID=function(t){return this._DPL_curPlayerID.get(t)||0},e.prototype.Set_DPL_curPlayID=function(t,e){this._DPL_curPlayerID.set(t,e)},e.prototype.setMaxHp=function(t,e,o){this.maxHps[t]=e,this.startHps[t]=o},e.prototype.setBuffInfo=function(t){this.buffInfos[t.insId]=t},e.prototype.setEndHp=function(t,e){this.endHps[t]=Math.min(e,this.maxHps[t])},e.prototype.setExtra=function(t){this.extras[t.id]=t},e.prototype.setAddHpInfo=function(t){t.insId=this.insIdGentor.getNewId(),this.addHpInfos[t.insId]=t},e.prototype.setAddMaxHpInfo=function(t){t.insId=this.insIdGentor.getNewId(),this.addMaxHpInfos[t.insId]=t},e.prototype.setHurtInfo=function(t){t.insId=this.insIdGentor.getNewId(),this.hurtInfos[t.insId]=t,this.setDelHurt(t.execer,t.damage)},e.prototype.setSkillInfo=function(t){this.skillInfos[t.insId]=t;for(var e=0;e<t.effects.length;e++){var o=t.effects[e];this.buffInfos[o.buffInsId].insSkillId=t.insId}},e.prototype.setBracksDamege=function(t){t.insId=this.insIdGentor.getNewId(),this.bracksHurtInfos[t.insId]=t,this.barrackHps-=t.damage,this.barrackHps<0||(this._flags.setHp(this.maxBarrackHps,this.barrackHps),this._flags.flagsShake(),this._bool.string=r.L(a.JXLocales.fight.bool,this.barrackHps))},e.prototype.pushRecord=function(t,e){var o=this.record.get(t);o||(o=[]),o.push(e),this.record.set(t,o)},e.prototype.write=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var o=t[c.JXBtlArrIx.Zero],i=t[c.JXBtlArrIx.One];switch(o){case c.JXBattleEvt.ROLE_SKILL_PRESS:var n=t[c.JXBtlArrIx.Two];this.pushRecord(i,[o,n.insId]);break;case c.JXBattleEvt.ROLE_SKILL_PRESS_END:this.pushRecord(i,[o,t[c.JXBtlArrIx.Three]]);break;case c.JXBattleEvt.ROLE_SKILL_HURT:case c.JXBattleEvt.ROLE_COM_ATK:case c.JXBattleEvt.ROLE_HURT_2_ATK:var r=t[c.JXBtlArrIx.Two];this.setHurtInfo(r),this.pushRecord(i,[o,r.insId]);break;case c.JXBattleEvt.ROLE_SKILL_ADDHP:var a=t[c.JXBtlArrIx.Two];this.setAddHpInfo(a),this.pushRecord(i,[o,a.insId]);break;case c.JXBattleEvt.ROLE_ATK_2_HP:case c.JXBattleEvt.ROLE_ATK_2_PROTECT:case c.JXBattleEvt.ROLE_HURT_2_PROTECT:case c.JXBattleEvt.ROLE_HURT_2_HP:s=t[c.JXBtlArrIx.Two],this.setAddHpInfo(s),this.pushRecord(i,[o,s.insId]);break;case c.JXBattleEvt.ROLE_SKILL_ADDMAXHP:s=t[c.JXBtlArrIx.Two],this.setAddMaxHpInfo(s),this.pushRecord(i,[o,s.insId]);break;case c.JXBattleEvt.HURT_BARKS:var s=t[c.JXBtlArrIx.Two];this.setBracksDamege(s),this.pushRecord(i,[o,s.insId]);break;case c.JXBattleEvt.ROLE_END:default:this.pushRecord(i,t)}},e.prototype.setDelHurt=function(t,e){var o=this.iBtlTeams[c.JXBtlCamp.Defenser],i=o.heroIds.indexOf(t);if(i!==s.INVALID_VALUE){var n=o.partnerData[i];if(n){var r=this.heroHurdInfo.get(n.tableId);r||(r=0),r+=e,this.allHurt+=e,this.heroHurdInfo.set(n.tableId,r)}}},e.prototype.DPL_reSetDisPlayInfo=function(){this._DPL_curPlayerID.clear()},e.prototype.DPL_getCurRecord=function(t,e){var o=this.Get_DPL_curPlayID(t);if(e){var i=o+1;this.Set_DPL_curPlayID(t,i)}else o-=1;return this.DPL_getCurRecordByID(t,o)},e.prototype.DPL_getCurRecordByID=function(t,e){var o=this.record.get(t);return(o=o||[])[e]},e.prototype.DPL_getRecordsByID=function(t){var e=this.record.get(t);return e||[]},e.prototype.setDefResult=function(t){this.defResult=t,this.isDefWin=t!=c.JXBtlAns_Result.Lost},e.prototype.setBarrackHps=function(t,e){this.barrackHps=t,this._bool=e,this.maxBarrackHps=t,console.log("\u519b\u8425\u8840\u91cf\u4e3a"+t)},e.prototype.maxHurtHero=function(){this.heroHurdInfo.forEach(function(){})},e}(u);o.JXBattleAnalysis=h,cc._RF.pop()},{"../../Common/Language":"Language","../../Common/Zh":"Zh","./../../../Core/CoreDefine":"CoreDefine","./BattleTextParse":"BattleTextParse","./JXBattleDefine":"JXBattleDefine","./JXBattleUtility":"JXBattleUtility"}],JXBattleCb:[function(t,e,o){"use strict";cc._RF.push(e,"8808aEF8V9J0L5U7AXoSlDw","JXBattleCb"),Object.defineProperty(o,"__esModule",{value:!0}),o.JXBattleCb=void 0;o.JXBattleCb=function(){},cc._RF.pop()},{}],JXBattleDefine:[function(t,e,o){"use strict";var i,n,r;cc._RF.push(e,"70073aJc9hEjKVXxo8yZmEv","JXBattleDefine"),Object.defineProperty(o,"__esModule",{value:!0}),o.JXBtlPs=o.JXBattleEvt=o.ERR_SKILL_EFFECT=o.ERR_CB_UN_READY=o.JXBtlMap_Spoce=o.JXBtlAns_Result=o.JXBtlAns_PressModel=o.JXBtlStepType=o.JXBtlAirDis=o.JXBtlRT=o.JXBtlBER=o.JXBtlBEMT=o.JXBtl_Race=o.JXBtlBEM=o.JXBtlSAirTR=o.JXBtlSAirT=o.JXBtlSAirCEM=o.JXBtlSRC=o.JXBtlSSM=o.JXBtlArrIx=o.JXBtlST=o.JXBtlCamp=o.JxBtlCollisionType=o.JXBtlEntityType=void 0,function(t){t[t.Ambient=0]="Ambient",t[t.Role=1]="Role",t[t.Other=2]="Other"}(o.JXBtlEntityType||(o.JXBtlEntityType={})),function(t){t[t.Null=0]="Null",t[t.Unmatched=1]="Unmatched",t[t.Normal=2]="Normal"}(o.JxBtlCollisionType||(o.JxBtlCollisionType={})),function(t){t[t.Attacker=0]="Attacker",t[t.Defenser=1]="Defenser",t[t.NoCamp=2]="NoCamp"}(o.JXBtlCamp||(o.JXBtlCamp={})),function(t){t[t.Global=0]="Global",t[t.Initiat=1]="Initiat",t[t.Passive=2]="Passive",t[t.Pursuit=3]="Pursuit",t[t.Beatback=4]="Beatback"}(n=o.JXBtlST||(o.JXBtlST={})),function(t){t[t.Zero=0]="Zero",t[t.One=1]="One",t[t.Two=2]="Two",t[t.Three=3]="Three",t[t.Four=4]="Four",t[t.Five=5]="Five",t[t.Six=6]="Six",t[t.Seven=7]="Seven",t[t.Eight=8]="Eight",t[t.Nine=9]="Nine",t[t.Ten=10]="Ten"}(o.JXBtlArrIx||(o.JXBtlArrIx={})),function(t){t[t.Idle=0]="Idle",t[t.Passive=1]="Passive",t[t.Preparing=2]="Preparing",t[t.forcePreparing=3]="forcePreparing"}(o.JXBtlSSM||(o.JXBtlSSM={})),function(t){t[t.Every=0]="Every",t[t.Singular=1]="Singular",t[t.Even=2]="Even",t[t.Atked=3]="Atked",t[t.Hited=4]="Hited"}(o.JXBtlSRC||(o.JXBtlSRC={})),function(t){t[t.All=0]="All",t[t.ME=1]="ME",t[t.Enemy=2]="Enemy"}(o.JXBtlSAirCEM||(o.JXBtlSAirCEM={})),function(t){t[t.Any=100]="Any",t[t.Every=101]="Every",t[t.Bing=102]="Bing",t[t.Che=103]="Che",t[t.Ma=104]="Ma",t[t.Pao=105]="Pao",t[t.Xiang=106]="Xiang",t[t.Shi=107]="Shi",t[t.RDSelf=108]="RDSelf",t[t.LastAtk=109]="LastAtk",t[t.LastAtkMe=110]="LastAtkMe"}(o.JXBtlSAirT||(o.JXBtlSAirT={})),function(t){t[t.Every=100]="Every",t[t.RDMinHpOne=101]="RDMinHpOne",t[t.RDMaxHpOne=102]="RDMaxHpOne"}(o.JXBtlSAirTR||(o.JXBtlSAirTR={})),function(t){t[t.Hurt=100]="Hurt",t[t.AddHp=200]="AddHp",t[t.AddProtect=201]="AddProtect",t[t.SubPropts=301]="SubPropts",t[t.SubMulPropts=302]="SubMulPropts",t[t.AddPropts=401]="AddPropts",t[t.AddMulPropts=402]="AddMulPropts",t[t.RoundActivePropts=403]="RoundActivePropts",t[t.AddMaxHp=404]="AddMaxHp",t[t.AtkToHp=501]="AtkToHp",t[t.AtkToProtect=502]="AtkToProtect",t[t.HurtToAtk=601]="HurtToAtk",t[t.HurtToHp=602]="HurtToHp",t[t.HurtToProtect=603]="HurtToProtect",t[t.DBHit=701]="DBHit",t[t.BanAttack=801]="BanAttack",t[t.BanSkill=802]="BanSkill",t[t.Confusion=803]="Confusion",t[t.Mock=804]="Mock",t[t.BanAction=805]="BanAction",t[t.BanAddHp=901]="BanAddHp",t[t.BanBuff=902]="BanBuff",t[t.BanIme=903]="BanIme",t[t.BanProtect=904]="BanProtect",t[t.ImDamage=1001]="ImDamage",t[t.ImDeBuff=1002]="ImDeBuff",t[t.ImDeCtrl=1003]="ImDeCtrl",t[t.ImByBuffId=1004]="ImByBuffId",t[t.ClDamage=1101]="ClDamage",t[t.ClDeBuff=1102]="ClDeBuff",t[t.ClCtl=1103]="ClCtl",t[t.ClAddHp=1104]="ClAddHp",t[t.ClBuff=1105]="ClBuff",t[t.ClIm=1106]="ClIm",t[t.ClByBuffId=1107]="ClByBuffId",t[t.ExEffect=1201]="ExEffect",t[t.Detonated=1202]="Detonated",t[t.RELife=1203]="RELife",t[t.LockHp=1204]="LockHp"}(r=o.JXBtlBEM||(o.JXBtlBEM={})),function(t){t[t.SOLDIER=1]="SOLDIER",t[t.VEHICLE=2]="VEHICLE",t[t.HORSE=3]="HORSE",t[t.CANNON=4]="CANNON",t[t.MUTUALLY=5]="MUTUALLY",t[t.SCHOLAR=6]="SCHOLAR"}(o.JXBtl_Race||(o.JXBtl_Race={})),function(t){t[t.Damage=1]="Damage",t[t.AddHp=2]="AddHp",t[t.DeBuff=3]="DeBuff",t[t.Buff=4]="Buff",t[t.AtkEffect=5]="AtkEffect",t[t.HurtEffect=6]="HurtEffect",t[t.Strengthen=7]="Strengthen",t[t.Ctrl=8]="Ctrl",t[t.Ban=9]="Ban",t[t.Ime=10]="Ime",t[t.Clear=11]="Clear",t[t.Special=12]="Special",t[t.AddFp=13]="AddFp"}(o.JXBtlBEMT||(o.JXBtlBEMT={})),function(t){t[t.Invalid=0]="Invalid",t[t.Cover=1]="Cover",t[t.OverlieMinNum=2]="OverlieMinNum",t[t.OverlieMaxNum=7]="OverlieMaxNum",t[t.Forever=8]="Forever"}(o.JXBtlBER||(o.JXBtlBER={})),function(t){t[t.Card=0]="Card",t[t.Ambient=1]="Ambient"}(o.JXBtlRT||(o.JXBtlRT={})),function(t){t[t.ALL=0]="ALL",t[t.Front=1]="Front",t[t.Center=2]="Center",t[t.Back=3]="Back"}(o.JXBtlAirDis||(o.JXBtlAirDis={})),function(t){t[t.Null=0]="Null",t[t.Buff=1]="Buff",t[t.Main=2]="Main",t[t.Pursuit=3]="Pursuit",t[t.Beatback=4]="Beatback",t[t.Combo=5]="Combo"}(o.JXBtlStepType||(o.JXBtlStepType={})),function(t){t[t.RoundPoll=0]="RoundPoll",t[t.PrepareEnd=1]="PrepareEnd",t[t.Pursuit=2]="Pursuit",t[t.Beatback=3]="Beatback"}(o.JXBtlAns_PressModel||(o.JXBtlAns_PressModel={})),function(t){t[t.Draw=0]="Draw",t[t.Win=1]="Win",t[t.Lost=2]="Lost"}(o.JXBtlAns_Result||(o.JXBtlAns_Result={})),function(t){t[t.TRACK=1]="TRACK",t[t.AROUND=2]="AROUND",t[t.SECTOR=3]="SECTOR",t[t.MAP=4]="MAP"}(o.JXBtlMap_Spoce||(o.JXBtlMap_Spoce={})),o.ERR_CB_UN_READY="you must init all callback handler in static class JXBattleCb!",o.ERR_SKILL_EFFECT="the skill effect not have objective decision condition",function(t){t[t.START=0]="START",t[t.ROLE_BEGIN=1]="ROLE_BEGIN",t[t.ROLE_END=2]="ROLE_END",t[t.ROLE_SKILL_PREPARE=3]="ROLE_SKILL_PREPARE",t[t.ROLE_SKILL_PRESS=4]="ROLE_SKILL_PRESS",t[t.ROLE_SKILL_PRESS_END=5]="ROLE_SKILL_PRESS_END",t[t.ROLE_SKILL_BREAK=6]="ROLE_SKILL_BREAK",t[t.ROLE_COM_ATK=7]="ROLE_COM_ATK",t[t.ROLE_CONTRLED=8]="ROLE_CONTRLED",t[t.ROLE_IMDE=9]="ROLE_IMDE",t[t.ROLE_SKILL_HURT=10]="ROLE_SKILL_HURT",t[t.ROLE_SKILL_ADDHP=11]="ROLE_SKILL_ADDHP",t[t.ROLE_SKILL_ADDMAXHP=12]="ROLE_SKILL_ADDMAXHP",t[t.ROLE_ATK_2_HP=13]="ROLE_ATK_2_HP",t[t.ROLE_HURT_2_ATK=14]="ROLE_HURT_2_ATK",t[t.ROLE_ATK_2_PROTECT=15]="ROLE_ATK_2_PROTECT",t[t.ROLE_HURT_2_HP=16]="ROLE_HURT_2_HP",t[t.ROLE_HURT_2_PROTECT=17]="ROLE_HURT_2_PROTECT",t[t.ROLE_ADD_BUFF=18]="ROLE_ADD_BUFF",t[t.ROLE_PREPARE_BUFF=19]="ROLE_PREPARE_BUFF",t[t.ROLE_REMOVE_BUFF=20]="ROLE_REMOVE_BUFF",t[t.ROLE_DIE=21]="ROLE_DIE",t[t.ROLE_RELIFE=22]="ROLE_RELIFE",t[t.CLEAR_LOCK_HP=23]="CLEAR_LOCK_HP",t[t.LOCK_HP_EFFECT=24]="LOCK_HP_EFFECT",t[t.LIFE_TIME_CHANGE=25]="LIFE_TIME_CHANGE",t[t.DETONATED_BUFF=26]="DETONATED_BUFF",t[t.HURT_BARKS=27]="HURT_BARKS",t[t.END_FIGHT=28]="END_FIGHT"}(o.JXBattleEvt||(o.JXBattleEvt={})),o.JXBtlPs={Invalid:-1,InvalidString:"-1",S:{PCDT:{Type:0,Surplus:1,Rate:2,force:3},PRI:(i={},i[n.Passive]=0,i[n.Global]=1,i[n.Initiat]=2,i[n.Pursuit]=2,i[n.Beatback]=2,i.Normal=10,i)},B:{FLAG:{ROUND_EFFECT:1,EFFECT:2,ACTIVE:4,CALCULAT:8,BREAK:16,CRIT:1<<27,LOCKHP_EFFECT:1<<29,DESTROY:1<<30},PROTECTS:[r.AddProtect,r.AtkToProtect,r.HurtToProtect]},C:{WS:1,BZ:2,CT:3,WS2:4},T:{NATURE_MUL:.1},N:[0],R:{PORPTS:{MAXHP:50,CURHP:51,PROTECT:52},FLAG:{DIE:2,PROPTS:4,LOCKHP:8,TIMESPROPTS:16}},MaxPts:{ProtectWithMaxHp:1},FirstRd:0,PrepareRd:1,MaxRd:16,MaxDamgeMul:10},cc._RF.pop()},{}],JXBattleManager:[function(t,e,o){"use strict";cc._RF.push(e,"5f39asfNThMy5kwVp5ZPNA+","JXBattleManager");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/Math/MathEx"),s=t("../../Common/Language"),c=t("../../Common/Zh"),l=t("./../../../conventions/JXCommon"),u=t("./../../../Core/FrameEx/ES5Ex"),h=t("./../../Common/Define"),p=t("./JXBattleAnalysis"),d=t("./JXBattleCb"),f=t("./JXBattleDefine"),g=t("./JXBattleRole"),_=t("./JXBattleTeam"),m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._anlysis=null,e._cmdMgr=null,e._stepActions=[],e._waitRemoveBuffs=[],e.actionCount={attker:0,defens:0},e}return n(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anlysis",{get:function(){return this._anlysis},enumerable:!1,configurable:!0}),e.cbReady=function(){return!!d.JXBattleCb.getPrng&&!!d.JXBattleCb.getCardData&&!!d.JXBattleCb.getSkillData&&!!d.JXBattleCb.getBuffData&&d.JXBattleCb.getUnitData&&!!d.JXBattleCb.getEffectData},e.prototype.addRemoveBuff=function(t){this._waitRemoveBuffs||(this._waitRemoveBuffs=[]),this._waitRemoveBuffs.push(t)},e.prototype.getTeamByCamp=function(t){return this._teams[t]},e.prototype.fight=function(t,o,i,n,r){if(!e.cbReady())throw new Error(f.ERR_CB_UN_READY);return this._endCb=r,this._cmdMgr=i,this.random=new l.JXRandom(d.JXBattleCb.getPrng,n),this._anlysis=new p.JXBattleAnalysis([t,{heroIds:[],partnerData:[],tableIds:[]}],o),this._teams=[new _.default(t,f.JXBtlCamp.Attacker,i),new _.default(o,f.JXBtlCamp.Defenser,i)],this._ambientEntitys=[],this._ambientEntitys.push(new g.JXBattleAmbienter([],0)),this._ambientEntitys.push(this._teams[f.JXBtlCamp.Attacker].ambienter),this._ambientEntitys.push(this._teams[f.JXBtlCamp.Defenser].ambienter),this._anlysis.randomSeed=this.random.seed.toString(),this._anlysis},e.prototype.update=function(t){if(this.isEndFight())return this._cmdMgr.pauseCmd(),void this._cmdMgr.evtMgr.post(h.CMsg.client.fight_ui.end_fight);var e=[];e.push.apply(e,this._teams[f.JXBtlCamp.Defenser].roles.values()),e.push.apply(e,this._teams[f.JXBtlCamp.Attacker].roles.values()),(e=a.default.fisherYatesShuffle(e)).forEach(function(e){e.update(t)})},e.prototype.isEndFight=function(){var t=this._teams[f.JXBtlCamp.Attacker].getRoles(function(t){return!t.isDie}),e=this._cmdMgr.monsterFactory.isProduceEnd,o=this._cmdMgr.monsterFactory.isProduce;if(0===t.length&&o&&!e){var i=this._cmdMgr.monsterFactory.nextWave();return this._cmdMgr._wave.string=i?s.L(c.JXLocales.fight.wave,this._cmdMgr.monsterFactory.waveNum+1):s.L(c.JXLocales.fight.wave,this._cmdMgr.monsterFactory.waveNum),!1}return this.anlysis.barrackHps<=0?(this._anlysis.setDefResult(f.JXBtlAns_Result.Lost),this._cmdMgr.isEnd=!0,!0):!!(0==t.length&&e&&this._anlysis.barrackHps>0&&o)&&(this._anlysis.setDefResult(f.JXBtlAns_Result.Win),this._cmdMgr.isEnd=!0,!0)},e.prototype.getAllRoles=function(t){void 0===t&&(t=!1);for(var e=[],o=0;o<this._teams.length;o++)e.push.apply(e,this._teams[o].getRoles(function(e){return!!t||!e.isDie}));return e},e.prototype.getEntityById=function(t){if(!t)return cc.error("no heroid"),null;for(var e=0;e<this._teams.length;e++)for(var o=this._teams[e].getRoles(),i=0;i<o.length;i++)if(o[i].id==t)return o[i];return null},e.prototype.getAllEntitys=function(t){void 0===t&&(t=!1);for(var e=this.getAllRoles(t),o=0;o<this._ambientEntitys.length;o++)!t&&this._ambientEntitys[o].isDie||e.push(this._ambientEntitys[o]);return e},e.prototype.cleanWaitRemoveBuffs=function(){for(var t=0;t<this._waitRemoveBuffs.length;t++)this._waitRemoveBuffs[t].destroy();this._waitRemoveBuffs.length=0},e.prototype.addStep=function(t){this._stepActions.push(t)},e.prototype.workSteps=function(){if(this._stepActions&&0!=this._stepActions.length){var t=this._stepActions.shift();t.exec(),t.completed(),e.ins.cleanWaitRemoveBuffs(),this._stepActions.length>0&&this.workSteps()}},e.prototype.getRoleQueue=function(){return this.getAllEntitys(!0)},e.prototype.getAkerLifeNum=function(){for(var t=0,e=0;e<this._teams.length;e++)if(this._teams[e].camp==f.JXBtlCamp.Attacker)for(var o=this._teams[e].roles.values(),i=0;i<o.length;i++)o[i].isDie||t++;return t},e.prototype.onEvent=function(t){for(var e,o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];(e=this._anlysis).write.apply(e,r([t],o)),d.JXBattleCb.evtEmitCb&&d.JXBattleCb.evtEmitCb.apply(d.JXBattleCb,r([t],o))},e}(u.ObjectWrap);o.default=m,cc._RF.pop()},{"../../../Core/Math/MathEx":"MathEx","../../Common/Language":"Language","../../Common/Zh":"Zh","./../../../Core/FrameEx/ES5Ex":"ES5Ex","./../../../conventions/JXCommon":"JXCommon","./../../Common/Define":"Define","./JXBattleAnalysis":"JXBattleAnalysis","./JXBattleCb":"JXBattleCb","./JXBattleDefine":"JXBattleDefine","./JXBattleRole":"JXBattleRole","./JXBattleTeam":"JXBattleTeam"}],JXBattleMonster:[function(t,e,o){"use strict";cc._RF.push(e,"f6ff60vSdlFALVDPy7nJZLw","JXBattleMonster");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var r=t("../../../conventions/JXCommon"),a=t("../../Logic/GameMgr"),s=t("./../../../Core/CoreDefine"),c=t("./../../../Core/FrameEx/ES5Ex"),l=t("./JXBattleDefine"),u=t("./JXBattleManager"),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._monsterBrithInfo=[],e._roadInfo=[],e.timer=null,e.maxWave=s.INVALID_VALUE,e._monsterInterval=s.INVALID_VALUE,e._teamInterval=s.INVALID_VALUE,e._cmd=null,e._produceEnd=!1,e._isProduce=!1,e._tweens=[],e._curIsOver=!1,e._waveNum=0,e}return n(e,t),Object.defineProperty(e.prototype,"isProduceEnd",{get:function(){return this._produceEnd},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isProduce",{get:function(){return this._isProduce},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"waveNum",{get:function(){return this._waveNum},enumerable:!1,configurable:!0}),e.prototype.init=function(t,e,o,i){var n=this;this.maxWave=0,this._tweens=i,this._monsterBrithInfo=t,this._roadInfo=e,this._cmd=o,this._monsterBrithInfo.forEach(function(t){n.maxWave<t.length&&(n.maxWave=t.length)}),this._waveNum=0,this.timer=null,this._monsterInterval=a.default.systemConfig.value(r.JXDef.SYS_CONFIG_KEY.monsterInterval),this._teamInterval=a.default.systemConfig.value(r.JXDef.SYS_CONFIG_KEY.teamInterval)},e.prototype.startRoadAni=function(){for(var t=0;t<this._roadInfo.length;t++)if(this._monsterBrithInfo[t]){var e=this._monsterBrithInfo[t][this._waveNum];e&&e.length&&this._tweens[t].start()}},e.prototype.startProduce=function(){var t=this;if(setTimeout(function(){t._isProduce=!0},2e3),!this._produceEnd){this._curIsOver=!1;for(var e=0;e<this._roadInfo.length;e++)if(this._monsterBrithInfo[e]){var o=this._monsterBrithInfo[e][this._waveNum];if(o){var i=this._roadInfo[e],n=o.shift();n&&this.produceRole(n,i),this.checkAllTeamOver()?(clearTimeout(this.timer),this._curIsOver=!0,this.timer=null):this.timer||(this.timer=setTimeout(function(){clearTimeout(t.timer),t.timer=null,t.startProduce()},1e3*this._monsterInterval))}}}},e.prototype.nextWave=function(){return this._waveNum>=this.maxWave?(clearTimeout(this.timer),this.timer=null,this._produceEnd=!0,console.log("\u602a\u7269\u751f\u6210\u7ed3\u675f"),!1):!!this._curIsOver&&(this._waveNum++,clearTimeout(this.timer),this.startRoadAni(),this.timer=null,this.startProduce(),!0)},e.prototype.checkAllTeamOver=function(){for(var t=!0,e=0;e<this._roadInfo.length;e++)if(this._monsterBrithInfo[e]){var o=this._monsterBrithInfo[e][this._waveNum];if(o&&o.length){t=!1;break}}return t},e.prototype.produceRole=function(t,e){var o=u.default.ins.getTeamByCamp(l.JXBtlCamp.Attacker).goBattle(t);o&&this._cmd.createRole(o.heroId,o.index,l.JXBtlCamp.Attacker,e)},e.prototype.destory=function(){clearTimeout(this.timer),this._produceEnd=!1,this._isProduce=!1,this.timer=null,this._waveNum=0,this.maxWave=0},e}(c.ObjectWrap);o.default=h,cc._RF.pop()},{"../../../conventions/JXCommon":"JXCommon","../../Logic/GameMgr":"GameMgr","./../../../Core/CoreDefine":"CoreDefine","./../../../Core/FrameEx/ES5Ex":"ES5Ex","./JXBattleDefine":"JXBattleDefine","./JXBattleManager":"JXBattleManager"}],JXBattleRole:[function(t,e,o){"use strict";cc._RF.push(e,"9ff70yYdblHHLyOv38KFxGy","JXBattleRole");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.JXBattleAmbienter=o.JXBattleTeamAmbienter=o.JXBattleHero=o.JXBattleTeamEntiry=o.JXBattleEntity=void 0;var r=t("../../../Core/Math/MathEx"),a=t("./../../../conventions/EnumUtil"),s=t("./../../../conventions/JXCommon"),c=t("./../../../Core/CoreDefine"),l=t("./../../Common/Define"),u=t("./JXBattleCb"),h=t("./JXBattleDefine"),p=t("./JXBattleManager"),d=t("./JXBattleSkill"),f=t("./JXBattleStep"),g=t("./JXBattleUtility"),_=function(){function t(t,e){this.camp=h.JXBtlCamp.NoCamp,this.curInitiSkillId=c.INVALID_VALUE,this._cmd=null,this._cd=0,this._curTime=0,this.curRound=1,this.flag=0,this.scopeId=c.INVALID_VALUE,this.lv=1,this._curHurters=[],this._JxRole=null,this._lastComHurter=null,this._lastAtker=null,this.type=t,this.roleType=e,this.flag|=h.JXBtlPs.R.FLAG.PROPTS,this.buffs=[],this.buffMaps=new g.JXBattleMap,this.controlBuffs=[],this.proptEnvs=[]}return Object.defineProperty(t.prototype,"cmd",{get:function(){return this._cmd},set:function(t){this._cmd=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cd",{get:function(){return this._cd},set:function(t){this._cd=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cTime",{get:function(){return this._curTime},set:function(t){this._curTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxHp",{get:function(){return this.collision!=h.JxBtlCollisionType.Normal?0:this._maxHp},set:function(t){this.propts[h.JXBtlPs.R.PORPTS.MAXHP]=this._maxHp=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"curHp",{get:function(){return this.collision!=h.JxBtlCollisionType.Normal?0:this._curHp},set:function(t){this.propts[h.JXBtlPs.R.PORPTS.CURHP]=this._curHp=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tempHp",{get:function(){return this._tempHp||0},set:function(t){this.propts[h.JXBtlPs.R.PORPTS.PROTECT]=this._tempHp=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"jxRole",{get:function(){return this._JxRole||(this._JxRole=this.cmd.getRoleById(this.id)),this._JxRole},enumerable:!1,configurable:!0}),t.prototype.addHurter=function(t){this._curHurters||(this._curHurters=[]);for(var e=0;e<this._curHurters.length;e++)if(this._curHurters[e].id==t.id)return;this._curHurters.push(t)},t.prototype.popHurters=function(){var t=this._curHurters;return this._curHurters=[],t},Object.defineProperty(t.prototype,"lastComHurter",{get:function(){return this._lastComHurter},set:function(t){this._lastComHurter=t,t.lastAtker=this},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastAtker",{get:function(){return this._lastAtker},set:function(t){this._lastAtker=t,t.addHurter(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDie",{get:function(){return!!(this.flag&h.JXBtlPs.R.FLAG.DIE)},enumerable:!1,configurable:!0}),t.prototype.addBuff=function(t){this.buffs||(this.buffs=[]),this.buffs.push(t);var e=this.buffMaps.get(t.effect.nBufId);return e||(e=[],this.buffMaps.set(t.effect.nBufId,e)),e.push(t),this},t.prototype.removeBuff=function(t){if(this.buffs){var e=this.buffMaps.get(t.effect.nBufId);e&&g.JXBattleUtility.fastRemove(e,t),g.JXBattleUtility.remove(this.buffs,t)}},t.prototype.addControlBuff=function(t){this.controlBuffs||(this.controlBuffs=[]),this.controlBuffs.push(t)},t.prototype.removeControlBuff=function(t){this.controlBuffs&&g.JXBattleUtility.remove(this.controlBuffs,t)},t.prototype.hasEffectById=function(t){var e=this.buffMaps.get(t);if(!e)return!1;for(var o=0;o<e.length;o++)if(!e[o].isDestroy)return!0;return!1},t.prototype.getEffectById=function(t){return this.buffMaps.get(t)||[]},t.prototype.getTopEffectSameID=function(t){var e=this.getEffectById(t.effect.nBufId);if(!e)return t;if(0==e.length)return t;for(var o=0;o<e.length;o++)if(!e[o].isDestroy)return e[o]},t.prototype.hasEffectByBEM=function(t){for(var e=0;e<this.buffs.length;e++)if(this.buffs[e].isCanActive&&this.buffs[e].res.effectMold==t)return!0;return!1},t.prototype.getEffectByBEM=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var o=[],i=0;i<this.buffs.length;i++)if(this.buffs[i].isCanActive)for(var n=0;n<t.length;n++)if(t[n]==this.buffs[i].res.effectMold){o.push(this.buffs[i]);break}return o},t.prototype.hasEffectByBEMT=function(t){for(var e=0;e<this.buffs.length;e++)if(this.buffs[e].isCanActive&&this.buffs[e].res.effectType==t)return!0;return!1},t.prototype.getEffectByBEMT=function(t){for(var e=[],o=0;o<this.buffs.length;o++)this.buffs[o].isCanActive&&this.buffs[o].res.effectType==t&&e.push(this.buffs[o]);return e},t.prototype.checkAndTakeBEM=function(t,e){var o=this.getEffectByBEM(t);if(0==o.length)return null;for(var i=0;i<o.length;i++)if(o[i].isCanActive&&!(o[i].priority>e))return o[i].take(),o[i];return null},t.prototype.checkIsSpecialIm=function(t){for(var e=this.getEffectByBEM(h.JXBtlBEM.ImByBuffId),o=0;o<e.length;o++)if(e[o].isCanActive&&e[o].propts==t.effect.nBufId&&!(e[o].priority>t.priority))return e[o].take(),e[o];return null},t.prototype.checkIsBanSkill=function(t,e){if(t<=h.JXBtlPs.S.PRI[h.JXBtlST.Global])return null;var o=this.getEffectByBEM(h.JXBtlBEM.BanSkill,h.JXBtlBEM.BanAction);if(!o)return null;for(var i=0;i<o.length;i++){var n=o[i];if(!n.isDestroy)return n.take(),e&&p.default.ins.onEvent(h.JXBattleEvt.ROLE_CONTRLED,this.id,n.res.effectMold,n.uuid),n}return null},t.prototype.checkIsBanComAtk=function(){var t=this.checkAndTakeBEM(h.JXBtlBEM.BanAttack,h.JXBtlPs.S.PRI.Normal);return t?(p.default.ins.onEvent(h.JXBattleEvt.ROLE_CONTRLED,this.id,h.JXBtlBEM.BanAttack,t.uuid),!0):!!(t=this.checkAndTakeBEM(h.JXBtlBEM.BanAction,h.JXBtlPs.S.PRI.Normal))&&(p.default.ins.onEvent(h.JXBattleEvt.ROLE_CONTRLED,this.id,h.JXBtlBEM.BanAction,t.uuid),!0)},t.prototype.checkIsTimesPropts=function(){this.flag&=~h.JXBtlPs.R.FLAG.TIMESPROPTS;for(var t=0;t<this.buffs.length;t++){var e=this.buffs[t];if(!e.isDestroy&&e.isProptsBuff&&e.isTimesBuff)return void(this.flag|=h.JXBtlPs.R.FLAG.TIMESPROPTS)}},t.prototype.getPropts=function(t){if(this.collision==h.JxBtlCollisionType.Null)return 0;if(!(this.flag&h.JXBtlPs.R.FLAG.PROPTS))return this.proptCaches[t]||0;this.flag&=~h.JXBtlPs.R.FLAG.PROPTS,this.proptCaches=g.JXBattleUtility.copyArray(this.propts),g.JXBattleUtility.addToPropts(this.proptEnvs,this.proptCaches);for(var e=0;e<this.buffs.length;e++){var o=this.buffs[e];o.isDestroy||o.isProptsBuff&&(o.isTimesBuff||g.JXBattleUtility.addToPropts(o.propts,this.proptCaches))}for(var i in h.JXBtlPs.MaxPts){if(!h.JXBtlPs.MaxPts[i])return;var n=parseInt(i);this.proptCaches[n]=g.JXBattleUtility.clamp(this.proptCaches[n],h.JXBtlPs.MaxPts[i].min,h.JXBtlPs.MaxPts[i].max)}return this.proptCaches[t]||0},t.prototype.getBasePropts=function(t){return this.propts[t]||0},t.prototype.getTimesPropts=function(t){for(var e=0,o=0;o<this.buffs.length;o++){var i=this.buffs[o];i.isProptsBuff&&i.isTimesBuff&&i.propts[t]&&(i.isDestroy||(e+=i.propts[t],i.take()))}return e},t.prototype.onLockHp=function(){if(this.flag&h.JXBtlPs.R.FLAG.LOCKHP){for(var t,e=0;e<this.buffs.length;e++)if(this.buffs[e].res.effectMold==h.JXBtlBEM.LockHp&&this.buffs[e].stateFlag&h.JXBtlPs.B.FLAG.LOCKHP_EFFECT){t=this.buffs[e];break}t&&(this.onSkillAddHp(t),t.endLockHp()),p.default.ins.onEvent(h.JXBattleEvt.CLEAR_LOCK_HP,this.id),this.flag&=~h.JXBtlPs.R.FLAG.LOCKHP}},t.prototype.onControlRoundBuff=function(){for(var t=0;t<this.controlBuffs.length;t++)this.controlBuffs[t].onControlRoundBegin();p.default.ins.cleanWaitRemoveBuffs()},t.prototype.onStartRoundBuff=function(){for(var t=this.getEffectByBEMT(h.JXBtlBEMT.AddHp),e=0;e<t.length;e++)t[e].active();var o=this.getEffectByBEMT(h.JXBtlBEMT.Damage);for(e=0;e<o.length;e++)o[e].active();var i=this.getEffectByBEMT(h.JXBtlBEMT.Clear);for(e=0;e<i.length;e++)i[e].active();p.default.ins.cleanWaitRemoveBuffs()},t.prototype.onNormalSkillAction=function(t){var e=r.default.fisherYatesShuffle(this.skills);if(this.skills=e,this.isSkillPrepare()){for(var o=0;o<this.skills.length;o++)if(this.skills[o].state==h.JXBtlSSM.forcePreparing){this.skills[o].onEnterSkill(t);break}return!0}for(o=0;o<this.skills.length;o++)if(!this.skills[o].isPursuit()&&!this.skills[o].isBeatback()&&(t!=h.JXBtlPs.FirstRd||this.skills[o].isPassive())&&!this.checkIsBanSkill(h.JXBtlPs.S.PRI[this.skills[o].skillRes.type],!0)&&this.skills[o].onEnterSkill(t)&&!this.skills[o].isPassive())return!0;return!1},t.prototype.calculatDamge=function(t,e){void 0===e&&(e=h.JXBtlPs.C.WS);var o=p.default.ins.random.getRandom()<this.getPropts(l.PART_PROPTS.BaoJi),i=p.default.ins.random.getRandom()<t.getPropts(l.PART_PROPTS.ShanBi),n=o?this.getPropts(l.PART_PROPTS.BaoShang):1;switch(e){case h.JXBtlPs.C.WS:return[(this.getPropts(l.PART_PROPTS.GongJi)-t.getPropts(l.PART_PROPTS.FangYu)+this.getPropts(l.PART_PROPTS.BingGong)-t.getPropts(l.PART_PROPTS.BingKang)+this.getPropts(l.PART_PROPTS.HuoGong)-t.getPropts(l.PART_PROPTS.HuoKang))*n,o,i];case h.JXBtlPs.C.CT:return[(this.getPropts(l.PART_PROPTS.GongJi)+this.getPropts(l.PART_PROPTS.BingGong)+this.getPropts(l.PART_PROPTS.HuoGong))*n,o,i];case h.JXBtlPs.C.BZ:return[(this.getPropts(l.PART_PROPTS.GongJi)-t.getPropts(l.PART_PROPTS.FangYu)+this.getPropts(l.PART_PROPTS.BingGong)-t.getPropts(l.PART_PROPTS.BingKang)+this.getPropts(l.PART_PROPTS.HuoGong)-t.getPropts(l.PART_PROPTS.HuoKang))*n,o,!1];case h.JXBtlPs.C.WS2:var r=this.getPropts(l.PART_PROPTS.GongJi)-t.getPropts(l.PART_PROPTS.FangYu),a=this.getPropts(l.PART_PROPTS.BingGong)-t.getPropts(l.PART_PROPTS.BingKang),s=this.getPropts(l.PART_PROPTS.HuoGong)-t.getPropts(l.PART_PROPTS.HuoKang);return[Math.max(r,a,s),o,i]}},t.prototype.calculateDamageMul=function(t,e,o){return e.raceType,o.raceType,(t*=1)<=0&&(t=0),t},t.prototype.onHurt=function(t,e){void 0===e&&(e=!1);var o=this._tempHp;if(t=Math.floor(t),this.jxRole&&this.jxRole.changePreState(),this._tempHp>0){this.tempHp=g.JXBattleUtility.clamp(this._tempHp-t,0,this._tempHp);var i=o-this._tempHp;if(i>=t)return[0,i,null];t-=i}var n=this.curHp;if(this.curHp=g.JXBattleUtility.clamp(this.curHp-Math.floor(t),0,this.maxHp),this.curHp<=0){if(this.flag&h.JXBtlPs.R.FLAG.LOCKHP)return this.curHp=1,p.default.ins.onEvent(h.JXBattleEvt.LOCK_HP_EFFECT,this.id,Math.floor(t)),[0,0,null];var r=this.getEffectByBEM(h.JXBtlBEM.LockHp);r.length>0?(r[h.JXBtlArrIx.Zero].startLockHp(),r[h.JXBtlArrIx.Zero].take(),this.curHp=1,this.flag|=h.JXBtlPs.R.FLAG.LOCKHP,p.default.ins.onEvent(h.JXBattleEvt.LOCK_HP_EFFECT,this.id,Math.floor(t))):this.onDie()}return[Math.floor(n-this.curHp),o,null]},t.prototype.onSkillHurt=function(t){var e,o,i=t.propts,n=t.effect.skill.our,r=null;i=this.calculateDamageMul(i,n,this,t.effect.nBufId),i=(e=this.onHurt(i))[0],o=e[1],r=e[2];var a={insId:null,execer:n.id,target:this.id,damage:i,protect:o,isCrit:!!(t.stateFlag&h.JXBtlPs.B.FLAG.CRIT),insBuff:t.ansBuff.insId,isImDamage:null!=r,targetIsDie:this.isDie};return p.default.ins.onEvent(h.JXBattleEvt.ROLE_SKILL_HURT,this.id,a),t.ansBuff.effects.push(a.insId),r&&r.isDestroy&&r.setDestroy(),this.isDie&&p.default.ins.onEvent(h.JXBattleEvt.ROLE_DIE,this.id),a},t.prototype.onSkillAddHp=function(t){var e=t.propts,o=h.JXBtlPs.B.PROTECTS.indexOf(t.res.effectMold)!=h.JXBtlPs.Invalid;if(o?e=this.onAddHp(e,o):(e=this.onAddHp(e))<=0&&(e=0),!e)return null;var i={insId:null,execer:t.effect.skill.our.id,target:this.id,isProtect:o,isCrit:!!(t.stateFlag&h.JXBtlPs.B.FLAG.CRIT),addNum:e,insBuff:t.uuid};return p.default.ins.onEvent(h.JXBattleEvt.ROLE_SKILL_ADDHP,this.id,i),t.ansBuff.effects.push(i.insId),i},t.prototype.onSkillAddMaxHp=function(t){var e=Math.floor(t.propts[h.JXBtlPs.R.PORPTS.MAXHP]||0);if(!(e<=0)){var o=this.maxHp,i=this.curHp;this.maxHp=o+e,this.curHp=i+e;var n={insId:null,execer:t.effect.skill.our.id,target:this.id,insBuff:t.uuid,addNum:Math.floor(e),oldMaxHp:o};return p.default.ins.onEvent(h.JXBattleEvt.ROLE_SKILL_ADDMAXHP,this.id,n),t.ansBuff.effects.push(n.insId),n}},t.prototype.onAtkingEvent=function(t,e){this.onAtk2Hp(e),this.onAtk2Protect(e)},t.prototype.onHurtingEvent=function(t,e,o){this.isDie||e.isImDamage||(o&&!o.lifeTimer&&(this.lastAtker=t),this.onHurt2Atk(t,e,o),this.onHurt2Hp(t,e),this.onHurt2Protect(t,e))},t.prototype.onHurt2Hp=function(t,e){if(!this.isDie){var o=this.getEffectByBEM(h.JXBtlBEM.HurtToHp);if(0!=o.length){var i=o[h.JXBtlArrIx.Zero];if(!this.checkAndTakeBEM(h.JXBtlBEM.BanAddHp,i.priority)){var n=i.effect.skill.our,r=n.getPropts(i.propts[h.JXBtlArrIx.Zero])*i.propts[h.JXBtlArrIx.One],a=i.runtimeRate;if(0!=r&&p.default.ins.random.getRandom()<a){r=this.onAddHp(r);var s={insId:null,execer:n.id,target:this.id,addNum:r,insHurt:e.insId,insBuff:o[0].uuid};return p.default.ins.onEvent(h.JXBattleEvt.ROLE_HURT_2_HP,this.id,s),e.ins2DefHp=s.insId,!0}}}}},t.prototype.onHurt2Protect=function(t,e){if(!this.isDie){var o=this.getEffectByBEM(h.JXBtlBEM.HurtToProtect);if(0!=o.length){var i=o[h.JXBtlArrIx.Zero];if(!this.checkAndTakeBEM(h.JXBtlBEM.BanProtect,i.priority)){var n=i.effect.skill.our,r=n.getPropts(i.propts[h.JXBtlArrIx.Zero])*i.propts[h.JXBtlArrIx.One],a=i.runtimeRate;if(p.default.ins.random.getRandom()<a){r=this.onAddHp(r,!0);var s={insId:null,execer:n.id,target:this.id,addNum:r,insHurt:e.insId,insBuff:o[0].uuid,isProtect:!0};return p.default.ins.onEvent(h.JXBattleEvt.ROLE_HURT_2_PROTECT,this.id,s),e.ins2DefHp=s.insId,!0}}}}},t.prototype.onAddHp=function(t,e){if(void 0===e&&(e=!1),t=Math.floor(t),e){var o=this.tempHp,i=this.tempHp+t;return this.tempHp=g.JXBattleUtility.clamp(i,0,this.maxHp*h.JXBtlPs.MaxPts.ProtectWithMaxHp),this.tempHp-o}var n=this.curHp,r=this.curHp+t;return this.curHp=g.JXBattleUtility.clamp(r,0,this.maxHp),this.curHp-n},t.prototype.onHurt2Atk=function(t,e){var o,i=e.damage;if(0!=i&&!t.isDie&&t.collision==h.JxBtlCollisionType.Normal){for(var n=this.getEffectByBEM(h.JXBtlBEM.HurtToAtk),r=0,a=0,s=0;s<n.length;s++)n[s].isCanActive&&(r+=n[s].propts,a=Math.max(a,n[s].runtimeRate||0));if(!(r<=0)&&p.default.ins.random.getRandom()<a){var c,l;i*=r,i=(o=t.onHurt(i))[0],l=o[1],c=o[2];var u={insId:null,execer:this.id,target:t.id,damage:i,protect:l,insFromHurt:e.insId,isImDamage:null!=c,targetIsDie:t.isDie,insBuff:n[0].uuid};p.default.ins.onEvent(h.JXBattleEvt.ROLE_HURT_2_ATK,t.id,u),e.ins2Hurt=u.insId,c&&c.isDestroy&&c.setDestroy(),t.isDie&&p.default.ins.onEvent(h.JXBattleEvt.ROLE_DIE,t.id)}}},t.prototype.onAtk2Hp=function(t){var e=t.damage+t.protect;if(0!=e&&!this.checkAndTakeBEM(h.JXBtlBEM.BanAddHp,h.JXBtlPs.S.PRI.Normal)){for(var o=this.getEffectByBEM(h.JXBtlBEM.AtkToHp),i=0,n=0,r=0;r<o.length;r++)o[r].isCanActive&&(i+=o[r].propts,n=Math.max(n,o[r].runtimeRate||0));if(0!=i&&p.default.ins.random.getRandom()<n){var a=e*i;(a=this.onAddHp(a))<=0&&(a=0);var s={insId:null,target:this.id,execer:this.id,insHurt:t.insId,addNum:a,insBuff:o[0].uuid};p.default.ins.onEvent(h.JXBattleEvt.ROLE_ATK_2_HP,this.id,s),t.ins2AtkHp=s.insId}}},t.prototype.onAtk2Protect=function(t){var e=t.damage+t.protect;if(0!=e&&!this.checkAndTakeBEM(h.JXBtlBEM.BanProtect,h.JXBtlPs.S.PRI.Normal)){for(var o=this.getEffectByBEM(h.JXBtlBEM.AtkToProtect),i=0,n=0,r=0;r<o.length;r++)o[r].isCanActive&&(i+=o[r].propts,n=Math.max(n,o[r].runtimeRate||0));if(0!=i&&p.default.ins.random.getRandom()<n){var a=e*i;a=this.onAddHp(a,!0);var s={insId:null,target:this.id,execer:this.id,insHurt:t.insId,addNum:a,isProtect:!0,insBuff:o[0].uuid};p.default.ins.onEvent(h.JXBattleEvt.ROLE_ATK_2_PROTECT,this.id,s),t.ins2AtkHp=s.insId}}},t.prototype.onDie=function(){this.flag|=h.JXBtlPs.R.FLAG.DIE;for(var t=0;t<this.buffs.length;t++)this.buffs[t].setDestroy();for(t=0;t<this.controlBuffs.length;t++){var e=this.controlBuffs[t];e.effect.skill.isGlobal()||e.setDestroy()}p.default.ins.cleanWaitRemoveBuffs()},t.prototype.clearBuffsByEffectType=function(t,e){for(var o=this.getEffectByBEMT(e),i=t.propts||o.length,n=o.length-1;n>=0&&0!=i;n--)o[n].isDestroy||o[n].priority<t.priority||(o[n].setDestroy(),t.take(),i--)},t.prototype.clearBuffsByEffectId=function(t){for(var e=this.getEffectById(t.propts),o=0;o<e.length;o++)e[o].isDestroy||e[o].priority<t.priority||(e[o].setDestroy(),t.take())},t.prototype.isSkillPrepare=function(){for(var t=0;t<this.skills.length;t++)if(this.skills[t].state==h.JXBtlSSM.forcePreparing)return!0},t.prototype.onEndRound=function(){for(var t=0;t<this.buffs.length;t++)this.buffs[t].isDestroy||this.buffs[t].resetRoundEffect()},t}();o.JXBattleEntity=_;var m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.bindTeam=function(t){return this.team=t,this.camp=t.camp,this},e.prototype.update=function(t){this.cTime+=t,this.cTime>=this.cd&&(this.cTime=0,this.jxRole.checkRoleIsEnd()&&(this.roleStartAction(),this.curRound++))},e.prototype.roleStartAction=function(){var t=new f.JXBattleBuffTake(this,this.curRound);p.default.ins.addStep(t),p.default.ins.workSteps(),this.onEndRound(),this.curInitiSkillId=c.INVALID_VALUE},e.prototype.onComAttack=function(t,e){var o;if(this.checkIsBanComAtk())return null;if(!e){var i,n=[],a=this.jxRole;i=this.cmd.btlMapConverts.converToMapPos(a.birthPos),n.push.apply(n,this.team.enemyTeam().getRolesByPos(i,this.scopeId)),n.length>0&&(e=(n=r.default.fisherYatesShuffle(n))[r.default.random(0,n.length-1)])}if(!e)return null;if(this.camp===e.camp||this.id===e.id)return null;var s,c=this.calculatDamge(e),l=c[0],u=c[1],d=c[2];l=this.calculateDamageMul(l,this,e),l=(o=e.onHurt(l))[0],s=o[1];var f={insId:null,execer:this.id,target:e.id,protect:s,damage:l,isCrit:u,targetIsDie:e.isDie,isImDamage:d};return this.lastComHurter=e,this.onAtkingEvent(e,f),e.onHurtingEvent(this,f),p.default.ins.onEvent(h.JXBattleEvt.ROLE_COM_ATK,e.id,f),e.isDie&&p.default.ins.onEvent(h.JXBattleEvt.ROLE_DIE,e.id),f},e.prototype.onAfterComAttack=function(t){for(var e=this.skills,o=0;o<e.length;o++)if(e[o].isPursuit()&&e[o].onEnterSkill(t))return e[o];return null},e.prototype.onBeatbackSkill=function(t){for(var e=0;e<this.skills.length;e++)if(this.skills[e].isBeatback()&&this.skills[e].onEnterSkill(t))return this.skills[e];return null},e.prototype.onCombo=function(){for(var t=this.getEffectByBEM(h.JXBtlBEM.DBHit),e=0;e<t.length;e++)if(!t[e].isRoundEffect)return t[e].take(!0),!0;return!1},e}(_);o.JXBattleTeamEntiry=m;var y=function(t){function e(e,o,i){var n=t.call(this,h.JXBtlEntityType.Role,h.JXBtlRT.Card)||this;n.id=e.heroId,n.posiiton=i,n.cmd=o.cmd,n.collision=h.JxBtlCollisionType.Normal,n.bindTeam(o),n.res=u.JXBattleCb.getCardData(e.tableId),n.roleType=n.res.type,n.scopeId=n.res.scope,n.cd=n.res.cd,n.propts=s.JXMath.newArray(a.EnumUtil.size(l.PART_PROPTS));for(var r=0;r<e.propts.length;r++)n.propts[r]=e.propts[r];n.propts[h.JXBtlPs.R.PORPTS.MAXHP]=n.maxHp=Math.floor(e.maxHp),n.curHp=Math.floor(null==e.curHp?n.maxHp:e.curHp),n.tempHp=0,n.propts[l.PART_PROPTS.FormulaMaxHp]||(n.propts[l.PART_PROPTS.FormulaMaxHp]=n.maxHp),n.lv=1,n.heroType=n.res.type,p.default.ins.anlysis.setMaxHp(n.id,n.maxHp,n.curHp),n.skills=[];var c=e.skillIds;for(r=0;r<c.length;r++)n.skills[r]=new d.JXBattleSkill(c[r],r),n.skills[r].our=n;return n}return n(e,t),e}(m);o.JXBattleHero=y;var v=function(t){function e(e,o,i,n){var r=t.call(this,h.JXBtlEntityType.Ambient,h.JXBtlRT.Ambient)||this;r.id=n||g.JXBattleUtility.AmbientGtor.getNewId(),r.collision=h.JxBtlCollisionType.Null,r.posiiton=o,r.bindTeam(i),r.skills=[];for(var a=0;a<e.length;a++)r.skills[a]=new d.JXBattleSkill(e[a][h.JXBtlArrIx.Zero],a),r.skills[a].our=r;return p.default.ins.anlysis.setExtra({id:r.id,position:r.posiiton,collisiton:r.collision,type:r.type,camp:r.team.camp,skills:e}),r}return n(e,t),e}(m);o.JXBattleTeamAmbienter=v;var C=function(t){function e(e,o,i){var n=t.call(this,h.JXBtlEntityType.Ambient,h.JXBtlRT.Ambient)||this;n.collision=h.JxBtlCollisionType.Null,n.posiiton=o,n.id=i||g.JXBattleUtility.AmbientGtor.getNewId(),n.skills=[];for(var r=0;r<e.length;r++)n.skills[r]=new d.JXBattleSkill(e[r][h.JXBtlArrIx.Zero],r),n.skills[r].our=n;return p.default.ins.anlysis.setExtra({id:n.id,position:n.posiiton,collisiton:n.collision,type:n.type,skills:e,camp:n.camp}),n}return n(e,t),e}(_);o.JXBattleAmbienter=C,cc._RF.pop()},{"../../../Core/Math/MathEx":"MathEx","./../../../Core/CoreDefine":"CoreDefine","./../../../conventions/EnumUtil":"EnumUtil","./../../../conventions/JXCommon":"JXCommon","./../../Common/Define":"Define","./JXBattleCb":"JXBattleCb","./JXBattleDefine":"JXBattleDefine","./JXBattleManager":"JXBattleManager","./JXBattleSkill":"JXBattleSkill","./JXBattleStep":"JXBattleStep","./JXBattleUtility":"JXBattleUtility"}],JXBattleSkill:[function(t,e,o){"use strict";cc._RF.push(e,"93de3KpbtJEE7bQ5OhesiaM","JXBattleSkill");var i=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0}),o.JXBattleBuff=o.JXBattleSkill=o.JXBattleEffect=void 0;var n=t("../../../Core/Math/MathEx"),r=t("../../Logic/GameMgr"),a=t("./../../../Core/CoreDefine"),s=t("./../../Common/Define"),c=t("./JXBattleCb"),l=t("./JXBattleDefine"),u=t("./JXBattleManager"),h=t("./JXBattleRole"),p=t("./JXBattleUtility"),d=l.JXBtlPs.B.FLAG,f=function(){function t(t,e,o){this.nIndex=t,this.nBufId=e,this.nBufRate=1,this.nBufPrepare=0,this.nBufDuration=o}return Object.defineProperty(t.prototype,"priority",{get:function(){return this.skill?this.skill.priority:null},enumerable:!1,configurable:!0}),t.prototype.addInGroup=function(t){this.groups||(this.groups=[]),this.groups.push(t),t.groups=this.groups,t.groupRoot=this,t.bindContinue(this.continues)},t.prototype.bindTarget=function(t){return this.skill=t,this},t.prototype.bindAffect=function(t){return this.affect=t,this},t.prototype.bindContinue=function(t){return this.continues=t,this},t.prototype.activeChild=function(t,e,o){var i=new _(this),n=i.bindTarget(t);return n&&e&&e.addInGroup(i),o.push({index:this.nIndex,effectId:this.nBufId,target:t.id,buffInsId:i.uuid}),n},t.prototype.bindAtkTargets=function(t){this.targets=t},t.prototype.active=function(){var t=[],e=this.targets;if(e&&0!=e.length){for(var o=0;o<e.length;o++){var i=new _(this),n=i.bindTarget(e[o]);if(this.groups&&this.groups.indexOf(this)==l.JXBtlPs.Invalid)for(var r=0;r<this.groups.length;r++){var a=this.groups[r].activeChild(e[o],n,t);n=n||a}var s=[];n&&(n==i?(s.push(i),i.groups&&i.groups.length>0&&s.push.apply(s,i.groups)):(s.push(n),n.groups&&n.groups.length>0&&s.push.apply(s,n.groups)));for(var c=0;c<s.length;c++)s[c].onCreate();t.splice(0,0,{index:this.nIndex,effectId:this.nBufId,target:e[o].id,buffInsId:i.uuid})}return t}},t}();o.JXBattleEffect=f;var g=function(){function t(t,e){this.state=l.JXBtlSSM.Idle,this.effects=[],this.skillId=t,this.skillRes=c.JXBattleCb.getSkillData(t),this.skillIdx=e;var o=this.skillRes.affect;this.bindCondition.apply(this,this.skillRes.position);for(var n=0;n<this.skillRes.skillEffect.length;n++){var r=this.skillRes.skillEffect[n],a=o[n],s=(new(f.bind.apply(f,i([void 0,n],r)))).bindTarget(this);s.bindAffect(a);var u=this.skillRes.position;if(u&&u.length>0)s.bindContinue([1,this.skillRes.condition[l.JXBtlPs.S.PCDT.Rate]]),this.effects.push(s);else{var h=this.effects[this.effects.length-1];if(!h)throw new Error(l.ERR_SKILL_EFFECT);h.addInGroup(s)}}}return Object.defineProperty(t.prototype,"priority",{get:function(){return l.JXBtlPs.S.PRI[this.skillRes.type]},enumerable:!1,configurable:!0}),t.prototype.bindCondition=function(t,e,o,i){return this.nAirCamp=t,this.nAirType=e,this.nAirRange=o,this.nAirNum=i,this},t.prototype.isGlobal=function(){return this.skillRes.type==l.JXBtlST.Global},t.prototype.isPassive=function(){return this.skillRes.type==l.JXBtlST.Passive},t.prototype.isInitiat=function(){return this.skillRes.type===l.JXBtlST.Initiat},t.prototype.isPursuit=function(){return this.skillRes.type==l.JXBtlST.Pursuit},t.prototype.isBeatback=function(){return this.skillRes.type==l.JXBtlST.Beatback},t.prototype.press=function(t){var e,o=this.getTargets();if(o.length){var i={skillId:this.skillId,insId:u.default.ins.anlysis.insIdGentor.getNewId(),effects:[],model:t,execer:this.our.id,type:this.skillRes.type};u.default.ins.onEvent(l.JXBattleEvt.ROLE_SKILL_PRESS,this.our.id,i);for(var n=0;n<this.effects.length;n++){this.effects[n].bindAtkTargets(o);var r=this.effects[n].active();u.default.ins.cleanWaitRemoveBuffs(),r&&(e=i.effects).push.apply(e,r)}u.default.ins.anlysis.setSkillInfo(i),u.default.ins.onEvent(l.JXBattleEvt.ROLE_SKILL_PRESS_END,this.our.id,t,i.insId)}},t.prototype.getTargets=function(){if(void 0!==this.nAirCamp){var t=[];return this.emCondition(t),this.spoceCondition(t),this.airPosCondition(t),this.rangeCondition(t),this.numCondition(t),this.isEndCondition(t),this.emRecheck(t),t}},t.prototype.emCondition=function(t){var e=this.our;this.nAirCamp!==l.JXBtlSAirCEM.All&&this.nAirCamp!=l.JXBtlSAirCEM.Enemy||t.push.apply(t,e.team.enemyTeam().getRoles(function(t){return!t.isDie})),this.nAirCamp!==l.JXBtlSAirCEM.All&&this.nAirCamp!=l.JXBtlSAirCEM.ME||t.push.apply(t,e.team.getRoles(function(t){return!t.isDie}))},t.prototype.emRecheck=function(t){if(this.nAirCamp!=l.JXBtlSAirCEM.All)for(var e=t.length-1;e>=0;e--){var o,i=t[e];o=this.our.camp===l.JXBtlCamp.Defenser?this.nAirCamp===l.JXBtlSAirCEM.Enemy?l.JXBtlCamp.Attacker:l.JXBtlCamp.Defenser:this.nAirCamp===l.JXBtlSAirCEM.Enemy?l.JXBtlCamp.Defenser:l.JXBtlCamp.Attacker,i.camp!=o&&p.JXBattleUtility.fastRemoveAt(t,e)}},t.prototype.spoceCondition=function(t){var e,o=this.our,i=o.jxRole;e=i.cmd.btlMapConverts.converToMapPos(i.birthPos);var n=r.default.mapMgr.getAdjacent(o.scopeId,e);n.push(e);for(var a=t.length-1;a>=0;a--){for(var s=t[a].jxRole,c=s.cmd.btlMapConverts.converToMapPos(s.birthPos),u=!1,h=0;h<n.length;h++)if(n[h].x===c.x&&n[h].y===c.y){u=!0,this.our.id==t[a].id&&this.nAirCamp===l.JXBtlSAirCEM.Enemy&&(u=!1);break}u||p.JXBattleUtility.fastRemoveAt(t,a)}},t.prototype.airPosCondition=function(t){if(this.nAirType!==a.INVALID_VALUE)for(var e=t.length-1;e>=0;e--)switch(this.nAirType){case l.JXBtlSAirT.Any:t=[t[n.default.random(0,t.length-1)]];break;case l.JXBtlSAirT.Every:break;case l.JXBtlSAirT.RDSelf:t[e]!=this.our&&p.JXBattleUtility.fastRemoveAt(t,e);break;case l.JXBtlSAirT.Bing:t[e].raceType!=l.JXBtl_Race.SOLDIER&&p.JXBattleUtility.fastRemoveAt(t,e);break;case l.JXBtlSAirT.Che:t[e].raceType!=l.JXBtl_Race.VEHICLE&&p.JXBattleUtility.fastRemoveAt(t,e);break;case l.JXBtlSAirT.Ma:t[e].raceType!=l.JXBtl_Race.HORSE&&p.JXBattleUtility.fastRemoveAt(t,e);break;case l.JXBtlSAirT.Xiang:t[e].raceType!=l.JXBtl_Race.MUTUALLY&&p.JXBattleUtility.fastRemoveAt(t,e);break;case l.JXBtlSAirT.Pao:t[e].raceType!=l.JXBtl_Race.CANNON&&p.JXBattleUtility.fastRemoveAt(t,e);break;case l.JXBtlSAirT.Shi:t[e].raceType!=l.JXBtl_Race.SCHOLAR&&p.JXBattleUtility.fastRemoveAt(t,e);break;case l.JXBtlSAirT.Bing:t[e].raceType!=l.JXBtl_Race.SOLDIER&&p.JXBattleUtility.fastRemoveAt(t,e);break;case l.JXBtlSAirT.LastAtk:if(t.length=0,!(this.our instanceof h.JXBattleTeamEntiry))break;(o=this.our.lastComHurter)&&!o.isDie&&t.push(o);break;case l.JXBtlSAirT.LastAtkMe:if(t.length=0,!(this.our instanceof h.JXBattleTeamEntiry))break;var o;(o=this.our.lastAtker)&&!o.isDie&&o.collision==l.JxBtlCollisionType.Normal&&t.push(o)}},t.prototype.rangeCondition=function(t){if(this.nAirRange!=l.JXBtlSAirTR.Every&&this.nAirRange!==a.INVALID_VALUE)if(this.nAirRange==l.JXBtlSAirTR.RDMaxHpOne){if((e=1)>=t.length)return;t.sort(function(t,e){return e.curHp-t.curHp}),t.splice(e,t.length-e)}else if(this.nAirRange==l.JXBtlSAirTR.RDMinHpOne){var e;if((e=1)>=t.length)return;t.sort(function(t,e){return t.curHp-e.curHp}),t.splice(e,t.length-e)}},t.prototype.numCondition=function(t){if(this.nAirNum!==a.INVALID_VALUE)for(var e=t.length-1;e>=0;e--)t.length>this.nAirNum&&p.JXBattleUtility.fastRemoveAt(t,e)},t.prototype.isEndCondition=function(t){for(var e=t.length-1;e>=0;e--)t[e].jxRole.checkRoleIsEnd()||p.JXBattleUtility.fastRemoveAt(t,e)},t.prototype.onEnterSkill=function(t){return!(!this.roundCondition(t)||!this.boolCondition(t)||!this.randomConditon()||!this.isPursuit()&&!this.isBeatback()&&(this.press(l.JXBtlAns_PressModel.RoundPoll),0))},t.prototype.roundCondition=function(t){var e=this.skillRes.condition[l.JXBtlPs.S.PCDT.Type];if(!p.JXBattleUtility.isNumber(e))return e.indexOf(t)!=l.JXBtlPs.Invalid;if(0==t)return!1;switch(e){case l.JXBtlSRC.Every:return!0;case l.JXBtlSRC.Singular:return t%2!=0;case l.JXBtlSRC.Even:return t%2==0;default:return!1}},t.prototype.boolCondition=function(t){var e=this.skillRes.condition[l.JXBtlPs.S.PCDT.Surplus];return 0!==t&&(e===a.INVALID_VALUE||this.our.curHp/this.our.maxHp<=e)},t.prototype.randomConditon=function(){var t=this.skillRes.condition[l.JXBtlPs.S.PCDT.Rate];return u.default.ins.random.getRandom()<=t},t}();o.JXBattleSkill=g;var _=function(){function t(t){this.perpareTimer=null,this.lifeTimer=null,this._takeTimes=0,this._nMaxTakeTimes=0,this._totalDamageHurtTimesEnv=null,this._totalAddHpTimesEnv=null,this._runtimeRate=null,this._stateFlag=0,this.effect=t,this.res=c.JXBattleCb.getEffectData(t.nBufId),this.uuid=p.JXBattleUtility.BuffIdGtor.getNewId(),this._takeTimes=0,this.ansBuff={insId:this.uuid,index:t.nIndex,buffId:this.effect.nBufId,execer:this.effect.skill.our.id,effects:[]}}return Object.defineProperty(t.prototype,"runtimeRate",{get:function(){return this._runtimeRate},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stateFlag",{get:function(){return this._stateFlag},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDestroy",{get:function(){return!!(this._stateFlag&d.DESTROY)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCalculatPropts",{get:function(){return!!(this._stateFlag&d.CALCULAT)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRoundEffect",{get:function(){return!!(this._stateFlag&d.ROUND_EFFECT)},enumerable:!1,configurable:!0}),t.prototype.resetRoundEffect=function(){this._stateFlag&=~d.ROUND_EFFECT},Object.defineProperty(t.prototype,"isCanActive",{get:function(){return!!(this._stateFlag&d.ACTIVE)&&!this.isDestroy&&!this.isRoundEffect},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isProptsBuff",{get:function(){return this.res.effectMold==l.JXBtlBEM.SubPropts||this.res.effectMold==l.JXBtlBEM.SubMulPropts||this.res.effectMold==l.JXBtlBEM.AddPropts||this.res.effectMold==l.JXBtlBEM.AddMulPropts||this.res.effectMold==l.JXBtlBEM.RoundActivePropts},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isTimesBuff",{get:function(){return this._nMaxTakeTimes>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"priority",{get:function(){return this.effect?this.effect.priority:null},enumerable:!1,configurable:!0}),t.prototype.bindTarget=function(t){this.ansBuff.target=t.id,u.default.ins.anlysis.setBuffInfo(this.ansBuff);var e=l.JXBtlPs.Invalid;switch(this.res.effectType){case l.JXBtlBEMT.Damage:e=l.JXBtlBEM.ImDamage;break;case l.JXBtlBEMT.AddHp:e=l.JXBtlPs.B.PROTECTS.indexOf(this.res.effectMold)!=l.JXBtlPs.Invalid?l.JXBtlBEM.BanProtect:l.JXBtlBEM.BanAddHp;break;case l.JXBtlBEMT.DeBuff:e=l.JXBtlBEM.ImDeBuff;break;case l.JXBtlBEMT.Buff:e=l.JXBtlBEM.BanBuff;break;case l.JXBtlBEMT.Ctrl:e=l.JXBtlBEM.ImDeCtrl;break;case l.JXBtlBEMT.Ime:e=l.JXBtlBEM.BanIme}if(e!=l.JXBtlPs.Invalid){var o=t.checkAndTakeBEM(e,this.priority);if(o)return this.ansBuff.imBuffId=o.uuid,void u.default.ins.onEvent(l.JXBattleEvt.ROLE_IMDE,t.id,l.JXBtlBEM.ImDeCtrl,this.effect.nBufId,o.effect.nBufId)}var i=this.buffRp();if(i==l.JXBtlBER.Invalid){if(t.hasEffectById(this.effect.nBufId))return void(this.ansBuff.imBuffId=this.uuid)}else if(i==l.JXBtlBER.Cover)for(var n=(r=t.getEffectById(this.effect.nBufId)).length-1;n>=0;n--)r[n].setDestroy();else if(i>=l.JXBtlBER.OverlieMinNum&&i<=l.JXBtlBER.OverlieMaxNum){var r;if((r=t.getEffectById(this.effect.nBufId)).length>=i)return void(this.ansBuff.imBuffId=this.uuid)}return this.target=t,this.target.addBuff(this),this.effect.skill.our.addControlBuff(this),this},t.prototype.unBindTarget=function(){this.target&&(this.isProptsBuff&&(this.target.flag|=l.JXBtlPs.R.FLAG.PROPTS),this.target.removeBuff(this),this.effect.skill.our.removeControlBuff(this),u.default.ins.onEvent(l.JXBattleEvt.ROLE_REMOVE_BUFF,this.effect.skill.our.id,this.uuid,this.effect.skill.skillId,this.effect.nBufId,this.target.id))},t.prototype.addInGroup=function(t){this.groups||(this.groups=[]),this.groups.push(t),t.groupsRoot=this},t.prototype.removeFromGroup=function(){this.groupsRoot&&(p.JXBattleUtility.remove(this.groupsRoot.groups,this),this.groupsRoot=null)},t.prototype.buffRp=function(){return l.JXBtlBER.Forever},t.prototype.onCreate=function(){this.effect.skill.isGlobal()&&this.calculatGlobalEffectCaches(),0!=this.effect.nBufPrepare?this.startPerpare():this.onEnterLife()},t.prototype.setDestroy=function(){this.isDestroy||(this._stateFlag|=d.DESTROY,this._stateFlag&d.LOCKHP_EFFECT||u.default.ins.addRemoveBuff(this))},t.prototype.take=function(t){void 0===t&&(t=!1),this._takeTimes++,t&&(this._stateFlag|=d.ROUND_EFFECT),0!=this.maxTakeTimes()&&this._takeTimes>=this.maxTakeTimes()&&this.setDestroy()},t.prototype.startLockHp=function(){this._stateFlag|=d.LOCKHP_EFFECT},t.prototype.endLockHp=function(){this._stateFlag&=~d.LOCKHP_EFFECT,this.isDestroy&&this.setDestroy()},t.prototype.destroy=function(){if(this.groups)for(var t=this.groups.length-1;t>=0;t--)this.groups[t].removeFromGroup();this.groups=null,this.removeFromGroup(),this.unBindTarget(),this.perpareTimer&&this.perpareTimer.destroy(),this.lifeTimer&&this.lifeTimer.destroy(),this.perpareTimer=null,this.lifeTimer=null,this._globalProptsCaches=null},t.prototype.maxTakeTimes=function(){return this._nMaxTakeTimes},t.prototype.startPerpare=function(){var t=this.effect.nBufPrepare;return this.perpareTimer=new p.JXRoundTimer(t,this.onPerpared.bind(this)),u.default.ins.onEvent(l.JXBattleEvt.ROLE_PREPARE_BUFF,this.effect.skill.our.id,this.uuid,t),this.ansBuff.prepareRd=t,this},t.prototype.onPerpared=function(){this.perpareTimer.destroy(),this.perpareTimer=null,this.onEnterLife()},t.prototype.onEnterLife=function(){if(0==this.effect.nBufDuration)return this.calculatEffect(),this.active(),void this.setDestroy();var t=this.effect.nBufDuration;u.default.ins.onEvent(l.JXBattleEvt.ROLE_ADD_BUFF,this.target.id,this.uuid,this.effect.skill.skillId,this.effect.nBufId,this.effect.skill.our.id,this.target.id),this.lifeTimer=new p.JXRoundTimer(t,this.onEndLife.bind(this)),this.ansBuff.lifeRd=t,this.curRoundLifeCheck(),this.isCanActive&&(this.calculatEffect(),this.res.effectType!=l.JXBtlBEMT.Buff&&this.res.effectType!=l.JXBtlBEMT.DeBuff&&this.res.effectType!=l.JXBtlBEMT.Ctrl&&this.res.effectType!=l.JXBtlBEMT.AddHp&&this.res.effectType!=l.JXBtlBEMT.AddFp||this.active())},t.prototype.onControlRoundBegin=function(){this._stateFlag&=~(d.ACTIVE|d.CALCULAT),this.isDestroy||(this.perpareTimer?this.perpareTimer.life():(this.lifeTimer&&this.lifeTimer.life(),this.isDestroy||(this.curRoundBreakCheck(),this.curRoundLifeCheck(),this.calculatEffect(),!this.isCanActive||this.res.effectType!=l.JXBtlBEMT.Buff&&this.res.effectType!=l.JXBtlBEMT.DeBuff||this.active())))},t.prototype.curRoundLifeCheck=function(){!this.groupsRoot||this.groupsRoot.isDestroy||0!=this.effect.continues.length?0==this.effect.continues.length||this.effect.continues[l.JXBtlArrIx.Zero]>=u.default.ins.random.getRandom()?this._stateFlag|=d.ACTIVE:this._stateFlag&=~d.ACTIVE:this._stateFlag&d.ACTIVE?this._stateFlag|=d.ACTIVE:this._stateFlag&=~d.ACTIVE},t.prototype.active=function(){var t,e;if(!this.target.isDie){var o;switch(this.res.effectMold){case l.JXBtlBEM.Hurt:if(this.target.collision!=l.JxBtlCollisionType.Normal)break;var i=this.target.onSkillHurt(this);this.effect.skill.our.onAtkingEvent(this.target,i,this),this.target.onHurtingEvent(this.effect.skill.our,i,this),o=i;break;case l.JXBtlBEM.AddHp:if(this.target.collision!=l.JxBtlCollisionType.Normal)break;if(this.target.checkAndTakeBEM(l.JXBtlBEM.BanAddHp,this.priority))break;o=this.target.onSkillAddHp(this);break;case l.JXBtlBEM.AddProtect:if(this.target.checkAndTakeBEM(l.JXBtlBEM.BanProtect,this.priority))break;o=this.target.onSkillAddHp(this);break;case l.JXBtlBEM.ClDamage:this.target.clearBuffsByEffectType(this,l.JXBtlBEMT.Damage);break;case l.JXBtlBEM.ClDeBuff:this.target.clearBuffsByEffectType(this,l.JXBtlBEMT.DeBuff);break;case l.JXBtlBEM.ClCtl:this.target.clearBuffsByEffectType(this,l.JXBtlBEMT.Ctrl);break;case l.JXBtlBEM.ClAddHp:this.target.clearBuffsByEffectType(this,l.JXBtlBEMT.AddHp);break;case l.JXBtlBEM.ClBuff:this.target.clearBuffsByEffectType(this,l.JXBtlBEMT.Buff);break;case l.JXBtlBEM.ClIm:this.target.clearBuffsByEffectType(this,l.JXBtlBEMT.Ime);break;case l.JXBtlBEM.ClByBuffId:this.target.clearBuffsByEffectId(this);break;case l.JXBtlBEM.BanSkill:for(var n=0;n<this.target.skills.length;n++)this.target.skills[n].priority<this.priority||this.take();break;case l.JXBtlBEM.AddMaxHp:if(this.target.collision!=l.JxBtlCollisionType.Normal)break;o=this.target.onSkillAddMaxHp(this);break;case l.JXBtlBEM.SubPropts:case l.JXBtlBEM.SubMulPropts:case l.JXBtlBEM.AddPropts:case l.JXBtlBEM.AddMulPropts:case l.JXBtlBEM.RoundActivePropts:if(this.ansBuff.effects.push(this.propts),this.propts[l.JXBtlPs.R.PORPTS.PROTECT]){var r=this.target.onAddHp(Math.floor(this.propts[l.JXBtlPs.R.PORPTS.PROTECT]),!0),a={insId:null,execer:this.effect.skill.our.id,target:this.target.id,isCrit:!1,addNum:r,isProtect:!0,insBuff:this.uuid};u.default.ins.onEvent(l.JXBattleEvt.ROLE_SKILL_ADDHP,this.target.id,a)}if(this._nMaxTakeTimes>0){this.target.checkIsTimesPropts();break}this.target.flag|=l.JXBtlPs.R.FLAG.PROPTS;break;case l.JXBtlBEM.RELife:if(this.target.isDie){this.target.flag&=~l.JXBtlPs.R.FLAG.DIE;var c=Math.floor(this.target.getPropts(s.PART_PROPTS.FormulaMaxHp)*this.propts);this.target.onAddHp(c),u.default.ins.onEvent(l.JXBattleEvt.ROLE_RELIFE,this.target.id,this.uuid,this.target.id,c)}break;case l.JXBtlBEM.ExEffect:var h=this.propts,p=h[0],f=h[1],g=this.target.getEffectById(p),_=[];for(n=0;n<g.length;n++)g[n].isDestroy||g[n].lifeTimer&&(g[n].effect.skill.isGlobal()||(g[n].lifeTimer.addTotalTimes(f),_.push(g[n].uuid)));(t=this.ansBuff.effects).push.apply(t,_),u.default.ins.onEvent(l.JXBattleEvt.LIFE_TIME_CHANGE,this.target.id,this.uuid,_,f);break;case l.JXBtlBEM.Detonated:for(var m=this.propts,y=(p=m[0],m[1]),v=(g=this.target.getEffectById(p),[]),C=(n=0,Math.min(y,g.length));n<C&&!this.effect.skill.our.isDie&&!this.target.isDie;n++){var I=g[n];if(!I.isDestroy){this._stateFlag|=d.CALCULAT,I.calculatEffect();var E=I.active();v.push({uuid:I.uuid,effect:E?E.insId:null})}}(e=this.ansBuff.effects).push.apply(e,v),u.default.ins.onEvent(l.JXBattleEvt.DETONATED_BUFF,this.target.id,this.uuid,v)}return o}},t.prototype.curRoundBreakCheck=function(){this.groupsRoot&&0==this.effect.continues.length?this.groupsRoot._stateFlag&d.BREAK&&(this._stateFlag|=d.BREAK,this.setDestroy()):(0==this.effect.continues.length||this.effect.continues[l.JXBtlArrIx.One]>u.default.ins.random.getRandom())&&(this._stateFlag|=d.BREAK,this.setDestroy())},t.prototype.onEndLife=function(){this.lifeTimer.destroy(),this.lifeTimer=null,this.setDestroy()},t.prototype.calculatEffect=function(t){if(!(this._stateFlag&d.CALCULAT))if(this._stateFlag|=d.CALCULAT,this.effect.skill.isGlobal()){var e=this.lifeTimer?this.lifeTimer.nLife:0;this.propts=this._globalProptsCaches[e]}else{var o=this.effect.affect[l.JXBtlArrIx.Zero];if(o){var i=this["effectFormula_"+o];i&&i.call(this,t)}}},t.prototype.calculatGlobalEffectCaches=function(){this._globalProptsCaches=[];for(var t=this.effect.nBufDuration?this.effect.nBufDuration:1,e=0;e<t;e++){this.propts=null;var o=this.effect.affect[l.JXBtlArrIx.Zero];if(!o)return;var i=this["effectFormula_"+o];if(!i)return;i.call(this,e),this._globalProptsCaches.push(this.propts)}},t.prototype.affectValue=function(t){for(var e=[],o=this.effect.decay||0,i=null!=t?t:this.lifeTimer?this.lifeTimer.nLife:0,n=l.JXBtlArrIx.One;n<this.effect.affect.length;n++)e[n]=this.effect.affect[n]*(1+o*i);return e},t.prototype.effectFormula_1=function(t){var e=this.affectValue(t),o=(e[0],e[1]),i=this.effect.skill.our.calculatDamge(this.target),n=i[0];i[1]?this._stateFlag|=d.CRIT:this._stateFlag&=~d.CRIT,this.propts=n*o},t.prototype.effectFormula_2=function(t){var e=this.affectValue(t),o=(e[0],e[1]);this.propts=this.target.getPropts(s.PART_PROPTS.GongJi)*o},t.prototype.effectFormula_3=function(t){var e=this.affectValue(t),o=(e[0],e[1]),i=e[2];this.propts=[],this.propts[o]=i},t.prototype.effectFormula_4=function(t){var e=this.affectValue(t),o=(e[0],e[1]),i=e[2];this.propts=[],this.propts[o]=this.target.getBasePropts(o)*i},t.prototype.effectFormula_5=function(t){var e=[l.JXBtlPs.Invalid,s.PART_PROPTS.GongJi,s.PART_PROPTS.FangYu,s.PART_PROPTS.XueLiang,s.PART_PROPTS.BaoJi,s.PART_PROPTS.ShanBi,s.PART_PROPTS.BaoShang],o=this.affectValue(t);this.propts=[];for(var i=l.JXBtlArrIx.One;i<e.length;i++)this.propts[e[i]]=o[i]},t.prototype.effectFormula_6=function(t){var e=[l.JXBtlPs.Invalid,s.PART_PROPTS.GongJi,s.PART_PROPTS.FangYu,s.PART_PROPTS.XueLiang,s.PART_PROPTS.BaoJi,s.PART_PROPTS.ShanBi,s.PART_PROPTS.BaoShang],o=this.affectValue(t);this.propts=[];for(var i=l.JXBtlArrIx.One;i<e.length;i++)this.propts[e[i]]=this.target.getBasePropts(e[i])*o[i]},t.prototype.effectFormula_7=function(t){var e=this.affectValue(t),o=(e[0],e[1]),i=e[2],n=e[3];this.propts=[],this.propts[o]=i,this._nMaxTakeTimes=n},t.prototype.effectFormula_8=function(t){var e=this.affectValue(t),o=(e[0],e[1]),i=e[2],n=e[3];this.propts=[],this.propts[o]=this.target.getPropts(o)*i,this._nMaxTakeTimes=n},t.prototype.effectFormula_9=function(t){var e=this.affectValue(t),o=(e[0],e[1]),i=e[2],n=e[3];this.propts=[],this.propts[o]=this.target.getPropts(i)*n},t.prototype.effectFormula_10=function(t){var e=this.affectValue(t),o=(e[0],e[1]),i=e[2],n=e[3],r=e[4],a=e[5];this.propts=[],this.propts[o]=Math.floor((this.target.getPropts(i)-this.target.getPropts(n))/(1*r))*a},t.prototype.effectFormula_11=function(t){var e=this.affectValue(t),o=(e[0],e[1]);this.propts=o},t.prototype.effectFormula_12=function(t){var e=this.affectValue(t),o=(e[0],e[1]);this._nMaxTakeTimes=o},t.prototype.effectFormula_13=function(t){var e=this.affectValue(t),o=(e[0],e[1]),i=e[2];this.propts=[o,i]},t.prototype.effectFormula_14=function(t){var e=this.affectValue(t),o=(e[0],e[1]),i=e[2];this.propts=o,this._nMaxTakeTimes=i},t.prototype.effectFormula_15=function(t){var e=this.affectValue(t),o=(e[0],e[1]),i=e[2],n=e[3];this._nMaxTakeTimes=o;var r=this.effect.skill.our;this.propts=r.getPropts(i)*n},t.prototype.effectFormula_16=function(t){var e=this.affectValue(t),o=(e[0],e[1]),i=e[2];this._nMaxTakeTimes=o;var n=this.effect.skill.our.calculatDamge(this.target),r=n[0];n[1]?this._stateFlag|=d.CRIT:this._stateFlag&=~d.CRIT,this.propts=r*i},t.prototype.effectFormula_101=function(t){var e=this.affectValue(t),o=(e[0],e[1]),i=this.effect.skill.our.calculatDamge(this.target,l.JXBtlPs.C.CT),n=i[0];i[1]?this._stateFlag|=d.CRIT:this._stateFlag&=~d.CRIT,this.propts=n*o},t.prototype.effectFormula_102=function(t){var e=this.affectValue(t),o=(e[0],e[1]),i=e[2],n=this.effect.skill.our.calculatDamge(this.target,l.JXBtlPs.C.CT),r=n[0];n[1]?this._stateFlag|=d.CRIT:this._stateFlag&=~d.CRIT,this.propts=r*o+Math.floor(i*this.target.getPropts(s.PART_PROPTS.FormulaMaxHp)/this.target.curHp)*this.target.getPropts(s.PART_PROPTS.FormulaMaxHp)},t.prototype.effectFormula_103=function(t){var e=this.affectValue(t),o=(e[0],e[1]),i=this.effect.skill.our.calculatDamge(this.target,l.JXBtlPs.C.BZ),n=i[0];i[1]?this._stateFlag|=d.CRIT:this._stateFlag&=~d.CRIT,this.propts=n*o},t.prototype.effectFormula_104=function(t){var e=this.affectValue(t),o=(e[0],e[1]),i=this.effect.skill.our.calculatDamge(this.target,l.JXBtlPs.C.WS2),n=i[0];i[1]?this._stateFlag|=d.CRIT:this._stateFlag&=~d.CRIT,this.propts=n*o},t.prototype.effectFormula_201=function(t){var e=this.affectValue(t),o=(e[0],e[1]);this.propts=o},t.prototype.effectFormula_202=function(t){var e=this.affectValue(t),o=(e[0],e[1]);this.propts=this.target.getPropts(s.PART_PROPTS.FormulaMaxHp)*o},t.prototype.effectFormula_301=function(t){var e=this.affectValue(t),o=(e[0],e[1]),i=e[2],n=e[3];this._runtimeRate=o,this.propts=i,this._nMaxTakeTimes=n},t.prototype.effectFormula_302=function(t){var e=this.affectValue(t),o=(e[0],e[1]),i=e[2],n=e[3],r=e[4];this._runtimeRate=o,this.propts=[i,n],this._nMaxTakeTimes=r},t}();o.JXBattleBuff=_,cc._RF.pop()},{"../../../Core/Math/MathEx":"MathEx","../../Logic/GameMgr":"GameMgr","./../../../Core/CoreDefine":"CoreDefine","./../../Common/Define":"Define","./JXBattleCb":"JXBattleCb","./JXBattleDefine":"JXBattleDefine","./JXBattleManager":"JXBattleManager","./JXBattleRole":"JXBattleRole","./JXBattleUtility":"JXBattleUtility"}],JXBattleStep:[function(t,e,o){"use strict";cc._RF.push(e,"8aadfi7UcRNr5A9Qio+UmrK","JXBattleStep");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.JXBattleComboStep=o.JXBattlePursuitStep=o.JXBattleHurtStep=o.JXBattleRdMain=o.JXBattleBuffTake=o.JXBattleStep=void 0;var r=t("./JXBattleDefine"),a=t("./JXBattleManager"),s=t("./JXBattleRole"),c=function(){function t(t,e){this.type=r.JXBtlStepType.Null,this.entity=null,this.entity=t,this.nRound=e}return t.prototype.exec=function(){console.log("11")},t.prototype.completed=function(){},t.prototype.dealWithPursuit=function(t,e){if(t==r.JXBtlPs.Invalid||this.entity.isDie)return!1;if(e){var o=this.entity.onAfterComAttack(this.nRound);return!!o&&(e.hasPursuit=!0,a.default.ins.addStep(new p(this.entity,this.nRound,o,t)),!0)}},t.prototype.dealWithBeatback=function(){for(var t=this.entity.popHurters(),e=!1,o=0;o<t.length;o++){var i=t[o];if(!i.isDie){var n=i,r=n.onBeatbackSkill(this.nRound);r&&(a.default.ins.addStep(new h(n,this.nRound,r,this.entity)),e=!0)}}return e},t.prototype.dealWithCombo=function(t){return this.entity.collision==r.JxBtlCollisionType.Normal&&t!=r.JXBtlPs.Invalid&&!(this.entity.isDie||!this.entity.onCombo())&&(a.default.ins.addStep(new d(this.entity,this.nRound,t)),!0)},t}();o.JXBattleStep=c;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=r.JXBtlStepType.Buff,e}return n(e,t),e.prototype.exec=function(){this.entity.onControlRoundBuff(),this.entity.isDie||(this.entity.onLockHp(),this.entity.onStartRoundBuff(this.nRound))},e.prototype.completed=function(){this.entity.isDie||a.default.ins.addStep(new u(this.entity,this.nRound))},e}(c);o.JXBattleBuffTake=l;var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=r.JXBtlStepType.Main,e._atkCombo=r.JXBtlPs.Invalid,e}return n(e,t),e.prototype.exec=function(){this.entity.onNormalSkillAction(this.nRound)||this.nRound!=r.JXBtlPs.FirstRd&&this.entity.collision==r.JxBtlCollisionType.Normal&&this.entity instanceof s.JXBattleTeamEntiry&&(this._comAtkHurtInfo=this.entity.onComAttack(0),this._comAtkHurtInfo&&this._atkCombo++)},e.prototype.completed=function(){this.nRound!=r.JXBtlPs.FirstRd&&(this.dealWithPursuit(this._atkCombo,this._comAtkHurtInfo)||(this.dealWithBeatback(),this.dealWithCombo(this._atkCombo)))},e}(c);o.JXBattleRdMain=u;var h=function(t){function e(e,o,i,n){var a=t.call(this,e,o)||this;return a.type=r.JXBtlStepType.Beatback,a._skill=i,a._atker=n,a}return n(e,t),e.prototype.exec=function(){this._skill.press(r.JXBtlAns_PressModel.Beatback)},e.prototype.completed=function(){this._atker.isDie||this.entity.popHurters()},e}(c);o.JXBattleHurtStep=h;var p=function(t){function e(e,o,i,n){var a=t.call(this,e,o)||this;return a.type=r.JXBtlStepType.Pursuit,a.skill=i,a._atkCombo=n,a}return n(e,t),e.prototype.exec=function(){this.skill.press(r.JXBtlAns_PressModel.Pursuit)},e.prototype.completed=function(){this.dealWithBeatback(),this.dealWithCombo(this._atkCombo)},e}(c);o.JXBattlePursuitStep=p;var d=function(t){function e(e,o,i){var n=t.call(this,e,o)||this;return n._atkCombo=i,n}return n(e,t),e.prototype.exec=function(){if(this.entity.isDie)return!1;var t=this.entity;this._comAtkHurtInfo=t.onComAttack(this._atkCombo+1),this._comAtkHurtInfo&&this._atkCombo++},e.prototype.completed=function(){this.dealWithPursuit(this._atkCombo,this._comAtkHurtInfo)||(this.dealWithBeatback(),this.dealWithCombo(this._atkCombo))},e}(c);o.JXBattleComboStep=d,cc._RF.pop()},{"./JXBattleDefine":"JXBattleDefine","./JXBattleManager":"JXBattleManager","./JXBattleRole":"JXBattleRole"}],JXBattleTeam:[function(t,e,o){"use strict";cc._RF.push(e,"a71d8EbjLVONpSad9lBrgsq","JXBattleTeam"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../../../Core/CoreDefine"),n=t("../../Logic/GameMgr"),r=t("./JXBattleDefine"),a=t("./JXBattleManager"),s=t("./JXBattleRole"),c=t("./JXBattleUtility"),l=function(){function t(t,e,o){this.iTeam=null,this.size=100,this.camp=e,this.cmd=o,this.iTeam=t,this.roles=new c.JXBattleMap,this.outBtlRoles=new c.JXBattleMap,this.ambienter=new s.JXBattleTeamAmbienter([],this.camp+1,this)}return t.prototype.goBattle=function(t){for(var e,o=null,a=0;a<this.iTeam.partnerData.length;a++)this.iTeam.partnerData[a].heroId===t&&(o=i.OBJECT_COPY(this.iTeam.partnerData[a]));if(o&&(this.camp===r.JXBtlCamp.Defenser&&(o.heroId=n.default.rHeroData.insIdGentor.getNewId()),0!=o.curHp))return e=new s.JXBattleHero(o,this,this.size),o.index=this.size,this.roles.set(this.size,e),this.size++,o},t.prototype.outBattle=function(t){if(this.roles.has(t)){var e=this.roles.get(t);this.outBtlRoles.set(t,e),this.roles.delete(t)}},t.prototype.goBtlById=function(t){if(this.outBtlRoles.has(t)){var e=this.outBtlRoles.get(t);this.roles.set(t,e),this.outBtlRoles.delete(t)}else cc.error("\u4e0a\u5468\u5931\u8d25")},t.prototype.sycRole=function(t,e){var o=this.outBtlRoles.get(t),i=this.outBtlRoles.get(e);if(o&&i)return o.maxHp+=i.maxHp,o.curHp+=i.curHp,o.lv+=1,o.propts.forEach(function(t,e){e<r.JXBtlPs.R.PORPTS.MAXHP&&(o.propts[e]+=i.propts[e])}),i.onDie(),this.outBtlRoles.delete(e),{maxHp:o.maxHp,curHp:o.curHp};cc.error("\u5408\u6210\u5931\u8d25,")},t.prototype.enemyTeam=function(){return a.default.ins.getTeamByCamp(this.camp>0?0:1)},t.prototype.getRoles=function(t){var e=[];return this.roles.forEach(function(o){t&&!t(o)||e.push(o)}),e},t.prototype.getRolesByPos=function(t,e){var o=this,i=[],r=n.default.mapMgr.getAdjacent(e,t);return this.roles.forEach(function(t){var e=o.cmd.getRoleById(t.id);if(cc.isValid(e)){var n=cc.v2();n=o.cmd.btlMapConverts.converToMapPos(e.birthPos);for(var a=0;a<r.length;a++){var s=r[a];if(s.x===n.x&&s.y===n.y&&!t.isDie&&t.jxRole.checkRoleIsEnd()){i.push(t);break}}}}),i},t}();o.default=l,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../Logic/GameMgr":"GameMgr","./JXBattleDefine":"JXBattleDefine","./JXBattleManager":"JXBattleManager","./JXBattleRole":"JXBattleRole","./JXBattleUtility":"JXBattleUtility"}],JXBattleUtility:[function(t,e,o){"use strict";cc._RF.push(e,"7a06aIsrGhDU5K4k+Z8/qwU","JXBattleUtility"),Object.defineProperty(o,"__esModule",{value:!0}),o.JXRoundTimer=o.JXBattleMap=o.JXBattleUtility=o.JXIdGenerater=void 0;var i=t("./JXBattleDefine"),n=".",r=function(){function t(t){this._id=0|998*Math.random(),this._prefix=t?t+n:""}return t.prototype.getNewId=function(){return this._prefix+ ++this._id},t.prototype.getOffsetId=function(t){return this._prefix+(this._id+t)},t}();o.JXIdGenerater=r;var a=function(){function t(){}return t.isNumber=function(t){return"number"==typeof t||t instanceof Number},t.fastRemove=function(t,e){var o=t.indexOf(e);return!(o==i.JXBtlPs.Invalid||o>=t.length||(t[o]=t[t.length-1],t.pop(),0))},t.fastRemoveAt=function(t,e){return!(e==i.JXBtlPs.Invalid||e>=t.length||(t[e]=t[t.length-1],t.pop(),0))},t.remove=function(t,e){var o=t.indexOf(e);return o!=i.JXBtlPs.Invalid&&(t.splice(o,1),!0)},t.computePropts=function(t,e){if("number"==typeof t)return(e=e||0)+t;e=e||[];for(var o=0;o<t.length;o++)e[o]=e[o]||0,e[o]=e[o]+t[o];return e},t.addToPropts=function(t,e){if(t&&t.length)for(var o=0;o<t.length;o++)t[o]&&(e[o]=e[o]||0,e[o]=e[o]+t[o])},t.subToPropts=function(t,e){for(var o=0;o<t.length;o++)t[o]&&e[o]&&(e[o]=e[o]+t[o])},t.copyArray=function(t){for(var e=[],o=0;o<t.length;o++)e[o]=t[o];return e},t.clamp=function(t,e,o){if(e>o){var i=e;e=o,o=i}return t<e?e:t<o?t:o},t.minZero=function(t){return Math.max(0,t)},t.BuffIdGtor=new r("JXBf"),t.EffectGRoupGtor=new r("JXEC"),t.AmbientGtor=new r("JXAb"),t}();o.JXBattleUtility=a;var s=function(){function t(){this._size=0,this._objects=Object.create(null),this._size=0}return Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),t.prototype.clear=function(){this._objects=Object.create(null),this._size=0},t.prototype.has=function(t){return t in this._objects},t.prototype.set=function(t,e){this.has(t)||this._size++,this._objects[t]=e},t.prototype.get=function(t){return this.has(t)?this._objects[t]:null},t.prototype.delete=function(t){this.has(t)&&(delete this._objects[t],this._size--)},t.prototype.keys=function(){return Object.keys(this._objects)},t.prototype.values=function(){var t=this,e=this.keys(),o=[];return e.forEach(function(e){o.push(t.get(e))}),o},t.prototype.toArray=function(){var t=this,e=[];return this.keys().forEach(function(o){e.push([o,t.get(o)])}),e},t.prototype.forEach=function(t){for(var e=this.keys(),o=0;o<e.length;o++){var i=t(this._objects[e[o]],e[o]);if(i)return i}},t.prototype.rforEach=function(t){for(var e=this.keys(),o=e.length-1;o>=0;o--){var i=t(this._objects[e[o]],e[o]);if(i)return i}},t}();o.JXBattleMap=s;var c=function(){function t(t,e){this._nCur=0,this._nTotal=t,this._endCb=e}return t.prototype.addTotalTimes=function(t){this._nTotal+=t},Object.defineProperty(t.prototype,"nLife",{get:function(){return this._nCur},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nTotal",{get:function(){return this._nTotal},enumerable:!1,configurable:!0}),t.prototype.life=function(){this._nCur++,this._nCur>=this._nTotal&&this._endCb&&this._endCb()},t.prototype.destroy=function(){this._nCur=null,this._nTotal=null,this._endCb=null},t}();o.JXRoundTimer=c,cc._RF.pop()},{"./JXBattleDefine":"JXBattleDefine"}],JXColor:[function(t,e,o){"use strict";cc._RF.push(e,"46ee0xa899Aoa9UDZ7XMLV8","JXColor"),Object.defineProperty(o,"__esModule",{value:!0}),o.JXColor=void 0,o.JXColor={C000000:cc.color(0,0,0,255),Cffffff:cc.color(255,255,255,255),C949494:cc.color(148,148,148,255),C636363:cc.color(99,99,99,255),CFFF075:cc.color(255,240,117,255),C8BF5FF:cc.color(139,245,255,255),C925600:cc.color(146,86,0,255),C133D5B:cc.color(19,61,91,255),CA4FF9F:cc.color(164,255,159,255),C004A00:cc.color(0,74,0,255),C2AFFFC:cc.color(42,255,252,255),CFFD74E:cc.color(255,215,78,255),CFFFD42:cc.color(255,253,66,255),C382F0D:cc.color(56,47,13,255),Cff0000:cc.color(255,0,0,255),C472811:cc.color(71,40,17,255),CFF003D:cc.color(255,0,61,255),C00FF3D:cc.color(0,255,61,255),C66FF00:cc.color(102,255,0,255),CFFF10B:cc.color(255,241,11,255)},cc._RF.pop()},{}],JXCommon:[function(t,e,o){"use strict";cc._RF.push(e,"c1a34sklRtCbLyJYlmx96b0","JXCommon"),Object.defineProperty(o,"__esModule",{value:!0}),o.generateUid=o.JXRandom=o.JXMath=o.JXVec2=o.JXDef=void 0;var i=t("./../Game/Common/Define");o.JXDef={Time:{MS:1,SECOND:1e3,MINUTE:6e4,HOUR:36e5,GAMEYEAR:9e5},bundle:{texture:"texture",prefab:"prefabs",spine:"anis",data:"data",audio:"audio"},umaPoint:{inGameScene:"\u8fdb\u5165\u6e38\u620f",loadScene:"\u8fdb\u5165\u52a0\u8f7d\u9875",watchAdErr:"\u89c6\u5c4f\u9519\u8bef",shareRecord:"\u5206\u4eab\u5f55\u5c4f",VipCtrl:"vip\u754c\u9762",officerCtrl:"\u5b98\u7235\u754c\u9762",signCtrl:"\u7b7e\u5230\u754c\u9762",storeCtrl:"\u5546\u57ce\u754c\u9762",goToBattle:"\u4e0a\u9635\u754c\u9762",bless:"\u52a0\u6210\u754c\u9762",heroCtrl:"\u82f1\u96c4\u754c\u9762",common:"\u901a\u7528\u754c\u9762",battle:"\u6218\u6597",tower:"\u722c\u5854\u754c\u9762",setting:"\u8bbe\u7f6e\u754c\u9762",timeBox:"\u70b9\u51fb\u5728\u7ebf\u5b9d\u7bb1",levelBox:"\u5173\u5361\u5b9d\u7bb1\u9884\u89c8",heroTry:"\u82f1\u96c4\u8bd5\u7528",openBook:"\u5f00\u5c40\u5b9d\u5178",rewardCtrl:"\u606d\u559c\u83b7\u5f97\u9886\u53d6",FeatureCtrl:"\u82f1\u96c4\u7279\u5199\u754c\u9762",mainBox:"\u4e3b\u9875\u5b9d\u7bb1",detailsCtrl:"\u82f1\u96c4\u8be6\u60c5",heroBattle:"\u5e03\u9635-\u4e0a",blessEquip:"\u52a0\u6301-",level4:"\u8fdb\u5165\u7b2c\u56db\u5173\u73a9\u5bb6",guide:"\u65b0\u624b\u5f15\u5bfc",recruit:"\u62bd\u5361\u62db\u52df\u754c\u9762"},Player:{},System:{AUTO_SAVE_TIME:1,SIGN_ROUND:7,NOTICE_PATH:"notice/"},SYS_CONFIG_KEY:{quality:"quality",basicGem:"basicGem",basicGold:"basicGold",teamInterval:"teamInterval",monsterInterval:"monsterInterval",basicsWheat:"basicsWheat",basicWheat:"basicWheat",wheatTime:"wheatTime",lvCap:"lvCap",sell:"sell",free:"free",twoUp:"twoUp",weakNpc:"weakNpc",white:"white",green:"green",Blue:"Blue",purple:"purple",orange:"orange",red:"red",bossNpc:"bossNpc",equipFitMoney:"equipFitMoney",equipFitOdds:"equipFitOdds",basic:"basic",silverBoxOpen:"silverBoxOpen",GoldBoxOpen:"GoldBoxOpen",dearBoxOpen:"dearBoxOpen",videoForging:"videoForging",heroresolve:"heroresolve",towerPressTime:"towerPressTime",videoAwardsGold:"videoAwardsGold",videoAwardsGem:"videoAwardsGem",heroTv:"heroTv",defScale:"defScale",boxDraw1:"boxDraw1",boxDraw2:"boxDraw2",boxDraw3:"boxDraw3",forageUp:"forageUp",noticeTime:"noticeTime",aidOpen:"aidOpen",onceCard:"onceCard",guideHero:"guideHero",stoneDraw:"stoneDraw",stone1:"stone1",cerDrawCost:"jinzita"},LOCAL_KEY:{},SYS_IDENTITY_ID:{load:100001,home:1e5,vip:100100,levelCtrl:100200,sginIn:100102,officer:100103,detailsCtrl:100104,blessCtrl:100105,setting:100106,EquipDetailsCtrl:100107,FightDataPreView:100108,TimeLimitGift:100109,RankView:100110,PowerUp:100111,strengthenView:200001,skillPage:200002,currencyFrame:200003,previewCtrl:200004,featureCtrl:200005,storePage:101e3,heroPage:102e3,heroTry:102001,openBox:102002,mainPage:103e3,squadPage:104e3,equipPage:105e3,recruitPage:106e3,fightLayer:601e3,fightLayerPut:601001,guessLayer:601002,ceremonialGiftView:601003,dailyView:601004,battleResult:602e3,battleResultView:602006,battleReward:602002,rewardCtrl:602001,guessResultView:602007,recuitCardCtrl:602003,MoreGameCtrl:603001,DaioCanView:603002}};o.JXVec2=function(t,e){this.x=t||0,this.y=e||0};var n=function(){function t(){}return t.getRightAngleRoute=function(t,e,o){var i=[];if(t.x!=e.x)for(var n=(t.x-e.x)/Math.abs(t.x-e.x),r=e.x;r!=t.x;r+=n)i.push(new o(r+n,e.y));if(t.y!=e.y){n=(t.y-e.y)/Math.abs(t.y-e.y);for(var a=e.y;a!=t.y;a+=n)i.push(new o(t.x,a+n))}return i},t.encodeV2xxyy=function(t,e,o){return e*o+t},t.decodeV2xxyy=function(t,e){return[t%e,Math.floor(t/e)]},t.getV2NeighborIds=function(t,e,o){for(var i=[],n=this.decodeV2xxyy(t,e),r=n[0],a=n[1],s=r-1;s<=r+1;s++)for(var c=a-1;c<=a+1;c++)s<0||s>=e||c<0||c>=o||s==r&&c==a||i.push(this.encodeV2xxyy(s,c,e));return i},t.getLastStepPos=function(t,e,o){if(e.y-t.y>=1){var i=(e.y-t.y)/Math.abs(e.y-t.y);return new o(e.x,e.y-i)}return i=(e.x-t.x)/Math.abs(e.x-t.x),new o(e.x-i,e.y)},t.newArray=function(t,e){for(var o=[],i=0;i<t;i++)o.push(e||0);return o},t.shuffle=function(t,e,o){var i;if(void 0===o&&(o=!0),o)i=t;else{i=[];for(var n=0;n<t.length;n++)i.push(t[n])}for(var r,a,s=i.length;s;)a=Math.floor(e()*s--),r=i[s],i[s]=i[a],i[a]=r;return i},t.getZhanli=function(t){return 25*t[i.PART_PROPTS.GongJi]+25*t[i.PART_PROPTS.FangYu]+t[i.PART_PROPTS.XueLiang]+2*t[i.PART_PROPTS.BaoJi]+500*t[i.PART_PROPTS.ShanBi]+300*(t[i.PART_PROPTS.HuoGong]+t[i.PART_PROPTS.HuoKang]+t[i.PART_PROPTS.BingGong]+t[i.PART_PROPTS.BingKang])},t.getEquipZhanli=function(t){return 25*t[i.PART_PROPTS.GongJi]+25*t[i.PART_PROPTS.FangYu]+t[i.PART_PROPTS.XueLiang]+2*t[i.PART_PROPTS.BaoJi]+500*t[i.PART_PROPTS.ShanBi]+300*(t[i.PART_PROPTS.HuoGong]+t[i.PART_PROPTS.HuoKang]+t[i.PART_PROPTS.BingGong]+t[i.PART_PROPTS.BingKang])},t}();o.JXMath=n;var r=function(){function t(t,e){if(this._nRandomTimes=0,!t)throw new Error("the genPrng call back is not ready!");this._getPrng=t,this._seed=e||Date.now().toString()}return Object.defineProperty(t.prototype,"prng",{get:function(){return this._prng||(this._prng=this._getPrng(this._seed)),this._prng},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},enumerable:!1,configurable:!0}),t.prototype.getRandom=function(){return this._nRandomTimes++,this.prng()},t.prototype.randomFloor=function(t,e){return t=t||0,e=e||100,Math.floor(t+this.getRandom()*(e-t))},t.prototype.randoms=function(t,e,o){for(var i=n.newArray(o-e).map(function(t,o){return o+e}),r=new Array,a=0;a<t&&!(i.length<=0);a++){var s=Math.floor(this.randomFloor(0,i.length));r[a]=i[s],i.splice(s,1)}return r},t}();o.JXRandom=r,o.generateUid=function(t,e){var o,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[];if(e=e||i.length,t)for(o=0;o<t;o++)n[o]=i[0|Math.random()*e];else{var r=void 0;for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4",o=0;o<36;o++)n[o]||(r=0|16*Math.random(),n[o]=i[19==o?3&r|8:r])}return n.join("")},cc._RF.pop()},{"./../Game/Common/Define":"Define"}],JXItem:[function(t,e,o){"use strict";cc._RF.push(e,"b27f1rt3WFPQIyiVAje3kc3","JXItem");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/GCtrl"),c=t("../../../Core/GEvent/GParam"),l=t("../../../Core/GView/GChild"),u=t("../../../Core/Manager/AudioMgr"),h=t("../../Common/JXColor"),p=t("../../Common/UI"),d=t("../../Common/Zh"),f=t("../../Logic/GameMgr"),g=t("./../../Common/Define"),_=t("./../../Common/Language"),m=t("./../../Common/UIResources"),y=cc._decorator,v=y.ccclass,C=y.property,I=y.menu,E=(y.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.icon=null,e.bg=null,e.kuangbg=null,e.icon_plane=null,e.numLb=null,e.eqLvLb=null,e.eqlv1=null,e.light=null,e.eqName=null,e.eq=null,e.eqNumLb=null,e.light1=null,e.mask=null,e.heroChip=null,e.round=null,e.eqLvLbRound=null,e.gray=null,e._IHeroData=null,e._equipNameArr=[],e.data=null,e._flag=0,e._index=0,e._equipUse=!1,e._equipId=null,e._equipSlot=[],e._touchMove=!1,e._dragShowNode=null,e._touchBegin=!1,e._canPutOn=!1,e._isDraging=!1,e._onSeat=!1,e._seatNode=[],e._heroId=null,e._delEquip=null,e}return n(e,t),Object.defineProperty(e.prototype,"equipUse",{get:function(){return this._equipUse},set:function(t){this._equipUse=t},enumerable:!1,configurable:!0}),e.prototype.onGLoad=function(){this.numLb.node.on(cc.Node.EventType.SIZE_CHANGED,this.onNumLabelSizeChange,this),this.initCarName()},e.prototype.start=function(){},e.prototype.setView=function(t,e,o,i,n){var r=this;if(void 0===e&&(e=g.ITEM_DETAIL_FLAG.TPL),void 0===n&&(n=!1),this.setDefault(),this._cb=o,this.data=t,this._flag=e,i&&(this._equipId=i),this.kuangbg.active=n,this.round.active=!1,this.icon_plane.active=!1,!t.raw&&this.data.type==g.ITEM_TYPE.HERO&&e&g.ITEM_DETAIL_FLAG.LIGHT){e&g.ITEM_DETAIL_FLAG.SHOWLIGHT&&(this.light.active=!0);var a=f.default.heroData.getRaw(this.data.id);this.light1.active=!0,this.eqName.string=a.name,this.eq.string="x",this.eqNumLb.string=_.LNumberInEn(this.data.num),this.numLb.node.active=!1,this.icon.node.scale=.5,this.assetImpl.spriteAtlasFrame(this.bg,m.Res.texture.views.common,"quality_"+a.trait),this.assetImpl.spriteFrame(this.icon,m.Res.texture.hero.hero+a.icon)}if(t.raw){if(e&g.ITEM_DETAIL_FLAG.NULLICON&&(this.icon.node.active=!1,this.eqlv1.node.active=!1),this.data.type!=g.ITEM_TYPE.HERO&&this.assetImpl.spriteAtlasFrame(this.icon,m.Res.texture.views.icon,this.data.icon),e&g.ITEM_DETAIL_FLAG.NO_BG&&(this.bg.node.active=!1),e&g.ITEM_DETAIL_FLAG.MATERIAL_STYLE_LINE&&(this.icon.node.scale=.5),e&g.ITEM_DETAIL_FLAG.NO_NUM?this.numLb.node.active=!1:this.numLb.node.active=!0,e&g.ITEM_DETAIL_FLAG.NUMPOS_ITEM_BC&&(this.numLb.node.anchorX=.5,this.numLb.fontSize=30,this.numLb.node.position=cc.v2(0,-35)),e&g.ITEM_DETAIL_FLAG.ICON_SCALE&&(this.icon.node.scale=.8),e&g.ITEM_DETAIL_FLAG.NUM_SCALE){var s=this.node.scale;this.node.parent&&(s*=this.node.parent.scale),this.numLb.node.scale=1/s}if(e&g.ITEM_DETAIL_FLAG.BAG||e&g.ITEM_DETAIL_FLAG.TPL)this.numLb.string=_.LNumberInEn(t.num);else if(e&g.ITEM_DETAIL_FLAG.MATERIAL){var c=f.default.itemMgr.testCost(this.data,1);this.setNumLb(c)}if(e&g.ITEM_DETAIL_FLAG.NO_BG_SHOWSLV&&(this.eqlv1.node.active=!0,this.eqlv1.node.x=-40,this.eqlv1.node.y=45,this.bg.node.active=!1),(this._flag&g.ITEM_DETAIL_FLAG.TOUCH||this._flag&g.ITEM_DETAIL_FLAG.BLESS)&&(this.eqlv1.node.active=!0),this._flag&g.ITEM_DETAIL_FLAG.NULLICON&&(this.eqlv1.node.active=!1),t.type==g.ITEM_TYPE.EQUIPDATA){var l=t.attach;this.numLb.string=this.data.attach?"":t.num.toString(),this.assetImpl.spriteAtlasFrame(this.bg,m.Res.texture.views.common,"quality_"+this.data.quality),this.eqlv1.string=l?"Lv."+l.itemData.raw.lv:"Lv."+t.raw.lv,this.eqLvLbRound.string=l?l.itemData.raw.lv+"":""+t.raw.lv,parseInt(this.eqLvLbRound.string)>0&&!(e&g.ITEM_DETAIL_FLAG.NULLICON)&&(this.round.active=!0),this._flag&g.ITEM_DETAIL_FLAG.NO_BG|e&g.ITEM_DETAIL_FLAG.NO_SLV?this.eqLvLb.node.active=!1:(this.eqLvLb.node.active=!!l,this.eqLvLb.string=l?"+"+l.sLv.toString():"Lv.",(this._flag&g.ITEM_DETAIL_FLAG.BLESS||this._flag&g.ITEM_DETAIL_FLAG.TOUCH||e&g.ITEM_DETAIL_FLAG.NO_BG_SHOWSLV)&&(l.sLv>0?this.eqLvLb.node.setPosition(-16,-23):this.eqLvLb.node.active=!1,e&g.ITEM_DETAIL_FLAG.NO_BG_SHOWSLV&&(this.eqLvLb.node.setPosition(-25,-40),this.eqLvLb.node.setScale(1.2))),this.eqLvLb.node.active=!1)}else if(!(this._flag&g.ITEM_DETAIL_FLAG.NO_BG))if(this.data.quality)this.assetImpl.spriteAtlasFrame(this.bg,m.Res.texture.views.common,"quality_"+this.data.quality);else if(this.assetImpl.spriteAtlasFrame(this.bg,m.Res.texture.views.common,"quality_1"),this.data.id>=g.PILL.PILL0&&this.data.id<=g.PILL.PILL5&&(this.assetImpl.spriteAtlasFrame(this.bg,m.Res.texture.views.common,"quality_"+(this.data.id-200)),this.assetImpl.spriteAtlasFrame(this.icon,m.Res.texture.views.icon,this.data.icon)),this.data.type==g.ITEM_TYPE.PROP){var u=f.default.rHeroData.getAllHerosNum();this.data.id>=1001&&this.data.id<=1e3+u&&(this.icon_plane.active=!0,this.mask.active=!0,this.assetImpl.spriteFrame(this.heroChip,m.Res.texture.hero.hero+this.data.id),this.heroChip.node.scaleX=this.heroChip.node.scaleY=.8)}e&g.ITEM_DETAIL_FLAG.TOUCH&&(l=t.attach,this.assetImpl.spriteAtlasFrame(this.bg,m.Res.texture.views.common,"quality_"+l.quality),this.numLb.node.active=!1),e&g.ITEM_DETAIL_FLAG.BLESS&&(l=t.attach,this.assetImpl.spriteAtlasFrame(this.bg,m.Res.texture.views.common,"quality_"+l.quality),this.numLb.node.active=!1),e&g.ITEM_DETAIL_FLAG.SCALEICON&&this.icon.node.setScale(1.1),e&g.ITEM_DETAIL_FLAG.SCALEBLESSICON&&this.icon.node.setScale(1.8),g.ITEM_DETAIL_FLAG.FONTHECHENG,e&g.ITEM_DETAIL_FLAG.SHOWLIGHT&&(this.light.active=!0);var h=this.node.getComponent(cc.Button);if(h&&(h.enabled=!(e&g.ITEM_DETAIL_FLAG.NOT_TOUCH)),this._flag&g.ITEM_DETAIL_FLAG.LVFONTCHANGE&&this.assetImpl.font(m.Res.font.fzcy,function(t){r.numLb.font=t}),this._flag&g.ITEM_DETAIL_FLAG.FONTHECHENG&&this.assetImpl.font(m.Res.font.mnpw,function(t){r.numLb.font=t}),e&g.ITEM_DETAIL_FLAG.LIGHT&&(this.light1.active=!0,this.eqName.string=this.data.raw.name,this.eq.string="x",this.eqNumLb.string=_.LNumberInEn(t.num),this.numLb.node.active=!1,this.icon.node.scale=1),this.data.type==g.ITEM_TYPE.PROP&&e&g.ITEM_DETAIL_FLAG.STOREHERO&&(this.round.active=!1,this.numLb.node.active=!1,this.icon.node.scale=.6,this.eqlv1.node.active=!1,this.eqLvLb.node.active=!1,this.data.type==g.ITEM_TYPE.PROP)){var p=f.default.rHeroData.getHaveHeros(g.SQUAD_BUTTON.ALL),d=p.have.length+p.notHave.length;this.data.id>=1001&&this.data.id<=1e3+d&&(this.icon_plane.active=!0,this.mask.active=!0,this.icon.node.scale=1,this.assetImpl.spriteFrame(this.heroChip,m.Res.texture.hero.hero+this.data.id),this.heroChip.node.scaleX=this.heroChip.node.scaleY=.8)}e&g.ITEM_DETAIL_FLAG.STORECHIPHIDE&&(this.mask.active=!1),e&g.ITEM_DETAIL_FLAG.SHOWNUM&&(this.numLb.node.active=!1,this.eq.string="x",this.eqNumLb.string=_.LNumberInEn(this.data.num),this.eqNumLb.node.active=!0),this.eqlv1.node.active=!1}},e.prototype.setNumLb=function(t){if(this._flag&g.ITEM_DETAIL_FLAG.MATERIAL_NO_HAVE){var e=t.need;this.numLb.node.color=h.JXColor.Cffffff,this.numLb.string=_.LCoin(e),this.numLb.node.addComponent(cc.LabelOutline);var o=this.numLb.node.getComponent(cc.LabelOutline);o.width=2,o.color=h.JXColor.C000000,this.numLb.node.scale=.8}else{var i="<color="+(t.enough?h.JXColor.C925600.toHEX():h.JXColor.CFF003D.toHEX())+">"+_.LNumberInEn(t.cur)+"</c>",n="<color="+h.JXColor.C925600.toHEX()+">"+_.LNumberInEn(t.need)+"</c>";this.numLb.string=i+"|"+n}this.onNumLabelSizeChange()},e.prototype.onNumLabelSizeChange=function(){if(this._flag&g.ITEM_DETAIL_FLAG.ICON_SCALE&&this._flag&g.ITEM_DETAIL_FLAG.MATERIAL){var t=this.icon.node.width/2+15;this.node.height=this.icon.node.height/2,this.node.width=t+this.numLb.node.width,this.icon.node.x=(t-this.node.width)/2-10,this.numLb.node.anchorX=0,this.numLb.node.y=-2,this.numLb.lineHeight=26,this.numLb.fontSize=26,this.numLb.node.x=this.icon.node.x+t/2+5,this.icon.node.setScale(.35)}},e.prototype.setDefault=function(){this.data=null;var t=m.Res.texture.views.heroDetail;this.assetImpl.spriteAtlasFrame(this.bg,t,"equipBottom"),this.icon.spriteFrame=null,this.eqLvLb.node.active=!1,this.numLb.node.active=!1},e.prototype.cancelTouch=function(){this._flag&g.ITEM_DETAIL_FLAG.NOT_TOUCH||(this._flag|=g.ITEM_DETAIL_FLAG.NOT_TOUCH,this.node.getComponent(cc.Button).enabled=!1)},e.prototype.onClick=function(){this._cb?this._cb(this):this.data&&(this._flag,g.ITEM_DETAIL_FLAG.NOT_OP)},e.prototype.setTouch=function(t,e,o){this._IHeroData=t,this._heroId=this._IHeroData.tableId,this._seatNode=e,this.checkStatus(),this.initEvent(),o&&(this._delEquip=o,this._seatNode.push(this._delEquip))},e.prototype.initEvent=function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStar,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this)},e.prototype.initOffEvent=function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchStar,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this)},e.prototype.destroyDragNode=function(){cc.isValid(this._dragShowNode)&&(this._dragShowNode.destroy(),this._dragShowNode=null)},e.prototype.replaceData=function(t,e,o){var i=f.default.RBagData.getEquipDataById(t);if(i.itemData.raw.seat==o||g.EQUIP_PART.BINGSHU1==i.itemData.raw.seat&&o>=g.EQUIP_PART.BINGSHU1){var n={equipId:t,heroId:e,site:o},r=f.default.RBagData.getEquipDataById(t).itemData.raw.lv;if(this._IHeroData.lv>=r){if(!i.isFirstExp){var a={heroId:this._IHeroData.tableId,exp:i.itemData.raw.exp};f.default.RBagData.setIsFirstExp(i.insId),s.GCtrl.ES.emit(g.CMsg.client.hero.onHeroAddExp,new c.default(a))}var l=f.default.suitData.getAllHeroSuit(this._IHeroData.tableId),h=f.default.suitData.getHeroSuit(i.equipId,l),p={IHeroData:this._IHeroData,suit:h};u.AudioMgr.Ins().playEffect(m.Res.audio.addEquip),s.GCtrl.ES.emit(g.CMsg.client.hero.onAddSuit,new c.default(p)),s.GCtrl.ES.emit(g.CMsg.client.equip.onEquipPutOn,new c.default(n))}else{var _=f.default.lvData.getIdByInfo(f.default.RBagData.getEquipDataById(t).itemData.raw.lv),y="\u82f1\u96c4\u7b49\u7ea7\u4e0d\u8db3\uff0c\u9700\u8981\u82f1\u96c4\u8fbe\u5230"+this._equipNameArr[_.quality-1]+_.showLv+"\u7ea7";f.default.uiMgr.showToast(y)}}else f.default.uiMgr.showToast(d.JXLocales.tip.equip)},e.prototype.initCarName=function(){var t=f.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.white);this._equipNameArr.push(t);var e=f.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.green);this._equipNameArr.push(e);var o=f.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.Blue);this._equipNameArr.push(o);var i=f.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.purple);this._equipNameArr.push(i);var n=f.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.orange);this._equipNameArr.push(n);var r=f.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.red);this._equipNameArr.push(r)},e.prototype.pushEquip=function(t,e,o){f.default.RBagData.getEquipDataById(t);var i={equipId:t,heroId:e,site:o};s.GCtrl.ES.emit(g.CMsg.client.equip.onBlessEquip,new c.default(i))},e.prototype.checkStatus=function(){this.data?this._canPutOn=!0:this._canPutOn=!1},e.prototype._onTouchStar=function(t){this._touchMove=!1,this.destroyDragNode(),this._touchBegin=!0,t.stopPropagation()},e.prototype._onTouchMove=function(t){if(this._canPutOn){var e=t.getLocation().sub(t.getStartLocation());if(this._isDraging||(this._isDraging=!0),e.mag()>7&&this._isDraging){var o=this._seatNode[0].parent;if(this._touchMove){var i=t.getLocation();n=o.convertToNodeSpaceAR(i),this._dragShowNode.setPosition(n),"content"==this.node.parent.name&&(this.node.parent.parent.parent.getComponent(cc.ScrollView).enabled=!1),this.checkIsEnter(i).isEnter?this._onSeat||(this._onSeat=!0):this._onSeat&&(this._onSeat=!1)}else{this._touchMove=!0,this._dragShowNode=cc.instantiate(this.icon.node),this._dragShowNode.active=!0,this._flag&g.ITEM_DETAIL_FLAG.BLESS|g.ITEM_DETAIL_FLAG.ICON_SCALE?this._seatNode[0].parent.parent.active?this._dragShowNode.parent=this._seatNode[0].parent:this._seatNode[2].parent.active&&(this._dragShowNode.parent=this._seatNode[2]):this._dragShowNode.parent=this._seatNode[0].parent;var n=o.convertToNodeSpaceAR(t.getLocation());this._dragShowNode.setPosition(n)}}}},e.prototype.checkIsEnter=function(t){for(var e=null,o=!1,i=0;i<this._seatNode.length;i++)if(o=this._seatNode[i].getBoundingBoxToWorld().contains(t)){e=i;break}return{isEnter:o,index:e}},e.prototype._onTouchEnd=function(t,e){void 0===e&&(e=!1);var o=t.getLocation();if(this.destroyDragNode(),this._touchMove){var i=this.checkIsEnter(o);i.isEnter&&(this._flag&g.ITEM_DETAIL_FLAG.TOUCH&&(i.index>5?this.recovery():this.replaceData(this._equipId,this._heroId,i.index)),this._flag&g.ITEM_DETAIL_FLAG.BLESS&&(i.index>3?this.recovery():this.pushEquip(this._equipId,this._heroId,i.index)))}else this.destroyDragNode();"content"==this.node.parent.name&&(this.node.parent.parent.parent.getComponent(cc.ScrollView).enabled=!0),this._touchBegin=!1,this._touchMove=!1,this._onSeat=!1,this._isDraging=!1},e.prototype._onTouchCancel=function(t){this._onTouchEnd(t,!0)},e.prototype.recovery=function(){if(this.data.raw){var t=this.data.raw.recycle;if(f.default.itemMgr.testCost(t)){var e=t;f.default.jumpToMgr.jumpGoTo(p.VIEW_ID.currencyFrame,e,1,!0,this._equipId)}}},e.prototype.setGray=function(t){this.gray.active=t},e.prototype.getEquipId=function(){return this.data.id},e.NAME="Item",r([C(cc.Sprite)],e.prototype,"icon",void 0),r([C(cc.Sprite)],e.prototype,"bg",void 0),r([C(cc.Node)],e.prototype,"kuangbg",void 0),r([C(cc.Node)],e.prototype,"icon_plane",void 0),r([C(cc.Label)],e.prototype,"numLb",void 0),r([C(cc.Label)],e.prototype,"eqLvLb",void 0),r([C(cc.Label)],e.prototype,"eqlv1",void 0),r([C(cc.Node)],e.prototype,"light",void 0),r([C(cc.Label)],e.prototype,"eqName",void 0),r([C(cc.Label)],e.prototype,"eq",void 0),r([C(cc.Label)],e.prototype,"eqNumLb",void 0),r([C(cc.Node)],e.prototype,"light1",void 0),r([C(cc.Node)],e.prototype,"mask",void 0),r([C(cc.Sprite)],e.prototype,"heroChip",void 0),r([C({type:cc.Node,tooltip:"\u5b9d\u5e93\u5c55\u793a\u5706\u5708"})],e.prototype,"round",void 0),r([C({type:cc.Label,tooltip:"\u5b9d\u5e93\u5c55\u793a\u7b49\u7ea7\u663e\u793a"})],e.prototype,"eqLvLbRound",void 0),r([C(cc.Node)],e.prototype,"gray",void 0),r([v,I("View/Common/JXItem")],e)}(l.default));o.default=E,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../../Core/GEvent/GParam":"GParam","../../../Core/GView/GChild":"GChild","../../../Core/Manager/AudioMgr":"AudioMgr","../../../conventions/JXCommon":"JXCommon","../../Common/JXColor":"JXColor","../../Common/UI":"UI","../../Common/Zh":"Zh","../../Logic/GameMgr":"GameMgr","./../../Common/Define":"Define","./../../Common/Language":"Language","./../../Common/UIResources":"UIResources"}],JXRBAmbient:[function(t,e,o){"use strict";cc._RF.push(e,"fe4a1VchipJuaXaXztToNnJ","JXRBAmbient");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.JXRBAmbient=void 0;var r=t("./JXRBCmdMgr"),a=t("./JXRBRole"),s=t("./JXULDefine"),c=function(t){function e(e){var o=t.call(this,e)||this;return o._actionList=[],o._script=null,o.skeleton=e.getComponent(sp.Skeleton),o.skeleton||(o.skeleton=e.addComponent(sp.Skeleton)),o}return n(e,t),e.prototype.setEffectSkeletonData=function(t){var e=this;this.skeleton&&this.skeleton.skeletonData&&(this.skeleton.clearTracks(),this.skeleton.skeletonData=null),this.skeleton.skeletonData=t,this.skeleton.timeScale=r.ANIMATION_SPEED*this.cmd.getSpeed(),this.skeleton.setEventListener(function(t,o){e.onSkEventListen(e.skeleton,t,o)})},e.prototype.changeState=function(t,e){void 0===e&&(e=!1)},e.prototype.checkRoleIsEnd=function(){return 0==this._actionList.length&&null==this.skeleton.skeletonData},e.prototype.scrpitExit=function(t){if(t==this._script){if(t._aniConfig.ansInfo,t.existAcions&&t.existAcions.length>0){for(var e=0;e<t.existAcions.length;e++)this.addAction(t.existAcions.shift(),!0);t.existAcions=[]}this.cmd.evtMgr.post(s.JXMsg.action.scExit,this),this._script=null,this.effectSkeleton&&this.effectSkeleton.skeletonData&&(this.effectSkeleton.skeletonData=null)}else cc.error("the exit scrpit is not equal mine script! please check the logic!")},e.prototype.scrpitBreak=function(){this._script=null},e.prototype.update=function(){if(!this.btlActionMgr.hasQueueAction(this)&&this._actionList.length>0)this.addActionToMgr(this,this._actionList.shift());else if(this.skeleton&&this.skeleton.skeletonData){var t=this.skeleton.getCurrent(0);t&&this.skeleton.getAnimationInfo(t.animation.name).duration<t.trackTime&&(this.skeleton.clearTracks(),this.skeleton.skeletonData=null)}},e}(a.JXRBRole);o.JXRBAmbient=c,cc._RF.pop()},{"./JXRBCmdMgr":"JXRBCmdMgr","./JXRBRole":"JXRBRole","./JXULDefine":"JXULDefine"}],JXRBBuff:[function(t,e,o){"use strict";cc._RF.push(e,"6aa734FmIRNdLrpsMLVivsN","JXRBBuff");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.JXRBBuff=void 0;var r=t("./../../../Core/CoreDefine"),a=t("./../../../Core/FrameEx/ES5Ex"),s=t("./JXULDefine"),c=function(t){function e(e,o,i,n){var r=t.call(this)||this;return r.buffFrames=[],r._active=!0,r._cmd=null,r.index=o,r.buffuuids=[],r.skillId=e,r._effectRaw=i,r._cmd=n,r}return n(e,t),Object.defineProperty(e.prototype,"visLayer",{get:function(){return this._effectRaw.visFirst},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"effectFirst",{get:function(){return this._effectRaw.effectFirst},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ext",{get:function(){return this._effectRaw.ext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){for(var t=[],e=0;e<this._effectRaw.effect.length;e++){var o=this._effectRaw.position[e];o?t.push(cc.v2(o[0],o[1])):t.push(cc.Vec2.ZERO)}return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._effectRaw.state},enumerable:!1,configurable:!0}),e.prototype.addToTarget=function(t){this.execer=t;for(var e=this.visLayer,o=this.offset,i=0;i<this._effectRaw.effect.length;i++){var n=this._cmd.assetManager.createEffect(this._effectRaw.effect[i],s.JXBattleBuffRoot,cc.WrapMode.Loop);if(e[i]<s.JXBuffOrderThreshold){var r=t.target.getChildByName(s.JXRB_ROLE_LAYER_NAME.LOWER);n.node.parent=r}else r=t.target.getChildByName(s.JXRB_ROLE_LAYER_NAME.UPPER),n.node.parent=r;var a=t.dir==s.JXEDir.Right?1:-1;n.node.zIndex=this.visLayer[i],o[i].x*=a,n.node.position=o[i],n.node.scaleX*=a,n.play(s.COMMON_ANI_NAME),this.buffFrames.push(n.node)}},e.prototype.addInsBuff=function(t){this.buffuuids.indexOf(t)==r.INVALID_VALUE&&this.buffuuids.push(t)},e.prototype.removeInsBuff=function(t){var e=this.buffuuids.indexOf(t);e!=r.INVALID_VALUE&&(this.buffuuids.splice(e,1),0==this.buffuuids.length&&this.execer.removeBuff(this))},e.prototype.hasInsBuff=function(t){return this.buffuuids.indexOf(t)!=r.INVALID_VALUE},e.prototype.destroy=function(){this.execer.btlActionMgr.removeAllActionsFromTarget(this,!0),this._effectRaw=null,this.execer=null;for(var t=0;t<this.buffFrames.length;t++)this.buffFrames[t].destroy();this.buffFrames.length=0,this.buffuuids=[],this._cmd=null},Object.defineProperty(e.prototype,"active",{get:function(){return this._active},set:function(t){this._active=t,this.buffFrames.forEach(function(e){e.active=t})},enumerable:!1,configurable:!0}),e}(a.ObjectWrap);o.JXRBBuff=c,cc._RF.pop()},{"./../../../Core/CoreDefine":"CoreDefine","./../../../Core/FrameEx/ES5Ex":"ES5Ex","./JXULDefine":"JXULDefine"}],JXRBBullet:[function(t,e,o){"use strict";cc._RF.push(e,"17a054NcypHLpKpr7XMeJ8G","JXRBBullet");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.JXRBBullet=void 0;var r=t("../../../Core/FrameEx/ActionEx"),a=t("../../../Core/FrameEx/CCNodeImpl"),s=t("../../../Core/Math/MathEx"),c=t("./JXBattleDefine"),l=t("./JXULDefine"),u=function(t){function e(e,o,i){var n=t.call(this,new cc.Node(e.id+""))||this;return n._cmd=null,n._bulletConfig=e,n._cmd=i,n.bindScript(o),e.isSpine?n.loadSpine(e.aniconfig):n.loadFrames(e.aniconfig),n}return n(e,t),e.prototype.bindRoute=function(t){return this._moveAction=t,this},e.prototype.bindScript=function(t){return this.script=t,this.gunner=this.script.execer,this.zIndex=l.JXRB_LAYER_INDEX.ROLE_SPECIAL+l.JXRB_LAYER_INDEX.BLACK+l.JXRB_LAYER_INDEX.SCENE_EFFECT_UPPER,this.parent=this.gunner.parent,this},e.prototype.bindHiter=function(t){return this.hiter=t,this},e.prototype.bindOrder=function(t){return this.order=t,this},e.prototype.bindDelayOffset=function(t){return this.delayOffset=t,this},e.prototype.bindEndExc=function(t){return this._endExec=t,this},Object.defineProperty(e.prototype,"endExec",{get:function(){return this._endExec},enumerable:!1,configurable:!0}),e.prototype.loadSpine=function(t){var e=this.createBySpineConfig(t),o=this._bulletConfig.supAction1,i=o?this.createBySpineConfig(o):null;i&&(i.node.position=cc.v2(o[(c.JXBtlArrIx.Two,c.JXBtlArrIx.Three)]),e.node.addChild(i.node)),this._startDisplay=cc.callFunc(function(){i&&i.setAnimation(0,o[c.JXBtlArrIx.One],!1),e.setAnimation(0,t[c.JXBtlArrIx.One],!0)}),e.node.parent=this.target},e.prototype.createBySpineConfig=function(t){var e=new cc.Node,o=e.addComponent(sp.Skeleton);o.premultipliedAlpha=!!t[c.JXBtlArrIx.Four];var i=this._cmd.assetManager.assetImpl.getPreLoadAsset(l.JXBattleSkillSpine+t[c.JXBtlArrIx.Zero]);return o.skeletonData=i,e.scale=t[c.JXBtlArrIx.Five],e.anchorY=0,e.opacity=255*t[c.JXBtlArrIx.Six],o},e.prototype.loadFrames=function(t){var e=this._cmd.assetManager.createEffect(t,l.JXBattleBulletRoot,this._bulletConfig.duration?cc.WrapMode.Loop:cc.WrapMode.Normal),o=e.node.opacity;e.node.opacity=255,this.opacity=o;var i=e.node.scale;this.scale=i,e.node.scale=1,e.node.anchorY=.5,this._startDisplay=cc.callFunc(function(){e.play(l.COMMON_ANI_NAME)}),this._clip=e.getClips()[c.JXBtlArrIx.Zero],e.node.parent=this.target},e.prototype.generate=function(){var t=cc.v2(this._bulletConfig.param1[0]||0,this._bulletConfig.param1[1]||0);t.x=this.script.execer.dir*t.x;var e=cc.v2(this._bulletConfig.param1[2]||0,this._bulletConfig.param1[3]||0),o=this._bulletConfig.param4,i=1,n=this._bulletConfig.duration||this._clip.duration;switch(this._bulletConfig.scType){case l.JXEBulleType.Line:this.position=cc.v2(this.script.execer.x,this.script.execer.y+this.script.execer.skeleton.node.sHeight/2).addSelf(t),(d=this.hiter.position).y+=this.hiter.skeleton.node.sHeight/2,d.addSelf(e),i=this.position.x>d.x?l.JXEDir.Left:l.JXEDir.Right,this._moveAction=new r.JXMoveTo(n,d);break;case l.JXEBulleType.Curve:this.position=cc.v2(this.script.execer.x,this.script.execer.y+this.script.execer.skeleton.node.sHeight/2).addSelf(t),(d=this.hiter.position).y+=this.hiter.skeleton.node.sHeight/2,d.addSelf(e),i=this.position.x>d.x?l.JXEDir.Left:l.JXEDir.Right;var a=[],c=s.default.getAnglePos(this._bulletConfig.param2[0]+Math.floor(Math.random()*(this._bulletConfig.param3[0]||0)),this._bulletConfig.param2[1]+Math.floor(Math.random()*(this._bulletConfig.param3[1]||0)));c.x*=i;var u=this.position.add(c);if(a.push(u),null!=this._bulletConfig.param2[2]){var h=s.default.getAnglePos(this._bulletConfig.param2[2]+Math.floor(Math.random()*(this._bulletConfig.param3[2]||0)),this._bulletConfig.param2[3]+Math.floor(Math.random()*(this._bulletConfig.param3[3]||0)));h.x*=i;var p=d.add(h);a.push(p)}a.push(d),this._moveAction=new r.JXBezierTo(n,a);break;case l.JXEBulleType.Vertical:var d=this.hiter.position.add(e),f=s.default.getAnglePos(90+-this.hiter.dir*this._bulletConfig.param2[0],this._bulletConfig.param2[1]);this.position=f.add(d).addSelf(t),i=this.position.x>d.x?l.JXEDir.Left:l.JXEDir.Right,this._moveAction=new r.JXMoveTo(n,d)}this._bulletConfig.ease&&cc[this._bulletConfig.ease]&&(this._moveAction=this._moveAction.easing(cc[this._bulletConfig.ease]()));for(var g=0,_=this.target.children,m=_.length;g<m;g++)_[g].scaleY*=i;if(o&&o.length>0){var y=[];for(g=0;g<o.length;g++){var v=o[g],C=v[0],I=v[1],E=v[2];if(C){var S=I?cc.scaleTo(C,I):null,R=E?cc.fadeTo(C,255*E):null;S&&R?y.push(cc.spawn(S,R)):y.push(S||R)}}this._otherAction=null,y.length>0&&(1==y.length?this._otherAction=y.pop():this._otherAction=cc.sequence(y))}return this.target.active=!1,this},e.prototype.shoot=function(){if(this._startDisplay&&this._moveAction){var t=0;this.delayOffset&&(t+=this.delayOffset),this._bulletConfig.interval&&0!=this.order&&(t+=this._bulletConfig.interval*this.order);var e=[this._startDisplay,this._moveAction];this._otherAction&&e.push(this._otherAction);var o,i=cc.spawn(e),n=cc.callFunc(this.onRouteEnd,this);o=t?cc.sequence(cc.delayTime(t),i,n):cc.sequence(i,n),this.target.active=!0,this.target.runAction(o)}},e.prototype.onRouteEnd=function(){this.hiter.btlActionMgr.removeAllActionsFromTarget(this.target,!0),this._moveAction=null,this._startDisplay=null,this._otherAction=null,this.target.destroy(),this.script.onBulletCollision(this)},e.prototype.destroy=function(){this.hiter.btlActionMgr.removeAllActionsFromTarget(this.target,!0),this._moveAction=null,this._startDisplay=null,this._otherAction=null,this.target.destroy(),this.hiter=null,this._clip=null,this.script=null,this._cmd=null},e}(a.CCNodeImpl);o.JXRBBullet=u,cc._RF.pop()},{"../../../Core/FrameEx/ActionEx":"ActionEx","../../../Core/FrameEx/CCNodeImpl":"CCNodeImpl","../../../Core/Math/MathEx":"MathEx","./JXBattleDefine":"JXBattleDefine","./JXULDefine":"JXULDefine"}],JXRBCmdMgr:[function(t,e,o){"use strict";cc._RF.push(e,"48e9bWsmKpBsJGqpcWsrsjk","JXRBCmdMgr");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0}),o.ANIMATION_SPEED=void 0;var a=t("../../../conventions/JXCommon"),s=t("../../../Core/GEvent/GEventSystem"),c=t("../../../Core/Manager/AudioMgr"),l=t("../../../Core/Math/MathEx"),u=t("../../Common/Define"),h=t("../../Common/UI"),p=t("../../Common/UIResources"),d=t("../../Logic/GameMgr"),f=t("../Hero/HeroChange"),g=t("./../../../Core/CoreDefine"),_=t("./../../../Core/FrameEx/ES5Ex"),m=t("./../../../Core/GCtrl"),y=t("./JXBattleCb"),v=t("./JXBattleDefine"),C=t("./JXBattleManager"),I=t("./JXBattleMonster"),E=t("./JXRBAmbient"),S=t("./JXRBBuff"),R=t("./JXRBRole"),D=t("./JXRBScript"),b=t("./JXULAsset"),w=t("./JXULDefine");o.ANIMATION_SPEED=1.2;var A=function(t){function e(e,o,i){var n=t.call(this)||this;return n._speed=1.2,n._pause=!1,n._pauseCmd=!1,n.isEnd=!1,n.monsterFactory=null,n._changeRoleTime=0,n._waitCleanActions=!1,n._monsterIndex=1e3,n._wheat=0,n._wave=null,n._wheatAdd=0,n._sceneId=0,n.monsterCtrl=null,n._count=1,n._heroCount=[],n.level=0,n.level=i,n.isEnd=!1,n.initJXBattleCb(),n._sceneId=e,n._heroCount=[0,0],n.assetManager=new b.BattleAssets(o),n.monsterFactory=new I.default,n._roles=new _.MapWrap,n.evtMgr=new s.default,n._wheat=d.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.basicsWheat),d.default.rHeroData.openBook&&(n._wheat*=3,d.default.rHeroData.openBook=!1),n._wheat+=d.default.lUserData.getUserBuff(u.BUFFINFO.InitBattlefieldRes),n._wheat+=d.default.RBagData.getMegreItems(u.CURRENCY.WHEAT,u.ITEM_TYPE.CURRENCY).num,n._wheatAdd=d.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.wheatTime),setTimeout(function(){m.GCtrl.ES.emit(u.CMsg.client.bag.onBagItemChange,[[u.CURRENCY.WHEAT,u.ITEM_TYPE.CURRENCY,-d.default.RBagData.getMegreItems(u.CURRENCY.WHEAT,u.ITEM_TYPE.CURRENCY).num]])},1e3),m.GCtrl.ES.emit(u.CMsg.client.fight_ui.onWheatChange),n.registerEvent(),n}return n(e,t),Object.defineProperty(e.prototype,"wheat",{get:function(){return this._wheat},enumerable:!1,configurable:!0}),e.prototype.addWheat=function(t){this._wheat+=t},Object.defineProperty(e.prototype,"sceneId",{get:function(){return this._sceneId},enumerable:!1,configurable:!0}),e.prototype.registerEvent=function(){var t=this;this.evtMgr.register(w.JXMsg.action.scExit,this,this.onSCExit.bind(this),g.PRIORITY_VIEW),m.GCtrl.ES.on(w.JXMsg.action.debuger.pause,this,this.onMsgPause.bind(this),g.PRIORITY_VIEW),m.GCtrl.ES.on(m.GCtrl.GTimerSecondEventMsg,this,this.onSecondTimeAdd.bind(this),g.PRIORITY_VIEW),m.GCtrl.ES.on(u.CMsg.data.onClientGuideChange,this,this.onClientGuideChange.bind(this),g.PRIORITY_VIEW),cc.game.on(cc.game.EVENT_SHOW,function(){t._pause=!1}),cc.game.on(cc.game.EVENT_HIDE,function(){t._pause=!0})},e.prototype.onClientGuideChange=function(){this._sceneId===u.PART_BTL_SCENE.GUANQIA&&1===this.level&&!this._running&&d.default.lUserData.isGuidseExits(1)&&this.startCmd()},e.prototype.onSecondTimeAdd=function(){var t=d.default.uiMgr.getView(h.VIEW_ID.battleResult);this._pause||!this.jxBtlAns||t||(this._wheat+=this._wheatAdd,m.GCtrl.ES.emit(u.CMsg.client.fight_ui.onWheatChange))},e.prototype.expendWheat=function(t){this._wheat-=t,m.GCtrl.ES.emit(u.CMsg.client.fight_ui.onWheatChange)},e.prototype.initJXBattleCb=function(){y.JXBattleCb.getCardData=function(t){return d.default.heroData.getRaw(t)},y.JXBattleCb.getSkillData=function(t){return d.default.skillData.getRaw(t)},y.JXBattleCb.getBuffData=function(t){return d.default.buffData.getRaw(t)},y.JXBattleCb.getEffectData=function(t){return d.default.skillEffect.getRaw(t)},y.JXBattleCb.getUnitData=function(t){return d.default.unitData.getRaw(t)},y.JXBattleCb.getPrng=seedrandom},e.prototype.initRDBtlLayer=function(t){if(t)return this.rootNode=t,t},e.prototype.loadAllResources=function(t){this.assetManager.loadAllRoundAssets([this.jxBtlAns.iBtlTeams[v.JXBtlCamp.Attacker],this.jxBtlAns.defTPL],this._sceneId,function(){t()})},e.prototype.createAmbient=function(t,e){var o=new cc.Node(t),i=new E.JXRBAmbient(o);return i.cmd=this,i.id=t,i._name=e==v.JXBtlCamp.Attacker?"ATKAmbient":v.JXBtlCamp.Defenser?"DEFAmbient":"NOAmbient",this.addRole(i,i.id),i},e.prototype.addRole=function(t,e){this._roles.has(e)||(t.parent=this.rootNode,this._roles.set(e,t))},e.prototype.removeDefRole=function(t){this._roles.has(t)&&this._roles.delete(t)},e.prototype.createRoleModel=function(t,e,o,i,n){var r=this.assetManager.assetImpl.getPreLoadAsset(p.Res.prefab.fight.role);if(r){var a=cc.instantiate(r);this._heroCount[t]=this._heroCount[t]+1,a.name=w.JXRB_ROLE_NAME_PREFIX+"_"+(t==v.JXBtlCamp.Attacker?"Atk":"Def")+"_"+this._heroCount[t];var s=a.getChildComByName("skeleton",sp.Skeleton);if(s){s.skeletonData=this.assetManager.assetImpl.getPreLoadAsset(e),s.defaultSkin="skin1";var c=new o(a);return c.cmd=this,c.id=n,c.iKey=i,c.initState(),c.setModel(e),c.setCamp(t),c}}},e.prototype.createRoleNew=function(t,e){if(!g.IS_EMPTY_INVALID(t)){for(var i,n,r,a=this.jxBtlAns.iBtlTeams[e],s=0;s<a.partnerData.length;s++)if(a.partnerData[s].heroId==t){r=a.partnerData[s];break}n=d.default.heroData.getRaw(r.tableId),(i=this.createRoleModel(e,p.Res.model+n.animation+"/"+n.animation,R.JXRBRole,e*w.ICampKeyCode+this._count,r.heroId)).wheatUp=n.wheatUp,this.addRole(i,i.id);var c=i.scale,l=cc.size(i.skeleton.node.width*c,i.skeleton.node.height*c);i.skeleton.node.sWidth=l.width,i.skeleton.node.sHeight=l.height;var u=i.target.getComponent(f.default);if(u&&u.init(r),i.postfix=u.skillPostfix,this._count++,r.nickName?i._name=r.nickName:i._name=n.name,i.tableId=r.tableId,i.unitId=r.unitId,i.lv=1,i){var h=i.target.getChildByName("ui"),_=this.assetManager.assetImpl.addGChild(p.Res.prefab.fight.head);return _.node.parent=h,i.initHeadCtrl(_),i.initHp(this.jxBtlAns.maxHps[i.id]),i.comAtkActionId=n.action,i.vSpeedX=cc.v2(n.ms,0),i.vSpeedY=cc.v2(0,n.ms),i.skeleton.timeScale=o.ANIMATION_SPEED*this._speed,i.changeState(w.JXEState.Idle),i}}},e.prototype.createRole=function(t,e,i,n,r){if(!g.IS_EMPTY_INVALID(t))if(n||r){for(var a,s,c,l=n?d.default.mapMgr.decodeXxyy(n[0]):r,u=this.jxBtlAns.iBtlTeams[i],h=0;h<u.partnerData.length;h++)if(u.partnerData[h].heroId==t){c=u.partnerData[h];break}s=d.default.heroData.getRaw(c.tableId),(a=this.createRoleModel(i,p.Res.model+s.animation+"/"+s.animation,R.JXRBRole,i*w.ICampKeyCode+this._count,c.heroId)).wheatUp=s.wheatUp,this.addRole(a,a.id);var _=a.scale,m=cc.size(a.skeleton.node.width*_,a.skeleton.node.height*_);a.skeleton.node.sWidth=m.width,a.skeleton.node.sHeight=m.height;var y=a.target.getComponent(f.default);if(y&&y.init(c),a.postfix=y.skillPostfix,this._count++,c.nickName?a._name=c.nickName:a._name=s.name,a.tableId=c.tableId,a.unitId=c.unitId,a.lv=1,a){var v=a.target.getChildByName("ui"),C=this.assetManager.assetImpl.addGChild(p.Res.prefab.fight.head);C.node.parent=v,a.setBirthPos(l),a.zIndex=this._monsterIndex--,n&&(a.setAirPos(d.default.mapMgr.decodeXxyy(n[1])),a.setRoad(n)),a.initHeadCtrl(C),a.initHp(this.jxBtlAns.maxHps[a.id]),a.index=e,a.comAtkActionId=s.action,a.vSpeedX=cc.v2(s.ms,0),a.vSpeedY=cc.v2(0,s.ms),a.skeleton.timeScale=o.ANIMATION_SPEED*this._speed,r?a.changeState(w.JXEState.Idle):a.changeState(w.JXEState.Run),a.pushWaitRoles(a)}}else cc.error("\u65e0\u6548\u8def\u5f84\u6216\u751f\u6210\u70b9\u82f1\u96c4\u521b\u5efa\u5931\u8d25\uff1a"+t)},e.prototype.checkCanPutOn=function(t,e){for(var o=null,i=this._roles.values(),n=0;n<i.length;n++){var r=i[n],a=this.btlMapConverts.converToMapPos(r.birthPos);if(r.camp===t&&e.x===a.x&&e.y===a.y&&r.getCurState()!=w.JXEState.Death){o=r;break}}return o},e.prototype.numberParse=function(t,e){var o=t.split(""),i="",n="+"==o[0]?"G_":"R_";e&&(n="+"==t[0]?"Gcrit_":"Rcrit_");for(var r=0;r<o.length;r++)i+=n+o[r],r!=o.length-1&&(i+="|");return i},e.prototype.getRoleById=function(t){return this._roles.get(t)},e.prototype.getSpeed=function(){return this._speed},e.prototype.pause=function(){this._pause=!0},e.prototype.pauseCmd=function(){this._pauseCmd=!0},e.prototype.resume=function(){this._pause=!1},e.prototype.resumeCmd=function(){this._pauseCmd=!1},Object.defineProperty(e.prototype,"isPause",{get:function(){return this._pause},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isRunning",{get:function(){return this._running},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPauseCmd",{get:function(){return this._pauseCmd},enumerable:!1,configurable:!0}),e.prototype.onSCExit=function(){this._running=!0},e.prototype.startCmd=function(){(this._sceneId!==u.PART_BTL_SCENE.GUANQIA||1!==this.level||d.default.lUserData.isGuidseExits(1))&&(c.AudioMgr.Ins().playEffect(p.Res.audio.haojiao),this._running=!0,this.monsterCtrl(),this.jxBtlAns.DPL_reSetDisPlayInfo())},e.prototype.update=function(){if(this._roles&&!this._pause){var t=cc.director.getDeltaTime();t*=this._speed*o.ANIMATION_SPEED;var e=r(this._roles.values());if((e=l.default.fisherYatesShuffle(e)).forEach(function(e){return e.update(t)}),!this._pauseCmd&&(C.default.ins.update(t),this._running)){if(this._changeRoleTime){if(this._changeRoleTime-=t,this._changeRoleTime>0)return;this._changeRoleTime=null}this._running&&this._roles.forEach(function(t){return t.doNextCmd()})}}},e.prototype.getNextCmd=function(t){var e=this._roles.get(t);return e?e.getNextCmd():null},e.prototype.parseCmd=function(t,e){switch(void 0===e&&(e=!1),!e&&this.evtMgr.post(u.CMsg.client.fight_ui.CMD_CHANGE,t),t[v.JXBtlArrIx.Zero]){case v.JXBattleEvt.ROLE_BEGIN:this._changeRoleTime=.2;break;case v.JXBattleEvt.ROLE_END:if(!(s=this.getRoleById(t[v.JXBtlArrIx.One])))break;s.checkRoleIsEnd()||(s.running=!1,s.pushWaitRoles(s));break;case v.JXBattleEvt.ROLE_COM_ATK:var o=this.jxBtlAns.hurtInfos[t[v.JXBtlArrIx.One]];this.doComAtkScript(o);break;case v.JXBattleEvt.ROLE_SKILL_PRESS:o=this.jxBtlAns.skillInfos[t[v.JXBtlArrIx.One]],this.doSkillScript(o);break;case v.JXBattleEvt.ROLE_SKILL_PREPARE:if(!(s=this.getRoleById(t[v.JXBtlArrIx.One])))break;var i=t[v.JXBtlArrIx.Two],n=d.default.skillData.getRaw(i);if(!n)break;n.skillSk&&s.effectSkeleton&&(s.effectSkeleton.skeletonData=this.assetManager.assetImpl.getPreLoadAsset(w.JXBattleSkillSpine+n.skillSk)),s.changeParpareAnimation(n.animGroup[v.JXBtlArrIx.Zero],i),this._running=!1;break;case v.JXBattleEvt.ROLE_ADD_BUFF:this.addBuff(t[v.JXBtlArrIx.Six],t[v.JXBtlArrIx.Two],t[v.JXBtlArrIx.Three],this.jxBtlAns.buffInfos[t[v.JXBtlArrIx.Two]]);break;case v.JXBattleEvt.ROLE_REMOVE_BUFF:this.removeBuff(t[v.JXBtlArrIx.Five],t[v.JXBtlArrIx.Two],t[v.JXBtlArrIx.Three]);break;case v.JXBattleEvt.ROLE_SKILL_HURT:var r=this.jxBtlAns.hurtInfos[t[v.JXBtlArrIx.One]];(s=this.getRoleById(r.target)).onDamage(r);break;case v.JXBattleEvt.ROLE_SKILL_ADDHP:var a=this.jxBtlAns.addHpInfos[t[v.JXBtlArrIx.One]],s=this.getRoleById(a.target);a.isProtect||s.onAddHp(a),s.running=!1,s.pushWaitRoles(s);break;case v.JXBattleEvt.ROLE_SKILL_ADDMAXHP:var c=this.jxBtlAns.addMaxHpInfos[t[v.JXBtlArrIx.One]];(s=this.getRoleById(c.target)).onAddMaxHp(c);break;case v.JXBattleEvt.ROLE_ATK_2_PROTECT:case v.JXBattleEvt.ROLE_HURT_2_PROTECT:case v.JXBattleEvt.ROLE_HURT_2_HP:break;case v.JXBattleEvt.ROLE_DIE:(s=this.getRoleById(t[v.JXBtlArrIx.One])).onDie();break;case v.JXBattleEvt.ROLE_CONTRLED:s=this.getRoleById(t[v.JXBtlArrIx.One]);var l=t[v.JXBtlArrIx.Three];s.createEffect(w.JXStaticEffects.control);var h=this.jxBtlAns.buffInfos[l],p=d.default.skillEffect.getRaw(h.buffId);s.showDescribe({type:w.DescribeType.Effect,text:p.effectDes});break;case v.JXBattleEvt.ROLE_IMDE:(s=this.getRoleById(t[v.JXBtlArrIx.One])).createEffect(w.JXStaticEffects.resist);var f=t[v.JXBtlArrIx.Three];p=d.default.skillEffect.getRaw(f),s.showDescribe({type:w.DescribeType.Effect,text:p.effectDes});break;case v.JXBattleEvt.END_FIGHT:this._roles.forEach(function(t){t.pushWaitRoles(t)}),this._waitCleanActions=!0}},e.prototype.doComAtkScript=function(t){this._running=!1;var e=this.getRoleById(t.execer),o={isSkill:!1,actionId:e.comAtkActionId,ansInfo:t},i=this.getActionScript(e,o);i.setRecordIdx(this.jxBtlAns.Get_DPL_curPlayID(t.execer)),e.execScript(i)},e.prototype.doSkillScript=function(t){var e=this;this._running=!1;var o=this.getRoleById(t.execer);if(!o){var i=this.jxBtlAns.extras[t.execer];if(!(o=this.createAmbient(i.id,i.camp)))return void(0==this._running&&(this._running=!0))}var n=d.default.skillData.getRaw(t.skillId),r=n.animGroup,a=r[0],s=r[1],c={isSkill:!0,isPrepare:t.model==v.JXBtlAns_PressModel.PrepareEnd,actionId:s,skillGroup:a==g.INVALID_VALUE?null:a,ansInfo:t,effectSk:n.skillSk};if(0==t.effects.length)return o.changeState(w.JXEState.Idle),void(0==this._running&&(this._running=!0));this.displaySkillName(o,n,function(){if(o.target){var t=e.getActionScript(o,c);t.setRecordIdx(e.jxBtlAns.Get_DPL_curPlayID(o.id)),o.execScript(t)}})},e.prototype.displaySkillName=function(t,e,o){o()},e.prototype.getActionScript=function(t,e){var o=d.default.action.getRaw(e.actionId);switch(o.scAct){case w.JXEScriptID.OnceNearAtk:return new D.JXRBScript$OnceNearAtk(o).bindCmd(this).bindExecer(t).bindAniConfigure(e);case w.JXEScriptID.MulNearAtk:return new D.JXRBScript$MulNearAtk(o).bindCmd(this).bindExecer(t).bindAniConfigure(e);case w.JXEScriptID.BulletAtk:return new D.JXRBScript$BulletAtk(o).bindCmd(this).bindExecer(t).bindAniConfigure(e);case w.JXEScriptID.StandAct:return new D.JXRBScript$StandAct(o).bindCmd(this).bindExecer(t).bindAniConfigure(e);case w.JXEScriptID.RoadMoveAct:return new D.JXRBScript$RoadAct(o).bindCmd(this).bindExecer(t).bindAniConfigure(e);case w.JXEScriptID.DriftAct:return new D.JXRBScript$DriftAct(o).bindCmd(this).bindExecer(t).bindAniConfigure(e);case w.JXEScriptID.SyncMoveAct:return new D.JXRBScript$SyncMoveAct(o).bindCmd(this).bindExecer(t).bindAniConfigure(e);case w.JXEScriptID.SegmentAct:return new D.JXRBScript$SegmentAct(o).bindCmd(this).bindExecer(t).bindAniConfigure(e);case w.JXEScriptID.SegmentTAct:return new D.JXRBScript$SegmentTAct(o).bindCmd(this).bindExecer(t).bindAniConfigure(e);case w.JXEScriptID.SegmentNAct:return new D.JXRBScript$SegmentNAct(o).bindCmd(this).bindExecer(t).bindAniConfigure(e);case w.JXEScriptID.DriftActBullet:return new D.JXRBScript$DriftActBullet(o).bindCmd(this).bindExecer(t).bindAniConfigure(e);case w.JXEScriptID.SyncMoveActBullet:return new D.JXRBScript$SyncMoveActBullet(o).bindCmd(this).bindExecer(t).bindAniConfigure(e);case w.JXEScriptID.Ambient:return new D.JXRBScript$Ambient(o).bindCmd(this).bindExecer(t).bindAniConfigure(e)}},e.prototype.addBuff=function(t,e,o,i){var n=this.getRoleById(t);if(!i.imBuffId){var r=d.default.skillData.getRaw(o);if(n&&r){n.addBuffTip(e);var a=i.index,s=r.eAnimId[a];if(s){var c=d.default.effectAnim.getRaw(s);if(c){var l=n.skillBuffs,u=l.get(o);u||(u=new _.MapWrap,l.set(o,u));var h=u.get(a);h?h.addInsBuff(e):((h=new S.JXRBBuff(o,a,c,n.cmd)).addInsBuff(e),n.addBuff(h))}}}}},e.prototype.removeBuff=function(t,e,o){var i=this.getRoleById(t),n=d.default.skillData.getRaw(o);if(i&&n){var r=this.jxBtlAns.buffInfos[e];if(r.lifeRd){var a=d.default.skillEffect.getRaw(r.buffId);if(a){i.removeUIBuff(a);var s=r.index,c=n.eAnimId[s];if(c&&d.default.effectAnim.getRaw(c)){var l=i.skillBuffs.get(o);if(l){var u=l.get(s);u&&u.removeInsBuff(e)}}}}}},e.prototype.onMsgPause=function(){this._pause?this.resume():this.pause()},e.prototype.destroyAssetManager=function(){this.assetManager.destroy(),this.assetManager=null},e.prototype.destroy=function(){this.destroyAssetManager(),this.evtMgr.unRegister(this),this.monsterFactory.destory(),m.GCtrl.ES.off(this)},e}(_.ObjectWrap);o.default=A,cc._RF.pop()},{"../../../Core/GEvent/GEventSystem":"GEventSystem","../../../Core/Manager/AudioMgr":"AudioMgr","../../../Core/Math/MathEx":"MathEx","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr","../Hero/HeroChange":"HeroChange","./../../../Core/CoreDefine":"CoreDefine","./../../../Core/FrameEx/ES5Ex":"ES5Ex","./../../../Core/GCtrl":"GCtrl","./JXBattleCb":"JXBattleCb","./JXBattleDefine":"JXBattleDefine","./JXBattleManager":"JXBattleManager","./JXBattleMonster":"JXBattleMonster","./JXRBAmbient":"JXRBAmbient","./JXRBBuff":"JXRBBuff","./JXRBRole":"JXRBRole","./JXRBScript":"JXRBScript","./JXULAsset":"JXULAsset","./JXULDefine":"JXULDefine"}],JXRBCollisionEffect:[function(t,e,o){"use strict";cc._RF.push(e,"ff04cgfepdG5ZHlzJZptpDq","JXRBCollisionEffect");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.JXRBCollisionEffect=void 0;var r=t("./../../../Core/FrameEx/ES5Ex"),a=t("./JXBattleDefine"),s=t("./JXULDefine"),c=function(t){function e(e,o){var i=t.call(this)||this;return i._collisionRaw=null,i.colisionFrames=[],i._cmd=null,i._collisionRaw=e,i._cmd=o,i}return n(e,t),Object.defineProperty(e.prototype,"offsets",{get:function(){for(var t=[],e=0;e<this._collisionRaw.position.length;e++)t.push(cc.v2(this._collisionRaw.position[e][a.JXBtlArrIx.Zero]||0,this._collisionRaw.position[e][a.JXBtlArrIx.One]||0));return t},enumerable:!1,configurable:!0}),e.prototype.loadFrames=function(t,e){var o=this._cmd.assetManager.createEffect(t,s.JXCollisionRoot,cc.WrapMode.Normal);return e&&o.once(cc.Animation.EventType.FINISHED,this.onAnimationEnd,this),o.play(s.COMMON_ANI_NAME),o.node},e.prototype.loadSpine=function(t,e){var o=new cc.Node,i=o.addComponent(sp.Skeleton);i.premultipliedAlpha=!!t[a.JXBtlArrIx.Four];var n=this._cmd.assetManager.assetImpl.getPreLoadAsset(s.JXBattleSkillSpine+t[a.JXBtlArrIx.Zero]);return i.skeletonData=n,o.scale=t[a.JXBtlArrIx.Five],o.anchorY=0,o.opacity=255*t[a.JXBtlArrIx.Six],e&&i.setCompleteListener(this.onAnimationEnd.bind(this)),i.node},e.prototype.addToTarget=function(t){this.target=t;for(var e=this.offsets,o=this._collisionRaw.visFirst,i=0;i<this._collisionRaw.effect.length;i++){var n=null;if((n=this._collisionRaw.isSpine?this.loadSpine(this._collisionRaw.effect[i],i==a.JXBtlArrIx.Zero):this.loadFrames(this._collisionRaw.effect[i],i==a.JXBtlArrIx.Zero)).position=e[i],o[i]<s.JXBuffOrderThreshold){var r=t.target.getChildByName(s.JXRB_ROLE_LAYER_NAME.LOWER);n.parent=r}else r=t.target.getChildByName(s.JXRB_ROLE_LAYER_NAME.UPPER),n.parent=r;if(this._collisionRaw.isSpine){var c=n.getComponent(sp.Skeleton);c.timeScale=1.4,c.setAnimation(0,this._collisionRaw.effect[i][a.JXBtlArrIx.One],!1)}n.x*=this.target.dir,n.scaleX*=this.target.dir,n.zIndex=o[i],this.colisionFrames.push(n)}if(this._collisionRaw.state){var l=this.target,u=this._collisionRaw.state;l.addAction(cc.callFunc(function(){l.changeState(u)}))}},e.prototype.onAnimationEnd=function(){for(var t=0;t<this.colisionFrames.length;t++)this.colisionFrames[t].destroy();this.colisionFrames.length=0,this.colisionFrames=null,this._collisionRaw=null,this.target=null},e}(r.ObjectWrap);o.JXRBCollisionEffect=c,cc._RF.pop()},{"./../../../Core/FrameEx/ES5Ex":"ES5Ex","./JXBattleDefine":"JXBattleDefine","./JXULDefine":"JXULDefine"}],JXRBFlags:[function(t,e,o){"use strict";cc._RF.push(e,"f824ajoxHlKrLzvXWwniSHr","JXRBFlags");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/FrameEx/ActionEx"),s=t("../../../Core/GView/GChild"),c=t("../../Common/Language"),l=cc._decorator,u=l.ccclass,h=l.property,p=l.menu,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hpBar=null,e.lb_hp=null,e.flags=null,e}return n(e,t),e.prototype.setHp=function(t,e){var o=this,i=this.node.active;this.node.active=!0;var n=e/t;this.lb_hp.string=c.LNumber(e)+"/"+c.LNumber(t),cc.tween(this.hpBar).to(1,{fillRange:n}).call(function(){i||(o.node.active=!1)}).start()},e.prototype.flagsShake=function(){this.flags.stopAllActions();var t=new a.Shake(.3,10,0);this.flags.runAction(t)},r([h(cc.Sprite)],e.prototype,"hpBar",void 0),r([h(cc.Label)],e.prototype,"lb_hp",void 0),r([h(cc.Node)],e.prototype,"flags",void 0),r([u,p("JXRB/JXRBFlags")],e)}(s.default);o.default=d,cc._RF.pop()},{"../../../Core/FrameEx/ActionEx":"ActionEx","../../../Core/GView/GChild":"GChild","../../Common/Language":"Language"}],JXRBRoleHead:[function(t,e,o){"use strict";cc._RF.push(e,"31b7dJEwK1IZ6vixRXUnLgr","JXRBRoleHead");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GView/GChild"),s=t("../../Common/Language"),c=t("./../../../Core/FrameEx/ES5Ex"),l=t("./../../Common/UIResources"),u=t("./JXBattleDefine"),h=cc._decorator,p=h.ccclass,d=h.property,f=h.menu,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hpBar=null,e.lv=null,e.nameLb=null,e.buffCnt=null,e.lb_hp=null,e._buffs=new c.MapWrap,e}return n(e,t),e.prototype.setName=function(t,e){this.nameLb.string=t,this.nameLb.node.color=e},e.prototype.hideHpBar=function(){this.node.active=!1},e.prototype.setHp=function(t,e){var o=this,i=this.node.active;this.node.active=!0;var n=e/t;this.lb_hp.string=s.LNumber(e)+"/"+s.LNumber(t),cc.tween(this.hpBar).to(1,{fillRange:n}).call(function(){i||(o.node.active=!1)}).start()},e.prototype.setLv=function(t){this.lv.string=t.toString()},e.prototype.setTempHp=function(){},e.prototype.setHpBarColor=function(t){var e=this.hpBar,o=t==u.JXBtlCamp.Defenser?"ui_xl_lv":"ui_xl_ho";this.assetImpl.spriteAtlasFrame(e,l.Res.texture.fight.ui,o)},r([d(cc.Sprite)],e.prototype,"hpBar",void 0),r([d(cc.Label)],e.prototype,"lv",void 0),r([d(cc.Label)],e.prototype,"nameLb",void 0),r([d(cc.Node)],e.prototype,"buffCnt",void 0),r([d(cc.Label)],e.prototype,"lb_hp",void 0),r([p,f("JXRB/JXRBRoleHead")],e)}(a.default);o.default=g,cc._RF.pop()},{"../../../Core/GView/GChild":"GChild","../../Common/Language":"Language","./../../../Core/FrameEx/ES5Ex":"ES5Ex","./../../Common/UIResources":"UIResources","./JXBattleDefine":"JXBattleDefine"}],JXRBRole:[function(t,e,o){"use strict";cc._RF.push(e,"336be3q5t1B0LWc9o/RfYP8","JXRBRole");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.JXRBRole=o.JXGSt=o.JXVertigoSt=o.JXCollision1St=o.JXRecoverSt=o.JXStopFrameSt=o.JXHitSt=o.JXDeathSt=o.JXPrepareSt=o.JXSkillSt=o.JXComAtkSt=o.JXRunSt=o.JXIDleSt=o.JXRoleSt=void 0;var r=t("../../../conventions/JXCommon"),a=t("../../../Core/FrameEx/ActionEx"),s=t("../../../Core/FrameEx/ES5Ex"),c=t("../../../Core/GEvent/GParam"),l=t("../../Common/Define"),u=t("../../Common/UIResources"),h=t("../../Logic/GameMgr"),p=t("./../../../Core/BaseFSM/FiniteStateMachine"),d=t("./../../../Core/CoreDefine"),f=t("./../../../Core/FrameEx/ActionEx"),g=t("./../../../Core/FrameEx/CCNodeImpl"),_=t("./../../../Core/GCtrl"),m=t("./../../Common/JXColor"),y=t("./JXBattleCb"),v=t("./JXBattleDefine"),C=t("./JXBattleManager"),I=t("./JXRBCmdMgr"),E=t("./JXRBCollisionEffect"),S=t("./JXULDefine"),R=[.1,.4],D=function(t){function e(){return t.call(this)||this}return n(e,t),Object.defineProperty(e.prototype,"sk",{get:function(){return this.entity.skeleton},enumerable:!1,configurable:!0}),e}(p.FSMState);o.JXRoleSt=D;var b=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"stateID",{get:function(){return S.JXEState.Idle},enumerable:!1,configurable:!0}),e.prototype.enter=function(){this.entity.changeAnimation(S.JXEAniNames.idle,!0)},e}(D);o.JXIDleSt=b;var w=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"stateID",{get:function(){return S.JXEState.Run},enumerable:!1,configurable:!0}),e.prototype.enter=function(){this.entity.changeAnimation(this.entity.postfix?S.JXEAniNames.run2:S.JXEAniNames.run,!0),this.entity.smokeSkeleton.node.parent.active=!0,this.entity.smokeSkeleton.setAnimation(0,"animation",!0)},e.prototype.exit=function(){this.entity.smokeSkeleton.node.parent.active=!1},e.prototype.execute=function(t){var e=this.entity;e.airPos&&(e.airPos.x>e.position.x?(e.setDir(S.JXEDir.Right),e.position=e.position.add(e.vSpeedX.mul(t)),e.curPos=e.position,e.position.x>e.airPos.x&&this.goToNextPos()):e.airPos.x<e.position.x?(e.setDir(S.JXEDir.Left),e.position=e.position.add(e.vSpeedX.mul(-1*t)),e.curPos=e.position,e.position.x<e.airPos.x&&this.goToNextPos()):(e.cmd.btlMapConverts.converToMapPos(e.position).x>3?e.setDir(S.JXEDir.Left):e.setDir(S.JXEDir.Right),e.airPos.y>e.position.y?(e.position=e.position.add(e.vSpeedY.mul(t)),e.curPos=e.position,e.position.y>e.airPos.y&&this.goToNextPos()):(e.position=e.position.add(e.vSpeedY.mul(-1*t)),e.curPos=e.position,e.position.y<e.airPos.y&&this.goToNextPos())))},e.prototype.goToNextPos=function(){if(this.entity.position=this.entity.airPos,this.entity.roadIndex<this.entity.road.length-1)this.entity.roadIndex++,this.entity.setAirPos(this.entity.road[this.entity.roadIndex]);else{var t=1===this.entity.unitRaw.type?h.default.systemConfig.value(r.JXDef.SYS_CONFIG_KEY.bossNpc):h.default.systemConfig.value(r.JXDef.SYS_CONFIG_KEY.weakNpc),e={insId:null,execer:this.entity.id,damage:t};C.default.ins.onEvent(v.JXBattleEvt.HURT_BARKS,this.entity.id,e),this.entity.onEndDie()}},e}(D);o.JXRunSt=w;var A=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"stateID",{get:function(){return S.JXEState.ComAtk},enumerable:!1,configurable:!0}),e.prototype.enter=function(){this.entity.changeAnimation(S.JXEAniNames.comAtk,!1),this.entity.skeleton.setCompleteListener(this.onComAtkAnimationEnd.bind(this))},e.prototype.onComAtkAnimationEnd=function(){this.entity.changePreState()},e}(D);o.JXComAtkSt=A;var T=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"stateID",{get:function(){return S.JXEState.Skill},enumerable:!1,configurable:!0}),e.prototype.exit=function(){},e.prototype.onSkillAnimationEnd=function(){this.entity.changePreState()},e}(D);o.JXSkillSt=T;var M=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"stateID",{get:function(){return S.JXEState.Perpare},enumerable:!1,configurable:!0}),e.prototype.enter=function(){this.entity.changeAnimation(this.perpareAniName,!0)},e}(D);o.JXPrepareSt=M;var L=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"stateID",{get:function(){return S.JXEState.Death},enumerable:!1,configurable:!0}),e.prototype.enter=function(){var t=this;this.entity.addAction(cc.sequence(cc.delayTime(.5),cc.callFunc(function(){t.entity.dieSkeleton.node.active=!0,t.entity.dieSkeleton.setAnimation(0,"siwang",!1),t.entity.changeAnimation(S.JXEAniNames.die,!1)}),cc.delayTime(.5),cc.fadeOut(.5),cc.callFunc(function(){t.onAnimationEnd()})))},e.prototype.onAnimationEnd=function(){this.entity.onEndDie()},e}(D);o.JXDeathSt=L;var P=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._damageList=[],e}return n(e,t),Object.defineProperty(e.prototype,"stateID",{get:function(){return S.JXEState.Hit},enumerable:!1,configurable:!0}),e.prototype.addDamage=function(t){this._damageList.push(t)},e.prototype.clearDamageList=function(){this._damageList=[]},e.prototype.enter=function(){var t=this;if(!this.duration){var e=this.entity.skeleton.getAnimationInfo(S.JXEAniNames.hit);this.duration=e?e.duration:0}if(0!=this._damageList.length){if(!this.isInAnimation()){var o=this.showDamage();this.entity.showHitAni(),this.entity.changeAnimation(S.JXEAniNames.hit,!1,function(){t._damageList.length>0?t.enter():o.targetIsDie?t.entity.changeState(S.JXEState.Death):t.entity.camp===v.JXBtlCamp.Attacker?t.entity.changeState(S.JXEState.Run):t.entity.changeState(S.JXEState.Idle)})}}else this.entity.changePreState()},e.prototype.execute=function(){if(this._damageList.length>0&&this.showDamage().targetIsDie)return this.entity.changeState(S.JXEState.Death),void this.clearDamageList()},e.prototype.showDamage=function(){var t=this._damageList.shift();return this.entity.stateDamage(t),t},e.prototype.isInAnimation=function(){var t=this.entity.skeleton.getCurrent(0);return t.animation.name==S.JXEAniNames.hit&&t.trackTime<t.animationEnd},e}(D);o.JXHitSt=P;var B=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.buffInsIds=[],e}return n(e,t),Object.defineProperty(e.prototype,"stateID",{get:function(){return S.JXEState.StopFrame},enumerable:!1,configurable:!0}),e.prototype.enter=function(){this.entity.skeleton.paused=!0},e.prototype.execute=function(){0==this.buffInsIds.length&&(this.entity.skeleton.paused=!1,this.entity.changeState(S.JXEState.Idle))},e.prototype.exit=function(){this.entity.skeleton.paused=!1,this.buffInsIds=[]},e}(D);o.JXStopFrameSt=B;var O=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._addList=[],e.duration=.2,e}return n(e,t),Object.defineProperty(e.prototype,"stateID",{get:function(){return S.JXEState.Real},enumerable:!1,configurable:!0}),e.prototype.addHp=function(t){this._addList.push(t)},e.prototype.enter=function(){this._curTime=0},e.prototype.execute=function(t){if(this._curTime+=t,0!=this._addList.length){if(this._curTime>this.duration){this._curTime=0;var e=this._addList.shift();this.entity.stateAddHp(e)}}else this.entity.changePreState()},e}(D);o.JXRecoverSt=O;var x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"stateID",{get:function(){return S.JXEState.Collision1},enumerable:!1,configurable:!0}),e.prototype.enter=function(){var t=this;this.entity.changeAnimation(S.JXEAniNames.hit,!1,function(){t.entity.changePreState()})},e}(D);o.JXCollision1St=x;var N=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.buffInsIds=[],e}return n(e,t),Object.defineProperty(e.prototype,"stateID",{get:function(){return S.JXEState.Vertigo},enumerable:!1,configurable:!0}),e.prototype.enter=function(){this.entity.changeAnimation(S.JXEAniNames.vertigo,!0)},e.prototype.execute=function(){0==this.buffInsIds.length&&this.entity.changeState(S.JXEState.Idle)},e}(D);o.JXVertigoSt=N;var k=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.waitShowBuffs=[],e.duration=.2,e._oldModel=null,e._curModel=null,e._waitChageModel=!1,e}return n(e,t),Object.defineProperty(e.prototype,"stateID",{get:function(){return S.JXEState.Global},enumerable:!1,configurable:!0}),e.prototype.enter=function(){this._curTime=0},e.prototype.execute=function(){if(this.waitShowBuffs.length>0&&(this._curTime+=cc.director.getDeltaTime(),this._curTime>this.duration)){this._curTime=0;var t=this.waitShowBuffs.shift();this.entity.showUIBuff(t)}null==this.entity._script&&this._waitChageModel&&this.changeModel()},e.prototype.setModel=function(t){this._curModel!=t&&(this._curModel&&(this._oldModel=this._curModel),this._curModel=t,this._oldModel&&(this._waitChageModel=!0))},e.prototype.reOldModel=function(){this._oldModel&&this.setModel(this._oldModel)},e.prototype.changeModel=function(){this.entity.getCurState()!=S.JXEState.Hit&&(this.entity.getCurState()!=S.JXEState.Death?(this._waitChageModel=!1,this.entity.skeleton.skeletonData=this.entity.cmd.assetManager.assetImpl.getPreLoadAsset(this._curModel),this.entity.changeState(S.JXEState.Idle,!0),this.entity.head&&(this.entity.head.node.y=this.entity.skeleton.node.sHeight)):this._waitChageModel=!1)},e}(D);o.JXGSt=k;var G=function(t){function e(e){var o=t.call(this,e)||this;if(o.dir=S.JXEDir.Right,o.camp=v.JXBtlCamp.Attacker,o.road=[],o.airPos=null,o.roadIndex=1,o.index=d.INVALID_VALUE,o.postfix=!1,o.tableId=d.INVALID_VALUE,o.vSpeedX=cc.Vec2.ZERO,o.vSpeedY=cc.Vec2.ZERO,o.wheatUp=0,o._unitId=d.INVALID_VALUE,o._birthPos=cc.Vec2.ZERO,o._lv=1,o._curPos=cc.Vec2.ZERO,o._describeDeltas=[0,0,0,0,0,0],o.comAtkActionId=null,o._tempHp=0,o._skillBuffs=new s.MapWrap,o._waveTime=0,o.curScript=null,o._touchMove=!1,o._touchBegin=!1,o._isDraging=!1,o._canDraw=!1,o._waitRoles=[],o._running=!0,o._passiveCmds=null,o.btlActionMgr=new a.JXActionMgr,o._actionList=[],o._describeList=new s.MapWrap,o._describeDeltas=[0,0,0,0,0,0],o._script=null,o.skeleton=e.getChildComByName("skeleton",sp.Skeleton),!o.skeleton)return o;o.fogSkeleton=e.getChildComByName("yanwu",sp.Skeleton),o.hitSkeleton=o.skeleton.node.getChildComByName("hit",sp.Skeleton),o.dieSkeleton=o.skeleton.node.getChildComByName("die",sp.Skeleton),o.smokeSkeleton=e.getChildByName("smoke").getChildComByName("smoke",sp.Skeleton),o.lvUpSkeleton=e.getChildByName("lvUp").getComponent(sp.Skeleton),o.skeleton.setEventListener(function(t,e){o.onSkEventListen(o.skeleton,t,e)}),o._shadow=o.target.getChildByName("shadow");var i=new cc.Node("skilleffectNode"),n=i.addComponent(sp.Skeleton);return n.premultipliedAlpha=!1,o.target.addChild(i),i.position=cc.Vec2.ZERO,n.skeletonData=null,o.effectSkeleton=n,S.JXBattleLog(o.wrapId," role init"),o.start(),o}return n(e,t),Object.defineProperty(e.prototype,"unitId",{set:function(t){t?(this.unitRaw=y.JXBattleCb.getUnitData(t),this.skeleton.node.scale=this.unitRaw.scale,this.fogSkeleton.node.scale*=this.unitRaw.scale,this.fogSkeleton.node.active=!!this.unitRaw.fog,2===this.unitRaw.fog?this.fogSkeleton.setAnimation(0,"zise",!0):this.fogSkeleton.setAnimation(0,"zise2",!0),this._unitId=t):this.skeleton.node.scale=h.default.systemConfig.value(r.JXDef.SYS_CONFIG_KEY.defScale)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lv",{get:function(){return this._lv},set:function(t){this._lv=t,this.head&&this.head.setLv(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"birthPos",{get:function(){return this.camp===v.JXBtlCamp.Defenser?cc.v2(this._birthPos.x,this._birthPos.y):cc.v2(this._curPos.x,this._curPos.y)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"curPos",{get:function(){return cc.v2(this._curPos.x,this._curPos.y)},set:function(t){this._curPos=cc.v2(t.x,t.y)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"head",{get:function(){return this._head},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"curHp",{get:function(){return this._curHp},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tempHp",{get:function(){return this._tempHp},enumerable:!1,configurable:!0}),e.prototype.initHp=function(t){this._maxHp=t,this._curHp=this._maxHp,this._head&&this._head.setHp(this._maxHp,this._curHp)},e.prototype.updateHp=function(t,e){this._maxHp=e,this._curHp=t,this._head&&this._head.setHp(this._maxHp,this._curHp)},Object.defineProperty(e.prototype,"skillBuffs",{get:function(){return this._skillBuffs},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"running",{set:function(t){this._running=t},enumerable:!1,configurable:!0}),e.prototype.pushWaitRoles=function(t){this._waitRoles.push(t)},e.prototype.addPassiveCmds=function(t){this._passiveCmds=t},e.prototype.isPassiveCmd=function(){return!!this._passiveCmds},e.prototype.changePreState=function(){this.getPreState()===S.JXEState.Idle&&this.camp===v.JXBtlCamp.Attacker?this.changeState(S.JXEState.Run):this.changeState(this.getPreState())},e.prototype.setEffectSkeletonData=function(t){var e=this;this.effectSkeleton&&(this.effectSkeleton.skeletonData=t,this.effectSkeleton.timeScale=I.ANIMATION_SPEED*this.cmd.getSpeed(),this.effectSkeleton.setEventListener(function(t,o){e.onSkEventListen(e.effectSkeleton,t,o)}))},e.prototype.setModel=function(t){this._globalSt.setModel(t)},e.prototype.setBirthPos=function(t){this.position=this.cmd.btlMapConverts.converToCCPos(t),this.curPos=this.position,this._birthPos=this.cmd.btlMapConverts.converToCCPos(t)},e.prototype.setAirPos=function(t){this.airPos=this.cmd.btlMapConverts.converToCCPos(t)},e.prototype.setCamp=function(t){this.camp=t},e.prototype.setRoad=function(t){var e=this;this.road=[],t.forEach(function(t){e.road.push(h.default.mapMgr.decodeXxyy(t))})},e.prototype.setDir=function(t){this.dir=t,this.smokeSkeleton.node.parent.scaleX=Math.abs(this.smokeSkeleton.node.parent.scaleX)*this.dir,this.skeleton.node.scaleX=Math.abs(this.skeleton.node.scaleX)*this.dir,this.effectSkeleton.node.scaleX=this.dir},e.prototype.initHeadCtrl=function(t){this._head=t,t.node.y=this.skeleton.node.sHeight*this.skeleton.node.scale,this.unitRaw&&(t.node.active=1===this.unitRaw.type),this._head.setHpBarColor(this.camp)},e.prototype.initState=function(){this.fsm=new p.FiniteStateMachine(this),this._runSt=new w,this._idleSt=new b,this._comAtkSt=new A,this._deathSt=new L,this._skillSt=new T,this._prepareSt=new M,this._hitSt=new P,this._recoverSt=new O,this._collision1St=new x,this._vertigoSt=new N,this._stopFrameSt=new B,this.fsm.registerState(this._stopFrameSt),this.fsm.registerState(this._runSt),this.fsm.registerState(this._idleSt),this.fsm.registerState(this._comAtkSt),this.fsm.registerState(this._deathSt),this.fsm.registerState(this._skillSt),this.fsm.registerState(this._prepareSt),this.fsm.registerState(this._hitSt),this.fsm.registerState(this._vertigoSt),this.fsm.registerState(this._recoverSt),this.fsm.registerState(this._collision1St),this._globalSt=new k,this.fsm.registerState(this._globalSt),this.fsm.setGlobalState(this._globalSt)},e.prototype.changeState=function(t,e){void 0===e&&(e=!1),this.getCurState()==this._deathSt.stateID&&t==this._hitSt.stateID||this.fsm.changeState(t,e)},e.prototype.getCurState=function(){return this.fsm.getCurState()},e.prototype.getPreState=function(){var t=this.fsm.getPerState();return t==this._skillSt.stateID&&(t=this._idleSt.stateID),t},e.prototype.start=function(){this.initEvent()},e.prototype.initEvent=function(){this.target.on(cc.Node.EventType.TOUCH_START,this._onTouchStar,this),this.target.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.target.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.target.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this)},e.prototype.update=function(t){this.btlActionMgr.update(t),this.doSescribe(t),this.doWaveDescribe(t);var e=this.getCurState();if(!this.fsm||(this.fsm.FSMUpdate(t),e!=this._hitSt.stateID&&e!=this._recoverSt.stateID&&e!=this._collision1St.stateID)){if(!this.btlActionMgr.hasQueueAction(this)&&this._actionList.length>0&&this.addActionToMgr(this,this._actionList.shift()),this._waitRoles.length>0){for(var o=this._waitRoles.length-1;o>=0;o--){if(!this._waitRoles[o].checkRoleIsEnd())return;this._waitRoles.pop()}this._running=!0}this._running&&this.doNextCmd()}},e.prototype.getNextCmd=function(){if(this._passiveCmds){var t=this._passiveCmds[v.JXBtlArrIx.Zero];if(t){var e=t.shift();return 0==t.length&&(this._passiveCmds.shift(),0==this._passiveCmds.length&&(this._passiveCmds=null)),e}this._passiveCmds=null}return this.cmd.jxBtlAns.DPL_getCurRecord(this.id,!0)},e.prototype.doNextCmd=function(){if(!(this.cmd.jxBtlAns.Get_DPL_curPlayID(this.id)>=this.cmd.jxBtlAns.DPL_getRecordsByID(this.id).length)){var t=this.getNextCmd();this.cmd.parseCmd(t)}},e.prototype._onTouchStar=function(t){this._canDraw=this.camp===v.JXBtlCamp.Defenser,this._canDraw&&(this._touchMove=!1,this._touchBegin=!0,C.default.ins.getTeamByCamp(this.camp).outBattle(this.index),this.cmd.removeDefRole(this.id),t.stopPropagation())},e.prototype._onTouchEnd=function(t,e){var o=this;void 0===e&&(e=!1);var i=t.getLocation(),n=function(t){o.cmd.btlCameraMap.selectGridByPos(t).data.gridInfo[l.INFO_TYPE.GRID]===l.GRID_TYPE.PLACE?(o.setBirthPos(t),C.default.ins.getTeamByCamp(o.camp).goBtlById(o.index),o.cmd.addRole(o,o.id)):o._onTouchCancel()};if(this._touchMove){var r=this.parent.getBoundingBoxToWorld().contains(i),a=this.parent.convertToNodeSpaceAR(i),s=this.cmd.btlMapConverts.converToMapPos(a);if(s.x>this.cmd.btlMapConverts.mapSize.width-1||s.y>this.cmd.btlMapConverts.mapSize.height-1||s.x<0||s.y<0)return void this._onTouchCancel();if(r){var c=this.cmd.checkCanPutOn(v.JXBtlCamp.Defenser,s);c?c.tableId!=this.tableId?(c.setBirthPos(this.cmd.btlMapConverts.converToMapPos(this.birthPos)),n(s)):c.lv===this.lv?this.roleSynthetic(c):this._onTouchCancel():n(s)}_.GCtrl.ES.emit(l.CMsg.client.fight_ui.hideAllItem)}this._touchBegin=!1,this._touchMove=!1,this._isDraging=!1},e.prototype._onTouchMove=function(t){if(this._canDraw){var e=t.getLocation().sub(t.getStartLocation());if(this._isDraging||(this._isDraging=!0),e.mag()>7&&this._isDraging)if(this._touchMove){var o=t.getLocation(),i=this.target.parent.convertToNodeSpaceAR(o);this.target.setPosition(i);var n=this.cmd.btlMapConverts.converToMapPos(i);if(!this._curPos||n.x!=this._curPos.x||n.y!=this._curPos.y){var r={heroId:this.tableId,pos:n};_.GCtrl.ES.emit(l.CMsg.client.fight_ui.selectItem,new c.default(r)),this._curPos=n}}else this._touchMove=!0}},e.prototype._onTouchCancel=function(){this._canDraw&&(this.target.setPosition(this.birthPos),C.default.ins.getTeamByCamp(this.camp).goBtlById(this.index),this.cmd.addRole(this,this.id),this._touchBegin=!1,this._touchMove=!1,this._isDraging=!1)},e.prototype.addBuff=function(t){var e=this;if(t){var o=[],i=0;if(this._skillBuffs.forEach(function(e){e.forEach(function(e){e.visLayer==t.visLayer&&(o.push(e),i=Math.max(e.layerOrder,i))})}),t.addToTarget(this),this._skillBuffs.get(t.skillId).set(t.index,t),t.layerOrder=++i,o.push(t),this.visitBuffs(o),t.state){switch(t.state){case S.JXEState.Vertigo:this._vertigoSt.buffInsIds.push(t.wrapId);break;case S.JXEState.StopFrame:this._stopFrameSt.buffInsIds.push(t.wrapId);break;case S.JXEState.TransSpine:var n=t.ext;this._globalSt.setModel(u.Res.model+n+"/"+n)}t.state<S.JXEState.Global&&this.addAction(cc.callFunc(function(){e.changeState(t.state)}))}}},e.prototype.addBuffTip=function(t){this.fsm.global.waitShowBuffs.push(t)},e.prototype.removeBuff=function(t){var e=this._skillBuffs.get(t.skillId);e.delete(t.index),0==e.size&&this._skillBuffs.delete(t.skillId);var o=[];if(this._skillBuffs.forEach(function(e){e.forEach(function(e){e.visLayer==t.visLayer&&o.push(e)})}),this.visitBuffs(o),t.state)switch(t.state){case S.JXEState.Vertigo:(i=this._vertigoSt.buffInsIds.indexOf(t.wrapId))!=d.INVALID_VALUE&&this._vertigoSt.buffInsIds.splice(i,1);break;case S.JXEState.StopFrame:var i;(i=this._stopFrameSt.buffInsIds.indexOf(t.wrapId))!=d.INVALID_VALUE&&this._stopFrameSt.buffInsIds.splice(i,1);break;case S.JXEState.TransSpine:t.ext&&this._globalSt.reOldModel()}t.destroy()},e.prototype.removeUIBuff=function(){},e.prototype.visitBuffs=function(t){if(t&&0!=t.length){t.sort(function(t,e){return t.effectFirst!=e.effectFirst?t.effectFirst-e.effectFirst:e.layerOrder-t.layerOrder});for(var e=0;e<t.length;e++)t[e].active=e==v.JXBtlArrIx.Zero}},e.prototype.roleSynthetic=function(t){C.default.ins.getTeamByCamp(this.camp).outBattle(t.index),this.cmd.removeDefRole(t.id);var e=C.default.ins.getTeamByCamp(this.camp).sycRole(t.index,this.index);e?(t.lv+=1,t.updateHp(e.curHp,e.maxHp),t.playSyncAni(),h.default.heroData.getRaw(t.tableId),this.onEndDie()):this._onTouchCancel(),C.default.ins.getTeamByCamp(this.camp).goBtlById(t.index),this.cmd.addRole(t,t.id)},e.prototype.onDamage=function(t){var e=this;if(t.ins2Hurt){var o=this.cmd.jxBtlAns.hurtInfos[t.ins2Hurt];this.cmd.getRoleById(o.target).onDamage(o)}t.ins2AtkHp&&(o=this.cmd.jxBtlAns.addHpInfos[t.ins2AtkHp],this.cmd.getRoleById(o.target).onAddHp(o));var i=this.fsm.getCurState();if(i!=S.JXEState.Death){if(t.execer==t.target||i==this._stopFrameSt.stateID&&!t.targetIsDie||this._script)return this.stateDamage(t),void(t.targetIsDie&&this._script&&0==this._script.existAcions.length&&(this._script.existAcions=[cc.callFunc(function(){return e.changeState(S.JXEState.Death)})]));this._hitSt.addDamage(t),i!=this._hitSt.stateID&&this.addAction(cc.callFunc(function(){e.changeState(e._hitSt.stateID)}))}},e.prototype.onAddHp=function(t){var e=this,o=this.fsm.getCurState();t.execer==t.target||o==this._stopFrameSt.stateID||this._script?this.stateAddHp(t):(this._recoverSt.addHp(t),o!=this._recoverSt.stateID&&this.addAction(cc.callFunc(function(){e.changeState(e._recoverSt.stateID)})))},e.prototype.onAddMaxHp=function(t){this._curHp+=t.addNum,this._maxHp+=t.addNum,this._head.setHp(this._maxHp,this._curHp),this.showUIAddMaxHp(t)},e.prototype.stateAddHp=function(t){t.addNum&&(t.isProtect?(this._tempHp+=t.addNum,this._head.setTempHp(this._tempHp,this._maxHp),this.showUIAddHp(t)):(this._curHp+=t.addNum,this._head.setHp(this._maxHp,this._curHp),this.showUIAddHp(t)))},e.prototype.onDie=function(){var t=this;this.effectSkeleton.skeletonData=null,this.addAction(cc.callFunc(function(){t.changeState(S.JXEState.Death)}))},e.prototype.onEndDie=function(){var t=this;if(this.camp===v.JXBtlCamp.Attacker){var e=this.unitRaw.money;this.cmd.addWheat(e)}this.active=!1,this.effectSkeleton.skeletonData=null,this._shadow.active=!1,this._head&&(this._head.node.active=!1),C.default.ins.getTeamByCamp(this.camp).outBattle(this.index),this.cmd.removeDefRole(this.id),setTimeout(function(){t.btlActionMgr.removeAllActions(),t.target.destroy()},100)},e.prototype.checkRoleIsEnd=function(){var t=this.fsm.getCurState();return t!==this._hitSt.stateID&&(t===this._idleSt.stateID&&this.camp===v.JXBtlCamp.Defenser||t==this._runSt.stateID&&this.camp===v.JXBtlCamp.Attacker||t==this._deathSt.stateID&&0==this.active||t==this._prepareSt.stateID||t==this._vertigoSt.stateID||t==this._stopFrameSt.stateID)},e.prototype.stateDamage=function(t){if(this.showUIDamage(t),t.ins2DefHp){var e=this.cmd.jxBtlAns.addHpInfos[t.ins2DefHp];this.cmd.getRoleById(e.target).stateAddHp(e)}t.protect&&(this._tempHp-=t.protect,!t.damage)||(this._curHp&&(this._curHp-=t.damage),this._curHp<0&&(this._curHp=C.default.ins.getEntityById(this.id).curHp),this._head&&this._head.setHp(this._maxHp,this._curHp))},e.prototype.showUIAddHp=function(t){var e=this.cmd.numberParse("+"+t.addNum,t.isCrit);if(t.insBuff){var o=this.cmd.jxBtlAns.buffInfos[t.insBuff];o.lifeRd&&(e=h.default.skillEffect.getRaw(o.buffId).effectDes+"|"+e)}t.ext&&(e=t.ext+"|"+e),this.showDescribe({type:S.DescribeType.Cure,text:e})},e.prototype.showUIAddMaxHp=function(t){var e=this.cmd.numberParse("+"+t.addNum,!1);if(t.insBuff){var o=this.cmd.jxBtlAns.buffInfos[t.insBuff];o&&(e=h.default.skillEffect.getRaw(o.buffId).effectDes+"|"+e)}t.ext&&(e=t.ext+"|"+e),this.showDescribe({type:S.DescribeType.MaxHp,text:e})},e.prototype.showUIDamage=function(t){var e=this.cmd.numberParse("-"+(t.damage+(t.protect||0)),t.isCrit);if(t.insBuff){var o=this.cmd.jxBtlAns.buffInfos[t.insBuff];if(o.lifeRd){e=h.default.skillEffect.getRaw(o.buffId).effectDes+"|"+e;var i=this.createBuffCollisionEffect(t.insBuff);i&&i.addToTarget(this)}}t.ext&&(e=t.ext+"|"+e),t.isCrit&&(e="effectDes_gcrit|"+e),this.showDescribe({type:t.isCrit?S.DescribeType.CritHurt:S.DescribeType.Hurt,text:e})},e.prototype.showUIBuff=function(t){var e=this.cmd.jxBtlAns.buffInfos[t],o=h.default.skillEffect.getRaw(e.buffId);if(o)switch(o.effectType){case v.JXBtlBEMT.AddFp:case v.JXBtlBEMT.AddHp:break;case v.JXBtlBEMT.Buff:this.showDescribe({type:S.DescribeType.BuffAdd,text:o.effectDes});break;case v.JXBtlBEMT.DeBuff:this.showDescribe({type:S.DescribeType.BuffSub,text:o.effectDes});break;default:this.showDescribe({type:S.DescribeType.Effect,text:o.effectDes})}},e.prototype.showDescribe=function(t){if(t.text){var e=t.type<=S.DescribeType.MaxHp?S.DescribeGroup.Number:S.DescribeGroup.Effect,o=this._describeList.get(e);o||(o=[],this._describeList.set(e,o)),o.push(t)}},e.prototype.createBuffCollisionEffect=function(t){var e=this.cmd.jxBtlAns.buffInfos[t];if(e){var o=this.cmd.jxBtlAns.skillInfos[e.insSkillId];if(o){var i=h.default.skillData.getRaw(o.skillId);if(i.eAnimId&&i.eAnimId[e.index]){var n=h.default.effectAnim.getRaw(i.eAnimId[e.index]);if(n&&n.collision){var r=h.default.actionCollision.getRaw(n.collision);if(r)return new E.JXRBCollisionEffect(r,this.cmd)}}}}},e.prototype.doSescribe=function(t){var e=this;this._describeList.forEach(function(o,i){if(0!=o.length&&(e._describeDeltas[i]=e._describeDeltas[i]+t,!(e._describeDeltas[i]<R[i]))){var n=o.shift(),r=e.cmd.assetManager.createDescribe(n.text);r.color=m.JXColor.C000000,r.parent=e.cmd.rootNode,r.zIndex=Math.max(e.zIndex,S.JXRB_LAYER_INDEX.DESCRIBE_LAYER);var a=e.skeleton.node.sHeight,s=null;switch(n.type){case S.DescribeType.Hurt:r.position=e.cmd.rootNode.convertToNodeSpaceAR(e.target.convertToWorldSpaceAR(cc.v2(0,a-20))),r.scale=1*S.DESCRIPT_SCALE,r.opacity=128,s=cc.tween(r).by(.1,{scale:.5*S.DESCRIPT_SCALE,opacity:128,y:5}).by(.2,{scale:-.5*S.DESCRIPT_SCALE,y:10}).parallel(cc.tween(r).by(.5,{y:25},{easing:"cubicOut"}),cc.tween(r).delay(.1).by(.4,{opacity:-255}));break;case S.DescribeType.CritHurt:r.color=m.JXColor.Cff0000,r.position=e.cmd.rootNode.convertToNodeSpaceAR(e.target.convertToWorldSpaceAR(cc.v2(0,a-20))),r.scale=1*S.DESCRIPT_SCALE,r.opacity=128,s=cc.tween(r).by(.1,{scale:.5*S.DESCRIPT_SCALE,opacity:128,y:5}).by(.2,{scale:-.5*S.DESCRIPT_SCALE,y:10}).parallel(cc.tween(r).by(.5,{y:25},{easing:"cubicOut"}),cc.tween(r).delay(.1).by(.4,{opacity:-255}));break;case S.DescribeType.Cure:r.position=e.cmd.rootNode.convertToNodeSpaceAR(e.target.convertToWorldSpaceAR(cc.v2(0,a-20))),r.scale=1*S.DESCRIPT_SCALE,r.opacity=128,s=cc.tween(r).by(.1,{scale:.5*S.DESCRIPT_SCALE,opacity:128,y:5}).by(.2,{scale:-.5*S.DESCRIPT_SCALE,y:10}).parallel(cc.tween(r).by(.5,{y:25},{easing:"cubicOut"}),cc.tween(r).delay(.1).by(.4,{opacity:-255}));break;case S.DescribeType.MaxHp:r.position=e.cmd.rootNode.convertToNodeSpaceAR(e.target.convertToWorldSpaceAR(cc.v2(0,a+20))),r.scale=1*S.DESCRIPT_SCALE,r.opacity=128,s=cc.tween(r).by(.1,{scale:.5*S.DESCRIPT_SCALE,opacity:128,y:5}).by(.2,{scale:-.5*S.DESCRIPT_SCALE,y:10}).delay(.2).parallel(cc.tween(r).by(.5,{y:25},{easing:"cubicOut"}),cc.tween(r).delay(.1).by(.4,{opacity:-255}));break;case S.DescribeType.BuffAdd:r.scale=1*S.DESCRIPT_SCALE,r.opacity=128,r.position=e.cmd.rootNode.convertToNodeSpaceAR(e.target.convertToWorldSpaceAR(cc.v2(0,a/2-20))),s=cc.tween(r).parallel(cc.tween(r).to(.2,{opacity:255}).to(.8,{opacity:0}),cc.tween(r).by(.7,{y:25},{easing:"cubicOut"}));break;case S.DescribeType.BuffSub:r.scale=1*S.DESCRIPT_SCALE,r.opacity=128,r.position=e.cmd.rootNode.convertToNodeSpaceAR(e.target.convertToWorldSpaceAR(cc.v2(0,a/2+20))),s=cc.tween(r).parallel(cc.tween(r).to(.2,{opacity:255}).to(.8,{opacity:0}),cc.tween(r).by(.7,{y:-25},{easing:"cubicOut"}));break;case S.DescribeType.Effect:r.scale=1*S.DESCRIPT_SCALE,r.opacity=128,r.position=e.cmd.rootNode.convertToNodeSpaceAR(e.target.convertToWorldSpaceAR(cc.v2(0,a/2))),s=cc.tween(r).to(.1,{scale:1.5*S.DESCRIPT_SCALE,opacity:255}).to(.2,{scale:1*S.DESCRIPT_SCALE}).to(.8,{opacity:0},{easing:"cubicOut"})}s&&(s.call(function(){e.cmd.assetManager.recyclingDescribe(r)}),s.start()),e._describeDeltas[i]=0}})},e.prototype.doWaveDescribe=function(t){var e=this;if(this.camp==v.JXBtlCamp.Defenser&&!(this.wheatUp<=0))if(this._waveTime<1)this._waveTime+=t;else{this._waveTime=0;var o="wave|Gcrit_+|Gcrit_"+this.wheatUp;this.cmd.addWheat(this.wheatUp);var i=this.cmd.assetManager.createDescribe(o);i.color=m.JXColor.C000000,i.parent=this.cmd.rootNode,i.zIndex=Math.max(this.zIndex,S.JXRB_LAYER_INDEX.DESCRIBE_LAYER);var n=this.skeleton.node.sHeight,r=null;i.scale=1*S.DESCRIPT_SCALE,i.opacity=128,i.position=this.cmd.rootNode.convertToNodeSpaceAR(this.target.convertToWorldSpaceAR(cc.v2(2*this.target.width,n+30)));var a=cc.v2(i.position.x,i.position.y+30);(r=cc.tween(i).to(.1,{scale:1.5*S.DESCRIPT_SCALE,opacity:255,position:a}).to(.2,{scale:1*S.DESCRIPT_SCALE}).to(.8,{opacity:0},{easing:"cubicOut"})).call(function(){e.cmd.assetManager.recyclingDescribe(i)}),r.start()}},e.prototype.showHitAni=function(){var t=this;this.hitSkeleton.node.active=!0,this.hitSkeleton.setCompleteListener(function(){t.hitSkeleton.node.active=!1}),this.hitSkeleton.setAnimation(0,"animation",!1)},e.prototype.playSyncAni=function(){var t=this;this.lvUpSkeleton.node.active=!0,this.lvUpSkeleton.setCompleteListener(function(){t.lvUpSkeleton.node.active=!1}),this.lvUpSkeleton.setAnimation(0,"heti",!1)},e.prototype.changeAnimation=function(t,e,o,i){var n=this;if(void 0===e&&(e=!1),void 0===i&&(i=!0),this.skeleton){var r=this.skeleton.setAnimation(0,t,e);if(o?this.skeleton.setCompleteListener(o):this.skeleton.setCompleteListener(null),this.effectSkeleton&&this.effectSkeleton.skeletonData){var a=this.effectSkeleton.getAnimationInfo(t);this.effectSkeleton.setCompleteListener(function(){n.effectSkeleton.skeletonData=null}),a?this.effectSkeleton.setAnimation(0,t,e):this.effectSkeleton.setAnimation(0,"effect",e)}return r||cc.log("\u89d2\u8272\u6807\u7b7e"+this.id+",\u540d\u5b57"+this._name+'\u627e\u4e0d\u5230\u52a8\u4f5c:" + '+t),{track:r,duration:r.animation.duration}}},e.prototype.showSingleEffect=function(t,e,o){var i=this;if(void 0===e&&(e=!1),this.effectSkeleton&&this.effectSkeleton.skeletonData){var n,r=this.effectSkeleton.getAnimationInfo(t);return o?this.effectSkeleton.setCompleteListener(function(){i.effectSkeleton.skeletonData=null,o()}):this.effectSkeleton.setCompleteListener(function(){i.effectSkeleton.skeletonData=null}),(n=r?this.effectSkeleton.setAnimation(0,t,e):this.effectSkeleton.setAnimation(0,"effect",e))?n.animation.duration:0}},e.prototype.changeSkillAnimation=function(t,e,o){var i=this;void 0===o&&(o=!0);for(var n=0,r=0,a=0;a<t.length;a++){var s=this.skeleton.getAnimationInfo(t[a]);s||cc.log("\u89d2\u8272\u6807\u7b7e"+this.id+",\u540d\u5b57"+this._name+'\u627e\u4e0d\u5230\u52a8\u4f5c:" + '+t[a]),n+=s?s.duration:0}var c=function(){return r>=t.length?e&&e(!0):i.changeAnimation(t[r++],!1,function(){return c()},o)};return{duration:n,track:c().track}},e.prototype.appendAnimName=function(t,e){return t+"_"+e},e.prototype.changeParpareAnimation=function(t,e){var o=this;this.addAction(cc.callFunc(function(){o.getCurState()==o._stopFrameSt.stateID&&(o.skeleton.paused=!1),o.changeAnimation(S.JXEAniNames.qishou,!1,function(){o._prepareSt.perpareAniName=S.JXEAniNames.prepare,o._prepareSt.skillId=e,o.changeState(o._prepareSt.stateID),o.cmd.evtMgr.post(S.JXMsg.action.scExit,o)})}))},e.prototype.onSkEventListen=function(t,e,o){if(o.data.name,S.JXEAniEventName.HitAni,this._script){var i=o.data.name;switch(i){case S.JXEAniEventName.CaiAtk:var n=S.JXSceneEffect.tuteng,r=this.cmd.assetManager.createSpine(n),a=S.JXRB_LAYER_INDEX.SCENE_EFFECT_LOWER;r.node.anchorY=.5,r.node.parent=this.cmd.rootNode,r.node.name=i,r.node.position=this.position,r.premultipliedAlpha=!1,r.node.zIndex=a,r.node.scaleX*=this.dir==S.JXEDir.Right?1:-1,r.setCompleteListener(function(){r.node.destroy(),r=null}),r.setAnimation(0,"atk",!1);break;case S.JXEAniEventName.CaiSkill:n=S.JXSceneEffect.tuteng;var s=this.cmd.assetManager.createSpine(n),c=this.cmd.assetManager.createSpine(n),l=this.cmd.rootNode.getChildByName(i),h=this.cmd.rootNode.getChildByName(i+1);l&&l.destroy(),h&&h.destroy(),s.node.active=!1,c.node.active=!1,a=S.JXRB_LAYER_INDEX.SCENE_EFFECT_LOWER,s.node.anchorY=.5,s.node.parent=this.cmd.rootNode,s.node.name=i,s.node.position=this.position,s.premultipliedAlpha=!1,s.node.zIndex=a,s.node.scaleX*=this.dir==S.JXEDir.Right?1:-1,c.node.anchorY=.5,c.node.parent=this.cmd.rootNode,c.node.name=i+1,c.node.position=this.position,c.premultipliedAlpha=!1,c.node.zIndex=a,c.node.scaleX*=this.dir==S.JXEDir.Right?1:-1,s.setCompleteListener(function(){s.setAnimation(0,"zhen",!0),c.node.active=!0,c.setAnimation(0,"guang",!0),setTimeout(function(){s.node&&s.node.destroy(),c.node&&c.node.destroy(),c=null,s=null},2e3)}),s.node.active=!0,s.setAnimation(0,"skill",!1);break;case S.JXEAniEventName.BlackStart:if(!(m=this.cmd.rootNode.getChildByName(S.SCENE_EFFECT_NODE_NAME.BLACK))){(m=new cc.Node(S.SCENE_EFFECT_NODE_NAME.BLACK)).color=cc.Color.BLACK,m.width=_.GCtrl.actualSize.width,m.height=_.GCtrl.actualSize.height;var p=m.addComponent(cc.Sprite);p.sizeMode=cc.Sprite.SizeMode.CUSTOM,this.cmd.assetManager.assetImpl.spriteFrame(p,u.Res.texture.single),m.parent=this.cmd.rootNode,m.zIndex=S.JXRB_LAYER_INDEX.BLACK}for(var d=this._script.targets,f=0;f<d.length;f++)d[f].zIndex=S.JXRB_LAYER_INDEX.ROLE_SPECIAL+d[f].zIndex;this._script.execer.zIndex+=S.JXRB_LAYER_INDEX.ROLE_SPECIAL,m.opacity=0;var g=cc.tween(m).to(.1,{opacity:229.5});this.btlActionMgr.addTweenAction(g);break;case S.JXEAniEventName.BlackEnd:var m;if(!(m=this.cmd.rootNode.getChildByName(S.SCENE_EFFECT_NODE_NAME.BLACK)))break;for(d=this._script.targets,f=0;f<d.length;f++)d[f].zIndex=-d[f].y;this._script.execer.zIndex-=S.JXRB_LAYER_INDEX.ROLE_SPECIAL,g=cc.tween(m).to(.1,{opacity:0}).removeSelf(),this.btlActionMgr.addTweenAction(g);break;default:var y=this._script.isBullet(this._script.actionRaw.bullet);if(i==S.JXEAniEventName.Shoot)return y?void(!this._script.isShoots&&this._script.shoots()):void cc.log("\u89d2\u8272\u6807\u7b7e"+this.id+",\u540d\u5b57"+this._name+" \u52a8\u4f5c"+e.animation.name+", \u914d\u7f6e\u4e0a\u8fd9\u4e0d\u662f\u4e00\u4e2a\u5b50\u5f39\uff0c\u4f46\u662f\u5b58\u5728\u5b50\u5f39\u4e8b\u4ef6'");if(y)return void(this._script.isShoots||cc.log("\u89d2\u8272\u6807\u7b7e"+this.id+",\u540d\u5b57"+this._name+" \u52a8\u4f5c"+e.animation.name+"\u8fd9\u662f\u4e00\u4e2a\u5b50\u5f39"+this._script.skillId()));this._script.onAnimationCollision(e,i)}}},e.prototype.createEffect=function(t,e){var o=this.cmd.assetManager.createEffect(t.effect,t.root,t.loop?cc.WrapMode.Loop:cc.WrapMode.Normal,function(){o.node.destroy(),e&&e()});if(this.target){var i=this.target.getChildByName(S.JXRB_ROLE_LAYER_NAME.EFFECT);return o.node.parent=i,t.anchor&&(o.node.anchorX=t.anchor.x,o.node.anchorY=t.anchor.y),t.anchOffset&&(o.node.x=this.skeleton.node.sWidth*t.anchOffset.x,o.node.y=this.skeleton.node.sHeight*t.anchOffset.y),t.offset&&(o.node.x+=t.offset.x,o.node.y+=t.offset.y),o.node.scaleX*=this.dir,o.play(S.COMMON_ANI_NAME),o}},e.prototype.execScript=function(t){var e=this,o=this;this.addAction(cc.callFunc(function(){if(o._script)return cc.error("the script by ID = "+o._script.ID+"is running!"),void(o._script._bullets&&o._script._bullets.length&&!o._script.isShoots?(o._script._endFlag=0,o._script.shoots()):(o._script.exit(),o._script=null));if(o._script=t,t.targets.length>0){for(var i=null,n=0,r=t.targets;n<r.length;n++)i=i?Math.max(i,r[n].zIndex):r[n].zIndex;e.zIndex=Math.max(e.zIndex,i)+1}else e.zIndex=S.JXRB_LAYER_INDEX.ROLE_SPECIAL+e.zIndex;var a=t.skillId();a&&e._prepareSt&&e._prepareSt.skillId&&e._prepareSt.skillId==a&&(e._prepareSt.perpareAniName=null,e._prepareSt.skillId=null),e.changeState(S.JXEState.Skill),t.exec()}))},e.prototype.scrpitExit=function(t,e){if(void 0===e&&(e=!0),t==this._script){var o=t._aniConfig.ansInfo;if(t.existAcions&&t.existAcions.length>0){for(var i=0;i<t.existAcions.length;i++)this.addAction(t.existAcions.shift(),!0);t.existAcions=[]}o.model&&o.model==v.JXBtlAns_PressModel.PrepareEnd?this.changeState(S.JXEState.Idle):this.changePreState(),e&&(this.position.equals(this.birthPos)||(this.position=this.birthPos)),this.zIndex=-this.y,this.cmd.evtMgr.post(S.JXMsg.action.scExit,this),this._script=null,this.effectSkeleton&&this.effectSkeleton.skeletonData&&(this.effectSkeleton.skeletonData=null)}else cc.error("the exit scrpit is not equal mine script! please check the logic!")},e.prototype.scrpitBreak=function(){this._script=null,this.getPreState()!=S.JXEState.Idle&&this.changeState(S.JXEState.Idle),this.zIndex=-this.y},e.prototype.addActionToMgr=function(t,e,o){return void 0===o&&(o=!1),this.btlActionMgr.addAction(e,t,o),e},e.prototype.addAction=function(t,e){void 0===e&&(e=!0),e?(t.setTag(f.QUEUE_ACTION_TAG),this._actionList.push(t)):this.addActionToMgr(this,t)},e.prototype.addTopAction=function(t){t.setTag(f.QUEUE_ACTION_TAG),this._actionList.push(t)},e.prototype.removeTopQueueAction=function(){this.btlActionMgr.removeAction(this._actionList[0],!0)},e}(g.CCNodeImpl);o.JXRBRole=G,cc._RF.pop()},{"../../../Core/FrameEx/ActionEx":"ActionEx","../../../Core/FrameEx/ES5Ex":"ES5Ex","../../../Core/GEvent/GParam":"GParam","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr","./../../../Core/BaseFSM/FiniteStateMachine":"FiniteStateMachine","./../../../Core/CoreDefine":"CoreDefine","./../../../Core/FrameEx/ActionEx":"ActionEx","./../../../Core/FrameEx/CCNodeImpl":"CCNodeImpl","./../../../Core/GCtrl":"GCtrl","./../../Common/JXColor":"JXColor","./JXBattleCb":"JXBattleCb","./JXBattleDefine":"JXBattleDefine","./JXBattleManager":"JXBattleManager","./JXRBCmdMgr":"JXRBCmdMgr","./JXRBCollisionEffect":"JXRBCollisionEffect","./JXULDefine":"JXULDefine"}],JXRBScript:[function(t,e,o){"use strict";cc._RF.push(e,"b2e64urHSBGzJOBSvvjvXJj","JXRBScript");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.JXRBScript$Ambient=o.JXRBScript$SegmentNAct=o.JXRBScript$SegmentTAct=o.JXRBScript$SegmentAct=o.JXRBScript$SyncMoveAct=o.JXRBScript$DriftAct=o.JXRBScript$StandAct=o.JXRBScript$SyncMoveActBullet=o.JXRBScript$DriftActBullet=o.JXRBScript$BulletAtk=o.JXRBScript$MulNearAtk=o.JXRBScript$RoadAct=o.JXRBScript$OnceNearAtk=o.JXRBScript=void 0;var r=t("../../Common/UIResources"),a=t("../../Logic/GameMgr"),s=t("./../../../Core/CoreDefine"),c=t("./../../../Core/FrameEx/ES5Ex"),l=t("./../../../Core/Manager/AudioMgr"),u=t("./JXBattleCb"),h=t("./JXBattleDefine"),p=t("./JXRBBullet"),d=t("./JXRBCollisionEffect"),f=t("./JXULDefine"),g=function(t){function e(e){var o=t.call(this)||this;return o.execer=null,o._cmd=null,o.targets=null,o._endFlag=0,o.existAcions=[],o._ansSegmentInfos={},o.actionRaw=e,o}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collsionType",{get:function(){return null},enumerable:!1,configurable:!0}),e.prototype.bindExecer=function(t){return this.execer=t,this},e.prototype.bindCmd=function(t){return this._cmd=t,this},e.prototype.bindActionRaw=function(t){return this.actionRaw=t,this},e.prototype.bindAniConfigure=function(t){if(this._aniConfig=t,this.targets=[],this._aniConfig.effectSk){var e=f.JXBattleSkillSpine+this._aniConfig.effectSk;this.execer.setEffectSkeletonData(this._cmd.assetManager.assetImpl.getPreLoadAsset(e))}if(this._aniConfig.isSkill&&this.collsionType==f.JXECollsionType.Siglon){var o=u.JXBattleCb.getSkillData(this.skillId());this._segmentCount=o.skillEffect.length;for(var i=this._aniConfig.ansInfo,n=0;n<i.effects.length;n++){var r=i.effects[n];this.targets.push(this._cmd.getRoleById(r.target))}}else if(this._aniConfig.isSkill)if(this.collsionType==f.JXECollsionType.InsEffect){if(!(i=this._aniConfig.ansInfo))return;for(this._segmentCount=i.effects.length,n=0;n<i.effects.length;n++){r=i.effects[n];var a=this._cmd.getRoleById(r.target);this.targets.push(a)}}else{if(!(i=this._aniConfig.ansInfo))return;for(n=0;n<i.effects.length;n++)r=i.effects[n],a=this._cmd.getRoleById(r.target),this.targets.indexOf(a)==s.INVALID_VALUE&&this.targets.push(a)}else{var c=this._aniConfig.ansInfo;this.targets.push(this._cmd.getRoleById(c.target))}return this},e.prototype.setRecordIdx=function(t){this._recordId=t},e.prototype.break=function(){if(this._bullets&&!this.isShoots){for(var t=0;t<this._bullets.length;t++)this._bullets[t].destroy();this._bullets.length=0}this.execer.scrpitBreak(this)},e.prototype.skillId=function(){return this._aniConfig.isSkill?this._aniConfig.ansInfo.skillId:null},e.prototype.exec=function(){},e.prototype.playAudio=function(){if(this._aniConfig.isSkill){var t=r.Res.audio.battle+this.skillId();l.AudioMgr.Ins().playEffect(t)}else{var e=a.default.heroData.getRaw(this.execer.tableId).atkAudio;l.AudioMgr.Ins().playEffect(r.Res.audio.battle+e)}},e.prototype.exit=function(){this._ansSegmentInfos=null;var t=!0;if(this._aniConfig.isSkill){for(var e=this._aniConfig.ansInfo.insId,o=this._cmd.getNextCmd(this.execer.id),i=[],n=null,r=0;o&&o[h.JXBtlArrIx.Zero]!=h.JXBattleEvt.ROLE_SKILL_PRESS_END&&o[h.JXBtlArrIx.One]!=e||r;)o&&o[h.JXBtlArrIx.Zero]==h.JXBattleEvt.ROLE_SKILL_PRESS?(r++,(n=[]).push(o)):o&&o[h.JXBtlArrIx.Zero]==h.JXBattleEvt.ROLE_SKILL_PRESS_END?(r--,n.push(o),i.unshift(n),n=null):n&&n.push(o),(o=this._cmd.getNextCmd(this.execer.id))&&0==r&&o[h.JXBtlArrIx.Zero]==h.JXBattleEvt.ROLE_REMOVE_BUFF&&this._cmd.removeBuff(o[h.JXBtlArrIx.Five],o[h.JXBtlArrIx.One],o[h.JXBtlArrIx.Two]);i.length>0&&this.execer.addPassiveCmds(i)}else{var a=this._aniConfig.ansInfo;a&&a.hasPursuit&&!a.targetIsDie&&(t=!1)}this.execer.scrpitExit(this,t)},e.prototype.getBaseAnimName=function(t){var e=this.targets[0],o=t||e.position,i=o.x<this.execer.x?f.JXEDir.Left:f.JXEDir.Right;this.execer.setDir(i);var n=this.execer.position;if(this._aniConfig.isSkill)return r="",a=f.JXEAniNames.skill+(this._aniConfig.skillGroup?this._aniConfig.skillGroup:""),a=this.execer.postfix?a+"_2":a,r=o.y>n.y?a+"_up":o.y<n.y?a+"_down":a,this.execer.skeleton.getAnimationInfo(r)?r:a;var r="",a=f.JXEAniNames.comAtk;return a=this.execer.postfix?a+"2":a,r=o.y>n.y?a+"_up":o.y<n.y?a+"_down":a,this.execer.skeleton.getAnimationInfo(r)?r:a},e.prototype.getComFullAnimNames=function(){return[this.getBaseAnimName()]},e.prototype.appendAnimName=function(t,e){return this.execer.appendAnimName(t,e)},e.prototype.getSingleTargetPos=function(){var t;if(this.actionRaw.targetType==f.JXETargetPosType.Target){var e=this.targets[0];e==this.execer?t=this.execer.position:(t=e.position,this.actionRaw.airOffsetX?t.x+=this.actionRaw.airOffsetX*e.dir:t.x+=(e.skeleton.node.sWidth/4+this.execer.skeleton.node.sWidth/4)*e.dir)}return t},e.prototype.createBullet=function(t,e,o){var i=e,n=this.actionRaw.bullet.length;i>=n&&(i%=n);var r=this.actionRaw.bullet[i],s=this.actionRaw.bulletInterval?this.actionRaw.bulletInterval:0,c=a.default.bullet.getRaw(r);return new p.JXRBBullet(c,this,this._cmd).bindHiter(t).bindOrder(e).bindDelayOffset(s).bindEndExc(o).generate()},e.prototype.createBullets=function(){if(this.isBullet(this.actionRaw.bullet)){if(this._bullets=this._bullets||[],this.tagBullet(),this.targets.length){var t=this.targets[h.JXBtlArrIx.Zero],e=this.execer.x>t.x?f.JXEDir.Left:f.JXEDir.Right;this.execer.setDir(e)}if(this._aniConfig.isSkill){var o=this._aniConfig.ansInfo,i=0;if(this.collsionType==f.JXECollsionType.Effect)for(var n=0;n<o.effects.length;n++){var r=o.effects[n];t=this._cmd.getRoleById(r.target),u=this.createBullet(t,i,[r]),this._bullets.push(u),i++}else for(var a=[],c=0;c<this.targets.length;c++){var l=this.targets[c].id;if(a.indexOf(l)==s.INVALID_VALUE){for(a.push(l),r=[],n=0;n<o.effects.length;n++)o.effects[n].target==l&&r.push(o.effects[n]);u=this.createBullet(this.targets[c],i,r),this._bullets.push(u),i++}}}else{var u=this.createBullet(this.targets[h.JXBtlArrIx.Zero],0,null);this._bullets.push(u)}}},e.prototype.shoots=function(){this.playAudio(),this._bullets&&this._bullets.length>0&&this._bullets.forEach(function(t){return t.shoot()}),this.isShoots=!0},e.prototype.getCurSegmentAniName=function(){var t=this._curSegment,e=this.actionRaw.segmentIdxs.length;return t>=e&&(t%=e),this.actionRaw.segmentIdxs[t]},e.prototype.onAnimationCollision=function(t,e){if(this._aniConfig.ansInfo){var o=0,i=0,n=!1;if(e==f.JXEAniEventName.Effects||"Effects"==e)n=!0,e=f.JXEAniEventName.Effects;else{var r=e.split("_"),a=Number(r[1])||0;r[0]==f.JXEAniEventName.Hurt?(o=a,e=f.JXEAniEventName.Hurt):r[0]==f.JXEAniEventName.Cure&&(i=a,e=f.JXEAniEventName.Cure)}if(!this._aniConfig.isSkill){var c=this._aniConfig.ansInfo;return this.dealComAtk(c,this.targets[h.JXBtlArrIx.Zero],o),void this.onCollisionEffect(c.protect?f.JXECollisionEffectFlag.Damage1:f.JXECollisionEffectFlag.Damage,this.targets[h.JXBtlArrIx.Zero])}var l=this._aniConfig.ansInfo,p=u.JXBattleCb.getSkillData(l.skillId);if(this.collsionType==f.JXECollsionType.Effect){var d=this._curSegment||0,g=p.skillEffect[d];if(!g)return void cc.error("the skill config is error, the action segment is not equal skill effects.length! ");for(var _=g[h.JXBtlArrIx.Zero],m=0;m<l.effects.length;m++)if(l.effects[m].effectId==_){var y=this.dealSkillEffect(l.effects[m],{cureMul:i,isEffect:n,isBullet:!1,hurtMul:o,eventName:e}),v=this._cmd.getRoleById(l.effects[m].target);this.onCollisionEffect(y,v)}}else if(this.collsionType==f.JXECollsionType.InsEffect)d=this._curSegment||0,y=this.dealSkillEffect(l.effects[d],{cureMul:i,isEffect:n,isBullet:!1,hurtMul:o,eventName:e}),v=this._cmd.getRoleById(l.effects[d].target),this.onCollisionEffect(y,v);else{for(var C=[],I=[],E=0;E<l.effects.length;E++){var S=l.effects[E],R=S.target;(d=C.indexOf(R))==s.INVALID_VALUE&&(d=C.push(R)-1),I[d]=this.dealSkillEffect(S,{cureMul:i,isEffect:n,isBullet:!1,hurtMul:o,eventName:e})}for(E=0;E<I.length;E++)(v=this._cmd.getRoleById(C[E]))&&this.onCollisionEffect(I[E],v)}}},e.prototype.onCollisionEffect=function(t,e,o){void 0===o&&(o=0);var i=this.actionRaw.collision||[];if(i.length>0){var n=o%i.length,r=a.default.actionCollision.getRaw(i[n]);if(r)return void new d.JXRBCollisionEffect(r,this._cmd).addToTarget(e)}},e.prototype.getPercentHurtAns=function(t,e){var o=s.OBJECT_COPY(t),i=t&&this._ansSegmentInfos?this._ansSegmentInfos[t.insId]:null;i||(i=0);var n=i,r=t.damage+t.protect;e?(o.damage=Math.floor(r*e),i+=o.damage):(o.damage=i?r-i:r,i=r);var a=o.damage;if(n<t.protect)if(a+n<t.protect)o.protect=a,o.damage=0;else{var c=t.protect-n;o.damage=a-c,o.protect=c}else o.protect=null;return this._ansSegmentInfos&&(this._ansSegmentInfos[t.insId]=i),i<r&&(o.ins2Hurt=null,o.ins2AtkHp=null,o.ins2DefHp=null,o.targetIsDie=!1),o},e.prototype.getPercentCureAns=function(t,e){var o=s.OBJECT_COPY(t),i=this._ansSegmentInfos[t.insId];return i||(i=0),e?(o.addNum=Math.floor(t.addNum*e),i+=o.addNum):i&&(o.addNum=t.addNum-i),this._ansSegmentInfos[t.insId]=i,o},e.prototype.getPercentMaxHpAns=function(t,e){var o=s.OBJECT_COPY(t),i=this._ansSegmentInfos[t.insId];return i||(i=0),e?(o.addNum=Math.floor(t.addNum*e),i+=o.addNum):i&&(o.addNum=t.addNum-i),this._ansSegmentInfos[t.insId]=i,o},e.prototype.dealSkillEffect=function(t,e){var o=this._cmd,i=o.jxBtlAns,n=i.buffInfos[t.buffInsId],r=a.default.skillEffect.getRaw(n.buffId);if(r){var s=i.skillInfos[n.insSkillId];if(n.prepareRd)(e.isEffect||e.isBullet)&&o.addBuff(t.target,t.buffInsId,s.skillId,n);else{n.lifeRd&&(e.isEffect||e.isBullet)&&o.addBuff(t.target,t.buffInsId,s.skillId,n);var c=o.getRoleById(n.target);switch(r.effectMold){case h.JXBtlBEM.Hurt:if(e.isEffect&&!e.isBullet)break;var l=i.hurtInfos[n.effects[h.JXBtlArrIx.Zero]];if(!l)return void(c&&c.showDescribe({type:f.DescribeType.Hurt,text:"-0"}));var u=this.getPercentHurtAns(l,e.hurtMul);return c&&c.onDamage(u),u.protect?f.JXECollisionEffectFlag.Damage1:f.JXECollisionEffectFlag.Damage;case h.JXBtlBEM.AddHp:case h.JXBtlBEM.AddProtect:var p=i.addHpInfos[n.effects[h.JXBtlArrIx.Zero]];if(!p)return void(c&&c.showDescribe({type:f.DescribeType.Cure,text:"+0"}));var d=this.getPercentCureAns(p,e.cureMul);return c&&c.onAddHp(d),f.JXECollisionEffectFlag.AddHp;case h.JXBtlBEM.AddMaxHp:var g=i.addMaxHpInfos[n.effects[h.JXBtlArrIx.Zero]];if(!g)return;return d=this.getPercentMaxHpAns(g,e.cureMul),c&&c.onAddMaxHp(d),f.JXECollisionEffectFlag.AddHp;case h.JXBtlBEM.Detonated:if(!e.isEffect)return;if(0==n.effects.length)return void c.showDescribe({type:f.DescribeType.Effect,text:r.effectDes+"_miss"});for(var _=n.effects,m=0;m<_.length;m++){var y=i.buffInfos[_[m].uuid],v=a.default.skillEffect.getRaw(y.buffId);if(v){var C=o.getRoleById(y.target);if(v.effectMold==h.JXBtlBEM.Hurt&&_[m].effect){var I=i.hurtInfos[_[m].effect];if(!I)continue;I.ext=r.effectDes,C.onDamage(I)}else if(v.effectMold==h.JXBtlBEM.AddHp&&_[m].effect){var E=i.addHpInfos[_[m].effects];if(E)continue;E.ext=r.effectDes,C.onAddHp(E)}}}break;default:if(e.isEffect&&!e.isBullet)return;o.addBuff(t.target,t.buffInsId,s.skillId,n)}}return f.JXECollisionEffectFlag.Config}},e.prototype.dealComAtk=function(t,e,o){var i=this.getPercentHurtAns(t,o);e.onDamage(i)},e.prototype.onSessionEnd=function(t){this._endFlag&=~t,this._endFlag>0||this.exit()},e.prototype.isAllSessionEnd=function(){return!(this._endFlag>0)},e.prototype.tagAnimation=function(){this._endFlag|=2},e.prototype.tagAction=function(){this._endFlag|=4},e.prototype.tagBullet=function(){this._endFlag|=8},e.prototype.bulletEnd=function(){this.onSessionEnd(8)},e.prototype.actionEnd=function(){this.onSessionEnd(4)},e.prototype.animationEnd=function(){this.onSessionEnd(2)},e.prototype.onBulletCollision=function(t){var e=this._bullets.indexOf(t);if(e!=s.INVALID_VALUE){if(this._bullets.splice(e,1),this._aniConfig.isSkill){if(t.endExec){for(var o=null,i=0;i<t.endExec.length;i++){var n=this.dealSkillEffect(t.endExec[i],{cureMul:0,isEffect:!0,isBullet:!0,hurtMul:0,eventName:null});o||(o=n)}this.onCollisionEffect(o,t.hiter,t.order)}}else this.onAnimationCollision(null,f.JXEAniEventName.Effects);this._bullets&&0!=this._bullets.length||this.bulletEnd()}},e.prototype.isBullet=function(t){return t&&t.length>0},e}(c.ObjectWrap);o.JXRBScript=g;var _=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return f.JXEScriptID.OnceNearAtk},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collsionType",{get:function(){return f.JXECollsionType.Siglon},enumerable:!1,configurable:!0}),e.prototype.exec=function(){var e=this;t.prototype.exec.call(this);var o=this.targets[0],i=this.getSingleTargetPos(),n=this.getBaseAnimName();this.tagAnimation(),this.tagAction();var r=null,a=i.x>o.x?f.JXEDir.Left:f.JXEDir.Right;if(this.execer.setDir(a),this.actionRaw.effect){var s=this.execer.changeAnimation(n,!1,function(){(r=e._cmd.assetManager.createEffect(e.actionRaw.effect,f.JXBattleEffectsRoot,cc.WrapMode.Normal)).node.scaleX=e.execer.dir===f.JXEDir.Right?e.actionRaw.effect[h.JXBtlArrIx.Five]:-e.actionRaw.effect[h.JXBtlArrIx.Five],e.playAudio(),r.once(cc.Animation.EventType.FINISHED,function(){e.execer.changeAnimation(f.JXEAniNames.back,!1,e.animationEnd.bind(e)),r.node.destroy(),r=null},e),r.node.position=cc.v2(e.actionRaw.position[0],e.actionRaw.position[1]);var t=e.execer.target.getChildByName(f.JXRB_ROLE_LAYER_NAME.UPPER);r.node.parent=t,r.play(f.COMMON_ANI_NAME);var o=r?r.getClips()[0].duration:0;e.execer.addAction(cc.delayTime(o)),e.execer.addAction(cc.moveTo(.1,e.execer.birthPos).endCallback(function(){if(!this._aniConfig.isSkill){var t=this._aniConfig.ansInfo;this.dealComAtk(t,this.targets[h.JXBtlArrIx.Zero])}this.actionEnd()}.bind(e)))});this.actionRaw.airOffsetX?i.x+=this.actionRaw.airOffsetX*o.dir:i.x+=(o.skeleton.node.sWidth/2+this.execer.skeleton.node.sWidth/2)*o.dir,this.execer.addAction(cc.moveTo(.1,i))}else this.playAudio(),s=this.execer.changeAnimation(n,!1,this.animationEnd.bind(this)),this.actionRaw.airOffsetX?i.x+=this.actionRaw.airOffsetX*o.dir:i.x+=(o.skeleton.node.sWidth/2+this.execer.skeleton.node.sWidth/2)*o.dir,this.execer.addAction(cc.moveTo(.1,i)),this.execer.addAction(cc.delayTime(s.duration)),this.execer.addAction(cc.moveTo(.1,this.execer.birthPos).endCallback(function(){if(!this._aniConfig.isSkill){var t=this._aniConfig.ansInfo;this.dealComAtk(t,this.targets[h.JXBtlArrIx.Zero])}this.actionEnd()}.bind(this)))},e}(g);o.JXRBScript$OnceNearAtk=_;var m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curPosIdx=0,e.road=null,e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return f.JXEScriptID.RoadMoveAct},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collsionType",{get:function(){return f.JXECollsionType.Siglon},enumerable:!1,configurable:!0}),e.prototype.exec=function(){t.prototype.exec.call(this),this.curPosIdx=0;var e=this.execer.cmd.btlMapConverts.converToMapPos(this.execer.birthPos),o=u.JXBattleCb.getCardData(this.execer.tableId),i=a.default.mapMgr.getAdjacent(o.scope,e);this.road=i,this.playAudio(),this.nextAction()},e.prototype.nextAction=function(){if(this.curPosIdx!=this.road.length){var t=this.execer.cmd.btlMapConverts.converToCCPos(this.road[this.curPosIdx]),e=this.getBaseAnimName(t);this.execer.changeAnimation(e),this.execer.addAction(cc.moveTo(.2,t).endCallback(this.nextAction.bind(this))),this.curPosIdx++}else this.execer.addAction(cc.moveTo(.1,this.execer.birthPos).endCallback(this.exit.bind(this)))},e}(g);o.JXRBScript$RoadAct=m;var y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curTargetIdx=0,e}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return f.JXEScriptID.MulNearAtk},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collsionType",{get:function(){return f.JXECollsionType.Siglon},enumerable:!1,configurable:!0}),e.prototype.exec=function(){t.prototype.exec.call(this),this.curTargetIdx=0,this.nextAction()},e.prototype.nextAction=function(){if(this.curTargetIdx!=this.targets.length){var t=this.getBaseAnimName();this.playAudio();var e=this.execer.changeAnimation(t),o=this.targets[this.curTargetIdx],i=o.position;this.actionRaw.airOffsetX?i.x+=this.actionRaw.airOffsetX*o.dir:i.x+=(o.skeleton.node.sWidth/2+this.execer.skeleton.node.sWidth/2)*o.dir,this.execer.addAction(cc.moveTo(.1,i)),this.execer.addAction(cc.delayTime(e.duration-.1).endCallback(this.nextAction.bind(this))),this.curTargetIdx++}else this.execer.addAction(cc.moveTo(.1,this.execer.birthPos).endCallback(this.exit.bind(this)))},e}(g);o.JXRBScript$MulNearAtk=y;var v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return f.JXEScriptID.BulletAtk},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collsionType",{get:function(){return this.actionRaw.bulletType?f.JXECollsionType.Siglon:f.JXECollsionType.Effect},enumerable:!1,configurable:!0}),e.prototype.exec=function(){t.prototype.exec.call(this),this.tagAnimation();var e=this.getComFullAnimNames();this.execer.changeSkillAnimation(e,this.animationEnd.bind(this)),this.createBullets()},e}(g);o.JXRBScript$BulletAtk=v;var C=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return f.JXEScriptID.DriftActBullet},enumerable:!1,configurable:!0}),e.prototype.exec=function(){S.prototype.exec.call(this),this.createBullets()},e}(v);o.JXRBScript$DriftActBullet=C;var I=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return f.JXEScriptID.SyncMoveActBullet},enumerable:!1,configurable:!0}),e.prototype.exec=function(){R.prototype.exec.call(this),this.createBullets()},e}(v);o.JXRBScript$SyncMoveActBullet=I;var E=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return f.JXEScriptID.StandAct},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collsionType",{get:function(){return f.JXECollsionType.Siglon},enumerable:!1,configurable:!0}),e.prototype.exec=function(){var e=this;t.prototype.exec.call(this);var o=this.getComFullAnimNames();if(this.tagAnimation(),!this._aniConfig.isSkill){var i=this._aniConfig.ansInfo;this.targets[h.JXBtlArrIx.Zero].onDamage(i)}this.execer.changeSkillAnimation(o,function(){e.animationEnd()}),this.playAudio(),this.createBullets()},e}(g);o.JXRBScript$StandAct=E;var S=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return f.JXEScriptID.DriftAct},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collsionType",{get:function(){return f.JXECollsionType.Siglon},enumerable:!1,configurable:!0}),e.prototype.exec=function(){var e=this;t.prototype.exec.call(this);var o=this.getSingleTargetPos();if(o!=this.execer.position){var i=o.x>this.targets[0].x?f.JXEDir.Left:f.JXEDir.Right;this.execer.setDir(i)}var n=this.getComFullAnimNames();this.tagAnimation(),this.playAudio();var r=cc.moveTo(this.actionRaw.moveTime,o).endCallback(function(){return e.execer.changeSkillAnimation(n,e.animationEnd.bind(e))});this.execer.addAction(r)},e}(g);o.JXRBScript$DriftAct=S;var R=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return f.JXEScriptID.SyncMoveAct},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collsionType",{get:function(){return f.JXECollsionType.Siglon},enumerable:!1,configurable:!0}),e.prototype.exec=function(){t.prototype.exec.call(this);var e=this.getSingleTargetPos();if(e!=this.execer.position){var o=e.x>this.targets[0].x?f.JXEDir.Left:f.JXEDir.Right;this.execer.setDir(o)}var i=this.getComFullAnimNames();this.tagAction(),this.tagAnimation(),this.playAudio();var n=this.execer.changeSkillAnimation(i,this.animationEnd.bind(this));this.execer.addAction(cc.moveTo(n.duration,e).endCallback(this.actionEnd.bind(this)))},e}(g);o.JXRBScript$SyncMoveAct=R;var D=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return f.JXEScriptID.SegmentAct},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collsionType",{get:function(){return f.JXECollsionType.Siglon},enumerable:!1,configurable:!0}),e.prototype.exec=function(){this._curSegment=null,this.tagAnimation(),this.nextSegment()},e.prototype.nextSegment=function(){var t=this;if(null===this._curSegment?(this._segmentCount=a.default.action.getRaw(this._aniConfig.actionId).segmentIdxs.length,this._curSegment=0):this._curSegment++,this._curSegment!=this._segmentCount)if(0==this._curSegment){var e=this.getSingleTargetPos(),o=this.getComFullAnimNames(),i=this.getBaseAnimName();this.playAudio(),o[o.length-1]=this.appendAnimName(i,this.getCurSegmentAniName());var n=this.execer.changeSkillAnimation(o,this.nextSegment.bind(this)),r=cc.moveTo(n.duration,e);this.execer.addAction(r)}else i=this.getBaseAnimName(),this.execer.changeAnimation(this.appendAnimName(i,this.getCurSegmentAniName()),!1,function(){t.nextSegment()});else this.animationEnd()},e}(g);o.JXRBScript$SegmentAct=D;var b=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return f.JXEScriptID.SegmentAct},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collsionType",{get:function(){return f.JXECollsionType.Siglon},enumerable:!1,configurable:!0}),e.prototype.exec=function(){this._curSegment=null,this.tagAnimation(),this.nextSegment()},e.prototype.nextSegment=function(){var t=this;if(null===this._curSegment?(this._segmentCount=a.default.action.getRaw(this._aniConfig.actionId).segmentIdxs.length,this._curSegment=0):this._curSegment++,this._curSegment!=this._segmentCount){var e=this.getComFullAnimNames(),o=this.getBaseAnimName();if(e[e.length-1]=this.appendAnimName(o,this.getCurSegmentAniName()),0==this._curSegment)var i=this.getSingleTargetPos(),n=this.execer.changeAnimation(e[e.length-1],!1,function(){var e=cc.sequence(cc.fadeOut(.08),cc.moveTo(n.duration,i),cc.callFunc(t.nextSegment.bind(t)));t.playAudio(),t.execer.addAction(e)});else if(0===this.execer.target.opacity){var r=cc.spawn(cc.fadeIn(.08),cc.callFunc(function(){t.execer.changeAnimation(e[e.length-1],!1,function(){t.nextSegment()})}));this.execer.addAction(r)}else this.execer.changeAnimation(e[e.length-1],!1,function(){t.nextSegment()})}else this.animationEnd()},e}(g);o.JXRBScript$SegmentTAct=b;var w=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return f.JXEScriptID.SegmentAct},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collsionType",{get:function(){return f.JXECollsionType.InsEffect},enumerable:!1,configurable:!0}),e.prototype.exec=function(){this._curSegment=null,this.tagAnimation(),this.nextSegment()},e.prototype.nextSegment=function(){var t=this;if(null===this._curSegment?this._curSegment=0:this._curSegment++,this._curSegment!=this._segmentCount){var e=this.getComFullAnimNames(),o=this.getBaseAnimName();if(e[e.length-1]=this.appendAnimName(o,this.getCurSegmentAniName()),0==this._curSegment)var i=this.getSingleTargetPos(),n=this.execer.changeAnimation(e[e.length-1],!1,function(){var e=cc.sequence(cc.fadeOut(.08),cc.moveTo(n.duration,i),cc.callFunc(t.nextSegment.bind(t)));t.execer.addAction(e),t.playAudio()});else{var r=this.execer.target.getChildByName("skeleton"),a=this.execer.target.getChildByName(f.JXRB_ROLE_LAYER_NAME.LOWER),s=this.execer.target.getChildByName(f.JXRB_ROLE_LAYER_NAME.UPPER);if(0===this.execer.target.opacity){var c=cc.spawn(cc.fadeIn(.08),cc.callFunc(function(){cc.tween(r).to(.6,{opacity:0}).start(),cc.tween(a).to(.6,{opacity:0}).start(),cc.tween(s).to(.6,{opacity:0}).start(),t.execer.changeAnimation(e[e.length-1],!1,function(){cc.tween(r).to(.2,{opacity:255}).start(),cc.tween(a).to(.6,{opacity:255}).start(),cc.tween(s).to(.6,{opacity:255}).start(),t.nextSegment()})}));this.execer.addAction(c)}else cc.tween(r).to(.6,{opacity:0}).start(),this.execer.changeAnimation(e[e.length-1],!1,function(){cc.tween(r).to(.2,{opacity:255}).start(),t.nextSegment()})}}else this.animationEnd()},e}(g);o.JXRBScript$SegmentNAct=w;var A=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"ID",{get:function(){return f.JXEScriptID.Ambient},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collsionType",{get:function(){return f.JXECollsionType.Siglon},enumerable:!1,configurable:!0}),e.prototype.exec=function(){var t=this.appendAnimName(this.getBaseAnimName(),h.JXBtlArrIx.One);this.tagAnimation(),this.execer.changeSkillAnimation([t],this.animationEnd.bind(this)),this.createBullets()},e}(E);o.JXRBScript$Ambient=A,cc._RF.pop()},{"../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr","./../../../Core/CoreDefine":"CoreDefine","./../../../Core/FrameEx/ES5Ex":"ES5Ex","./../../../Core/Manager/AudioMgr":"AudioMgr","./JXBattleCb":"JXBattleCb","./JXBattleDefine":"JXBattleDefine","./JXRBBullet":"JXRBBullet","./JXRBCollisionEffect":"JXRBCollisionEffect","./JXULDefine":"JXULDefine"}],JXResultHero:[function(t,e,o){"use strict";cc._RF.push(e,"d5a99pxKIJLPoc9aIJfDCjM","JXResultHero");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GEvent/GParam"),s=t("../../../Core/GView/GChild"),c=t("../../Common/UI"),l=t("../../Common/UIResources"),u=t("../../Logic/GameMgr"),h=t("./../../../Core/GCtrl"),p=t("./../../Common/Define"),d=cc._decorator,f=d.ccclass,g=d.property,_=d.menu,m=(d.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.heroTarit=null,e.icon=null,e.king=null,e.up=null,e.lv=null,e.exp=null,e.expBar=null,e.heroId=null,e._cb=null,e}return n(e,t),e.prototype.closeExp=function(){this.exp.node.active=!1,this.expBar.node.parent.active=!1},e.prototype.openUp=function(){this.up.active=!0},e.prototype.setView=function(t,e,o){this._cb=o;var i=u.default.rHeroData.getHero(t);if(!i)return this.node.removeFromParent(),void this.node.destroy();this.heroId=t,this.assetImpl.spriteAtlasFrame(this.heroTarit,l.Res.texture.views.common,"hero_"+i.trait),this.assetImpl.spriteFrame(this.icon,l.Res.texture.hero.hero+""+i.tableId);var n=u.default.lvData.getRaw(i.lv+1);if(this.lv.string="Lv"+i.lv,n){var r=i.exp/n.exp;this.exp.string="\u7ecf\u9a8c+"+e,this.expBar.fillRange=r;var s=(i.exp+e)/n.exp;cc.tween(this.expBar).to(.2,{fillRange:s}).start();var c={heroId:i.tableId,exp:e};h.GCtrl.ES.emit(p.CMsg.client.hero.onHeroAddExp,new a.default(c))}else this.exp.string="MAX",this.expBar.fillRange=1},e.prototype.showKing=function(){this.king.active=!0},e.prototype.jumpHeroDetailCtrl=function(){var t=this,e=null;u.default.rHeroData.getHaveHeros(p.SQUAD_BUTTON.ALL).have.forEach(function(o){o.tableId==t.heroId&&(e=o)});var o=u.default.heroData.getRaw(this.heroId);this._cb&&this._cb(),h.GCtrl.ES.emit(p.CMsg.client.home.onaddLevel),u.default.jumpToMgr.jumpGoTo(c.VIEW_ID.detailsCtrl,e,o)},r([g({type:cc.Sprite,tooltip:"\u82f1\u96c4\u54c1\u8d28\u80cc\u666f"})],e.prototype,"heroTarit",void 0),r([g({type:cc.Sprite,tooltip:"\u82f1\u96c4\u5934\u50cf"})],e.prototype,"icon",void 0),r([g({type:cc.Node,tooltip:"\u7687\u51a0"})],e.prototype,"king",void 0),r([g({type:cc.Node,tooltip:"\u5347\u7ea7\u53d8\u5f3a"})],e.prototype,"up",void 0),r([g(cc.Label)],e.prototype,"lv",void 0),r([g(cc.Label)],e.prototype,"exp",void 0),r([g(cc.Sprite)],e.prototype,"expBar",void 0),r([f,_("View/Fight/JXResultHero")],e)}(s.default));o.default=m,cc._RF.pop()},{"../../../Core/GEvent/GParam":"GParam","../../../Core/GView/GChild":"GChild","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr","./../../../Core/GCtrl":"GCtrl","./../../Common/Define":"Define"}],JXULAsset:[function(t,e,o){"use strict";cc._RF.push(e,"e1e33MJeYRDsZ8UsmamyXR8","JXULAsset");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0}),o.BattleAssets=void 0;var a=t("../../../Core/GLoader/GLoader"),s=t("../../Common/UIResources"),c=t("../../Logic/GameMgr"),l=t("./../../../Core/CoreDefine"),u=t("./../../../Core/FrameEx/ES5Ex"),h=t("./JXBattleDefine"),p=t("./JXRBCmdMgr"),d=t("./JXULDefine"),f=function(t){function e(e){var o=t.call(this)||this;return o.assetImpl=null,o._spritePool=null,o.assetImpl=a.GAssetImpl.getAssetImpl(e),o._spritePool=new cc.NodePool,o}return n(e,t),e.prototype.preLoads=function(t){for(var e,o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];(e=this.assetImpl).preLoads.apply(e,r([function(e,o){e==o&&(console.log("curIndx = ",e),console.log("totalCount = ",o),t())},{type:cc.Prefab,path:s.Res.prefab.fight.role},{type:cc.Prefab,path:s.Res.prefab.fight.head},{type:cc.Prefab,path:s.Res.prefab.fight.fightFlags},{type:cc.Prefab,path:s.Res.prefab.fight.roleHead}],o))},e.prototype.loadAllRoundAssets=function(t,e,o){var i=[],n=[];this.loadSceneAssets(n,i);for(var a=0;a<t.length;a++)this.loadTeamAssets(t[a],n,i);n.push(),this.preLoads.apply(this,r([function(){return o()}],n))},e.prototype.loadSceneAssets=function(t,e){for(var o=Object.keys(d.JXSceneEffect),i=0;i<o.length;i++){var n=d.JXSceneEffect[o[i]];this.hasLoadAsset(e,n)||(t.push({type:sp.SkeletonData,path:n}),e.push(n))}},e.prototype.loadTeamAssets=function(t,e,o){for(var i=0;i<t.partnerData.length;i++){var n=t.partnerData[i];t.heroIds.indexOf(n.heroId)!=l.INVALID_VALUE&&this.loadHeroAssets(n.tableId,n.skillIds,e,o)}},e.prototype.loadHeroAssets=function(t,e,o,i){var n=c.default.heroData.getRaw(t),r=s.Res.model+n.animation+"/"+n.animation;this.hasLoadAsset(i,r)||(o.push({type:sp.SkeletonData,path:r}),i.push(r));var a=s.Res.audio.battle+n.atkAudio;this.hasLoadAsset(i,a)||(o.push({type:cc.AudioClip,path:a}),i.push(a));for(var u=0;u<e.length;u++){var h=e[u];l.IS_EMPTY_INVALID(h)||this.loadSkillAsset(h,o,i)}this.loadActionAsset(n.action,o,i)},e.prototype.loadSkillAsset=function(t,e,o){var i=c.default.skillData.getRaw(t);if(i){if(i.skillSk){var n=d.JXBattleSkillSpine+i.skillSk;this.hasLoadAsset(o,n)||(e.push({type:sp.SkeletonData,path:n}),o.push(n))}var r=s.Res.audio.battle+t;if(this.hasLoadAsset(o,r)||(e.push({type:cc.AudioClip,path:r}),o.push(r)),this.loadActionAsset(i.animGroup[h.JXBtlArrIx.One],e,o),i.eAnimId.length>0)for(var a=0;a<i.eAnimId.length;a++)i.eAnimId[a]&&this.loadEffectAnim(i.eAnimId[a],e,o)}},e.prototype.loadActionAsset=function(t,e,o){var i=c.default.action.getRaw(t);if(i){if(i.collision&&i.collision.length>0)for(var n=0,r=i.collision.length;n<r;n++)this.loadCollision(i.collision[n],e,o);var a=i.bullet;if(a&&a.length>0)for(n=0;n<a.length;n++)this.loadBulletAsset(a[n],e,o);var s=i.effect;if(s){var l=d.JXBattleEffectsRoot+s[h.JXBtlArrIx.Zero];this.hasLoadAsset(o,l)||(e.push({type:cc.SpriteAtlas,path:l}),o.push(l))}}},e.prototype.loadBulletAsset=function(t,e,o){var i=c.default.bullet.getRaw(t);if(i)if(i.isSpine){var n=d.JXBattleSkillSpine+i.aniconfig[h.JXBtlArrIx.Zero];this.hasLoadAsset(o,n)||(e.push({type:sp.SkeletonData,path:n}),o.push(n))}else n=d.JXBattleBulletRoot+i.aniconfig[h.JXBtlArrIx.Zero],this.hasLoadAsset(o,n)||(e.push({type:cc.SpriteAtlas,path:n}),o.push(n))},e.prototype.loadEffectAnim=function(t,e,o){var i=c.default.effectAnim.getRaw(t);if(i){for(var n=0;n<i.effect.length;n++){var r=d.JXBattleBuffRoot+i.effect[n][h.JXBtlArrIx.Zero];this.hasLoadAsset(o,r)||(e.push({type:cc.SpriteAtlas,path:r}),o.push(r))}i.collision&&this.loadCollision(i.collision,e,o)}},e.prototype.loadCollision=function(t,e,o){var i=c.default.actionCollision.getRaw(t);if(i)for(var n=0;n<i.effect.length;n++)if(i.isSpine){var r=d.JXBattleSkillSpine+i.effect[n][h.JXBtlArrIx.Zero];this.hasLoadAsset(o,r)||(e.push({type:sp.SkeletonData,path:r}),o.push(r))}else r=d.JXCollisionRoot+i.effect[n][h.JXBtlArrIx.Zero],this.hasLoadAsset(o,r)||(e.push({type:cc.SpriteAtlas,path:r}),o.push(r))},e.prototype.hasLoadAsset=function(t,e){return t.indexOf(e)!=l.INVALID_VALUE},e.prototype.createEffectsAnimation=function(t,e,o){var i=o+t[h.JXBtlArrIx.Zero],n=this.assetImpl.getPreLoadAsset(i);if(n){a.GAssetImpl.checkAtlasDyPack(i,n);var r=this.assetImpl.atlasJXLoadClips(n,{aniName:d.COMMON_ANI_NAME,prefix:t[h.JXBtlArrIx.One],numberFix:t[h.JXBtlArrIx.Two],minIdx:1,maxIdx:t[h.JXBtlArrIx.Three]})[h.JXBtlArrIx.Zero];return r||cc.log("\u5e27\u52a8\u753b\u914d\u7f6eBUG \u8d44\u6e90\u4e3a"+i+", \u914d\u7f6e\u4e3a"+JSON.stringify(t)),r.wrapMode=e,r.sample=30,r.speed=p.ANIMATION_SPEED,r}cc.log("\u627e\u4e0d\u5230\u8d44\u6e90\uff1a"+i)},e.prototype.createEffect=function(t,e,o,i){var n=new cc.Node,r=n.addComponent(cc.Sprite);r.type=cc.Sprite.Type.SIMPLE,r.sizeMode=cc.Sprite.SizeMode.RAW,n.scale=t[h.JXBtlArrIx.Five],n.anchorY=0,n.opacity=255*t[h.JXBtlArrIx.Six],t[h.JXBtlArrIx.Four]&&r.setBlend(cc.macro.BlendFactor.SRC_ALPHA,cc.macro.BlendFactor.ONE),r.trim=!1;var a=n.addComponent(cc.Animation),s=this.createEffectsAnimation(t,o,e);return a.addClip(s),a.once(cc.Animation.EventType.FINISHED,function(){n.destroy(),i&&i()}),a},e.prototype.createSpine=function(t){var e=(new cc.Node).addComponent(sp.Skeleton);return e.premultipliedAlpha=!1,e.skeletonData=this.assetImpl.getPreLoadAsset(t),e},e.prototype.getNodeFormPoll=function(){return this._spritePool.size()?this._spritePool.get():(new cc.Node).addComponent(cc.Sprite).node},e.prototype.createDescribe=function(t){var e=new cc.Node,o=e.addComponent(cc.Layout);o.type=cc.Layout.Type.HORIZONTAL;for(var i=t.split("|"),n=u.NewFillArray(i.length),r=0;r<i.length;r++){var a=i[r],c=this.getNodeFormPoll();this.assetImpl.spriteAtlasFrame(c.getComponent(cc.Sprite),s.Res.texture.fight.describe,a),n[r]=c,c.name=a}return n.forEach(function(t){t.position=cc.Vec2.ZERO,t.parent=e}),o.updateLayout(),o.node},e.prototype.recyclingDescribe=function(t){var e=this;t.children.forEach(function(t){t.removeFromParent(),t.name="",t.scale=1,t.opacity=255,t.active=!0,t.getComponent(cc.Sprite).spriteFrame=null,e._spritePool.put(t)})},e.prototype.destroy=function(){this.assetImpl.release(),this.assetImpl=null,this._spritePool.clear()},e}(u.ObjectWrap);o.BattleAssets=f,cc._RF.pop()},{"../../../Core/GLoader/GLoader":"GLoader","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr","./../../../Core/CoreDefine":"CoreDefine","./../../../Core/FrameEx/ES5Ex":"ES5Ex","./JXBattleDefine":"JXBattleDefine","./JXRBCmdMgr":"JXRBCmdMgr","./JXULDefine":"JXULDefine"}],JXULDefine:[function(t,e,o){"use strict";cc._RF.push(e,"a1365mnYddPtb5gIkQtFIxp","JXULDefine"),this&&this.__spreadArrays,Object.defineProperty(o,"__esModule",{value:!0}),o.JXEBtState=o.JXMsg=o.JXECollsionType=o.JXEScriptID=o.JXEBulleType=o.JXRB_LAYER_INDEX=o.DescribeGroup=o.DescribeType=o.JXBattleLog=o.JXECollisionEffectFlag=o.JXETargetPosType=o.SCENE_EFFECT_NODE_NAME=o.JXZcqzEffect=o.JXSceneEffect=o.JXEAniEventName=o.JXEBlessAniNames=o.JXEOverAniNames=o.JXEHeroBgAniNames=o.JXEAniNames=o.JXEState=o.BTL_CONFIG=o.DESCRIPT_SCALE=o.JXBuffOrderThreshold=o.JXStaticEffects=o.JXRB_ROLE_LAYER_NAME=o.ICampKeyCode=o.JXBattleSkillSpine=o.JXBattleBulletRoot=o.JXCollisionRoot=o.JXBattleBuffRoot=o.JXBattleEffectsRoot=o.COMMON_ANI_NAME=o.JXRB_ROLE_NAME_PREFIX=o.JXEDir=void 0,function(t){t[t.Left=1]="Left",t[t.Right=-1]="Right"}(o.JXEDir||(o.JXEDir={})),o.JXRB_ROLE_NAME_PREFIX="JXRBRole",o.COMMON_ANI_NAME="COMMON_NAME",o.JXBattleEffectsRoot="frames/battle/effect/",o.JXBattleBuffRoot="frames/battle/buffs/",o.JXCollisionRoot="frames/battle/collision/",o.JXBattleBulletRoot="frames/battle/bullets/",o.JXBattleSkillSpine="spine/battle/comskills/",o.ICampKeyCode=100,o.JXRB_ROLE_LAYER_NAME={LOWER:"lower",UPPER:"upper",EFFECT:"effect"},o.JXStaticEffects={},o.JXBuffOrderThreshold=100,o.DESCRIPT_SCALE=.8,o.BTL_CONFIG={ACTION_TIME:5},function(t){t[t.Idle=0]="Idle",t[t.ComAtk=1]="ComAtk",t[t.Run=2]="Run",t[t.Death=3]="Death",t[t.Skill=4]="Skill",t[t.Hit=5]="Hit",t[t.Perpare=6]="Perpare",t[t.Real=7]="Real",t[t.Vertigo=8]="Vertigo",t[t.StopFrame=9]="StopFrame",t[t.Collision1=10]="Collision1",t[t.Global=11]="Global",t[t.TransSpine=101]="TransSpine"}(o.JXEState||(o.JXEState={})),o.JXEAniNames={idle:"idle",comAtk:"atk",comAtk_up:"atk_up",comAtk_down:"atk_down",run:"move",run2:"move2",skill:"skill",qishou:"qishou",prepare:"xvli",hit:"hit",die:"die",vertigo:"vertigo",back:"back"},o.JXEHeroBgAniNames={white:"white",blue:"blue",green:"green",purple:"purple",red:"red",yellow:"yellow",shengji:"shengji",heti:"heti"},o.JXEOverAniNames={shengli1:"shengli1",shengli2:"shengli2",shibai1:"shibai1",shibai2:"shibai2"},o.JXEBlessAniNames={hecheng:"hecheng",animation:"animation"},o.JXEAniEventName={Shoot:"shoot",Hurt:"hurt",Cure:"cure",All:"all",HitAni:"hitAni",Effects:"effects",BlackStart:"black_start",BlackEnd:"black_end",CloudStart:"cloud_start",CloudEnd:"cloud_end",CaiAtk:"cai_atk",CaiSkill:"cai_skill"},o.JXSceneEffect={tuteng:"spine/battle/scene_effect/tuteng"},o.JXZcqzEffect="spine/battle/common/zcqz",o.SCENE_EFFECT_NODE_NAME={BLACK:"Black"},function(t){t[t.Target=0]="Target",t[t.SelfCamp=1]="SelfCamp",t[t.TargetCamp=2]="TargetCamp",t[t.SelfCenter=3]="SelfCenter",t[t.TargetCenter=4]="TargetCenter",t[t.TargetCntAft=5]="TargetCntAft"}(o.JXETargetPosType||(o.JXETargetPosType={})),function(t){t[t.Config=0]="Config",t[t.Damage=1]="Damage",t[t.Damage1=2]="Damage1",t[t.AddHp=3]="AddHp"}(o.JXECollisionEffectFlag||(o.JXECollisionEffectFlag={})),o.JXBattleLog=function(){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e]},function(t){t[t.Hurt=0]="Hurt",t[t.CritHurt=1]="CritHurt",t[t.Cure=2]="Cure",t[t.MaxHp=3]="MaxHp",t[t.BuffAdd=4]="BuffAdd",t[t.BuffSub=5]="BuffSub",t[t.Effect=6]="Effect"}(o.DescribeType||(o.DescribeType={})),function(t){t[t.Number=0]="Number",t[t.Effect=1]="Effect"}(o.DescribeGroup||(o.DescribeGroup={})),o.JXRB_LAYER_INDEX={SCENE_EFFECT_LOWER:-1500,SHADOW:-1e3,ROLE:1e3,SCENE_EFFECT_UPPER:1500,BLACK:2e3,ROLE_SPECIAL:2100,SECEN_BLACK_LAYER:2500,DESCRIBE_LAYER:2750},function(t){t[t.Line=0]="Line",t[t.Curve=1]="Curve",t[t.Vertical=2]="Vertical"}(o.JXEBulleType||(o.JXEBulleType={})),function(t){t[t.OnceNearAtk=0]="OnceNearAtk",t[t.MulNearAtk=1]="MulNearAtk",t[t.BulletAtk=2]="BulletAtk",t[t.StandAct=3]="StandAct",t[t.RoadMoveAct=4]="RoadMoveAct",t[t.DriftAct=5]="DriftAct",t[t.SyncMoveAct=6]="SyncMoveAct",t[t.SegmentAct=7]="SegmentAct",t[t.SegmentTAct=8]="SegmentTAct",t[t.SegmentNAct=9]="SegmentNAct",t[t.DriftActBullet=10]="DriftActBullet",t[t.SyncMoveActBullet=11]="SyncMoveActBullet",t[t.Ambient=12]="Ambient"}(o.JXEScriptID||(o.JXEScriptID={})),function(t){t[t.Effect=0]="Effect",t[t.Siglon=1]="Siglon",t[t.Total=2]="Total",t[t.InsEffect=3]="InsEffect"}(o.JXECollsionType||(o.JXECollsionType={})),o.JXMsg={action:{scExit:"JXECLMsg.action.scExit",damage:"JXECLMsg.action.Damage",debuger:{pause:"JXECLMsg.action.debuger.pause"}}},function(t){t[t.NONE=0]="NONE",t[t.ATKER_ACTION=1]="ATKER_ACTION",t[t.ENEMY_ACTION=2]="ENEMY_ACTION",t[t.END=3]="END"}(o.JXEBtState||(o.JXEBtState={})),cc._RF.pop()},{}],JumpUtil:[function(t,e,o){"use strict";cc._RF.push(e,"39679E3RbRHApUrr2qgft3o","JumpUtil");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/FrameEx/ES5Ex"),s=t("../../../Core/GCtrl"),c=t("../../../Shaders/Manager/ShaderUtil"),l=t("../../Common/UI"),u=t("../../Logic/ConditionListener"),h=t("../../Logic/GameMgr"),p=(function(t){function e(e){var o=t.call(this)||this;return o.viewId=null,o.viewId=e,o}n(e,t),e.prototype.emitConditionEnvChange=function(){},e.prototype.toast=function(){},e.prototype.guide=function(){for(var t=0;t<this._emitters.length;t++){var e=this._emitters[t];if(!e.curState&&0!=t&&e.guide())break}}}(u.ConditionListter),function(t){function e(){var e=t.call(this)||this;return e._unlockChecks=new a.MapWrap,e._unlockKeyRefs=new a.MapWrap,e.rechageViews=[],e}return n(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!1,configurable:!0}),e.prototype.initGame=function(){this.initSystemUnlock()},e.prototype.loginOut=function(){this.unSystemUnlock()},e.prototype.initSystemUnlock=function(){this._unlockChecks.clear(),this._unlockKeyRefs.clear()},e.prototype.unSystemUnlock=function(){this._unlockChecks.forEach(function(t){t.destroy()}),this._unlockChecks.clear(),this._unlockKeyRefs.clear()},e.prototype.jumpGoTo=function(t){for(var e,o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];if(this.isSystemOpen(t,!0)){var n=[],a=l.VIEW_IDByPageNum[t]?l.VIEW_IDByPageNum[t]:null;a&&a.page&&(t=a.view,n.push.apply(n,a.page));var c=this.getParam(t);(c||0==c)&&n.push(c),n.push.apply(n,o),(e=h.default.uiMgr).showWin.apply(e,r([t],n)),s.GCtrl.ES.emit(s.GCtrl.GClientWinOpenEventMsg,t)}},e.prototype.getSystemOpenListener=function(t){return this._unlockChecks.get(t)},e.prototype.isSystemOpen=function(t,e){void 0===e&&(e=!1);var o=this._unlockChecks.get(t);if(!o){var i=this._unlockKeyRefs.get(t);if(i&&i.length>0)for(var n=0;n<i.length;n++)if(!this.isSystemOpen(i[n],e))return!1;return!0}return!o.cureState&&e?(o.toast(),!1):o.cureState},e.prototype.setBtnStatus=function(t,e){var o=h.default.jumpToMgr.isSystemOpen(e,!1);return o?c.default.normal(t):c.default.gray(t),o},e.prototype.getParam=function(){return null},e}(a.ObjectWrap));o.default=p,cc._RF.pop()},{"../../../Core/FrameEx/ES5Ex":"ES5Ex","../../../Core/GCtrl":"GCtrl","../../../Shaders/Manager/ShaderUtil":"ShaderUtil","../../Common/UI":"UI","../../Logic/ConditionListener":"ConditionListener","../../Logic/GameMgr":"GameMgr"}],LHeroData:[function(t,e,o){"use strict";cc._RF.push(e,"53287KFO5NFqa5QnxjsrduJ","LHeroData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.$localKey="LHeroData",e.$ownHeros=[],e._needAutoSave=!1,e}return n(e,t),e.prototype.getAllHeros=function(){return this.$ownHeros},e.prototype.onInit=function(){this.load()},e.prototype.save=function(t){var e=this;this.$ownHeros=[],t.values().forEach(function(t){e.$ownHeros.push(t)}),this.set()},r([s],e)}(a.GLocal);o.default=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],LOwnEquips:[function(t,e,o){"use strict";cc._RF.push(e,"2f4baXuzolPE7YfhK4r4JN1","LOwnEquips");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.$localKey="LOwnEquips",e.$ownEquips=[],e}return n(e,t),e.prototype.onInit=function(){this.load(),this.set()},e.prototype.save=function(t){var e=this;this.$ownEquips=[],t.values().map(function(t){var o=[t.insId,t.equipId,t.sLv,t.quality,t.isFirstExp,t.wear];e.$ownEquips.push(o)}),this.set()},e.prototype.getAllEquips=function(){return this.$ownEquips},r([s],e)}(a.GLocal);o.default=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],LOwnItems:[function(t,e,o){"use strict";cc._RF.push(e,"fbc1dD/545JgpzBXYSGXv4r","LOwnItems");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.$localKey="LOwnProps",e.$isFrist=!0,e.$ownItems={},e}return n(e,t),e.prototype.onInit=function(){this.load(),this.set()},Object.defineProperty(e.prototype,"isFrist",{get:function(){return this.$isFrist},set:function(t){this.$isFrist=t,this.set()},enumerable:!1,configurable:!0}),e.prototype.getAllItems=function(){return this.$ownItems},e.prototype.save=function(t){var e=this;this.$ownItems={},t.forEach(function(t,o){if(t.length){var i=[];t.forEach(function(t){i.push([t.id,t.type,t.num])}),e.$ownItems[o]=i}}),this.set()},r([s],e)}(a.GLocal);o.default=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],LUserData:[function(t,e,o){"use strict";cc._RF.push(e,"46dfbEApy1NTo1Cf7tQTaGR","LUserData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.LUserData=void 0;var a=t("../../../conventions/JXCommon"),s=t("../../../Core/FrameEx/ES5Ex"),c=t("../../../Core/GCtrl"),l=t("../../../Core/GEvent/GParam"),u=t("../../../Core/Manager/DataPool"),h=t("../../Common/Define"),p=t("../../Common/Language"),d=t("../../Common/TimeUtils"),f=t("../../Common/Zh"),g=t("../../Logic/GameMgr"),_=t("../../Logic/UserMgr"),m=t("./../../../Core/CoreDefine"),y=cc._decorator.ccclass,v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.$localKey="LUserData",e.$fristTime=0,e.$freePressDate=0,e.$heroBuff=[],e.$userBuff=s.NewFillArray(6,m.INVALID_VALUE_ZERO),e.$chapterBoxArr=[],e.$officerBoxReceiverArr=[],e.$vipReward=[],e.$HeroInBattle=s.NewFillArray(5,m.INVALID_VALUE),e.$mainSectionReward=[],e.$signInDate=0,e.$useDayFreeDate=0,e.$signInCount=0,e.$signDoubleDate=0,e.$dayReceiveDate=[],e.$onLine=0,e.$onLineDatTime=0,e.$onLineNum=0,e.$onLineAdd=1,e.$recruitCtrl=0,e.$addDial=1,e.$receiveId=1,e.$towerReward=null,e.$lastTowerGet=null,e.$towerRewardSpeed=null,e.$lastHideTime=null,e.$time=null,e.$guide=null,e.$CeremonialState=[0,0,0,0,0,0,0,0,0,0],e.$ceremonialDrawTime=0,e.$dailyTaskDate=0,e.$dailyTaskState=[{id:1,ftime:1,receive:0}],e.$dailyTaskReceive=[0,0,0,0],e.$isVideoSkipGame=!1,e}return n(e,t),e.prototype.onInit=function(){if(this.load(),this.$time=0,this.initEvent(),this.$vipReward.length<1){for(var t=[],e=0;e<5;e++){var o={recycle:h.VIPRECEIVE.No,recycleUp:h.VIPRECEIVE.No};t.push(o)}this.vipReward=t}this.$fristTime||(this.$fristTime=c.GCtrl.now),this.$freePress||(this.$freePress=0),this.$lastTowerGet||(this.$lastTowerGet=c.GCtrl.now),this.$free||(this.$free=0),this.$officerLv||(this.$officerLv=0),this.$signOfficerLv||(this.$signOfficerLv=0),this.$vipLv||(this.$vipLv=1),this.$guide||(this.$guide=[]),this.$adWatchTime||(this.$adWatchTime=0),this.$sportsLv||(this.$sportsLv=0),this.$level||(this.$level=0),this.$levelStart||(this.$levelStart=[]),this.$towerReward||(this.$towerReward=[0,0]),this.$towerRewardSpeed||(this.$towerRewardSpeed=[0,0]),this.$CeremonialState||(this.$CeremonialState=[0,0,0,0,0,0,0,0,0,0]),this.set()},e.prototype.setConfigData=function(){for(var t=[],e=0;e<5;e++){var o={recycle:h.VIPRECEIVE.No,recycleUp:h.VIPRECEIVE.No};t.push(o)}this.vipReward=t,this.$fristTime=c.GCtrl.now,this.$freePress=0,this.$lastTowerGet=c.GCtrl.now,this.$free=0,this.$officerLv=0,this.$signOfficerLv=0,this.$vipLv=1,this.$guide=[],this.$adWatchTime=0,this.$sportsLv=0,this.$level=0,this.$levelStart=[],this.$towerReward=[0,0],this.$towerRewardSpeed=[0,0],this.$CeremonialState=[0,0,0,0,0,0,0,0,0,0],this.$ceremonialDrawTime=0,this.$isVideoSkipGame=!1},e.prototype.initEvent=function(){var t=this;cc.game.on(cc.game.EVENT_SHOW,function(){var e=c.GCtrl.now;if(e-t.$lastHideTime>a.JXDef.Time.MINUTE){var o=e-t.$lastHideTime,i=Math.floor(o/a.JXDef.Time.MINUTE);t.$towerReward[0]=t.$towerReward[0]+t.$towerRewardSpeed[0]*i,t.$towerReward[1]=t.$towerReward[1]+t.$towerRewardSpeed[1]*i,c.GCtrl.ES.emit(h.CMsg.client.tower.onAddTowerReward)}}),cc.game.on(cc.game.EVENT_HIDE,function(){t.$lastHideTime=c.GCtrl.now,t.set()}),c.GCtrl.ES.on(c.GCtrl.GTimerSecondEventMsg,this,this.addTowerReward.bind(this),m.PRIORITY_DATA)},e.prototype.checkIsNewUser=function(){return d.default.isSameDay(c.GCtrl.now,this.$fristTime)},e.prototype.addTowerSpeed=function(t){this.$towerRewardSpeed[0]||this.$towerRewardSpeed[1]||(this.lastTowerGet=c.GCtrl.now),this.$towerRewardSpeed[0]+=t[0],this.$towerRewardSpeed[1]+=t[1],this.set()},e.prototype.getTowerSpeed=function(){return m.OBJECT_COPY(this.$towerRewardSpeed)},e.prototype.getRewardInfo=function(){return m.OBJECT_COPY(this.$towerReward)},e.prototype.addTowerReward=function(){this.$time++,this.$time>=60&&(this.$towerReward[0]+=this.$towerRewardSpeed[0],this.$towerReward[1]+=this.$towerRewardSpeed[1],this.$time=0,c.GCtrl.ES.emit(h.CMsg.client.tower.onAddTowerReward),this.set())},e.prototype.getTowerReward=function(){this.$time=0,this.$towerReward=[0,0],this.$lastTowerGet=c.GCtrl.now,this.set()},e.prototype.getDailyTaskState=function(){return d.default.isSameDay(this.$dailyTaskDate,c.GCtrl.now)?this.$dailyTaskState:(this.$dailyTaskState=[{id:1,ftime:1,receive:0}],this.$dailyTaskDate=c.GCtrl.now,this.$dailyTaskReceive=[0,0,0,0],c.GCtrl.ES.emit(h.CMsg.client.bag.onBagItemChange,[[h.CURRENCY.ACTIVEVAL,h.ITEM_TYPE.CURRENCY,0-g.default.RBagData.getMegreItems(104,h.ITEM_TYPE.CURRENCY).num]]),this.$dailyTaskState)},e.prototype.pushDailyTaskState=function(t){this.$dailyTaskState.push(t)},e.prototype.setDailyTaskState=function(t){for(var e=0;e<this.$dailyTaskState.length;e++)if(this.$dailyTaskState[e].id==t.id)return;this.$dailyTaskState.push(t)},Object.defineProperty(e.prototype,"isVideoSkipGame",{get:function(){return this.$isVideoSkipGame},set:function(t){this.$isVideoSkipGame=t},enumerable:!1,configurable:!0}),e.prototype.getDailyBoxReceive=function(t){return this.$dailyTaskReceive[t]},e.prototype.setDailyBoxReceive=function(t){return this.$dailyTaskReceive[t]=1},Object.defineProperty(e.prototype,"CeremonialDrawTime",{get:function(){return this.$ceremonialDrawTime},set:function(t){this.$ceremonialDrawTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"CeremonialState",{get:function(){return this.$CeremonialState},set:function(t){this.$CeremonialState=t},enumerable:!1,configurable:!0}),e.prototype.setCeremonialState=function(t){this.$CeremonialState[t]=1},e.prototype.getLastTowerId=function(){return this.$sportsLv},e.prototype.getUserBuff=function(t){return this.$userBuff[t]},e.prototype.changeBuff=function(t){var e=this;t.forEach(function(t,o){0!=t&&(e.$userBuff[o]+=t,e.$userBuff[o]=Number(e.$userBuff[o].toFixed(4)))}),this.set()},e.prototype.changeHeroBuff=function(t){var e=this;t.forEach(function(t){t.length>0&&e.$heroBuff.push(t)})},e.prototype.getHeroBuff=function(t){var e=[];return this.$heroBuff.forEach(function(o){o.forEach(function(i){i==t&&e.push(o)})}),e},Object.defineProperty(e.prototype,"sportsLv",{set:function(t){this.$sportsLv=t,this.set()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"freePress",{get:function(){return this.$freePress},set:function(t){this.$freePress=t,this.set()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"addDial",{get:function(){return this.$addDial},set:function(){this.$addDial++,this.set()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"recruitCtrl",{get:function(){return this.$recruitCtrl},set:function(t){this.$recruitCtrl+=t,this.set()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"receiveId",{get:function(){return this.$receiveId},set:function(){this.$receiveId++,this.set()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"free",{get:function(){return this.$free},set:function(t){this.$free=t,this.set()},enumerable:!1,configurable:!0}),e.prototype.getStarByLevel=function(t){return this.$levelStart[t]||0},e.prototype.setStarByLevel=function(t,e){this.$levelStart[t]?this.$levelStart[t]=this.$levelStart[t]<e?e:this.$levelStart[t]:this.$levelStart[t]=e,this.set()},Object.defineProperty(e.prototype,"lastTowerGet",{get:function(){return this.$lastTowerGet},set:function(t){this.$lastTowerGet=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vipReward",{get:function(){return this.$vipReward},set:function(t){this.$vipReward=t,this.set()},enumerable:!1,configurable:!0}),e.prototype.getVipReward=function(t,e){return h.VIPRECEIVE.No,e==h.VIPBOXTYPE.DAYBOX?this.$vipReward[t].recycle:this.$vipReward[t].recycleUp},e.prototype.setVipReward=function(t,e,o){e==h.VIPBOXTYPE.DAYBOX?this.$vipReward[t].recycle=o:this.$vipReward[t].recycleUp=o,this.set()},Object.defineProperty(e.prototype,"dayReceiveDate",{get:function(){return this.$dayReceiveDate},set:function(t){this.$dayReceiveDate=t,this.set()},enumerable:!1,configurable:!0}),e.prototype.getOfficeStatus=function(t){return this.$officerBoxReceiverArr[t]||(this.$officerBoxReceiverArr[t]={adBox:h.OFFICERITEM.NOT,box:h.OFFICERITEM.NOT},this.set()),this.$officerBoxReceiverArr[t]},e.prototype.setOfficeStatus=function(t,e){this.$officerBoxReceiverArr[t]=e,this.set()},Object.defineProperty(e.prototype,"chapterBoxArr",{get:function(){return this.$chapterBoxArr},set:function(t){this.$chapterBoxArr=t,this.set()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mainSectionReward",{get:function(){return this.$mainSectionReward},set:function(t){this.$mainSectionReward=t,this.set()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){return this.$level},set:function(t){t>this.$level&&(this.$level=t,this.set(),c.GCtrl.ES.emit(h.CMsg.client.home.onaddLevel))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"heroInBattle",{get:function(){return this.$HeroInBattle},set:function(t){this.$HeroInBattle=t,this.set()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"adWatchTime",{get:function(){return this.$adWatchTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"officerLv",{get:function(){return this.$officerLv},set:function(t){this.$officerLv=t,this.set()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"signOfficerLv",{get:function(){return this.$signOfficerLv},set:function(t){this.$signOfficerLv=t,this.set()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vipLv",{get:function(){return this.$vipLv},enumerable:!1,configurable:!0}),e.prototype.addAdWatchTime=function(t){void 0===t&&(t=1),this.$adWatchTime+=t,_.default.ins().addDailyTaskState(11,1);var e=this.$vipLv+1;if(c.GCtrl.ES.emit(h.CMsg.client.home.onVipLvUp,new l.default(this.$vipLv)),e>g.default.vipData.size)return e=this.$vipLv,void this.set();var o=g.default.vipData.getRaw(e);e&&o.next<=this.$adWatchTime&&(this.$vipLv++,this.changeBuff(o.buff),this.changeHeroBuff(o.buff2)),this.set()},e.prototype.addSectionReward=function(){},e.prototype.signIn=function(){return this.$signInDate=c.GCtrl.now,c.GCtrl.ES.emit(h.CMsg.client.home.onSign),this.$signInCount++,this.set(),this.$signInCount},e.prototype.getOnLine=function(){return this.$onLine},e.prototype.setOnLine=function(t){this.onLineDayDate()?this.$onLine=t:(this.$onLine=0,this.$onLineNum=0,this.$onLineAdd=1),this.set()},e.prototype.setOnLineAdd=function(){this.$onLineAdd++,this.set()},Object.defineProperty(e.prototype,"onLineAddNum",{get:function(){return this.$onLineAdd},enumerable:!1,configurable:!0}),e.prototype.setOnLineRewardNum=function(){this.$onLineNum++,g.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.timeBox,{msg:p.L(f.JXLocales.tower.onlineRwWard,this.$onLineNum)}),this.set()},e.prototype.getOnLineRewardNum=function(){return this.$onLineNum},e.prototype.onLineDayDate=function(){return!!d.default.isSameDay(this.$onLineDatTime,c.GCtrl.now)},e.prototype.onLineTime=function(){this.$onLineDatTime=c.GCtrl.now,this.set()},e.prototype.signDouble=function(){this.$signDoubleDate=c.GCtrl.now,this.set()},e.prototype.doubleSign=function(){return!!d.default.isSameDay(this.$signDoubleDate,c.GCtrl.now)},e.prototype.setSignCount=function(t){this.$signInCount=t},e.prototype.getSignCount=function(){return this.$signInCount},e.prototype.todayIsSignIn=function(){return!!d.default.isSameDay(this.$signInDate,c.GCtrl.now)},e.prototype.useDayFree=function(){this.$useDayFreeDate=c.GCtrl.now,this.$free++,this.set()},e.prototype.useFreePress=function(){this.$freePressDate=c.GCtrl.now,this.$freePress++,this.set()},e.prototype.todayIsUseFreePressDate=function(){return!!d.default.isSameDay(this.$freePressDate,c.GCtrl.now)},e.prototype.todayIsUseDayFreeDate=function(){return!!d.default.isSameDay(this.$useDayFreeDate,c.GCtrl.now)},e.prototype.todayIsDayReceiveDate=function(t){return!!d.default.isSameDay(this.$dayReceiveDate[t],c.GCtrl.now)},e.prototype.useDayReceiveDate=function(t){this.$dayReceiveDate[t]=c.GCtrl.now,this.set()},e.prototype.getSignTodayIndex=function(){var t=-1;return this.todayIsSignIn()&&(t=this.$signInCount),t},e.prototype.isGuidseExits=function(t){return!g.default.guideChainData.getRaw(t)||this.$guide.indexOf(t)!=m.INVALID_VALUE},e.prototype.setGuides=function(t){this.$guide.indexOf(t)==m.INVALID_VALUE&&(this.$guide.push(t),this.set())},Object.defineProperty(e.prototype,"guide",{get:function(){return this.$guide},enumerable:!1,configurable:!0}),e.prototype.isDoneGuide=function(){return this.$guide.length>=g.default.guideChainData.data.size},e.prototype.checkGuideIsOver=function(){for(var t=g.default.guideChainData.data.values(),e=0;e<t.length;e++){var o=t[e];if(!this.isGuidseExits(o.guideId))return!1}return!0},e.prototype.heroNames=function(t){var e=null;switch(t){case 1001:e="\u67aa\u5175";break;case 1002:e="\u5173\u7fbd";break;case 1003:e="\u8bf8\u845b\u4eae";break;case 1004:e="\u82b1\u6728\u5170";break;case 1005:e="\u5b5f\u83b7";break;case 1006:e="\u9ec4\u5fe0";break;case 1007:e="\u5e03"}return e},e.prototype.heroType=function(t){var e=null;switch(t){case 1:e="\u5175";break;case 2:e="\u8f66";break;case 3:e="\u9a6c";break;case 4:e="\u70ae";break;case 5:e="\u8c61";break;case 6:e="\u58eb"}return e},e.prototype.herotarit=function(t){var e=null;switch(t){case 1:e="\u767d\u8272";break;case 2:e="\u7eff\u8272";break;case 3:e="\u84dd\u8272";break;case 4:e="\u7d2b\u8272";break;case 5:e="\u91d1\u8272";break;case 6:e="\u7ea2\u8272"}return e},e.prototype.heroOfficer=function(t){var e=null;switch(t){case 1:e="\u4e3b\u7c3f";break;case 2:e="\u53bf\u4e1e";break;case 3:e="\u90fd\u4e8b";break;case 4:e="\u77e5\u53bf";break;case 5:e="\u77e5\u5dde";break;case 6:e="\u77e5\u5e9c";break;case 7:e="\u5c1a\u4e66";break;case 8:e="\u5ef6\u5c09";break;case 9:e="\u592a\u5c09";break;case 10:e="\u592a\u53f2";break;case 11:e="\u592a\u5b88"}return e},r([y],e)}(u.GLocal);o.LUserData=v,cc._RF.pop()},{"../../../Core/FrameEx/ES5Ex":"ES5Ex","../../../Core/GCtrl":"GCtrl","../../../Core/GEvent/GParam":"GParam","../../../Core/Manager/DataPool":"DataPool","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/Language":"Language","../../Common/TimeUtils":"TimeUtils","../../Common/Zh":"Zh","../../Logic/GameMgr":"GameMgr","../../Logic/UserMgr":"UserMgr","./../../../Core/CoreDefine":"CoreDefine"}],Language:[function(t,e,o){"use strict";cc._RF.push(e,"b3268KQgv9AyaJKzqkUN4lh","Language");var i=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a},n=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0}),o.LNumberInEn=o.LNumber=o.LCoin=o.LnumToCh=o.LFormatTimeOut=o.LFormatDay=o.LFormatHours=o.LDate=o.LDayTimer=o.LTimer4=o.LTimer3=o.LTimer2=o.LTimer=o.L=void 0;var r=t("./Zh"),a=cc._decorator.ccclass,s=new(function(){function t(){}return t.prototype.getStr=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var i=i18n.t.apply(i18n,n([t],e));return i||(i=t+""),i},t.prototype.formatTime=function(t){var e=Math.floor(t/3600);t%=3600;var o=Math.floor(t/60),i=t%60,n="";return n+=(e>9?e:"0"+e)+":",(n+=(o>9?o:"0"+o)+":")+(i>9?i:"0"+i)},t.prototype.formatTime2=function(t){t%=3600;var e=Math.floor(t/60),o=t%60,i="";return(i+=(e>9?e:"0"+e)+":")+(o>9?o:"0"+o)},t.prototype.formatTime3=function(t,e){void 0===e&&(e=!1);var o=Math.floor(t/86400);t%=86400;var i=Math.floor(t/3600);t%=3600;var n=Math.floor(t/60);t%=60;var r="";return r+=0==o?"":o+"\u65e5",r+=(i>9?i:"0"+i)+":",r+=n>9?n:"0"+n,e&&(r+=":"+(t>9?t:"0"+t)),r},t.prototype.formatTime4=function(t){var e=Math.floor(t/86400);t%=86400;var o=Math.floor(t/3600);t%=3600;var i=Math.floor(t/60),n="";return 60==i&&(o+=1,i=0),n+=e+"\u5929",(n+=(o>9?o:"0"+o)+"\u65f6")+((i>9?i:"0"+i)+"fen")},t.prototype.formatDayTime=function(t,e){void 0===e&&(e=!0);var o=Math.floor(t/3600/24);t%=86400;var i=Math.floor(t/3600);t%=3600;var n=Math.floor(t/60),r=t%60,a="";return o>0&&(a+=o+"\u65e5"),(i>0||o>0)&&(a+=(i>9?i:"0"+i)+":"),a+=n>9?n:"0"+n,e&&(a+=":"+(r>9?r:"0"+r)),a},t.prototype.formatDate=function(t,e){void 0===e&&(e=!0);var o=new Date(1e3*t),i=o.getFullYear(),n=o.getMonth()+1,r=o.getDate(),a=o.getHours(),s=o.getMinutes(),c=o.getSeconds();return e?i+"/"+(n>9?n.toString():"0"+n)+"/"+(r>9?r.toString():"0"+r).toString()+(a>9?a.toString():"0"+a).toString()+":"+(s>9?s.toString():"0"+s).toString()+":"+(c>9?c.toString():"0"+c):i+"/"+(n>9?n.toString():"0"+n)+"/"+(r>9?r.toString():"0"+r)+" "+(a>9?a.toString():"0"+a)+":"+(s>9?s.toString():"0"+s)},t.prototype.formatHours=function(t){var e=new Date(t),o=e.getHours(),i=e.getMinutes(),n=e.getSeconds(),r="";return r+=(o>9?o:"0"+o)+":",(r+=(i>9?i:"0"+i)+":")+(n>9?n:"0"+n)},t.prototype.formatDay=function(t){var e=new Date(t),o=e.getMonth(),i=e.getDay(),n="";return(n+=(o>9?o:"0"+o)+"\u6708")+((i>9?i:"0"+i)+"\u65e5")},t.prototype.formatTimeOut=function(t){return t<60?t+"\u79d2\u524d":t<3600?Math.floor(t/60)+"\u5206\u524d":t<86400?Math.floor(t/3600)+"\u65f6\u524d":Math.floor(t/86400)+"\u5929\u524d"},t.prototype.coinToCN=function(t){return(t=Math.floor(t))<1e4?String(t):t<1e5?Math.floor(t/10)/1e3+this.getStr(r.JXLocales.tth):t<1e6?Math.floor(t/100)/100+this.getStr(r.JXLocales.tth):t<1e7?Math.floor(t/1e3)/10+this.getStr(r.JXLocales.tth):t<1e8?Math.floor(t/1e4)+this.getStr(r.JXLocales.tth):t<1e9?Math.floor(t/1e5)/1e3+this.getStr("\u4ebf"):t<1e10?Math.floor(t/1e6)/100+this.getStr("\u4ebf"):t<1e11?Math.floor(t/1e7)/10+this.getStr("hmi"):t<1e12?Math.floor(t/1e8)+this.getStr("hmi"):"9999"+this.getStr("hmi")+"+"},t.prototype.formatNumber=function(t,e){return void 0===e&&(e=2),t>=1e9?Math.floor(t/1e8)+this.getStr("hmi"):t>=1e4?(t/1e4).toFixed(e)+this.getStr(r.JXLocales.tth):t+""},t.prototype.formatNumberInEn=function(t){return t>=1e8?Math.floor(t/1e6)+"M":t>=1e4?Math.floor(t/1e3)+"K":t+""},t.prototype.toFixed=function(t,e){return(100*t).toFixed(e).replace(/(?:\.0*|(\.\d+?)0+)$/,"$1")},t.prototype.numToCh=function(t){for(var e=["\u96f6","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d"],o=["","\u5341","\u767e","\u5343","\u4e07"],i="",n="",r=0,a=!0;t>0;){var s=t%10;0===s?a||(a=!0,n=e[s]+n):(a=!1,i=e[s],n=(i+=o[r])+n),r++,t=Math.floor(t/10)}return n[0]==this.getStr("number_1")&&n[1]==this.getStr("number_10")&&(n=n.substr(1)),n},i([a],t)}());o.L=s.getStr.bind(s),o.LTimer=s.formatTime.bind(s),o.LTimer2=s.formatTime2.bind(s),o.LTimer3=s.formatTime3.bind(s),o.LTimer4=s.formatTime4.bind(s),o.LDayTimer=s.formatDayTime.bind(s),o.LDate=s.formatDate.bind(s),o.LFormatHours=s.formatHours.bind(s),o.LFormatDay=s.formatDay.bind(s),o.LFormatTimeOut=s.formatTimeOut.bind(s),o.LnumToCh=s.numToCh.bind(s),o.LCoin=s.coinToCN.bind(s),o.LNumber=s.formatNumber.bind(s),o.LNumberInEn=s.formatNumberInEn.bind(s),cc._RF.pop()},{"./Zh":"Zh"}],LevelCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"ad386sIWrVNMLgziGMzslqI","LevelCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/CoreDefine"),s=t("../../../Core/GCtrl"),c=t("../../../Core/GView/GViewBase"),l=t("../../../Core/Math/MathEx"),u=t("../../Logic/GameMgr"),h=t("./../../Common/Define"),p=t("./../../Common/UIResources"),d=t("./LevelItem"),f=cc._decorator,g=f.ccclass,_=f.property,m=(f.executionOrder,f.menu),y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.arrowNode=null,e.lvNode=null,e.lvView=null,e._curSection=0,e}return n(e,t),e.prototype.onGLoad=function(){s.GCtrl.ES.on(h.CMsg.client.fight_ui.onFinishSettle,this,this.onFinishSettle.bind(this),a.PRIORITY_VIEW)},e.prototype.onGStart=function(){var t=this;this.assetImpl.prefab(p.Res.prefab.vw.home.levelItem,function(){t.initLevelLayer(!0)}),s.GCtrl.ES.on(h.CMsg.client.test.export,this,this.exprotInfo.bind(this),a.PRIORITY_VIEW)},e.prototype.exprotInfo=function(){this.lvNode.children.forEach(function(t){var e=t.getComponent(d.default);console.info("\u5173\u5361id:"+e.levelData.id+",\u5173\u5361\u6240\u5728\u4f4d\u7f6e:["+t.position.x+","+t.position.y+"]")})},e.prototype.onFinishSettle=function(t,e){if(e.sceneId==h.PART_BTL_SCENE.GUANQIA){var o=u.default.userMgr.getCurLevelRaw();if(o.section!=this._curSection)this.initLevelLayer(!0);else{var i=o.id,n=i-1;this._changeLevelItemState(n,i)}}},e.prototype._changeLevelItemState=function(t,e){var o=this,i=this.lvNode.getChildComByName("ITEM_"+t,d.default);i&&i.changeItemState();var n=this.lvNode.getChildComByName("ITEM_"+(t+1),d.default);if(n&&(n.changeItemState(),n.playIntoAni(function(){++t<e&&o._changeLevelItemState(t,e)})),i){var r=this.lvView,a=cc.winSize.height/2;i.node.y>a&&r.scrollToOffset(cc.v2(0,-i.node.position.y),1)}},e.prototype.initLevelLayer=function(t){if(this.lvNode){var e=u.default.userMgr.getCurLevelRaw();if(e){this._curSection=e.section;var o=u.default.storyData.getStorysBySection(e.section);if(o){this.arrowNode.destroyAllChildren();for(var i=0,n=0;n<o.length;n++){var r=o[n],a=void 0,s=null;(a=this.lvNode.children[n])?s=a.getComponent(d.default):a=(s=this.addGChild(p.Res.prefab.vw.home.levelItem,this.lvNode)).node,a.position=cc.v2(r.pointXY[0],r.pointXY[1]),i<=a.position.y&&(i=a.position.y),a.opacity=0;var c=[];if(0!=n){var l=this.lvNode.children[n-1].position,h=this.lvNode.children[n].position;c=this._creatorArrow(l,h,e.id>=r.id)}s.init(r,n,c,o.length,this.lvView)}for(this.lvNode.parent.height=i+240,n=this.lvNode.children.length-1;n>=o.length;n--)this.lvNode.children[n].destroy();this._onDisplayShowLevelItems(t)}}}},e.prototype._creatorArrow=function(t,e,o){for(var i=[],n=[],r=l.default.getDistance(t,e)+25,a=Math.floor(r/25),s=1;s<a-1;s++){var c=t.lerp(e,(s+.5)/a);i.push(c)}for(s=0;s<i.length;s++){var u=(new cc.Node).addComponent(cc.Sprite);this.assetImpl.spriteAtlasFrame(u,p.Res.texture.views.homeUI,o?"point_1":"point_2"),u.node.position=i[s],u.node.opacity=0,u.node.parent=this.arrowNode,n.push(u.node)}return n},e.prototype._onDisplayShowLevelItems=function(t,e){var o=this;void 0===e&&(e=0),e<this.lvNode.children.length&&this.lvNode.children[e].getComponent(d.default).startInit(t,function(){return o._onDisplayShowLevelItems(t,e+1)})},r([_(cc.Node)],e.prototype,"arrowNode",void 0),r([_(cc.Node)],e.prototype,"lvNode",void 0),r([_(cc.ScrollView)],e.prototype,"lvView",void 0),r([g,m("View/Home/LevelCtrl")],e)}(c.default);o.default=y,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/GCtrl":"GCtrl","../../../Core/GView/GViewBase":"GViewBase","../../../Core/Math/MathEx":"MathEx","../../Logic/GameMgr":"GameMgr","./../../Common/Define":"Define","./../../Common/UIResources":"UIResources","./LevelItem":"LevelItem"}],LevelDataNode:[function(t,e,o){"use strict";cc._RF.push(e,"da5d3VyEC1DtI5BNkKAOObF","LevelDataNode");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GCtrl"),s=t("../../Logic/GameMgr"),c=t("./../../Common/Define"),l=cc._decorator,u=l.ccclass,h=(l.property,l.executionOrder,l.menu),p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.onLoad=function(){a.GCtrl.ES.on(c.CMsg.client.home.onChangeLevel,this,this.initLvData.bind(this))},e.prototype.start=function(){this.initLvData()},e.prototype.initLvData=function(){var t=cc.sys.localStorage.getItem("leveldata"+(s.default.lUserData.level+1)),e=this.node.getChildByName("Layout"),o=this.node.getChildByName("lvge1"),i=this.node.getChildByName("lvge2");if(e.removeAllChildren(),t){var n=0,r=JSON.parse(t);r.forEach(function(t){t.maxHp<=0&&n++}),this.node.getChildByName("lvbar").getComponent(cc.ProgressBar).progress=n/r.length;for(var a=0;a<n;a++)(l=cc.instantiate(i)).active=!0,e.addChild(l);for(a=0;a<r.length-n;a++)(l=cc.instantiate(o)).active=!0,e.addChild(l)}else{this.node.getChildByName("lvbar").getComponent(cc.ProgressBar).progress=0;var c=s.default.userMgr.getLevelRaw(s.default.lUserData.level+1);for(a=0;a<c.monsterList.length;a++){var l;(l=cc.instantiate(o)).active=!0,e.addChild(l)}}return this.node.getChildByName("lvbg2").getChildByName("Label").getComponent(cc.Label).string=s.default.lUserData.level+1+"",this.node.getChildByName("lvbg1").getChildByName("Label").getComponent(cc.Label).string=s.default.lUserData.level+2+"",null},r([u,h("View/Home/LevelDataNode")],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../Logic/GameMgr":"GameMgr","./../../Common/Define":"Define"}],LevelItem:[function(t,e,o){"use strict";cc._RF.push(e,"d5385QuVgJL/7fqmBxKA/ME","LevelItem");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GView/GChild"),s=t("../../../Core/Math/MathEx"),c=t("../../../Shaders/Manager/ShaderUtil"),l=t("../../Common/JXColor"),u=t("../../Common/UI"),h=t("../../Logic/GameMgr"),p=t("./../../Common/Define"),d=t("./../../Common/UIResources"),f=t("./../../Common/Zh"),g=cc._decorator,_=g.ccclass,m=g.property,y=(g.executionOrder,g.menu),v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.stars=null,e.img=null,e.lv=null,e.skill=null,e._curStar=0,e._levelData=null,e._arrowNodes=[],e._isTouchStart=!1,e._isTouchMoved=!1,e._state=p.LinearState.Pass,e._listView=null,e._isLast=!1,e}var o;return n(e,t),o=e,Object.defineProperty(e.prototype,"levelData",{get:function(){return this._levelData},enumerable:!1,configurable:!0}),e.prototype.onGLoad=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.touchBegin,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.touchEnd,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.touchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.touchEnd,this)},e.prototype.touchBegin=function(){this._isTouchStart=!0,this._listView.enabled=!1},e.prototype.touchMove=function(t){this._isTouchStart&&(s.default.getDistance(t.getStartLocation(),t.getLocation())<3||(this._isTouchMoved=!0))},e.prototype.touchEnd=function(){this._isTouchMoved&&this._isTouchStart||this.onItemClick(),this._isTouchStart=!1,this._isTouchMoved=!1,this._listView.enabled=!0},e.prototype.init=function(t,e,o,i,n){this._listView=n,this._levelData=t,this.node.name="ITEM_"+t.id,this.lv.string="\u7b2c"+t.id.toString()+"\u5173",this._arrowNodes=o,this._isLast=i===e+1,this.changeItemState()},e.prototype._DEBUG_checkArrows=function(){var t=this.node.parent.children,e=t.indexOf(this.node);if(0!=e&&this._arrowNodes.length>0){var i=t[e-1].position,n=this.node.position;this._DEBUG_reSetArrows(i,n)}if(e!=t.length-1){var r=t[e+1].getComponent(o);r._arrowNodes.length>0&&(i=this.node.position,n=r.node.position,r._DEBUG_reSetArrows(i,n))}},e.prototype._DEBUG_reSetArrows=function(t,e){for(var o=[],i=s.default.getDistance(t,e)+25,n=Math.floor(i/25),r=1;r<n-1;r++){var a=t.lerp(e,(r+.5)/n);o.push(a)}for(r=0;r<o.length;r++){var c=this._arrowNodes[r];c||((c=cc.instantiate(this._arrowNodes[0])).parent=this._arrowNodes[0].parent,this._arrowNodes.push(c)),c.position=o[r]}for(r=o.length;r<this._arrowNodes.length;r++)this._arrowNodes[r].destroy();this._arrowNodes.length=o.length},e.prototype.startInit=function(t,e){var o=this,i=function(){var t=o.node.parent.parent.parent.parent.getComponent(cc.ScrollView);o._state==p.LinearState.Pass?o.changeItemState():o._state==p.LinearState.Now&&o.changeItemState();var e=cc.winSize.height/2;o.node.y>e&&(o._state==p.LinearState.Pass||o._state==p.LinearState.Now)&&t.scrollToOffset(cc.v2(0,e-o.node.position.y),1),o._isLast};t?this.node.runAction(cc.sequence(cc.callFunc(function(){if(o._arrowNodes.length)for(var t=0;t<o._arrowNodes.length;t++)o._arrowNodes[t].runAction(cc.fadeIn(.015*(t+1)))}),cc.delayTime(.005*this._arrowNodes.length),cc.callFunc(i),cc.fadeIn(.01),cc.callFunc(function(){return e&&e()}))):(i(),e())},e.prototype.changeItemState=function(){var t=this;this._curStar=h.default.lUserData.getStarByLevel(this.levelData.id),this.stars.children.forEach(function(e,o){t._curStar<o+1?c.default.gray(e):c.default.normal(e)});var e=h.default.lUserData.level+1;this._levelData.id<e?this._state=p.LinearState.Pass:this._levelData.id==e?this._state=p.LinearState.Now:this._state=p.LinearState.Future,this._state==p.LinearState.Now?(this.img.node.active=!1,this.skill.active=!0):(this.img.node.active=!0,this.assetImpl.spriteAtlasFrame(this.img,d.Res.texture.views.homeUI,"ll_un_pass"),this.lv.node.color=l.JXColor.Cffffff)},e.prototype.playIntoAni=function(t){for(var e=this,o=this._arrowNodes,i=cc.tween(this.node).delay(.2),n=function(t){i=i.to(.15,{position:o[t]}).call(function(){e._arrowNodes[t]&&e.assetImpl.spriteAtlasFrame(e._arrowNodes[t].getComponent(cc.Sprite),d.Res.texture.views.homeUI,"point_1")})},r=0;r<o.length;r++)n(r);i.call(function(){t()}).start()},e.prototype.onItemClick=function(){if(this._state==p.LinearState.Now||this._state==p.LinearState.Pass)if(h.default.rHeroData.checkInNoHero())h.default.uiMgr.showToast(f.JXLocales.fight.teamEmpty);else{var t={sceneId:p.PART_BTL_SCENE.GUANQIA,args:{level:this.levelData.id,isFullPower:!1}};h.default.jumpToMgr.jumpGoTo(u.VIEW_ID.fightLayerPut,t)}},r([m(cc.Node)],e.prototype,"stars",void 0),r([m(cc.Sprite)],e.prototype,"img",void 0),r([m(cc.Label)],e.prototype,"lv",void 0),r([m({type:cc.Node,tooltip:"\u5200\u5b50"})],e.prototype,"skill",void 0),o=r([_,y("View/main/LevelItem")],e)}(a.default);o.default=v,cc._RF.pop()},{"../../../Core/GView/GChild":"GChild","../../../Core/Math/MathEx":"MathEx","../../../Shaders/Manager/ShaderUtil":"ShaderUtil","../../Common/JXColor":"JXColor","../../Common/UI":"UI","../../Logic/GameMgr":"GameMgr","./../../Common/Define":"Define","./../../Common/UIResources":"UIResources","./../../Common/Zh":"Zh"}],LoadCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"83336JK35FJTpOs4rejlkaT","LoadCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a},a=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0});var s=t("../../../Core/GView/GViewBase"),c=t("../../../tyqSDK/H5AdSdk4399"),l=t("../../../tyqSDK/tyqSDK"),u=t("../../Common/Language"),h=t("../../Common/UI"),p=t("../../Logic/GameMgr"),d=t("./../../../conventions/JXCommon"),f=t("./../../../Core/CoreDefine"),g=t("./../../../Core/GCtrl"),_=t("./../../../Core/Manager/UIMgr"),m=t("./../../Common/UIResources"),y=t("./../../Common/Zh"),v=cc._decorator,C=v.ccclass,I=v.property,E={start:.5,loginRaw:.25,loginStatic:.15},S={gameRaw:.3,gameStatic:.4,userData:.3},R=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.progressLabel=null,e.progressBar=null,e.lightNode=null,e.loadNode=null,e.useProgress=0,e.curProgress=0,e._curLoadConfig=null,e.loadNum=0,e}return n(e,t),e.prototype.onGLoad=function(){console.log("load onGLoad"),this.progressBar&&(this.progressBar.progress=0),this.progressLabel&&(this.progressLabel.string=""),cc.tween(this.progressBar).to(.5,{progress:.1}),this.startLoad();var t,e=cc.view.getFrameSize(),o=cc.view.getDesignResolutionSize();t=e.width/e.height<=.5625?e.width/o.width:e.height/o.height,this.node.y=0-e.height/t/2+100,l.tyqSDK.eventSendCustomEvent("\u8fdb\u5165\u52a0\u8f7d\u9875","\u73a9\u5bb6\u4eba\u6570"),c.H5AdSdk4399.instance.checkDownUrl()},e.prototype.VerifyRealName=function(){this.isVerifyRealName||this.startLoad()},e.prototype.Privacypolicy=function(){this.isPrivacy||this.VerifyRealName()},e.prototype.startLoad=function(){console.log("load startLoad"),this._curLoadConfig=E,this.useProgress=this._curLoadConfig.start,this.curProgress=this._curLoadConfig.loginRaw,this.loadPackage()},e.prototype.preLoadGameStart=function(){var t=this;this.setLoadText(u.L(y.JXLocales.load.assetLoad)),g.GCtrl.preLoadRawAssets.apply(g.GCtrl,a([function(e,o){t.setLoadText(u.L(y.JXLocales.load.process,e,o)),t.setLoadProgress(t.useProgress+e/o*t.curProgress)},function(){t.loadloginStatic()}],Object.keys(m.Res.material).map(function(t){return{type:cc.Material,path:m.Res.material[t]}}),[{type:cc.Prefab,path:m.Res.prefab.item.topUiItem},{type:cc.Prefab,path:m.Res.prefab.vw.tip.toast}]))},e.prototype.preLoadGameScene=function(){var t=this;this.setLoadText(u.L(y.JXLocales.load.assetLoad)),this.useProgress+=this.curProgress,this.curProgress=this._curLoadConfig.gameRaw,cc.tween(this.progressBar).to(.3,{progress:1}),g.GCtrl.preLoadRawAssets(function(e,o){t.setLoadText(u.L(y.JXLocales.load.process,e,o)),t.setLoadProgress(t.useProgress+e/o*t.curProgress)},function(){t.loadGameStatic()},{type:cc.SpriteFrame,path:m.Res.texture.single},{type:cc.AudioClip,path:m.Res.audio.main},{type:cc.AudioClip,path:m.Res.audio.btnClick},{type:cc.AudioClip,path:m.Res.audio.battle+"battle_1"},{type:cc.AudioClip,path:m.Res.audio.battle+"battle_2"},{type:cc.AudioClip,path:m.Res.audio.battle+"battle_3"},{type:cc.AudioClip,path:m.Res.audio.battle+"battle_4"},{type:cc.AudioClip,path:m.Res.audio.battle+"battle_5"})},e.prototype.loadloginStatic=function(){var t=this;this.useProgress+=this.curProgress,this.curProgress=this._curLoadConfig.loginStatic,p.default.initLoginStatic(function(e,o){t.setLoadText(u.L(y.JXLocales.load.static,e,o)),t.setLoadProgress(t.useProgress+t.curProgress*e/o)},function(){p.default.initSimulator(),p.default.initLogicManager(),p.default.sdkMgr.umaSetPoint(d.JXDef.umaPoint.loadScene,{msg:""}),t._curLoadConfig=S,t.preLoadGameScene()})},e.prototype.loadGameStatic=function(){var t=this;this.useProgress+=this.curProgress,this.curProgress=this._curLoadConfig.gameStatic,p.default.initFristGameStatics(function(e,o){t.setLoadText(u.L(y.JXLocales.load.static,e,o)),t.setLoadProgress(t.useProgress+e/o*t.curProgress)},function(){t.onInitUserData()})},e.prototype.onInitUserData=function(){this.setLoadText(u.L(y.JXLocales.load.initUserData)),this.useProgress+=this.curProgress,this.curProgress=this._curLoadConfig.userData,this.loadHomeCtrl()},e.prototype.loadHomeCtrl=function(){var t=this;this.setLoadText(u.L(y.JXLocales.load.enter_game)),p.default.ins().initGame(),g.GCtrl.preLoadRawAssets(null,function(){t.endLoadHomeCtrl()},{type:cc.Prefab,path:m.Res.prefab.vw.home.homeCtrl},{type:cc.Prefab,path:m.Res.prefab.vw.home.mainCtrl},{type:cc.Prefab,path:m.Res.prefab.vw.home.chapterPage},{type:cc.Prefab,path:m.Res.prefab.vw.store.storeCtrl},{type:cc.Prefab,path:m.Res.prefab.vw.hero.heroCtrl},{type:cc.Prefab,path:m.Res.prefab.vw.hero.squadCtrl},{type:cc.Prefab,path:m.Res.prefab.vw.home.recruitCtrl},{type:cc.Prefab,path:m.Res.prefab.item.jxItem},{type:cc.Prefab,path:m.Res.prefab.item.heroCardItem},{type:cc.Prefab,path:m.Res.prefab.item.guide_item})},e.prototype.endLoadHomeCtrl=function(){_.UIMgr.showWin(h.VIEW_ID.home,f.WinPage.Page2),g.GCtrl.ES.emit(g.GCtrl.GClientWinOpenEventMsg),p.default.sdkMgr.umaSetPoint(d.JXDef.umaPoint.inGameScene,{msg:""})},e.prototype.setLoadText=function(t){this.progressLabel&&(this.progressLabel.string=t)},e.prototype.setLoadProgress=function(t){this.progressBar&&(cc.Tween.stopAllByTarget(this.progressBar),this.progressBar.progress=Math.min(t,1),this.lightNode&&(this.lightNode.x=this.progressBar.totalLength*this.progressBar.progress))},e.prototype.loadPackage=function(){var t=this;this.setLoadText(u.L(y.JXLocales.load.loadPackage));var e=Object.keys(d.JXDef.bundle),o=d.JXDef.bundle[e[this.loadNum]];console.log("\u52a0\u8f7d\u5206\u5305: ",o),cc.Tween.stopAllByTarget(this.progressBar),cc.tween(this.progressBar).to(.2,{progress:this.loadNum/(e.length+1)}),cc.assetManager.loadBundle(o,function(i){i&&console.log(o+"\u5206\u5305\u52a0\u8f7d\u5931\u8d25"),t.loadNum++,t.setLoadProgress(t.loadNum/(e.length+1)),t.loadNum<e.length?t.loadPackage():t.preLoadGameStart()})},r([I(cc.Label)],e.prototype,"progressLabel",void 0),r([I(cc.ProgressBar)],e.prototype,"progressBar",void 0),r([I(cc.Node)],e.prototype,"lightNode",void 0),r([I(cc.Node)],e.prototype,"loadNode",void 0),r([C],e)}(s.default);o.default=R,cc._RF.pop()},{"../../../Core/GView/GViewBase":"GViewBase","../../../tyqSDK/H5AdSdk4399":"H5AdSdk4399","../../../tyqSDK/tyqSDK":"tyqSDK","../../Common/Language":"Language","../../Common/UI":"UI","../../Logic/GameMgr":"GameMgr","./../../../Core/CoreDefine":"CoreDefine","./../../../Core/GCtrl":"GCtrl","./../../../Core/Manager/UIMgr":"UIMgr","./../../../conventions/JXCommon":"JXCommon","./../../Common/UIResources":"UIResources","./../../Common/Zh":"Zh"}],MainCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"1c649SRd8xJ0JVc21KKvscx","MainCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/GCtrl"),c=t("../../../Core/GEvent/GParam"),l=t("../../../Core/GView/GPage"),u=t("../../../Core/Manager/AudioMgr"),h=t("../../../Core/Math/MathEx"),p=t("../../../tyqSDK/tyqAdManager"),d=t("../../../tyqSDK/tyqSDK"),f=t("../../Common/BtnCDTime"),g=t("../../Common/Define"),_=t("../../Common/TimeUtils"),m=t("../../Common/UI"),y=(t("../../Common/UICreate"),t("../../Common/UIResources")),v=t("../../Data/RunTime/RunRaw/RJXItem"),C=t("../../Entity/ArmRoleScript"),I=t("../../Guide/GuideLogic"),E=t("../../Logic/GameMgr"),S=t("../../Logic/UserMgr"),R=t("../../Manager/RoleManager"),D=t("../Common/HangPage"),b=cc._decorator,w=b.ccclass,A=b.property,T=b.menu,M=(b.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._index=0,e._maxIndex=0,e.titleIcon=null,e.bg=null,e.box=null,e.lineLab=null,e.recive=null,e.lineBox=null,e.powerLab=null,e.levelNode=null,e.armNode=null,e.sk_dao=null,e.node_zq=null,e.node_zm=null,e.node_ck=null,e.node_gift=null,e.btnSign=null,e.btnRank=null,e.btnDiaocan=null,e.videoPlayerView=null,e.isTouch=!0,e.snow=[],e.onLineReward=[],e.onLine=0,e.addarmDelay=100,e}return n(e,t),e.prototype.showVideoPlayer=function(){},e.prototype.chooseVideo=function(){},e.prototype.onVipBtnClick=function(){E.default.jumpToMgr.jumpGoTo(m.VIEW_ID.vip),s.GCtrl.ES.emit(g.CMsg.client.home.onVipLvUp,new c.default(E.default.lUserData.vipLv))},e.prototype.onTimeLimitGiftBtnClick=function(){if(!I.GuideLogic.ins().isGuidding()){for(var t=parseInt(E.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.guideHero)),e=E.default.heroData.getRaw(t),o=E.default.RBagData.getHeroEquip(t).equip,i=0,n=E.default.equipData.getJackpotJob(e.type,e.id,0,1,4,1),r=0;r<n.length;r++)for(var s=n[r],c=0;c<o.length;c++)E.default.RBagData.getEquipDataById(o[c]).itemData.id==s&&i++;i<3&&E.default.jumpToMgr.jumpGoTo(m.VIEW_ID.TimeLimitGift)}},e.prototype.onRankBtnClick=function(){E.default.jumpToMgr.jumpGoTo(m.VIEW_ID.RankView)},e.prototype.onDiaocanBtnClick=function(){E.default.jumpToMgr.jumpGoTo(m.VIEW_ID.DaioCanView)},e.prototype.onSignInBtnClick=function(){E.default.jumpToMgr.jumpGoTo(m.VIEW_ID.sginIn)},e.prototype.onOfficerBtnClick=function(){E.default.jumpToMgr.jumpGoTo(m.VIEW_ID.officer)},e.prototype.onGuessBtnClick=function(){E.default.jumpToMgr.jumpGoTo(m.VIEW_ID.guessLayer)},e.prototype.onCeremonialBtnClick=function(){E.default.jumpToMgr.jumpGoTo(m.VIEW_ID.ceremonialGiftView)},e.prototype.onDailyBtnClick=function(){E.default.jumpToMgr.jumpGoTo(m.VIEW_ID.dailyView)},e.prototype.onZhengbingClick=function(){E.default.sdkMgr.watchAd(function(){for(var t=E.default.userMgr.getCurLevelRaw(),e=t.monsterList,o=0,i=0;i<e.length;i++){var n=e[i];o+=R.default.getInstance().getEnemyPowerProp(n,t.monsterLevel[i],t.powerPro[i])[2]}var r=[];r.push([103,3,o]),E.default.jumpToMgr.jumpGoTo(m.VIEW_ID.rewardCtrl,r)},function(){},"\u5f81\u5175\u6309\u94ae")},e.prototype.onSportsCtrlBtnClick=function(){if(E.default.lUserData.level<5)return E.default.uiMgr.showToast("\u7ade\u6280\u573a\u5728\u901a\u51735\u5173\u540e\u5f00\u542f")},e.prototype.onGLoad=function(){d.tyqSDK.eventSendCustomEvent("\u8fdb\u5165\u6e38\u620f","\u73a9\u5bb6\u4eba\u6570"),E.default.redMgr.on(this.node,[{mask:[g.RPointMask.RPM_Vip_Daily,g.RPointMask.RPM_Vip_Frist],subPath:"bg/vipBtn",effectType:g.RedpointEffect.REDPOINT},{mask:[g.RPointMask.RPM_Office],subPath:"bg/BaronBtn",effectType:g.RedpointEffect.REDPOINT},{mask:[g.RPointMask.RPM_Sign],subPath:"bg/SignInBtn",effectType:g.RedpointEffect.REDPOINT},{mask:[g.RPointMask.RPM_Tower],subPath:"bg/sports",effectType:g.RedpointEffect.REDPOINT},{mask:[g.RPointMask.RPM_Task_Receive],subPath:"bg/rightLayout/btntask",effectType:g.RedpointEffect.REDPOINT}]),E.default.redMgr.setRPointView(this.node_gift,null,!0,g.RedpointEffect.REDPOINT,g.RedpointPos.right),E.default.redMgr.setRPointView(this.node_ck,this.node_ck,!0,g.RedpointEffect.REDPOINT,g.RedpointPos.right),E.default.redMgr.setRPointView(this.node_zm,this.node_zm,!0,g.RedpointEffect.REDPOINT,g.RedpointPos.right),E.default.redMgr.setRPointView(this.node_zq,this.node_zq,!0,g.RedpointEffect.REDPOINT,g.RedpointPos.right),setTimeout(function(){E.default.redMgr.sendValueSettingMsg(g.RPointMask.RPM_Vip_Daily,!0),E.default.redMgr.sendValueSettingMsg(g.RPointMask.RPM_Vip_Frist,!0),E.default.redMgr.sendValueSettingMsg(g.RPointMask.RPM_Task_Receive,!0)},10),this.node.setContentSize(cc.winSize),this.initChapterView(),this.addHang(),this.onLine=E.default.lUserData.getOnLine(),E.default.lUserData.setOnLine(this.onLine),E.default.lUserData.onLineDayDate()||(this.onLine=0),E.default.lUserData.onLineTime(),this.initLeftTime(),s.GCtrl.ES.on(s.GCtrl.GTimerSecondEventMsg,this,this.initLeftTime.bind(this));var t=E.default.userMgr.getCurLevelRaw();this.powerLab.string=t.power+"",this.armNode.stopAllActions(),this.btnSign.active=p.tyqAdManager.getChannel()==p.Channel.ANDROID_233,this.btnRank.active=p.tyqAdManager.getChannel()==p.Channel.WECHAT,this.btnRank.active=!1,cc.tween(this.btnDiaocan).to(3,{x:180,y:220}).to(3,{x:-180,y:120}).to(3,{x:180,y:20}).to(3,{x:-180,y:-90}).to(3,{x:180,y:-80}).to(3,{x:-180,y:-80}).to(3,{x:180,y:20}).to(3,{x:-180,y:120}).to(3,{x:180,y:220}).to(3,{x:-180,y:350}).union().repeatForever().start(),this.initGameType()},e.prototype.initLeftTime=function(){if(E.default.lUserData.onLineDayDate()||(E.default.lUserData.onLineTime(),this.onLine=0),this.onLine+=1,E.default.onLineAwardData.isReceiveReward(this.onLine).bool?(this.box.getComponent(cc.Animation).play("boxShake"),this.box.children[0].active=!0,this.lineLab.node.active=!1,this.recive.active=!0):(this.recive.active=!1,this.box.children[0].active=!1,this.lineLab.node.active=!0,this.box.getComponent(cc.Animation).stop(),this.box.children[0].active=!1),E.default.lUserData.onLineAddNum>E.default.onLineAwardData.maxTimeId){this.lineLab.string="";var t=E.default.lUserData.getOnLineRewardNum();E.default.onLineAwardData.isAllReward(t)&&(this.lineBox.active=!1)}else{var e=E.default.lUserData.onLineAddNum;E.default.lUserData.setOnLine(this.onLine),E.default.onLineAwardData.getRaw(e).time-this.onLine<0?E.default.lUserData.setOnLineAdd():this.lineLab.string=_.default.formatClock(E.default.onLineAwardData.getRaw(e).time-this.onLine,"hh:mm:ss")}},e.prototype.onLineBox=function(){var t=E.default.onLineAwardData.isReceiveReward(this.onLine);if(t.bool)E.default.lUserData.setOnLineRewardNum(),E.default.jumpToMgr.jumpGoTo(m.VIEW_ID.rewardCtrl,t.reward);else{var e=_.default.formatClock(E.default.onLineAwardData.getRaw(t.index).time-this.onLine,"hh:mm:ss");E.default.uiMgr.showToast("\u65f6\u95f4\u672a\u5230\uff0c"+e+"\u540e\u53ef\u4ee5\u9886\u53d6")}},e.prototype.onPageIn=function(){},e.prototype.start=function(){console.log("main start")},e.prototype.changeLevel=function(t,e){1==this.snow[e]&&this.sk_dao.setAnimation(0,"1",!0),2==this.snow[e]&&this.sk_dao.setAnimation(0,"2",!0)},e.prototype.addHang=function(){this.addGChild(y.Res.prefab.item.topUiItem,function(t){t.node.parent=E.default.uiMgr.uiRoot;var e=cc.winSize;t.node.setPosition(cc.v2(0,e.height/2-39)),t.addComponent(D.default).addListenPage([m.VIEW_ID.home,m.VIEW_ID.storePage,m.VIEW_ID.heroPage,m.VIEW_ID.squadPage,m.VIEW_ID.recruitPage],[m.VIEW_ID.officer,m.VIEW_ID.levelCtrl,m.VIEW_ID.blessCtrl,m.VIEW_ID.fightLayer,m.VIEW_ID.detailsCtrl])})},e.prototype.initChapterView=function(){var t=this;this.changeLevel(null,E.default.lUserData.level%2+1),this.levelNode.removeAllChildren(),this.assetImpl.prefab(y.Res.prefab.vw.home.chapterPage,function(e){var o=t.assetImpl.addGChild(e);t.levelNode.addChild(o.node),o.initData(null,null),s.GCtrl.ES.emit(g.CMsg.client.home.onaddLevel)})},e.prototype.initGameType=function(){2!=d.tyqSDK.getSwitchValue("tyq_gameType")&&this.bg.children.forEach(function(t){t.active="startGame"==t.name||"xiaodao"==t.name})},e.prototype.onStartFight=function(){2==d.tyqSDK.getSwitchValue("tyq_gameType")?R.default.getInstance().onStartFight():E.default.jumpToMgr.jumpGoTo(m.VIEW_ID.guessLayer)},e.prototype.addArmToShow=function(){var t=this;this.assetImpl.prefab(y.Res.prefab.fight.ArmRole,function(e){var o=cc.instantiate(e),i=1008+Math.floor(18*Math.random());o.getComponent(C.default).setRoleData(i),o.parent=t.armNode,o.x=150*Math.random()-75,o.y=80*Math.random()-40})},e.prototype.zhengbing=function(t){u.AudioMgr.Ins().playEffect(y.Res.audio.btnClick);var e=t.target;if((!e.getChildByName("ui_cd")||e.getChildByName("ui_cd").getComponent(f.default).isCDEnd())&&(e.getChildByName("ui_cd")&&e.getChildByName("ui_cd").getComponent(f.default).ontouch(),this.armNode.childrenCount>0))for(var o=0;o<this.armNode.childrenCount;o++){var i=this.armNode.children[o];if(i&&i.getComponent(C.default)&&i.getComponent(C.default).isLife())return i.getComponent(C.default).getNow(),void S.default.ins().addDailyTaskState(3,1)}},e.prototype.zhuangbei=function(){s.GCtrl.ES.emit("gotozhuangbei")},e.prototype.onceRecruit=function(t){var e=t.target;if(e.getChildByName("ui_cd").getComponent(f.default).isCDEnd()){e.getChildByName("ui_cd").getComponent(f.default).ontouch();var o=E.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.onceCard),i=new v.default([g.CURRENCY.GOLD,g.ITEM_TYPE.CURRENCY,o]),n=E.default.itemMgr.testCost(i,1,!0);n.enough?(s.GCtrl.ES.emit(g.CMsg.client.bag.onBagItemChange,[[g.CURRENCY.GOLD,g.ITEM_TYPE.CURRENCY,-o]]),this.luckDraw(1),E.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.recruit,{msg:g.PointInfo.recruit_click})):E.default.uiMgr.showToast(n.tip)}},e.prototype.tenRecruit=function(){var t=this;E.default.sdkMgr.watchAd(function(){E.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.recruit,{msg:g.PointInfo.recruit_ad}),t.luckDraw(10)},function(){},"\u4e3b\u9875\u5341\u8fde\u62bd")},e.prototype.luckDraw=function(t){void 0===t&&(t=1),S.default.ins().addDailyTaskState(5,t),E.default.lUserData.recruitCtrl=t;var e=null;e=E.default.callData.data.values();var o=[],i=[];e.forEach(function(t){var e={id:t.id,weight:t.weight,award:t.award};o.push(e)});for(var n=0;n<o.length;n++)for(var r=o[n].weight,a=0;a<r;a++)i.push(n);if(i=h.default.fisherYatesShuffle(i),1==t){var s=Math.floor(Math.random()*i.length),c=[];c.push(o[i[s]].award);var l={recruitNum:t,award:c,cb:function(){E.default.jumpToMgr.jumpGoTo(m.VIEW_ID.rewardCtrl,c)}};E.default.jumpToMgr.jumpGoTo(m.VIEW_ID.recuitCardCtrl,l),o=[]}else if(10==t){var u=[],p=!1,d=E.default.rHeroData.getHaveHeros(g.SQUAD_BUTTON.ALL),f=d.have.length+d.notHave.length;for(n=0;n<t;n++)s=Math.floor(Math.random()*i.length),0==o[i[s]].award[1]&&(p=!0),u.push(o[i[s]].award);if(!p){u.splice(Math.floor(Math.random()*u.length),1);var _=[1001+Math.floor(Math.random()*f),0,1];u.push(_),console.log("\u5341\u8fde\u62bd\u6ca1\u5f97\u5230\u82f1\u96c4\u8865\u8fdb",_)}l={recruitNum:t,award:u,cb:function(){E.default.jumpToMgr.jumpGoTo(m.VIEW_ID.rewardCtrl,u,g.REWARD.HERO),u=[]}},E.default.jumpToMgr.jumpGoTo(m.VIEW_ID.recuitCardCtrl,l),o=[]}},e.prototype.update=function(){this.addarmDelay--,this.addarmDelay<0?2==d.tyqSDK.getSwitchValue("tyq_gameType")&&(this.addArmToShow(),this.updateDelayTime()):this.addarmDelay>60&&this.armNode.childrenCount<=1&&(this.addarmDelay=60)},e.prototype.updateDelayTime=function(){this.armNode.childrenCount>2?this.addarmDelay=250:this.armNode.childrenCount<=1?this.addarmDelay=60:this.addarmDelay=120},r([A({type:cc.Sprite,tooltip:"\u7ae0\u8282\u6807\u9898"})],e.prototype,"titleIcon",void 0),r([A({type:cc.Node,tooltip:"\u80cc\u666f"})],e.prototype,"bg",void 0),r([A({type:cc.Node,tooltip:"\u5b9d\u7bb1"})],e.prototype,"box",void 0),r([A({type:cc.Label,tooltip:"\u5728\u7ebf\u65f6\u957f"})],e.prototype,"lineLab",void 0),r([A({type:cc.Node,tooltip:"\u5b9d\u7bb1\u9886\u53d6"})],e.prototype,"recive",void 0),r([A({type:cc.Node,tooltip:"\u5728\u7ebf\u5b9d\u7bb1"})],e.prototype,"lineBox",void 0),r([A({type:cc.Label,tooltip:"\u63a8\u8350\u6218\u529b"})],e.prototype,"powerLab",void 0),r([A({type:cc.Node,tooltip:"\u5173"})],e.prototype,"levelNode",void 0),r([A({type:cc.Node,tooltip:"\u64cd\u7ec3\u5175\u8282\u70b9"})],e.prototype,"armNode",void 0),r([A({type:sp.Skeleton,tooltip:"\u6f02\u6d6e\u5c0f\u5c9b"})],e.prototype,"sk_dao",void 0),r([A({type:cc.Node,tooltip:"\u8d5a\u94b1"})],e.prototype,"node_zq",void 0),r([A({type:cc.Node,tooltip:"\u62db\u52df"})],e.prototype,"node_zm",void 0),r([A({type:cc.Node,tooltip:"\u62bd\u5361"})],e.prototype,"node_ck",void 0),r([A({type:cc.Node,tooltip:"\u793c\u5305\u8282\u70b9"})],e.prototype,"node_gift",void 0),r([A({type:cc.Node})],e.prototype,"btnSign",void 0),r([A({type:cc.Node})],e.prototype,"btnRank",void 0),r([A({type:cc.Node})],e.prototype,"btnDiaocan",void 0),r([A({type:cc.Node})],e.prototype,"videoPlayerView",void 0),r([w,T("View/Home/MainCtrl")],e)}(l.default));o.default=M,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../../Core/GEvent/GParam":"GParam","../../../Core/GView/GPage":"GPage","../../../Core/Manager/AudioMgr":"AudioMgr","../../../Core/Math/MathEx":"MathEx","../../../conventions/JXCommon":"JXCommon","../../../tyqSDK/tyqAdManager":"tyqAdManager","../../../tyqSDK/tyqSDK":"tyqSDK","../../Common/BtnCDTime":"BtnCDTime","../../Common/Define":"Define","../../Common/TimeUtils":"TimeUtils","../../Common/UI":"UI","../../Common/UICreate":"UICreate","../../Common/UIResources":"UIResources","../../Data/RunTime/RunRaw/RJXItem":"RJXItem","../../Entity/ArmRoleScript":"ArmRoleScript","../../Guide/GuideLogic":"GuideLogic","../../Logic/GameMgr":"GameMgr","../../Logic/UserMgr":"UserMgr","../../Manager/RoleManager":"RoleManager","../Common/HangPage":"HangPage"}],MapMgr:[function(t,e,o){"use strict";cc._RF.push(e,"8971c39pQ5Ij5KSS09k6cE8","MapMgr");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var r,a=t("./../../Core/CoreDefine"),s=t("./../../Core/FrameEx/ES5Ex"),c=t("./../Views/JXBattle/JXBattleDefine"),l=t("./GameMgr");(function(t){t[t.Add=0]="Add",t[t.Del=1]="Del",t[t.Noc=2]="Noc"})(r||(r={}));var u={top:[2,3,4],bottom:[8,7,6],left:[2,1,8],right:[4,5,6]},h=function(t){function e(){var e=t.call(this)||this;return e._fsMapPatser=null,e._mapId=a.INVALID_VALUE,e}return n(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mapId",{get:function(){return this._mapId},set:function(t){this._mapId=t},enumerable:!1,configurable:!0}),e.prototype.getAdjacent=function(t,e){var o=this,i=l.default.scopeData.getRaw(t),n=[];switch(i.type){case c.JXBtlMap_Spoce.TRACK:var s=i.scope[0],h=i.scope[1];s.forEach(function(t,i){var s=t,c=r.Noc,l=r.Noc;u.top.indexOf(s)!=a.INVALID_VALUE&&(l=r.Add),u.bottom.indexOf(s)!=a.INVALID_VALUE&&(l=r.Del),u.left.indexOf(s)!=a.INVALID_VALUE&&(c=r.Del),u.right.indexOf(s)!=a.INVALID_VALUE&&(c=r.Add),n.push.apply(n,o.getGridByDir(e,h[i],c,l))});break;case c.JXBtlMap_Spoce.AROUND:for(var p=e.x-i.scope;p<=e.x+i.scope;p++)for(var d=e.y-i.scope;d<=e.y+i.scope;d++){var f=cc.v2(p,d);n.push(f)}break;case c.JXBtlMap_Spoce.SECTOR:s=i.scope[0];var g=i.scope[1];s.forEach(function(t,i){var a=t,s=g[i],c=null;switch(a){case 1:c=o.getSectorByDir1(e,s,r.Del,r.Add);break;case 3:c=o.getSectorByDir1(e,s,r.Add,r.Add);break;case 5:c=o.getSectorByDir1(e,s,r.Add,r.Del);break;case 7:c=o.getSectorByDir1(e,s,r.Del,r.Del);break;case 8:case 4:case 6:case 2:c=o.getSectorByDir2(e,s,a)}n.push.apply(n,c)});break;case c.JXBtlMap_Spoce.MAP:i.scope.forEach(function(t){n.push(o.decodeXxyy(t))})}return n},e.prototype.getGridByDir=function(t,e,o,i){for(var n=[],a=1,s=0;s<e;s++){var c=cc.v2();c.x=t.x,c.y=t.y,o===r.Add?c.x+=a:o===r.Del&&(c.x-=a),i===r.Add?c.y+=a:i===r.Del&&(c.y-=a),a++,n.push(c)}return n},e.prototype.getSectorByDir1=function(t,e,o,i){var n=[];if(o===r.Add)for(var a=1;a<=e+1;a++)if(i===r.Add)for(var s=1;s<=e+1-a;s++)(c=cc.v2()).x=t.x+a,c.y=t.y+s,n.push(c);else for(s=-1;s>=-e-1+a;s--)(c=cc.v2()).x=t.x+a,c.y=t.y+s,n.push(c);else for(a=-1;a>=-e-1;a--)if(i===r.Add)for(s=1;s<=e+1-Math.abs(a);s++)(c=cc.v2()).x=t.x+a,c.y=t.y+s,n.push(c);else for(s=-1;s>=-e-1+Math.abs(a);s--){var c;(c=cc.v2()).x=t.x+a,c.y=t.y+s,n.push(c)}return n},e.prototype.getSectorByDir2=function(t,e,o){for(var i=[],n=1;n<=e;n++)for(var r=0;r<=n-1;r++){var a=cc.v2(),s=cc.v2();2===o?(a.x=t.x+r,a.y=t.y+n,s.x=t.x-r,s.y=t.y+n,i.push(a),i.push(s)):4===o?(a.y=t.y+r,a.x=t.x+n,s.y=t.y-r,s.x=t.x+n,i.push(a),i.push(s)):6===o?(a.y=t.y-n,a.x=t.x-r,s.y=t.y-n,s.x=t.x+r,i.push(a),i.push(s)):8===o&&(a.y=t.y-r,a.x=t.x-n,s.y=t.y+r,s.x=t.x-n,i.push(a),i.push(s))}return i},e.prototype.encodeXxyy=function(t){return 100*t.x+t.y},e.prototype.decodeXxyy=function(t){var e=t/100|0,o=t%100;return cc.v2(e,o)},e}(s.ObjectWrap);o.default=h,cc._RF.pop()},{"./../../Core/CoreDefine":"CoreDefine","./../../Core/FrameEx/ES5Ex":"ES5Ex","./../Views/JXBattle/JXBattleDefine":"JXBattleDefine","./GameMgr":"GameMgr"}],MaskSprite:[function(t,e,o){"use strict";cc._RF.push(e,"f5760MiF6xL9IEQaoBApN03","MaskSprite");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../CoreDefine");function s(t,e,o,i){for(var n=o.vertexCount,r=e.request(n,o.indiceCount),a=r.byteOffset>>2,s=e._vData,c=e._uintVData,l=o._data,u=0;u<n;u++){var h=l[u];s[a++]=h.x,s[a++]=h.y,s[a++]=h.u,s[a++]=h.v,c[a++]=i}return r}var c={userModel:!1,createData:function(t){return t.requestRenderData()},updateRenderData:function(t){t._renderData||(t._renderData=this.createData(t));var e=t._renderData,o=t._spriteFrame;if(e&&o){var i=t._vertices;i||(i=t.caculateVertices()),i&&(e.vertexCount!==i.x.length&&(e.vertexCount=i.x.length,e.indiceCount=i.triangles.length,e.dataLength=2*e.vertexCount,e.uvDirty=e.vertDirty=!0),e.uvDirty&&this.updateUVs(t),e.vertDirty&&(this.updateVerts(t),this.updateWorldVerts(t)))}},updateUVs:function(t){for(var e=t.vertices,o=e.nu,i=e.nv,n=t._renderData,r=n._data,a=0,s=o.length;a<s;a++){var c=r[a];c.u=o[a],c.v=i[a]}n.uvDirty=!1},updateVerts:function(t){for(var e=t.node,o=Math.abs(e.width),i=Math.abs(e.height),n=e.anchorX*o,r=e.anchorY*i,a=t.vertices,s=a.x,c=a.y,l=e.scaleX,u=e.scaleY,h=t._renderData,p=h._data,d=0,f=s.length;d<f;d++){var g=p[d+f];g.x=(s[d]+e.width*e.anchorX-n)*l,g.y=(-c[d]+e.height*(1-e.anchorY)-r)*u}h.vertDirty=!1},updateWorldVerts:function(t){for(var e=t.node,o=t._renderData,i=o._data,n=e._worldMatrix,r=n.m00,a=n.m01,s=n.m04,c=n.m05,l=n.m12,u=n.m13,h=0,p=o.vertexCount;h<p;h++){var d=i[h+p],f=i[h];f.x=d.x*r+d.y*s+l,f.y=d.x*a+d.y*c+u}},fillBuffers:function(t,e){var o=t.vertices;if(o){e.worldMatDirty&&this.updateWorldVerts(t);for(var i=e._meshBuffer,n=t.node,r=s(0,i,t._renderData,n._color._val),a=i._iData,c=r.indiceOffset,l=r.vertexOffset,u=o.triangles,h=0,p=u.length;h<p;h++)a[c++]=l+u[h]}}},l=cc._decorator,u=l.ccclass,h=l.property,p=(l.executionOrder,l.menu),d=[[-48,-93],[0,-110],[48,-93],[48,89],[30,93],[28,98],[20,98],[16,103],[-16,103],[-21,98],[-29,98],[-31,93],[-48,89]],f=cc.size(97,203),g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._spriteFrame=null,e._maskType=a.MaskSpriteType.Square,e._c=cc.Vec2.ZERO,e._r=42,e._octParam=cc.Vec2.ONE,e}return n(e,t),Object.defineProperty(e.prototype,"spriteFrame",{get:function(){return this._spriteFrame},set:function(t){if(this.isValid){var e=this._spriteFrame;this._spriteFrame=t,e!==t&&(this._vertices=null,this._spriteFrame=t,this.markForUpdateRenderData(!1),this._applySpriteFrame(e))}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maskType",{get:function(){return this._maskType},set:function(t){t!=this._maskType&&(this._maskType=t,this._vertices=null,this.markForUpdateRenderData(!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this._c},set:function(t){t.equals(this._c)||(this._c=t,this._vertices=null,this.markForUpdateRenderData(!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._r},set:function(t){this._r!=t&&(this._r=t,this._vertices=null,this.markForUpdateRenderData(!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"octParam",{get:function(){return this._octParam},set:function(t){t.equals(this._octParam)||(this._octParam=t,this._vertices=null,this.markForUpdateRenderData(!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vertices",{get:function(){return this._vertices},enumerable:!1,configurable:!0}),e.prototype.setSprite=function(t,e,o,i,n,r){t&&(this.spriteFrame=t),e&&(this.maskType=e),o&&(this.center=o),i&&(this.radius=i),n&&(this.octParam.x=n),r&&(this.octParam.y=r)},e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this.onTransfromChange,this);var t=this.sharedMaterials[0];t||(t=cc.MaterialVariant.createWithBuiltin("2d-sprite",this),this.setMaterial(0,t)),this._applySpriteFrame()},e.prototype.onEnable=function(){t.prototype.onEnable.call(this),this.markForUpdateRenderData(!0)},e.prototype._activateMaterial=function(){var t=this._spriteFrame;if(t&&t.textureLoaded()){var e=this.sharedMaterials[0];e=e?cc.MaterialVariant.create(e,this):cc.MaterialVariant.createWithBuiltin("2d-sprite",this);var o=t.getTexture();e.setProperty("texture",o),this.setMaterial(0,e),this.markForRender(!0),this.markForUpdateRenderData(!0)}else this.disableRender()},e.prototype._onTextureLoaded=function(){this.isValid&&this._activateMaterial()},e.prototype.onTransfromChange=function(){this._vertices=null,this.markForUpdateRenderData(!0)},e.prototype.caculateVertices=function(){if(this._spriteFrame){switch(this._maskType){case a.MaskSpriteType.Square:this.getSquareVertices();break;case a.MaskSpriteType.Clire:this.getClireVertices();break;case a.MaskSpriteType.Octagon:this.getOctagonVertices();break;case a.MaskSpriteType.CardClip:this.getCardClipVertices()}return this._maskType!=a.MaskSpriteType.CardClip?this.node.width=this.node.height=2*this.radius:this.node.setContentSize(f),this._vertices}},e.prototype._applySpriteFrame=function(t){void 0===t&&(t=null),t&&t.off&&t.off("load",this._onTextureLoaded,this);var e=this._spriteFrame,o=this.sharedMaterials[0];e&&(o&&o._texture)===(e&&e._texture)||this.markForRender(!1),e&&(t&&e._texture===t._texture||(e.textureLoaded()?this._onTextureLoaded():(e.once("load",this._onTextureLoaded,this),e.ensureLoadTexture())))},e.prototype.getSquareVertices=function(){var t=this._spriteFrame.getTexture(),e=t.width,o=t.height,i=e/o,n=this.convertN2T(this._c,e,o),r=this._r/e,a=n.x-r,s=n.x+r,c=n.y-r*i,l=n.y+r*i,u=this.node.width,h=this.node.height,p=this.node.anchorX,d=this.node.anchorY,f=cc.v2(u*(.5-p),h*(.5-d));return this._vertices={x:[f.x-this._r,f.x+this._r,f.x+this._r,f.x-this._r],y:[f.y-this._r,f.y-this._r,f.y+this._r,f.y+this._r],nu:[a,s,s,a],nv:[c,c,l,l],triangles:[0,1,2,2,3,0]},this._vertices},e.prototype._canRender=function(){if(cc.game.renderType===cc.game.RENDER_TYPE_CANVAS){if(!this._enabled)return!1}else if(!this._enabled||!this.sharedMaterials[0]||!this.node._activeInHierarchy)return!1;var t=this._spriteFrame;return!(!t||!t.textureLoaded())},e.prototype.markForUpdateRenderData=function(t){if(t&&this._canRender()){this.node._renderFlag|=cc.RenderFlow.FLAG_UPDATE_RENDER_DATA,this._vertices=null;var e=this._renderData;e&&(e.uvDirty=!0,e.vertDirty=!0)}else t||(this.node._renderFlag&=~cc.RenderFlow.FLAG_UPDATE_RENDER_DATA,cc.Node)},e.prototype.getClireVertices=function(){this._vertices={x:[],y:[],nu:[],nv:[],triangles:[]};for(var t=cc.misc.degreesToRadians(360)/64,e=0,o=this._spriteFrame.getTexture(),i=o.width,n=o.height,r=i/n,a=this.convertN2T(this._c,i,n),s=this._r/i,c=this.node.width,l=this.node.height,u=this.node.anchorX,h=this.node.anchorY,p=cc.v2(c*(.5-u),l*(.5-h)),d=0;d<65;d++){var f=Math.cos(e),g=Math.sin(e);this.vertices.x[d]=f*this._r+p.x,this.vertices.y[d]=g*this._r+p.y,this.vertices.nu[d]=f*s+a.x,this.vertices.nv[d]=g*s*r+a.y,e+=t}d=0;for(var _=1;d<189;d+=3,_++)this.vertices.triangles[d]=0,this.vertices.triangles[d+1]=_+1,this.vertices.triangles[d+2]=_;return this.vertices.triangles[189]=0,this.vertices.triangles[190]=1,this.vertices.triangles[191]=64,this._vertices},e.prototype.getOctagonVertices=function(){this._vertices={x:[],y:[],nu:[],nv:[],triangles:[]};var t=this._spriteFrame.getTexture(),e=t.width,o=t.height,i=e/o,n=this.convertN2T(this._c,e,o),r=this._r/e,a=n.x-r,s=n.x+r,c=n.y-r*i,l=n.y+r*i,u=this._octParam.x/e,h=this._octParam.y/e,p=this.node.width,d=this.node.height,f=this.node.anchorX,g=this.node.anchorY,_=cc.v2(p*(.5-f),d*(.5-g));return this.vertices.x[0]=-this._r+this._octParam.x+_.x,this.vertices.y[0]=-this._r+_.y,this.vertices.nu[0]=a+u,this.vertices.nv[0]=c,this.vertices.x[1]=this._r-this._octParam.y+_.x,this.vertices.y[1]=-this._r+_.y,this.vertices.nu[1]=s-h,this.vertices.nv[1]=c,this.vertices.x[2]=this._r+_.x,this.vertices.y[2]=_.y-(this._r-this.octParam.y),this.vertices.nu[2]=r+n.x,this.vertices.nv[2]=n.y-r*i+h*i,this.vertices.x[3]=this._r+_.x,this.vertices.y[3]=_.y+(this._r-this._octParam.x),this.vertices.nu[3]=s,this.vertices.nv[3]=l-u*i,this.vertices.x[4]=this._r+_.x-this.octParam.x,this.vertices.y[4]=_.y+this._r,this.vertices.nu[4]=s-u,this.vertices.nv[4]=l,this.vertices.x[5]=-this._r+this._octParam.y+_.x,this.vertices.y[5]=_.y+this._r,this.vertices.nu[5]=a+h,this.vertices.nv[5]=l,this.vertices.x[6]=-this._r+_.x,this.vertices.y[6]=_.y+(this._r-this._octParam.y),this.vertices.nu[6]=a,this.vertices.nv[6]=l-h*i,this.vertices.x[7]=-this._r+_.x,this.vertices.y[7]=_.y-(this._r-this._octParam.x),this.vertices.nu[7]=a,this.vertices.nv[7]=c+u*i,this.vertices.triangles=[0,1,2,0,2,3,0,3,4,0,4,5,0,5,6,7,0,6],this.vertices},e.prototype.getCardClipVertices=function(){this._vertices={x:[],y:[],nu:[],nv:[],triangles:[]};for(var t=this._spriteFrame.getTexture(),e=t.width,o=t.height,i=this.convertN2T(this._c,e,o),n=(this._r,i.x,i.x,i.y,i.y,this.node.width),r=this.node.height,a=this.node.anchorX,s=this.node.anchorY,c=cc.v2(n*(.5-a),r*(.5-s)),l=d.length,u=0;u<l;u++)this._vertices.x[u]=d[u][0]+c.x,this._vertices.y[u]=-(d[u][1]+c.y),this._vertices.nu[u]=(d[u][0]+i.x*e)/e,this._vertices.nv[u]=1-(d[u][1]+i.y*o)/o;u=0;for(var h=1;u<3*l-6;u+=3,h++)this._vertices.triangles[u]=0,this._vertices.triangles[u+1]=h+1,this._vertices.triangles[u+2]=h;return this._vertices},e.prototype.convertN2T=function(t,e,o){var i=(.5*e+t.x)/e,n=1-(.5*o+t.y)/o;return cc.v2(i,n)},r([h(cc.SpriteFrame)],e.prototype,"_spriteFrame",void 0),r([h({type:cc.SpriteFrame})],e.prototype,"spriteFrame",null),r([h({type:cc.Enum(a.MaskSpriteType)})],e.prototype,"_maskType",void 0),r([h({type:cc.Enum(a.MaskSpriteType)})],e.prototype,"maskType",null),r([h(cc.Vec2)],e.prototype,"_c",void 0),r([h({tooltip:!1})],e.prototype,"center",null),r([h()],e.prototype,"_r",void 0),r([h({tooltip:!1,visible:function(){return this._maskType!=a.MaskSpriteType.CardClip}})],e.prototype,"radius",null),r([h(cc.Vec2)],e.prototype,"_octParam",void 0),r([h({tooltip:!1,visible:function(){return this._maskType==a.MaskSpriteType.Octagon}})],e.prototype,"octParam",null),r([u,p("FrameEx/MaskSprite")],e)}(cc.RenderComponent);o.default=g,g._assembler=c,cc._RF.pop()},{"../CoreDefine":"CoreDefine"}],MaskUtil:[function(t,e){"use strict";cc._RF.push(e,"8462atFlBhN5oYIA71GrWQs","MaskUtil");var o=function(){function t(){}return t.setOn=function(e,o){if(o<0)throw new Error("id("+o+")< 0");var i=Math.floor(o/32);if(void 0===e[i])for(var n=0;n<=i;n++)e[n]=e[n]||0;var r=o%32,a=e[i].toString(2),s=32-r-1;return a=(a=t._zeroMask.substr(0,32-a.length)+a).substr(0,s)+"1"+a.substr(s+1,32),e[i]=parseInt(a,2),e[i]},t.setOff=function(e,o){if(o<0)throw new Error("id("+o+")< 0");var i=Math.floor(o/32);if(void 0===e[i])for(var n=0;n<=i;n++)e[n]=e[n]||0;var r=o%32,a=e[i].toString(2),s=32-r-1;return a=(a=t._zeroMask.substr(0,32-a.length)+a).substr(0,s)+"0"+a.substr(s+1,32),e[i]=parseInt(a,2),e[i]},t.isOn=function(t,e){if(e<0)throw new Error("id("+e+")< 0");var o=Math.floor(e/32),i=e%32;return!(!t[o]||0==(t[o]&Math.pow(2,i)))},t.encodeVals=function(e,o){void 0===o&&(o=32);for(var i=[],n=o,r=0;r<e.length;r+=n)i.push(t.encodeVal(e.slice(r,r+n)));return i},t.encodeVal=function(t){var e=(t=t.reverse()).join("");return parseInt(e,2)},t.decodeVals=function(e,o){void 0===o&&(o=32),e=e;for(var i=[],n=0;n<e.length;n+=1){var r=t.decodeVal(e[n],o);i=i.concat(r)}return i},t.decodeVal=function(t,e){void 0===e&&(e=32);for(var o=t.toString(2);o.length<e;)o="0"+o;var i=o.split("");i.reverse();for(var n=i.length-1;n>=0;n-=1)i[n]=Number(i[n]);return i},t.checkAndSetOn=function(t,e,o,i){for(var n=[],r=0;r<t.length;r++){var a=o(e,t[r]),s=a[0],c=a[1];if(!(s<0)&&!(n.indexOf(s)>=0)&&(n.push(s),i(s),null===c||t[t.length-1]<c))break}},t.fixPreMask=function(e){for(var o=-1,i=e.length-1;i>=0;i--)if(e[i]||-1!==o)if(-1===o){o=i;for(var n=t.decodeVal(e[i]),r=!1,a=n.length-1;a>=0;a--)r||1!==n[a]||(r=!0),r&&(n[a]=1);e[i]=t.encodeVal(n)}else e[i]=parseInt(t._oneMask,2)},t.zip=function(t){console.dir(t);for(var e=0;e<t.length;e++)0==t[e]&&(t[e-1]<0?(t[e-1]-=1,t.splice(e,1),e--):t[e]=-1);console.dir(t)},t.unzip=function(t){var e=[];e.push.apply(e,t);for(var o=t.concat(),i=0,n=0;n<o.length;n++)if(o[n]<0){for(var r=0-o[n],a=0;a<r;a++)e[i+n+a]=0;i+=r-1}else e[i+n]=o[n];return e},t._oneMask="11111111111111111111111111111111",t._zeroMask="00000000000000000000000000000000",t}();e.exports=o,cc._RF.pop()},{}],MathEx:[function(t,e,o){"use strict";cc._RF.push(e,"62d55S/VPBFH42nVOEEV0a/","MathEx"),Object.defineProperty(o,"__esModule",{value:!0}),o.Plane=o.GRID_TEXTURE_CHEK_RANGE=void 0,o.GRID_TEXTURE_CHEK_RANGE=3;o.Plane=function(){};var i=function(){function t(){}return t.angle2Radian=function(t){return this.PI*t%360/180},t.radian2Angle=function(t){return 180*t/this.PI},t.angleByPos=function(t,e,o,i){var n;return t instanceof cc.Vec2&&e instanceof cc.Vec2?((n=new cc.Vec2).x=e.x-t.y,n.y=e.y-t.y,180*Math.atan2(n.y,n.x)/this.PI):"number"==typeof t&&"number"==typeof e?((n=new cc.Vec2).x=o-t,n.y=i-e,180*Math.atan2(n.y,n.x)/this.PI):0},t.pLineIntersect=function(t,e,o,i,n){if(t.x===e.x&&t.y===e.y||o.x===i.x&&o.y===i.y)return!1;var r=e.x-t.x,a=e.y-t.y,s=i.x-o.x,c=i.y-o.y,l=t.x-o.x,u=t.y-o.y,h=c*r-s*a;return n.x=s*u-c*l,n.y=r*u-a*l,0===h?0===n.x||0===n.y:(n.x=n.x/h,n.y=n.y/h,!0)},t.pSegmentIntersect=function(t,e,o,i){var n=cc.v2(0,0);return!!(this.pLineIntersect(t,e,o,i,n)&&n.x>=0&&n.x<=1&&n.y>=0&&n.y<=1)},t.segmentIntersectRect=function(t,e,o){return!(!o.contains(t)||!o.contains(e))||this.pSegmentIntersect(t,e,cc.v2(o.xMin,o.yMin),cc.v2(o.xMin,o.yMax))||this.pSegmentIntersect(t,e,cc.v2(o.xMin,o.yMin),cc.v2(o.xMax,o.yMin))||this.pSegmentIntersect(t,e,cc.v2(o.xMin,o.yMax),cc.v2(o.xMax,o.yMax))||this.pSegmentIntersect(t,e,cc.v2(o.xMax,o.yMax),cc.v2(o.xMax,o.yMin))},t.segmentArounds=function(t,e){var o=[];if(t.x==e.x){for(var i=e.y-t.y,n=Math.abs(i),r=1;r<=n;r++)o.push(cc.v2(t.x,t.y+i/n*r));return o}if(t.y==e.y){for(i=e.x-t.x,n=Math.abs(i),r=1;r<=n;r++)o.push(cc.v2(t.x+i/n*r,t.y));return o}var a=(e.y-t.y)/(e.x-t.x),s=t.y-t.x*a,c=Math.abs(a);if(c>0&&c<=1)for(var l=t.x<e.x?1:-1,u=t.x;l>0&&u<=e.x||l<0&&u>=e.x;u+=l){var h=Math.floor(a*u+s);o.push(cc.v2(u,h))}else for(l=t.y<e.y?1:-1,h=t.y;l>0&&h<=e.y||l<0&&h>=e.y;h+=l)u=Math.floor((h-s)/a),o.push(cc.v2(u,h));return o},t.getSegmentArounds=function(e,o,i,n){return e instanceof cc.Vec2&&o instanceof cc.Vec2?t.segmentArounds(e,o):"number"==typeof e&&"number"==typeof o?t.segmentArounds(cc.v2(e,o),cc.v2(i,n)):null},t.getDistance=function(t,e,o,i){if("number"!=typeof t&&"number"!=typeof e)return t.sub(e).mag();if("number"==typeof t&&"number"==typeof e){var n=t-o,r=e-i;return Math.sqrt(n*n+r*r)}return-1},t.getAngleAB=function(t,e){var o=e.sub(t),i=t.mag(),n=e.mag(),r=o.dot(t)/(i*n);return-180*Math.acos(r)/this.PI},t.getAngleX=function(t,e){var o=e.sub(t),i=o.mag(),n=o.dot(cc.Vec2.RIGHT)/i,r=180*Math.acos(n)/this.PI;return o.x>0&&o.y>0?r:o.x>=0&&o.y<=0?-r:o.x<=0&&o.y>=0?r:o.x<=0&&o.y<=0?-r:r},t.getAnglePos=function(t,e){var o=cc.misc.degreesToRadians(t);return cc.v2(Math.cos(o)*e,Math.sin(o)*e)},t.getAroundCoords=function(t,e){var i=[];if(t instanceof cc.Vec2)for(var n=cc.v2(t.x-1,t.y-1),r=0;r<o.GRID_TEXTURE_CHEK_RANGE;r++)for(var a=0;a<o.GRID_TEXTURE_CHEK_RANGE;a++)(s=cc.v2(n.x+a,n.y+r)).x==t.x&&s.y==t.y||i.push(s);else for(n=cc.v2(t-1,e-1),r=0;r<o.GRID_TEXTURE_CHEK_RANGE;r++)for(a=0;a<o.GRID_TEXTURE_CHEK_RANGE;a++){var s;(s=cc.v2(n.x+a,n.y+r)).x==t&&s.y==e||i.push(s)}return i},t.getRangeCoords=function(e,o,i){for(var n=[],r=-o;r<=o;r++)for(var a=-o;a<=o;a++){var s=cc.v2(e.x+a,e.y+r);s.x<0||s.x>=i.width-1||s.y<0||s.y>=i.height||Math.ceil(t.getDistance(e,s))>o||n.push(s)}return n},t.irregularCheck=function(t,e,o){var i,n,r=!1,a=o.length;for(i=0,n=a-1;i<a;n=i++)o[i].y>e!=o[n].y>e&&t<(o[n].x-o[i].x)*(e-o[i].y)/(o[n].y-o[i].y)+o[i].x&&(r=!r);return r},t.getViewClipCoords=function(t,e,o,i){for(var n=[],r=t[3].x-t[0].x,a=t[0].y-t[1].y,s=function(t){n.push(t),i&&i(t)},c=0;c<=r;c++)for(var l=t[0].x+c,u=t[0].y+c,h=0;h<=a;h++){var p=l+h,d=u-h,f=d-1;if(null!=e&&null!=o){if(p<e||p>=o)continue;d>=e&&d<o&&s(cc.v2(p,d)),f>=e&&f<o&&s(cc.v2(p,f))}else s(cc.v2(p,d)),s(cc.v2(p,f))}return n},t.getViewRectangleCoods=function(t,e){for(var o,i=[],n=t[0].x;n<=t[3].x;n++)for(var r=t[1].y;r<=t[0].y;r++)o=cc.v2(n,r),i.push(o),e&&e(o);return i},t.rASeaches=function(t,e,o){var i=0,n=t,r=e(n);for(o||(o=20);!(r||i>o);){for(var a=-++i;a<i&&!(r=e(n=cc.v2(t.x+a,t.y-i)));a++);if(!r)for(var s=-i;s<i&&!(r=e(n=cc.v2(t.x+i,t.y+s)));s++);if(!r)for(a=i;a>-i&&!(r=e(n=cc.v2(t.x+a,t.y+i)));a--);if(!r)for(s=i;s>-i&&!(r=e(n=cc.v2(t.x-i,t.y+s)));s--);}return n},t.getRightAngleRoute=function(t,e){for(var o=[],i=(t.x-e.x)/Math.abs(t.x-e.x),n=e.x;n!=t.x;n+=i)o.push(cc.v2(n,e.y));i=(t.y-e.y)/Math.abs(t.y-e.y);for(var r=e.y;r!=t.y;r+=i)o.push(cc.v2(t.x,r));return o},t.prefixZero=function(t,e){return(Array(e).join("0")+t).slice(-e)},t.newArray=function(t,e){for(var o=[],i=0;i<t;i++)o.push(e||0);return o},t.random=function(t,e){return t=t||0,e=null==e?100:e,Math.floor(t+Math.random()*(e-t+1))},t.randoms=function(t,e,o){if(t>=o-e)return this.newArray(o-e).map(function(t,o){return o+e});for(var i=this.newArray(o-e).map(function(t,o){return o+e}),n=new Array,r=0;r<t&&!(i.length<=0);r++){var a=Math.floor(this.random(0,i.length-1));n[r]=i[a],i.splice(a,1)}return n},t.fisherYatesShuffle=function(t){for(var e=[],o=0;o<t.length;o++)e.push(t[o]);for(var i,n,r=e.length;r;)n=Math.floor(Math.random()*r--),i=e[r],e[r]=e[n],e[n]=i;return e},t.prefixInteger=function(t,e){return(Array(e).join("0")+t).slice(-e)},t.rayPlaneIntersectPoint=function(t,e){var o=new cc.Vec3,i=e.n.dot(e.p)-e.n.dot(t.o)/e.n.dot(t.d);return o.x=t.o.x+t.d.x*i,o.y=t.o.y+t.d.y*i,o.z=t.o.z+t.d.z*i,o},t.getRandom=function(t,e,o,i){var n=Math.random()*(e-t)+t;if(n=Math.floor(n),i.length<o){for(var r=0;r<=i.length&&n!=i[r];r++)if(r==i.length){i.push(n);break}this.getRandom(t,e,o,i)}return i},t.PI=3.1415926,t}();o.default=i,cc._RF.pop()},{}],MoreGame:[function(t,e,o){"use strict";cc._RF.push(e,"b0ee7NRsIRFaJTaoyxB8msp","MoreGame");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GView/GViewBase"),s=t("../../../tyqSDK/tyqSDK"),c=cc._decorator,l=c.ccclass,u=(c.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.onGStart=function(){t.prototype.onGStart.call(this);var e=this;s.tyqSDK.showCustomRectCenterAd(function(){console.log("fail cb"),e.closeLayer()})},e.prototype.closeLayer=function(){s.tyqSDK.hideCustomRectCenterAd(),this.onClose()},r([l],e)}(a.default));o.default=u,cc._RF.pop()},{"../../../Core/GView/GViewBase":"GViewBase","../../../tyqSDK/tyqSDK":"tyqSDK"}],NoticeCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"9aaa5Mhh6hNv5tlM1Vfq5hv","NoticeCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/GView/GViewBase"),c=t("../../../Core/Math/MathEx"),l=t("../../Common/JXColor"),u=t("../../Logic/GameMgr"),h=cc._decorator,p=h.ccclass,d=h.property,f=h.menu,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.notice=null,e.noticeRichText=null,e}return n(e,t),e.prototype.start=function(){this.twe()},e.prototype.twe=function(){var t=this,e=(l.JXColor.CFFF10B.toHEX(),l.JXColor.Cff0000.toHEX(),c.default.random(1,u.default.noticeData.data.values().length)),o=u.default.noticeData.getRaw(e).txt.replace(/\"/g,"");this.noticeRichText.string=o,this.noticeRichText.node.x=150;var i=u.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.noticeTime);this.scheduleOnce(function(){t.notice.active=!1},9.1),this.scheduleOnce(function(){t.twe(),t.notice.active=!0},10.5+i),cc.tween(this.noticeRichText.node).to(9,{position:cc.v2(-1e3,0)}).call(function(){}).union().start()},r([d({type:cc.Node,tooltip:"\u516c\u544a\u80cc\u666f"})],e.prototype,"notice",void 0),r([d({type:cc.RichText,tooltip:"\u516c\u544a\u6587\u6848"})],e.prototype,"noticeRichText",void 0),r([p,f("View/Home/NoticeCtrl")],e)}(s.default);o.default=g,cc._RF.pop()},{"../../../Core/GView/GViewBase":"GViewBase","../../../Core/Math/MathEx":"MathEx","../../../conventions/JXCommon":"JXCommon","../../Common/JXColor":"JXColor","../../Logic/GameMgr":"GameMgr"}],OfficerCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"c7623kg14ND46NZBVwQWO2t","OfficerCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GCtrl"),s=t("../../../Core/GView/GListView"),c=t("../../../Core/GView/GViewBase"),l=t("../../Common/Define"),u=t("../../Common/UIResources"),h=t("../../Data/RunTime/RunRaw/RJXItem"),p=t("../../Logic/GameMgr"),d=cc._decorator,f=d.ccclass,g=d.property,_=d.menu,m=(d.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cardView=null,e.content=null,e.mask=null,e._listView=null,e._officerData=null,e._offAllData=[],e}return n(e,t),e.prototype.onGLoad=function(){this.node.setContentSize(cc.winSize),this.initEmbattle(),a.GCtrl.ES.on(l.CMsg.client.bag.onCurrencyChange,this,this.initEmbattle.bind(this))},e.prototype.initEmbattle=function(){var t=this;p.default.redMgr.sendValueSettingMsg(l.RPointMask.RPM_Office,!1),p.default.officerData.data.values().forEach(function(e){t._offAllData.push(e.exp)}),this._officerData=p.default.officerData.data.values(),this._listView?this._listView.setData(this._officerData):this.assetImpl.prefab(u.Res.prefab.item.officerItem,function(e){t._listView=new s.GListView({scrollview:t.cardView,mask:t.mask,content:t.content,itemTpl:cc.instantiate(e),itemSetter:t.onItemSetter.bind(t),direction:s.GListViewDir.Vertical,column:0,gapY:18,padingY:30,padingX:0,isCbClass:!0,isWidget:!0}),t._listView.setData(t._officerData)})},e.prototype.onItemSetter=function(t,e,o){t.node.zIndex=this._offAllData.length-o,t.init(e,o,this._offAllData)},e.prototype.onClose=function(){t.prototype.onClose.call(this)},e.prototype.addExploit=function(){var t=new h.default([l.CURRENCY.FEATS,l.ITEM_TYPE.CURRENCY,500]);p.default.itemMgr.testCost(t)&&a.GCtrl.ES.emit(l.CMsg.client.bag.onBagItemChange,[[l.CURRENCY.FEATS,l.ITEM_TYPE.CURRENCY,100]])},r([g(cc.ScrollView)],e.prototype,"cardView",void 0),r([g(cc.Node)],e.prototype,"content",void 0),r([g(cc.Node)],e.prototype,"mask",void 0),r([f,_("View/Home/OfficerCtrl")],e)}(c.default));o.default=m,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../../Core/GView/GListView":"GListView","../../../Core/GView/GViewBase":"GViewBase","../../Common/Define":"Define","../../Common/UIResources":"UIResources","../../Data/RunTime/RunRaw/RJXItem":"RJXItem","../../Logic/GameMgr":"GameMgr"}],OfficerItem:[function(t,e,o){"use strict";cc._RF.push(e,"960c7ZpzAVIsrYUx2E7dHEs","OfficerItem");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/CoreDefine"),c=t("../../../Core/GCtrl"),l=t("../../../Core/GEvent/GParam"),u=t("../../../Core/GView/GChild"),h=t("../../../Shaders/Manager/ShaderUtil"),p=t("../../Common/Define"),d=t("../../Common/UI"),f=t("../../Logic/GameMgr"),g=t("./../../Common/Define"),_=cc._decorator,m=_.ccclass,y=_.property,v=_.menu,C=(_.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.adBg=null,e.adMask=null,e.adUnlocked=null,e.adReceived=null,e.Received=null,e.boxBg=null,e.boxMask=null,e.boxUnlocked=null,e.boxReceived=null,e.boReceived=null,e.adBox=null,e.box=null,e.lv=null,e.progressBar=null,e.val=null,e.green=null,e.offNum=null,e.offLv=null,e.offLvbg=null,e.offLvbglight=null,e._officerLv=0,e._offAllData=[],e._upgradeExploitl=null,e._listData=null,e._index=null,e._curStatus=null,e}return n(e,t),e.prototype.onGLoad=function(){c.GCtrl.ES.on(p.CMsg.client.office.onGetAdReward,this,this.onCMSGGetAdReward.bind(this),s.PRIORITY_VIEW),c.GCtrl.ES.on(p.CMsg.client.office.onGetReward,this,this.onCMSGGetReward.bind(this),s.PRIORITY_VIEW)},e.prototype.onCMSGGetAdReward=function(t,e){e.get().id===this._listData.id&&this.initAdBoxImg("adBox")},e.prototype.onCMSGGetReward=function(t,e){e.get().id===this._listData.id&&(this.initBoxImg("box"),this.setRedPoint(),f.default.redMgr.sendValueSettingMsg(p.RPointMask.RPM_Office,!1))},e.prototype.initOfficerLv=function(){var t=f.default.RBagData.getMegreItems(g.CURRENCY.FEATS,g.ITEM_TYPE.CURRENCY),e=0;this._officerLv>=this._listData.id-1&&(e=this._officerLv>0?this._index<this._officerLv?1:(t.num-this._offAllData[this._officerLv-1])/this._upgradeExploitl:t.num/this._upgradeExploitl),e>=1?this.setLoadProgress(1):e<=0?this.setLoadProgress(0):(this.val.convertToWorldSpaceAR(this.green.position),this.setLoadProgress(e))},e.prototype.init=function(t,e,o){this._curStatus=f.default.lUserData.getOfficeStatus(t.id),this._officerLv=f.default.lUserData.officerLv,this._offAllData=o,this._index=e,this._index>0?this._upgradeExploitl=Number(Number(this._offAllData[this._index])-Number(this._offAllData[this._index-1])):this._upgradeExploitl=Number(this._offAllData[this._index]),this.offNum.string=this._offAllData[this._index]+"",this._listData=t,this.initOfficerLv(),this.setRedPoint(),this.initAdBoxImg(),this.initBoxImg(),this.lv.string=this._listData.name+""},e.prototype.setRedPoint=function(){var t=f.default.userMgr.checkOfficeReward(this._listData.id);f.default.redMgr.setRPointView(this.box,this.box,t,p.RedpointEffect.REDPOINT)},e.prototype.adClick=function(){var t=this;this._curStatus.adBox==p.OFFICERITEM.LOCK&&f.default.sdkMgr.watchAd(function(){var e={id:t._listData.id};c.GCtrl.ES.emit(p.CMsg.client.office.onGetAdReward,new l.default(e)),f.default.jumpToMgr.jumpGoTo(d.VIEW_ID.rewardCtrl,t._listData.award);var o=f.default.lUserData.officerLv,i=f.default.lUserData.heroOfficer(o);f.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.officerCtrl,{msg:"\u5b98\u804c\u5956\u52b1-"+i})},function(){},"\u83b7\u53d6\u989d\u5916\u5b98\u804c\u5956\u52b1")},e.prototype.click=function(){if(this._curStatus.box==p.OFFICERITEM.LOCK){var t={id:this._listData.id};c.GCtrl.ES.emit(p.CMsg.client.office.onGetReward,new l.default(t)),f.default.jumpToMgr.jumpGoTo(d.VIEW_ID.rewardCtrl,this._listData.award);var e=f.default.lUserData.officerLv,o=f.default.lUserData.heroOfficer(e);f.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.officerCtrl,{msg:"\u5b98\u804c\u5956\u52b1-"+o})}},e.prototype.initAdBoxImg=function(t){this._curStatus.adBox==p.OFFICERITEM.LOCK?(this.adMask.off(cc.Node.EventType.TOUCH_END,this._onTouchStar0,this),this.adBg.active=!0,this.adBox.getComponent(cc.Button).interactable=!0,this.adMask.active=!1,this.adUnlocked.active=!1,this.adReceived.active=!0):this._curStatus.adBox==p.OFFICERITEM.RECEICE||"adBox"==t?(this.adMask.off(cc.Node.EventType.TOUCH_END,this._onTouchStar0,this),this.adBox.getComponent(cc.Button).interactable=!1,this.adMask.active=!0,this.adUnlocked.active=!1,this.adReceived.active=!1,this.Received.active=!0):this._curStatus.adBox==p.OFFICERITEM.NOT&&(this.adMask.on(cc.Node.EventType.TOUCH_END,this._onTouchStar0,this),this.adMask.active=!0,this.adUnlocked.active=!0,this.adReceived.active=!1,this.Received.active=!1)},e.prototype._onTouchStar0=function(){f.default.jumpToMgr.jumpGoTo(d.VIEW_ID.previewCtrl,this._listData,p.BOXPREVIEW.OFFICEBOX)},e.prototype.initBoxImg=function(t){this.offLvbglight.active=!0,this._curStatus.box==p.OFFICERITEM.LOCK?(h.default.normal(this.offLv),this.boxMask.off(cc.Node.EventType.TOUCH_END,this._onTouchStar0,this),h.default.normal(this.offLvbg,!0),this.boxBg.active=!0,this.boxMask.active=!1,this.boxUnlocked.active=!1,this.box.getComponent(cc.Button).interactable=!0):this._curStatus.box==p.OFFICERITEM.RECEICE||"box"==t?(this.boxMask.off(cc.Node.EventType.TOUCH_END,this._onTouchStar0,this),h.default.normal(this.offLvbg,!0),this.boReceived.active=!0,this.boxMask.active=!0,this.boxUnlocked.active=!1,this.box.getComponent(cc.Button).interactable=!1):this._curStatus.box==p.OFFICERITEM.NOT&&(h.default.gray(this.offLv,!0),h.default.gray(this.offLvbg,!0),this.offLvbglight.active=!1,this.boxMask.on(cc.Node.EventType.TOUCH_END,this._onTouchStar0,this),this.boxMask.active=!0,this.boxUnlocked.active=!0,this.boxReceived.active=!1,this.boReceived.active=!1)},e.prototype.setLoadProgress=function(t){this.progressBar&&(this.progressBar.progress=Math.min(t,1))},r([y({type:cc.Node,tooltip:"ad\u80cc\u666f"})],e.prototype,"adBg",void 0),r([y({type:cc.Node,tooltip:"\u6fc0\u52b1\u5b9d\u7bb1\u906e\u7f69"})],e.prototype,"adMask",void 0),r([y({type:cc.Node,tooltip:"\u6fc0\u52b1\u5b9d\u7bb1\u672a\u89e3\u9501"})],e.prototype,"adUnlocked",void 0),r([y({type:cc.Node,tooltip:"\u6fc0\u52b1\u5b9d\u7bb1\u9886\u53d6"})],e.prototype,"adReceived",void 0),r([y({type:cc.Node,tooltip:"\u6fc0\u52b1\u5b9d\u7bb1\u5df2\u9886\u53d6"})],e.prototype,"Received",void 0),r([y({type:cc.Node,tooltip:"\u5b9d\u7bb1\u80cc\u666f"})],e.prototype,"boxBg",void 0),r([y({type:cc.Node,tooltip:"\u5b9d\u7bb1\u906e\u7f69"})],e.prototype,"boxMask",void 0),r([y({type:cc.Node,tooltip:"\u5b9d\u7bb1\u672a\u89e3\u9501"})],e.prototype,"boxUnlocked",void 0),r([y({type:cc.Node,tooltip:"\u5b9d\u7bb1\u9886\u53d6"})],e.prototype,"boxReceived",void 0),r([y({type:cc.Node,tooltip:"\u5b9d\u7bb1\u5df2\u9886\u53d6"})],e.prototype,"boReceived",void 0),r([y({type:cc.Node,tooltip:"\u89c2\u770b\u89c6\u9891\u5b9d\u7bb1"})],e.prototype,"adBox",void 0),r([y({type:cc.Node,tooltip:"\u5b9d\u7bb1"})],e.prototype,"box",void 0),r([y({type:cc.Label,tooltip:"\u5b98\u7235\u7b49\u7ea7"})],e.prototype,"lv",void 0),r([y({type:cc.ProgressBar,tooltip:"\u8fdb\u5ea6"})],e.prototype,"progressBar",void 0),r([y({type:cc.Node,tooltip:"\u8fdb\u5ea6\u7eff\u8272\u6761"})],e.prototype,"val",void 0),r([y({type:cc.Node,tooltip:"\u7eff\u8272\u7403"})],e.prototype,"green",void 0),r([y({type:cc.Label,tooltip:"\u5b98\u7235\u529f\u52cb\u6570\u91cf"})],e.prototype,"offNum",void 0),r([y({type:cc.Node,tooltip:"\u724c\u5b50"})],e.prototype,"offLv",void 0),r([y({type:cc.Node,tooltip:"\u724c\u5b50bg"})],e.prototype,"offLvbg",void 0),r([y({type:cc.Node,tooltip:"\u724c\u5b50bg"})],e.prototype,"offLvbglight",void 0),r([m,v("View/Home/OfficerItem")],e)}(u.default));o.default=C,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/GCtrl":"GCtrl","../../../Core/GEvent/GParam":"GParam","../../../Core/GView/GChild":"GChild","../../../Shaders/Manager/ShaderUtil":"ShaderUtil","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/UI":"UI","../../Logic/GameMgr":"GameMgr","./../../Common/Define":"Define"}],OpenBookCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"7cd13/DE7dFTp2ao99+Ma3b","OpenBookCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/GView/GViewBase"),c=t("../../Logic/GameMgr"),l=cc._decorator,u=l.ccclass,h=(l.property,l.menu),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._cb=null,e}return n(e,t),e.prototype.onGStart=function(e){t.prototype.onGStart.call(this),this._cb=e},e.prototype.noTryClick=function(){c.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.openBook,{msg:"\u4e0d\u8bd5"}),c.default.rHeroData.openBook=!1,this.onClose()},e.prototype.tryClick=function(){var t=this;c.default.sdkMgr.watchAd(function(){c.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.openBook,{msg:"\u8bd5\u7528"}),c.default.rHeroData.openBook=!0,t.onClose()})},e.prototype.onClose=function(){t.prototype.onClose.call(this),this._cb()},r([u,h("View/Home/OpenBookCtrl")],e)}(s.default);o.default=p,cc._RF.pop()},{"../../../Core/GView/GViewBase":"GViewBase","../../../conventions/JXCommon":"JXCommon","../../Logic/GameMgr":"GameMgr"}],PlistLabel:[function(t,e,o){"use strict";cc._RF.push(e,"dd6bcsdEdxLQZIj6ju7/4+5","PlistLabel");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../BaseFSM/HtmlTextParser"),s=cc._decorator,c=s.ccclass,l=s.property,u=(s.executionOrder,s.menu),h=(cc.renderer.renderEngine,cc.gfx),p=(new h.VertexFormat([{name:h.ATTR_POSITION,type:h.ATTR_TYPE_FLOAT32,num:2},{name:h.ATTR_UV0,type:h.ATTR_TYPE_FLOAT32,num:2}]),new h.VertexFormat([{name:h.ATTR_POSITION,type:h.ATTR_TYPE_FLOAT32,num:2},{name:h.ATTR_UV0,type:h.ATTR_TYPE_FLOAT32,num:2},{name:h.ATTR_COLOR,type:h.ATTR_TYPE_UINT8,num:4,normalize:!0}]),cc.rect());function d(t,e,o,i){for(var n=o.vertexCount,r=e.request(n,o.indiceCount),a=r.indiceOffset,s=r.byteOffset>>2,c=r.vertexOffset,l=e._vData,u=e._uintVData,h=e._iData,p=t._worldMatrix,d=p.m00,f=p.m01,g=p.m04,_=p.m05,m=p.m12,y=p.m13,v=o._data,C=0;C<n;C++){var I=v[C];l[s++]=I.x*d+I.y*g+m,l[s++]=I.x*f+I.y*_+y,l[s++]=I.u,l[s++]=I.v;var E=i[Math.floor(C/4)];E._fastSetA(t.color.a),u[s++]=E._val}C=0;for(var S=n/4;C<S;C++){var R=c+4*C;h[a++]=R,h[a++]=R+1,h[a++]=R+2,h[a++]=R+1,h[a++]=R+3,h[a++]=R+2}return r}var f={userModel:!1,createData:function(t){return t.requestRenderData()},fillBuffers:function(t,e){t.atlas&&t.getMaterials[0]&&d(t.node,e._meshBuffer,t._renderData,t._vertColors)},updateRenderData:function(t){t._renderData||(t._renderData=null,t._renderData=t.requestRenderData()),this._updateQuads(t)},renderIA:function(t,e){e._flushIA(t._renderData)},appendQuad:function(t,e,o,i,n,r,a){var s=t.dataLength;t.dataLength+=4,t.vertexCount=t.dataLength,t.indiceCount=t.dataLength/2*3;var c,l,u,h,p=t._data,d=e.width,f=e.height,g=o.width,_=o.height;i?(c=o.x/d,u=(o.x+_)/d,l=(o.y+g)/f,h=o.y/f,p[s].u=c,p[s].v=h,p[s+1].u=c,p[s+1].v=l,p[s+2].u=u,p[s+2].v=h,p[s+3].u=u,p[s+3].v=l):(c=o.x/d,u=(o.x+g)/d,l=(o.y+_)/f,h=o.y/f,p[s].u=c,p[s].v=l,p[s+1].u=u,p[s+1].v=l,p[s+2].u=c,p[s+2].v=h,p[s+3].u=u,p[s+3].v=h),p[s].x=n,p[s].y=r-_*a,p[s+1].x=n+g*a,p[s+1].y=r-_*a,p[s+2].x=n,p[s+2].y=r,p[s+3].x=n+g*a,p[s+3].y=r},_updateQuads:function(t){var e=t._atlas,o=t.spliteChar;if(!e)return!1;var i=e.getTexture();if(!i)return!1;var n=t.node,r=t._renderData;r.dataLength=r.vertexCount=r.indiceCount=0;for(var a=0,s=t._offsetX,c=[],l=0,u=0,h=0,d=null;d=t._renderStrings[h++];)if(d.text)for(var f=d.style&&d.style.color?cc.color().fromHEX(d.style.color):n.color,g=d.text.split(o||""),_=0,m=g.length;_<m;++_){var y=g[_];if(0==c.length&&(u+=1),"\n"!=y){var v=e.getSpriteFrame(y);v&&((p=v.getRect()).height>0&&p.width>0&&(c.push({frame:v,width:a,line:u,height:p.height,color:f}),a+=p.width),_!=g.length-1&&(a+=s))}else u+=1,l=a>l?a:l,a=0}l=a>l?a:l;for(var C=t._lineHeight,I=C*u,E=n._anchorPoint.x*l,S=n._anchorPoint.y*I,R=0;R<c.length;R++){var D=c[R];this.appendQuad(r,i,D.frame.getRect(),D.frame.isRotated(),D.width-E,(u-(D.line-1))*C-S-.5*(C-D.height),1),t._vertColors.push(D.color)}return n.setContentSize(cc.size(l,I)),!0}},g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._atlas=null,e.spliteChar="",e._string="",e._renderStrings=[],e._vertColors=[],e._lineHeight=0,e._offsetX=0,e._repleaceList={"/":"x"},e}return n(e,t),Object.defineProperty(e.prototype,"atlas",{get:function(){return this._atlas},set:function(t){this.isValid&&(this._atlas=t,this._assembler=f,this._activateMaterial(!0),this._updateRenderData(!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"string",{get:function(){return this._string},set:function(t){this._string!=t&&(this._string=t,this.parse(),this._updateRenderData())},enumerable:!1,configurable:!0}),e.prototype.parse=function(){this._string||(this._string="");for(var t=a.HtmlTextParser.ins,e=Object.keys(this._repleaceList),o=t.parse(this._string),i=0;i<e.length;i++)for(var n=0;n<o.length;n++)o[n].text&&(o[n].text=o[n].text.replace(new RegExp(e[i],"g"),this._repleaceList[e[i]]));this._vertColors=[],this._renderStrings=o},Object.defineProperty(e.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight!=t&&(this._lineHeight=t,this._updateRenderData())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetX",{get:function(){return this._offsetX},set:function(t){this._offsetX!=t&&(this._offsetX=t,this._updateRenderData())},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){if(this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this.onTransfromChange,this),this._string&&0==this._renderStrings.length&&this.parse(),this._atlas){var t=this._atlas.getTexture();t.loaded?this._updateRenderData(!0):(t.once("load",this._onTextureLoaded,this),cc.textureUtil.postLoadTexture(t))}else this._activateMaterial(!0)},e.prototype._updateRenderData=function(t){if(null!=this.getMaterials()[0]){var e=this._renderData;e?(e.vertDirty=!0,e.uvDirty=!0,this.markForRender(!0)):this._applyFontTexture(t)}else this._activateMaterial(!0)},e.prototype._applyFontTexture=function(t){this._activateMaterial(t),t&&this._assembler.updateRenderData(this)},e.prototype._activateMaterial=function(t){if(t){var e=this.getMaterials[0];e=e?cc.MaterialVariant.create(e,this):cc.MaterialVariant.createWithBuiltin("2d-sprite",this),this._atlas&&e.setProperty("texture",this._atlas.getTexture()),this.setMaterial(0,e),this.markForRender(!0)}},e.prototype._onTextureLoaded=function(){this._activateMaterial(!0),this._updateRenderData(!0)},e.prototype.onEnable=function(){t.prototype.onEnable.call(this)},e.prototype.onTransfromChange=function(){this._updateRenderData()},r([l(cc.SpriteAtlas)],e.prototype,"_atlas",void 0),r([l({type:cc.SpriteAtlas})],e.prototype,"atlas",null),r([l],e.prototype,"spliteChar",void 0),r([l],e.prototype,"_string",void 0),r([l({multiline:!0})],e.prototype,"string",null),r([l],e.prototype,"_lineHeight",void 0),r([l()],e.prototype,"lineHeight",null),r([l],e.prototype,"_offsetX",void 0),r([l()],e.prototype,"offsetX",null),r([c,u("FrameEx/PlistLabel")],e)}(cc.RenderComponent);o.default=g,cc._RF.pop()},{"../BaseFSM/HtmlTextParser":"HtmlTextParser"}],PowerUp:[function(t,e,o){"use strict";cc._RF.push(e,"cceb1Lu+DtBX7MGFDgdd6e7","PowerUp");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GView/GViewBase"),s=t("../../Logic/GameMgr"),c=t("../Hero/HeroChange"),l=cc._decorator,u=l.ccclass,h=l.property,p=l.menu,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.light2=[],e.lightNode=null,e.powerLab=null,e.HeroChange=null,e._curIndex=0,e._delay=10,e}return n(e,t),e.prototype.onLoad=function(){},e.prototype.onGStart=function(t,e){this.scheduleOnce(this.onClose,1.5),this.onAddCoin(t);var o=s.default.heroData.getRaw(e);this.HeroChange.node.scale=1.3*o.roleScale;var i=s.default.rHeroData.getHero(e);this.HeroChange.changeSpine(i,!1,0)},e.prototype.update=function(){this._delay>0?this._delay--:(this._delay=10,this._curIndex=(this._curIndex+1)%2,this.lightNode.spriteFrame=this.light2[this._curIndex])},e.prototype.onAddCoin=function(t){var e=this,o=parseInt(t.coin)-parseInt(t.add);this.powerLab.string=""+t.coin,cc.tween({a:0}).to(.3,{a:100},{progress:function(i,n,r,a){e.node&&(e.powerLab.string=o+Math.floor(parseFloat(t.add)*a)+"")}}).start()},r([h(cc.SpriteFrame)],e.prototype,"light2",void 0),r([h(cc.Sprite)],e.prototype,"lightNode",void 0),r([h(cc.Label)],e.prototype,"powerLab",void 0),r([h({type:c.default,tooltip:"\u82f1\u96c4\u4eba\u7269"})],e.prototype,"HeroChange",void 0),r([u,p("View/Tip/RewardCtrl")],e)}(a.default);o.default=d,cc._RF.pop()},{"../../../Core/GView/GViewBase":"GViewBase","../../Logic/GameMgr":"GameMgr","../Hero/HeroChange":"HeroChange"}],PreviewCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"6a684reMlJKdpZyQ7RWR1U9","PreviewCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GView/GViewBase"),s=t("../../Common/Define"),c=t("../../Common/UIResources"),l=t("../../Data/RunTime/RunRaw/RJXItem"),u=cc._decorator,h=u.ccclass,p=u.property,d=u.menu,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.jxLayer=null,e.jxLayer2=null,e}return n(e,t),e.prototype.onGStart=function(e,o){switch(t.prototype.onGStart.call(this),o){case s.BOXPREVIEW.FIRSTBOX:case s.BOXPREVIEW.DAYBOX:var i=e;this.init(i,o);break;case s.BOXPREVIEW.LEVELBOX:i=e,this.initBox(i);break;case s.BOXPREVIEW.OFFICEBOX:i=e,this.initOfficeBox(i)}},e.prototype.init=function(t,e){var o=this;this.assetImpl.prefab(c.Res.prefab.item.jxItem,function(i){if(e==s.VIPBOXTYPE.DAYBOX){var n=t.recycle.length;t.recycle.forEach(function(t,e){var r=o.assetImpl.addGChild(i);r.node.parent=e+1<n/2?o.jxLayer:o.jxLayer2;var a=new l.default(t);r.setView(a,s.ITEM_DETAIL_FLAG.BAG|s.ITEM_DETAIL_FLAG.NUMPOS_ITEM_BC|s.ITEM_DETAIL_FLAG.NOT_TOUCH|s.ITEM_DETAIL_FLAG.SHOWLIGHT|s.ITEM_DETAIL_FLAG.LIGHT)})}else{var r=t.recycleUp.length;t.recycleUp.forEach(function(t,e){var n=o.assetImpl.addGChild(i);n.node.parent=e+1<r/2?o.jxLayer:o.jxLayer2;var a=new l.default(t);n.setView(a,s.ITEM_DETAIL_FLAG.BAG|s.ITEM_DETAIL_FLAG.NUMPOS_ITEM_BC|s.ITEM_DETAIL_FLAG.NOT_TOUCH|s.ITEM_DETAIL_FLAG.SHOWLIGHT|s.ITEM_DETAIL_FLAG.LIGHT)})}})},e.prototype.initBox=function(t){var e=this,o=t.star3.length;this.assetImpl.prefab(c.Res.prefab.item.jxItem,function(i){t.star3.forEach(function(t,n){var r=e.assetImpl.addGChild(i);r.node.parent=n+1<o/2?e.jxLayer:e.jxLayer2;var a=new l.default(t);r.setView(a,s.ITEM_DETAIL_FLAG.BAG|s.ITEM_DETAIL_FLAG.NUMPOS_ITEM_BC|s.ITEM_DETAIL_FLAG.NOT_TOUCH|s.ITEM_DETAIL_FLAG.SHOWLIGHT|s.ITEM_DETAIL_FLAG.LIGHT)})})},e.prototype.initOfficeBox=function(t){var e=this;this.assetImpl.prefab(c.Res.prefab.item.jxItem,function(o){var i=t.award.length;t.award.forEach(function(t,n){var r=e.assetImpl.addGChild(o);r.node.parent=n+1<i/2?e.jxLayer:e.jxLayer2;var a=new l.default(t);r.setView(a,s.ITEM_DETAIL_FLAG.BAG|s.ITEM_DETAIL_FLAG.NUMPOS_ITEM_BC|s.ITEM_DETAIL_FLAG.NOT_TOUCH|s.ITEM_DETAIL_FLAG.SHOWLIGHT|s.ITEM_DETAIL_FLAG.LIGHT)})})},e.prototype.close=function(){this.onClose()},r([p({type:cc.Node,tooltip:"\u5956\u52b1\u9884\u89c8"})],e.prototype,"jxLayer",void 0),r([p({type:cc.Node,tooltip:"\u5956\u52b1\u9884\u89c8"})],e.prototype,"jxLayer2",void 0),r([h,d("View/Common/PreviewCtrl")],e)}(a.default);o.default=f,cc._RF.pop()},{"../../../Core/GView/GViewBase":"GViewBase","../../Common/Define":"Define","../../Common/UIResources":"UIResources","../../Data/RunTime/RunRaw/RJXItem":"RJXItem"}],PropertyItem:[function(t,e,o){"use strict";cc._RF.push(e,"23638h6z8pE+77Bp2l1p85c","PropertyItem");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GView/GChild"),s=cc._decorator,c=s.ccclass,l=s.menu,u=(s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),r([c,l("View/Home/PropertyItem")],e)}(a.default));o.default=u,cc._RF.pop()},{"../../../Core/GView/GChild":"GChild"}],RBagData:[function(t,e,o){"use strict";cc._RF.push(e,"3f213aBUhVKeL+oeGNVuJWN","RBagData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/CoreDefine"),s=t("../../../Core/FrameEx/ES5Ex"),c=t("../../../Core/Manager/DataPool"),l=t("../../Common/Define"),u=t("../../Common/UI"),h=t("../../Logic/GameMgr"),p=t("./../../../conventions/JXCommon"),d=t("./../../../Core/CoreDefine"),f=t("./../../../Core/GCtrl"),g=t("./../../Common/Define"),_=t("./RunRaw/RItemAttach"),m=t("./RunRaw/RJXItem"),y=cc._decorator.ccclass,v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._equipData=null,e._itemData=new s.MapWrap,e}return n(e,t),e.prototype.onInit=function(){this.initEvent(),this._equipData=new s.MapWrap,this._itemData=new s.MapWrap,this.initData()},e.prototype.initData=function(){var t=this;h.default.lOwnEquips.getAllEquips().map(function(e){var o=e[0],i=new _.REquireItem(e);t._equipData.set(o,i)});var e=h.default.lOwnItems.getAllItems(),o=function(t){if(Object.prototype.hasOwnProperty.call(e,t)){var o=[];e[t].forEach(function(t){var e=new m.default(t);o.push(e)}),i._itemData.set(t,o)}},i=this;for(var n in e)o(n);if(h.default.lOwnItems.isFrist){var r=h.default.systemConfig.value(p.JXDef.SYS_CONFIG_KEY.basicGold),a=h.default.systemConfig.value(p.JXDef.SYS_CONFIG_KEY.basicGem),s=h.default.systemConfig.value(p.JXDef.SYS_CONFIG_KEY.basicWheat);this.getOrUseItem(new m.default([g.CURRENCY.YUSHI,l.ITEM_TYPE.CURRENCY,a])),this.getOrUseItem(new m.default([g.CURRENCY.GOLD,l.ITEM_TYPE.CURRENCY,r])),this.getOrUseItem(new m.default([g.CURRENCY.WHEAT,l.ITEM_TYPE.CURRENCY,s])),this.saveItem(),h.default.lOwnItems.isFrist=!1}},e.prototype.initEvent=function(){f.GCtrl.ES.on(l.CMsg.client.equip.onEquipPutOn,this,this.onPutOnEquip.bind(this),d.PRIORITY_DATA),f.GCtrl.ES.on(l.CMsg.client.equip.onEquipPutOff,this,this.onPutOffEquip.bind(this),d.PRIORITY_DATA),f.GCtrl.ES.on(l.CMsg.client.equip.onAddEquipSlv,this,this.onAddEquipSlv.bind(this),d.PRIORITY_DATA),f.GCtrl.ES.on(l.CMsg.client.bag.onBagItemChange,this,this.onBagItemChange.bind(this),d.PRIORITY_DATA),f.GCtrl.ES.on(l.CMsg.client.equip.ondelEquip,this,this.delEquip.bind(this),d.PRIORITY_DATA),f.GCtrl.ES.on(l.CMsg.client.equip.AddSynthesisEquip,this,this.AddSynthesisEquip.bind(this),d.PRIORITY_DATA)},e.prototype.getMegreItems=function(t,e){var o,i;if("number"==typeof t?"number"==typeof e&&(o=this.getItems(t,e),i=new m.default([t,e,0])):(o=this.getItems(t.id,t.type),i=e&&e instanceof m.default?e:new m.default([t.id,t.type,0])),!o)return i;i.num=0;for(var n=0;n<o.length;n++)i.num+=o[n].num;return i},e.prototype.getItems=function(t,e){var o=g.KF.genItemKey(t,e);return this._itemData.get(o)||[]},Object.defineProperty(e.prototype,"itemData",{get:function(){return this._itemData},enumerable:!1,configurable:!0}),e.prototype.saveItem=function(){h.default.lOwnItems.save(this._itemData)},e.prototype.onBagItemChange=function(t,e){var o=this;"number"!=typeof e[0]?(e.forEach(function(t){var e=t[g.PART_GOODS.id];switch(t[g.PART_GOODS.type]){case l.ITEM_TYPE.HERO:f.GCtrl.ES.emit(l.CMsg.client.hero.onAddHero,e);break;case l.ITEM_TYPE.EQUIPDATA:o.addEquip(t);break;case l.ITEM_TYPE.PROP:case l.ITEM_TYPE.CURRENCY:o.getOrUseItem(new m.default(t))}}),this.saveEquip(),this.saveItem()):cc.error("\u7269\u54c1\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u786e\u5b9a\u4e1a\u52a1\u903b\u8f91")},e.prototype.getOrUseItem=function(t,e,o){var i,n=(i="number"==typeof t?new m.default([t,e,o]):t).num,r=g.KF.genItemKey(i.id,i.type),a=this._itemData.get(r);if(a||(a=[],this._itemData.set(r,a)),n>0){if(0==a.length){var s=new m.default([i.id,i.type,0]);this.addItem(s)}for(;n>0;){var c=(h=a[a.length-1]).maxPile-(p=h.num);if(c>=n)h.num+=n,n=0;else{h.num+=c,n=0;var u=new m.default([t,e,0]);this.addItem(u)}}}else if(n<0)for(;n<0;){if(0==a.length){cc.warn("\u7269\u54c1\u6d88\u8017\u4e0d\u6b63\u786e\uff0c\u4e0d\u5b58\u5728\u8be5\u7269\u54c1");break}var h,p;(p=(h=a[a.length-1]).num)<=-n?(n+=p,this.removeItem(h)):(h.num+=n,n=0)}i.type===l.ITEM_TYPE.CURRENCY&&f.GCtrl.ES.emit(l.CMsg.client.bag.onCurrencyChange)},e.prototype.addItem=function(t,e,o){var i;i="number"==typeof t?new m.default([t,e,o]):t;var n=this._itemData.get(i.key);n||(n=[]),n.push(i),this._itemData.set(i.key,n)},e.prototype.removeItem=function(t){t.num=a.INVALID_VALUE;var e=this._itemData.get(t.key),o=e.indexOf(t);o!=a.INVALID_VALUE&&(e.splice(o,1),0==e.length&&this._itemData.delete(t.key))},e.prototype.saveEquip=function(){h.default.lOwnEquips.save(this._equipData)},e.prototype.setIsFirstExp=function(t){var e=this.getEquipDataById(t);e&&(e.isFirstExp=!0,this._equipData.set(t,e),this.saveEquip())},e.prototype.getEquipDataById=function(t){var e=this._equipData.get(t);if(e)return e;cc.warn("can't find equip by id"+t)},e.prototype.getAllEquips=function(){return this._equipData.values()},e.prototype.getHeroEquip=function(t){for(var e=this.getAllEquips(),o=new Array,i=new Array,n=0;n<e.length;n++)for(var r=0;r<e[n].itemData.raw.target.length;r++)e[n].itemData.raw.target[r]==t&&o.push(e[n].insId),0==e[n].itemData.raw.target[r]&&i.push(e[n].insId);return{equip:o,book:i}},e.prototype.getAllBook=function(t){void 0===t&&(t=!0);var e=this.getAllEquips(),o=[],i=[];if(e.forEach(function(t){h.default.equipData.getRaw(t.equipId).job==l.SQUAD_BUTTON.ALL&&o.push(t)}),o.length>0){var n=h.default.rHeroData.getHaveHeros(l.SQUAD_BUTTON.ALL);t&&n.have.forEach(function(t){t.equips.length>0&&t.equips.forEach(function(t){o.forEach(function(e,i){t==e.insId&&o.splice(i,1)})})}),o.forEach(function(t){i.push(t.insId)})}return i},e.prototype.getOwnerAllEquip=function(t){for(var e=this.getAllEquips(),o=new Array,i=0;i<e.length;i++)for(var n=h.default.equipData.getRaw(e[i].equipId),r=0;r<e[i].itemData.raw.target.length;r++)(n&&e[i].itemData.raw.target[r]==t||n&&0==e[i].itemData.raw.target[r])&&o.push(e[i].insId);return o},e.prototype.addEquip=function(t){for(var e=t[g.PART_ITEM.ID],o=0;o<t[g.PART_ITEM.NUM];o++){var i=p.generateUid(6),n=new _.REquireItem([i,e,0,a.INVALID_VALUE]);this._equipData.set(i,n)}},e.prototype.AddSynthesisEquip=function(t,e){for(var o=e.id,i=null,n=null,r=0;r<e.num;r++)i=p.generateUid(6),n=new _.REquireItem([i,o,e.slv,a.INVALID_VALUE]),this._equipData.set(i,n);h.default.jumpToMgr.jumpGoTo(u.VIEW_ID.strengthenView,n,l.BLESSEND_INFO.synthesis)},e.prototype.delEquip=function(t,e){this._equipData.delete(e),this.saveEquip()},e.prototype.onPutOnEquip=function(t,e){var o=e.get(),i=this._equipData.get(o.equipId);i&&(i.wear=o.heroId,this._equipData.set(o.equipId,i))},e.prototype.onPutOffEquip=function(t,e){var o=e.get(),i=this._equipData.get(o.equipId);i&&(i.wear=null,this._equipData.set(o.equipId,i))},e.prototype.onAddEquipSlv=function(t,e){var o=e.get(),i=this.getEquipDataById(o.equipId);i&&(i.sLv+=o.exp,this._equipData.set(o.equipId,i),this.saveEquip(),i.updateProp())},e.prototype.onNextEquip=function(t,e){var o=e.get(),i=this.getEquipDataById(o.equipId);if(i)return new s.MapWrap,i.nextUpdateProp()},e.prototype.ontopEquip=function(t,e){var o=e.get(),i=this.getEquipDataById(o.equipId);if(i)return new s.MapWrap,i.topUpdateProp()},r([y],e)}(c.GRunTime);o.default=v,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/FrameEx/ES5Ex":"ES5Ex","../../../Core/Manager/DataPool":"DataPool","../../Common/Define":"Define","../../Common/UI":"UI","../../Logic/GameMgr":"GameMgr","./../../../Core/CoreDefine":"CoreDefine","./../../../Core/GCtrl":"GCtrl","./../../../conventions/JXCommon":"JXCommon","./../../Common/Define":"Define","./RunRaw/RItemAttach":"RItemAttach","./RunRaw/RJXItem":"RJXItem"}],RHeroData:[function(t,e,o){"use strict";cc._RF.push(e,"c1c83bDpx9IYYNOH8gZhfNo","RHeroData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.RHeroData=void 0;var a=t("../../../conventions/JXCommon"),s=t("../../../Core/CoreDefine"),c=t("../../../Core/FrameEx/ES5Ex"),l=t("../../../Core/Manager/DataPool"),u=t("../../../Core/Math/MathEx"),h=t("../../Common/Define"),p=t("../../Common/Zh"),d=t("../../Logic/GameMgr"),f=t("../../Views/JXBattle/JXBattleUtility"),g=t("./../../../Core/CoreDefine"),_=t("./../../../Core/GCtrl"),m=t("./../../Common/Define"),y=cc._decorator.ccclass,v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._heroDatas=new c.MapWrap,e._heroEqData=new c.MapWrap,e._heroIdsInBattle=[],e._tryHeroData=null,e._openBook=!1,e}return n(e,t),Object.defineProperty(e.prototype,"heroDatas",{get:function(){return this._heroDatas},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"heroIdsInBattle",{get:function(){return this._heroIdsInBattle},set:function(t){this._heroIdsInBattle=t,d.default.lUserData.heroInBattle=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tryHeroData",{get:function(){return this._tryHeroData},set:function(t){this._tryHeroData=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"openBook",{get:function(){return this._openBook},set:function(t){this._openBook=t},enumerable:!1,configurable:!0}),e.prototype.onInit=function(){var t;this.insIdGentor=new f.JXIdGenerater("Hero"),this._heroIdsInBattle=[],(t=this._heroIdsInBattle).push.apply(t,d.default.lUserData.heroInBattle),this.initEvent(),this.inAllHeroData()},e.prototype.save=function(){d.default.lHeroData.save(this.heroDatas)},e.prototype.checkInNoHero=function(){for(var t=!0,e=0;e<this.heroIdsInBattle.length;e++)if(this._heroIdsInBattle[e]!=g.INVALID_VALUE){t=!1;break}return t},e.prototype.checkBattleTeamisFull=function(){for(var t=!0,e=0;e<this.heroIdsInBattle.length;e++)if(this._heroIdsInBattle[e]===g.INVALID_VALUE){t=!1;break}return t},e.prototype.createRespWithRealData=function(t){var e=this,o={};if(t){for(var i=[],n=[],r=0;r<t.monsterTeam.length;r++){for(var a=t.monsterTeam[r],c=[],l=0;l<a.length;l++){var p=a[l],f=[],_=[];if(p!=g.INVALID_VALUE)for(var m=d.default.npcTeamData.getRaw(p),y=0;y<m.team.length;y++){var v=m.team[y],C=d.default.unitData.getRaw(v),I=null;C&&(I=this.createHeroData(C.unitId)),I?(I.unitId=v,I.heroId=this.insIdGentor.getNewId(),I.propts=s.OBJECT_COPY(C.alter),f.push(I.heroId)):f.push("-1"),_.push(I)}c.push(f),i.push.apply(i,_)}n.push(c)}o.atker=this.getMonInfo(i),o.atker.ext=n;var E=[];if(this._heroIdsInBattle.forEach(function(t){var o=e._heroDatas.get(t);E.push(o)}),this._tryHeroData){var S=d.default.heroData.getRaw(this._tryHeroData.heroId),R=this.createHeroData(this._tryHeroData.heroId),D=R;D.exp=0,D.skillIds=S.skill,D.star=5,D.trait=5,D.propts.map(function(t,o){o<=h.PART_PROPTS.XueLiang&&(D.propts[o]=R.propts[o]*(e._tryHeroData.up+1))});var b=E.indexOf(null);if(b!=g.INVALID_VALUE)E[b]=D;else{var w=u.default.random(0,E.length-1);E[w]=D}this._tryHeroData=null}return o.defer=this.getMonInfo(E),o}cc.error("\u5173\u5361\u6570\u636e\u4e0d\u5b58\u5728")},e.prototype.getMonInfo=function(t){var e=this,o={heroIds:[],tableIds:[],partnerData:[]};return t.forEach(function(t){var i;if(i=t&&t.heroId?t.heroId:e.insIdGentor.getNewId(),o.heroIds.push(t?i:"-1"),o.tableIds.push(t?t.tableId:g.INVALID_VALUE),t){var n=s.OBJECT_COPY(t);n.heroId=i,n.curHp=t.propts[h.PART_PROPTS.XueLiang],n.maxHp=t.propts[h.PART_PROPTS.XueLiang],o.partnerData.push(n)}}),o},e.prototype.createHeroData=function(t,e){var o;return(o="number"==typeof t?d.default.heroData.getRaw(t):t)?{tableId:o.id,propts:o.property,extendPropts:[],equips:[],skillIds:o.skill,suitBuffIds:[],lv:1,camp:o.type,nickName:e||o.name,trait:o.trait}:null},e.prototype.inAllHeroData=function(){var t=this,e=s.OBJECT_COPY(d.default.lHeroData.getAllHeros());if(e.length){var o={exp:0,tableId:0,lv:1,propts:[],equips:[],skillIds:[],suitBuffIds:[],camp:1,trait:1,star:1};e.forEach(function(e){for(var i in t._heroDatas.set(e.tableId,e),o)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=o[i]);t.updateHeroProp(e)})}d.default.heroData.getHeroTrue().forEach(function(e){e.unlock||t._heroDatas.has(e.id)||t.addHero(e)}),this.save()},e.prototype.initEvent=function(){_.GCtrl.ES.on(m.CMsg.client.equip.onEquipPutOn,this,this.onEquipPutOn.bind(this),g.PRIORITY_DATA),_.GCtrl.ES.on(m.CMsg.client.equip.onEquipPutOff,this,this.onEquipPutOff.bind(this),g.PRIORITY_DATA),_.GCtrl.ES.on(m.CMsg.client.hero.onAddHero,this,this.onAddHero.bind(this),g.PRIORITY_DATA),_.GCtrl.ES.on(m.CMsg.client.hero.onHeroAddExp,this,this.onAddExp.bind(this),g.PRIORITY_DATA),_.GCtrl.ES.on(m.CMsg.client.hero.onSetSkill,this,this.setSkill.bind(this),g.PRIORITY_DATA),_.GCtrl.ES.on(m.CMsg.client.hero.onHeroAddStar,this,this.onHeroAddStar.bind(this),g.PRIORITY_DATA),_.GCtrl.ES.on(m.CMsg.client.hero.onHeroLvUp,this,this.onHeroUpLv.bind(this),g.PRIORITY_DATA),_.GCtrl.ES.on(m.CMsg.client.hero.onHeroBreach,this,this.onHeroBreach.bind(this),g.PRIORITY_DATA),_.GCtrl.ES.on(m.CMsg.client.hero.onAddSuit,this,this.suitBuff.bind(this),g.PRIORITY_DATA),_.GCtrl.ES.on(m.CMsg.client.hero.onGetHeroZhangLi,this,this.onGetHeroZhangLi.bind(this),g.PRIORITY_DATA)},e.prototype.onPropChange=function(t){var e=d.default.heroData.getRaw(t.tableId),o=d.default.lvData.getRaw(t.lv),i=d.default.starLvData.getRaw(t.star),n=c.NewFillArray(10,s.INVALID_VALUE_ZERO);t.propts=s.OBJECT_COPY(e.property),d.default.lUserData.getHeroBuff(t.tableId).forEach(function(t){e.property[t[h.HEROBUFF.index]]+=t[h.HEROBUFF.num]});var r=0,a=new Array,l=new Array;t.suitBuffIds.forEach(function(e,o){a=[];var i=d.default.suitData.getRaw(e);r=0,n=c.NewFillArray(10,s.INVALID_VALUE_ZERO),i.suit.forEach(function(e){t.equips.forEach(function(t,o){if("-1"!=t&&t){var i=d.default.RBagData.getEquipDataById(t);if(!i)return;e==i.equipId&&(o>=3?a.length>0?a.forEach(function(t){t!=i.equipId&&(r++,a.push(i.equipId))}):(r++,a.push(i.equipId)):r++)}})}),r>0?l.push(r):t.suitBuffIds.splice(o,1),o==t.suitBuffIds.length-1&&l.forEach(function(t,e){var o=d.default.suitData.getRaw(e+1);if(o){if(t>=h.EQUIP_PART.WUQI+1)for(var i=0;i<o.up2.length;i++)n[i]+=o.up2[i];if(t>=h.EQUIP_PART.HEAD+1)for(i=0;i<o.up3.length;i++)n[i]+=o.up3[i];if(t>=h.EQUIP_PART.BINGSHU1+1)for(i=0;i<o.up4.length;i++)n[i]+=o.up4[i];if(t>=h.EQUIP_PART.BINGSHU2+1)for(i=0;i<o.up5.length;i++)n[i]+=o.up5[i];if(t>=h.EQUIP_PART.BINGSHU3)for(i=0;i<o.allUp.length;i++)n[i]+=o.allUp[i]}})}),d.default.lUserData.vipLv>=1&&1001==t.tableId&&(e.property[0]+=500);for(var u=0;u<t.propts.length;u++)t.propts[u]=e.property[u]+e.growValue[u]*(1+o.grow+i.grow)+n[u]},e.prototype.onEquipChange=function(t){for(var e=this._heroEqData.get(t.tableId),o=0;o<t.propts.length;o++)for(var i=0;i<e.length;i++)e[i]&&(t.propts[o]+=e[i].propts.get(o))},e.prototype.onAddHero=function(t,e){this.addHero(e)},e.prototype.onAddExp=function(t,e){var o=e.get(),i=this._heroDatas.get(o.heroId);i?(i.exp+=o.exp,this._heroDatas.set(i.tableId,i),this.save()):cc.error("\u82f1\u96c4\u6dfb\u52a0\u7ecf\u9a8c\u5931\u8d25\uff1a\u82f1\u96c4\u4e0d\u5b58\u5728")},e.prototype.setSkill=function(t,e){var o=e.get(),i=this._heroDatas.get(o.heroId);i?(i.skillIds=o.skill,this.save()):cc.error("\u82f1\u96c4\u6dfb\u52a0\u7ecf\u9a8c\u5931\u8d25\uff1a\u82f1\u96c4\u4e0d\u5b58\u5728")},e.prototype.suitBuff=function(t,e){var o=e.get(),i=this._heroDatas.get(o.IHeroData.tableId);if(i){var n=i.suitBuffIds;if(n.length>0){var r=!1;i.suitBuffIds.forEach(function(t){o.suit&&(t==o.suit.id&&(r=!0),r||n.push(o.suit.id))})}else o.suit&&n.push(o.suit.id);i.suitBuffIds=n,this.save()}else cc.error("\u82f1\u96c4\u6dfb\u52a0\u5957\u88c5buff\u5931\u8d25\uff1a\u82f1\u96c4\u4e0d\u5b58\u5728")},e.prototype.onHeroAddStar=function(t,e){var o=this._heroDatas.get(e);o?(o.star++,this.updateHeroProp(o),this.heroDatas.set(o.tableId,o),this.save()):cc.error("\u82f1\u96c4\u5347\u661f\u5931\u8d25\uff1a\u82f1\u96c4\u4e0d\u5b58\u5728")},e.prototype.onHeroUpLv=function(t,e){var o=this._heroDatas.get(e);o?(o.lv++,this.updateHeroProp(o),this.heroDatas.set(o.tableId,o),this.save()):cc.error("\u82f1\u96c4\u5347\u7ea7\u5931\u8d25\uff1a\u82f1\u96c4\u4e0d\u5b58\u5728")},e.prototype.onHeroBreach=function(t,e){var o=this._heroDatas.get(e);o?(o.trait++,this.updateHeroProp(o),this.heroDatas.set(o.tableId,o),this.save()):cc.error("\u82f1\u96c4\u5347\u7ea7\u5931\u8d25\uff1a\u82f1\u96c4\u4e0d\u5b58\u5728")},e.prototype.addHero=function(t,e){void 0===e&&(e=!0);var o;if(!(o="number"==typeof t?d.default.heroData.getRaw(t):t))return null;if(this.hasOwnHero(o.id)){var i=null;return d.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.heroresolve).forEach(function(t){t[h.HEROCHIPINFO.HEROID]==o.id&&(i=t[h.HEROCHIPINFO.HEROCHIPNUM],_.GCtrl.ES.emit(m.CMsg.client.bag.onBagItemChange,[[o.id,h.ITEM_TYPE.PROP,i]]))}),null}var n=d.default.lUserData.heroNames(o.id);d.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.FeatureCtrl,{msg:p.JXLocales.tower.hero+n});var r={exp:0,tableId:o.id,propts:o.property,equips:[],skillIds:[],suitBuffIds:[],lv:d.default.lvData.getLvMinByTrait(o.trait),camp:o.type,trait:o.trait,star:o.birthStar};return r.skillIds=d.default.skillData.getHeroUseSkill(r.tableId,r.lv),e&&(this._heroDatas.set(r.tableId,r),this.updateHeroProp(r),this.save()),r},e.prototype.setHero=function(t){this._heroDatas.get(t.tableId)&&(this._heroDatas.set(t.tableId,t),this.save())},e.prototype.hasOwnHero=function(t){return this._heroDatas.has(t)},e.prototype.checkHeroIsInBattle=function(t){return this._heroIdsInBattle.indexOf(t)!=g.INVALID_VALUE},e.prototype.getHeroInBattle=function(){return this._heroIdsInBattle},e.prototype.getHero=function(t){var e=this._heroDatas.get(t);return s.OBJECT_COPY(e)},e.prototype.getAllHeros=function(){return this._heroDatas},e.prototype.getHaveHeros=function(t){var e=this;if(0!=t)var o=d.default.heroData.getHeroByType(t);else o=d.default.heroData.getHeroTrue();var i=[],n=[];return o.forEach(function(t){e._heroDatas.has(t.id)?i.push(e.heroDatas.get(t.id)):n.push(t)}),{have:i,notHave:n}},e.prototype.getAllHerosNum=function(){var t=d.default.rHeroData.getHaveHeros(h.SQUAD_BUTTON.ALL);return t.have.length+t.notHave.length},e.prototype.getHaveHerosPower=function(){var t=d.default.rHeroData.getHaveHeros(0).have,e=0;return t.forEach(function(t){e+=a.JXMath.getZhanli(t.propts)}),Math.floor(e)},e.prototype.curHeroTypeMaxLv=function(t){var e=this,o=1;return d.default.heroData.getHeroByType(t).forEach(function(t){e._heroDatas.forEach(function(i){e._heroDatas.has(t.id)&&i.tableId==t.id&&o<i.lv&&(o=i.lv)})}),o},e.prototype.onEquipPutOff=function(t,e){var o=e.get(),i=this.heroDatas.get(o.heroId);i.equips[o.site]="-1",this.heroDatas.set(o.heroId,i),this.updateHeroProp(i),this.save()},e.prototype.onEquipPutOn=function(t,e){var o=e.get(),i=this.heroDatas.get(o.heroId);i.equips[o.site]=o.equipId,this.heroDatas.set(o.heroId,i),this.updateHeroProp(i),this.save()},e.prototype.onGetHeroZhangLi=function(t,e){var o=e.get(),i=this.heroDatas.get(o.heroId);this.updateHeroProp(i),this.save()},e.prototype.updateHeroProp=function(t){t.equips.length||this._heroEqData.set(t.tableId,[]);for(var e=0;e<t.equips.length;e++){var o=this._heroEqData.get(t.tableId);if(o||(o=[]),t.equips[e]&&"-1"!=t.equips[e]){var i=d.default.RBagData.getEquipDataById(t.equips[e]);o[e]=i}else o[e]=null;this._heroEqData.set(t.tableId,o)}this.onPropChange(t),this.onEquipChange(t)},r([y],e)}(l.GRunTime);o.RHeroData=v,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/FrameEx/ES5Ex":"ES5Ex","../../../Core/Manager/DataPool":"DataPool","../../../Core/Math/MathEx":"MathEx","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/Zh":"Zh","../../Logic/GameMgr":"GameMgr","../../Views/JXBattle/JXBattleUtility":"JXBattleUtility","./../../../Core/CoreDefine":"CoreDefine","./../../../Core/GCtrl":"GCtrl","./../../Common/Define":"Define"}],RItemAttach:[function(t,e,o){"use strict";cc._RF.push(e,"77be3tL+VtH/ZomN53nfucC","RItemAttach");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.REquireItem=void 0;var r=t("../../../../conventions/JXCommon"),a=t("../../../../Core/CoreDefine"),s=t("../../../../Core/FrameEx/ES5Ex"),c=t("../../../Logic/GameMgr"),l=t("./../../../Common/Define"),u=t("./RJXItem"),h=function(t){function e(e,o){var i=t.call(this)||this;return i.isFirstExp=!1,i.wear=a.INVALID_VALUE,i.propts=new s.MapWrap,i.updateData(e,o),i}return n(e,t),e.prototype.updateData=function(t,e){this.insId=t[l.PART_EQUIP.INS_ID],this.equipId=t[l.PART_EQUIP.TPLT_ID],this.sLv=t[l.PART_EQUIP.SLV],this.wear=t[l.PART_EQUIP.WEAR]?t[l.PART_EQUIP.WEAR]:-1,t[l.PART_EQUIP.ISFIRSTEXP]>-2||1!=t[l.PART_EQUIP.ISFIRSTEXP]?this.isFirstExp=!1:this.isFirstExp=t[l.PART_EQUIP.ISFIRSTEXP];var o=c.default.equipData.getRaw(this.equipId);o&&(this.quality=o.trait,this.itemData=e||new u.default([this.equipId,l.ITEM_TYPE.EQUIPDATA,1,this]),this.updateProp())},e.prototype.updateProp=function(){this.propts.clear();for(var t=0;t<this.itemData.raw.property.length;t++){var e=this.itemData.raw;this.propts.set(t,e.property[t]+c.default.itemMgr.getEquipLvUpGrowArgs(e.growPropty[t],this.sLv))}},e.prototype.nextUpdateProp=function(){for(var t=new s.MapWrap,e=0;e<this.itemData.raw.property.length;e++){var o=this.itemData.raw,i=this.sLv+1;t.set(e,o.property[e]+c.default.itemMgr.getEquipLvUpGrowArgs(o.growPropty[e],i))}return t},e.prototype.topUpdateProp=function(){for(var t=new s.MapWrap,e=0;e<this.itemData.raw.property.length;e++){var o=this.itemData.raw,i=this.sLv-1;t.set(e,o.property[e]+c.default.itemMgr.getEquipLvUpGrowArgs(o.growPropty[e],i))}return t},e.prototype.getZhanli=function(){var t=this.propts.values();return r.JXMath.getZhanli(t)},e}(s.ObjectWrap);o.REquireItem=h,cc._RF.pop()},{"../../../../Core/CoreDefine":"CoreDefine","../../../../Core/FrameEx/ES5Ex":"ES5Ex","../../../../conventions/JXCommon":"JXCommon","../../../Logic/GameMgr":"GameMgr","./../../../Common/Define":"Define","./RJXItem":"RJXItem"}],RJXItem:[function(t,e,o){"use strict";cc._RF.push(e,"5a14ajzRR5L2JNrjrs8/A9k","RJXItem");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var r=t("../../../../Core/FrameEx/ES5Ex"),a=t("../../../Common/Define"),s=t("../../../Logic/GameMgr"),c=t("./../../../Common/Define"),l=t("./RItemAttach"),u=function(t){function e(e){var o=t.call(this)||this;return o.id=null,o.type=null,o.num=null,o.key=null,e&&o.init.apply(o,e),o}return n(e,t),Object.defineProperty(e.prototype,"icon",{get:function(){return"icon_"+this.raw.icon},enumerable:!1,configurable:!0}),e.tpl=function(){for(var t,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];return this._tpl||(this._tpl=new e),o&&0!=o.length?((t=this._tpl).init.apply(t,o),this._tpl):this._tpl},Object.defineProperty(e.prototype,"name",{get:function(){if(this.raw)return this.raw.name;console.log("can't find item:",this.id,this.type)},enumerable:!1,configurable:!0}),e.prototype.instantiate=function(t){switch(this.type){case a.ITEM_TYPE.EQUIPDATA:if(!t)return;if(t instanceof l.REquireItem)return void(this.attach=t);this.attach=new l.REquireItem(t,this)}},Object.defineProperty(e.prototype,"maxPile",{get:function(){return this.raw&&this.raw.maxPile?this.raw.maxPile:1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){switch(this.type){case a.ITEM_TYPE.EQUIPDATA:case a.ITEM_TYPE.HERO:case a.ITEM_TYPE.PROP:return this.attach?this.attach.quality:this.raw.trait;default:return this.raw.quality}},enumerable:!1,configurable:!0}),e.prototype.init=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.id=t[a.PART_ITEM.ID],this.type=t[a.PART_ITEM.TYPE],this.num=t[a.PART_ITEM.NUM],this.key=c.KF.genItemKey(this.id,this.type),this.parseItem(),this.instantiate(t[3]),this},e.prototype.changeNum=function(t){this.num+=t},e.prototype.parseItem=function(){switch(this.type){case a.ITEM_TYPE.HERO:break;case a.ITEM_TYPE.EQUIPDATA:this.raw=s.default.equipData.getRaw(this.id);break;case a.ITEM_TYPE.CURRENCY:case a.ITEM_TYPE.PROP:this.raw=s.default.itemData.getRaw(this.id)}},e}(r.ObjectWrap);o.default=u,cc._RF.pop()},{"../../../../Core/FrameEx/ES5Ex":"ES5Ex","../../../Common/Define":"Define","../../../Logic/GameMgr":"GameMgr","./../../../Common/Define":"Define","./RItemAttach":"RItemAttach"}],RUserData:[function(t,e,o){"use strict";cc._RF.push(e,"c3676qybKpJeoPR4UHThrcD","RUserData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.RUserData=void 0;var a=t("../../../Core/CoreDefine"),s=t("../../../Core/GCtrl"),c=t("../../../Core/Manager/DataPool"),l=t("../../Common/Define"),u=t("../../Logic/GameMgr"),h=cc._decorator.ccclass,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._officerLv=a.INVALID_VALUE,e}return n(e,t),e.prototype.onInit=function(){this.initEvent()},e.prototype.initEvent=function(){s.GCtrl.ES.on(l.CMsg.client.bag.onBagItemChange,this,this.onBagItemChange.bind(this),a.PRIORITY_DATA),s.GCtrl.ES.on(l.CMsg.client.office.onGetAdReward,this,this.onCMSGGetAdReward.bind(this),a.PRIORITY_DATA),s.GCtrl.ES.on(l.CMsg.client.office.onGetReward,this,this.onCMSGGetReward.bind(this),a.PRIORITY_DATA)},e.prototype.onCMSGGetAdReward=function(t,e){var o=e.get(),i=u.default.lUserData.getOfficeStatus(o.id);i||cc.error("onCMSGGetAdReward is error"),i.adBox=l.OFFICERITEM.RECEICE,u.default.lUserData.setOfficeStatus(o.id,i)},e.prototype.onCMSGGetReward=function(t,e){var o=e.get(),i=u.default.lUserData.getOfficeStatus(o.id);i||cc.error("onCMSGGetReward is error"),i.box=l.OFFICERITEM.RECEICE,u.default.lUserData.setOfficeStatus(o.id,i)},e.prototype.onBagItemChange=function(){this._officerLv=u.default.lUserData.officerLv;var t=u.default.RBagData.getMegreItems(l.CURRENCY.FEATS,l.ITEM_TYPE.CURRENCY);if(this._officerLv<u.default.officerData.data.size-1){var e=u.default.lUserData.getOfficeStatus(this._officerLv+1);u.default.officerData.getRaw(this._officerLv+1).exp<=t.num&&(e.box=l.OFFICERITEM.LOCK,e.adBox=l.OFFICERITEM.LOCK,this._officerLv+=1,u.default.lUserData.officerLv=this._officerLv,u.default.lUserData.setOfficeStatus(this._officerLv,e))}},r([h],e)}(c.GRunTime);o.RUserData=p,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/GCtrl":"GCtrl","../../../Core/Manager/DataPool":"DataPool","../../Common/Define":"Define","../../Logic/GameMgr":"GameMgr"}],RankView:[function(t,e,o){"use strict";cc._RF.push(e,"845397Q8ztE0LcSO6N7JpB9","RankView");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GView/GViewBase"),s=t("../../Entity/ArmRoleScript"),c=t("../../Logic/GameMgr"),l=cc._decorator,u=l.ccclass,h=l.property,p=l.menu,d=(l.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.wxSubContextView=null,e.btnDianzan=null,e.tip=null,e.btnClickTime=0,e}return n(e,t),e.prototype.onLoad=function(){this.showRanks();var t=cc.sys.localStorage.getItem("zantime");t&&(this.btnClickTime=parseInt(t)),this.tip.string="",this.schedule(this.updateDate,1,cc.macro.REPEAT_FOREVER)},e.prototype.showRanks=function(){var t=c.default.rHeroData.getHaveHerosPower();if(console.log("my power = ",t),"undefined"!=typeof wx){var e=this;this.scheduleOnce(function(){console.log("wx.getSetting 0"),wx.getOpenDataContext().postMessage({message:"score",score:t}),e.updateDate()||cc.sys.platform==cc.sys.WECHAT_GAME&&wx.getOpenDataContext().postMessage({message:"dianzan"}),console.log("wx.getSetting"),wx.getSetting({success:function(t){t.authSetting["scope.userInfo"]?(console.log("wx.getSetting.\u5df2\u7ecf\u6388\u6743"),wx.getUserInfo({success:function(t){console.log("wx.getUserInfo",t.userInfo),wx.getOpenDataContext().postMessage({message:"shouquan",date:t.userInfo})}})):e.initUserInfoButton()}})},1)}},e.prototype.updateDate=function(){console.log("updatetime");var t=36e5-((new Date).getTime()-this.btnClickTime);return t<0?(this.btnDianzan.getComponent(cc.Button).interactable=!0,this.unschedule(this.updateDate),this.tip.string="",!0):(this.btnDianzan.getComponent(cc.Button).interactable=!1,this.tip.string=this.getTimeStr(t)+"\u540e\u5237\u65b0",!1)},e.prototype.btnZan=function(){var t=(new Date).getTime();t-this.btnClickTime<36e5||(this.btnClickTime=t,cc.sys.localStorage.setItem("zantime",t),this.schedule(this.updateDate,1,cc.macro.REPEAT_FOREVER),this.btnDianzan.getComponent(s.default).waitGet(null),cc.sys.platform==cc.sys.WECHAT_GAME&&wx.getOpenDataContext().postMessage({message:"dianzan"}))},e.prototype.getTimeStr=function(t,e){var o="";t<0&&(t=0),t/=1e3;var i=Math.floor(t/3600),n=Math.floor((t-3600*i)/60),r=Math.floor(t-3600*i-60*n);return e?n+=60*i:o=i>=10?o+i+":":o+"0"+i+":",o=n>=10?o+n+":":o+"0"+n+":",r>=10?o+=r:o=o+"0"+r,o},e.prototype.initUserInfoButton=function(){if("undefined"!=typeof wx){var t=wx.getSystemInfoSync(),e=t.windowWidth,o=t.windowHeight,i=wx.createUserInfoButton({type:"text",text:"",style:{left:0,top:0,width:e,height:o,lineHeight:40,backgroundColor:"#00000000",color:"#00000000",textAlign:"center",fontSize:10,borderRadius:4}});i.onTap(function(t){t.userInfo?(console.log("\u6388\u6743\u6210\u529f\uff01",t.userInfo),wx.getOpenDataContext().postMessage({message:"shouquan",date:t.userInfo})):console.log("\u6388\u6743\u5931\u8d25\uff01"),i.hide(),i.destroy()})}},r([h({type:cc.Node,tooltip:"\u4e3b\u57df\u89c6\u7a97\u5bb9\u5668"})],e.prototype,"wxSubContextView",void 0),r([h({type:cc.Node,tooltip:"\u70b9\u8d5e\u6309\u94ae"})],e.prototype,"btnDianzan",void 0),r([h({type:cc.Label,tooltip:"\u5012\u8ba1\u65f6\u65f6\u95f4"})],e.prototype,"tip",void 0),r([u,p("View/Tip/RankView")],e)}(a.default));o.default=d,cc._RF.pop()},{"../../../Core/GView/GViewBase":"GViewBase","../../Entity/ArmRoleScript":"ArmRoleScript","../../Logic/GameMgr":"GameMgr"}],RecruitCardCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"26053VbOhBO5IZ2OVesA7PY","RecruitCardCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GCtrl"),s=t("../../../Core/GView/GViewBase"),c=t("../../Common/Define"),l=t("../../Common/UIResources"),u=t("./RecuitCardItem"),h=cc._decorator,p=h.ccclass,d=h.property,f=h.menu,g=(h.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onceCard=null,e.tenCard=null,e.tenCardPos=null,e}return n(e,t),e.prototype.onGLoad=function(){},e.prototype.onGStart=function(t){var e=this;this.win.maskNode.opacity=215,1==t.recruitNum&&(this.onceCard.children.length>0?this.onceCard.getChildByName("RecuitCardItem").getComponent(u.default).init(0,t.award[0],t.cb):this.assetImpl.prefab(l.Res.prefab.vw.home.recuitCardItem,function(o){var i=e.assetImpl.addGChild(o);i.node.parent=e.onceCard,i.node.scale=1.3,i.init(0,t.award[0],t.cb),a.GCtrl.ES.emit(c.CMsg.client.home.onRecruit)})),10==t.recruitNum&&(this.tenCard.children.length>0||this.assetImpl.prefab(l.Res.prefab.vw.home.recuitCardItem,function(o){for(var i=0;i<t.recruitNum;i++){var n=e.assetImpl.addGChild(o);n.node.parent=e.tenCardPos.children[i],n.node.position.x=0,n.node.position.y=0,i==t.recruitNum-1?n.init(0,t.award[i],t.cb):n.init(0,t.award[i])}}))},r([d({type:cc.Node,tooltip:"\u62db\u52df\u5355\u5f20\u62bd\u5361"})],e.prototype,"onceCard",void 0),r([d({type:cc.Node,tooltip:"\u62db\u52df10\u5f20\u62bd\u5361"})],e.prototype,"tenCard",void 0),r([d({type:cc.Node,tooltip:"\u62db\u52df10\u5f20\u62bd\u5361\u4f4d\u79fb\u4f4d\u7f6e"})],e.prototype,"tenCardPos",void 0),r([p,f("View/Home/RecruitCardCtrl")],e)}(s.default));o.default=g,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../../Core/GView/GViewBase":"GViewBase","../../Common/Define":"Define","../../Common/UIResources":"UIResources","./RecuitCardItem":"RecuitCardItem"}],RecruitCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"87b18oRTO1FuIlb2Ap9GZYT","RecruitCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/GCtrl"),c=t("../../../Core/GView/GPage"),l=t("../../../Core/Math/MathEx"),u=t("../../Common/Define"),h=t("../../Common/Language"),p=t("../../Common/UI"),d=t("../../Common/Zh"),f=t("../../Data/RunTime/RunRaw/RJXItem"),g=t("../../Logic/GameMgr"),_=t("../../Logic/UserMgr"),m=cc._decorator,y=m.ccclass,v=m.property,C=m.menu,I=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.recruit=null,e.recruitProgress=null,e.recruiLight=null,e.rewardbox=null,e}return n(e,t),e.prototype.onGLoad=function(){this.initDialData()},e.prototype.initDialData=function(){g.default.lUserData.recruitCtrl>=g.default.addDialData.getRaw(g.default.lUserData.addDial).needNext?(this.recruiLight.active=!0,cc.tween(this.rewardbox).to(.5,{scaleX:1.2,scaleY:1.2}).to(.5,{scaleX:1,scaleY:1}).union().repeatForever().start(),g.default.redMgr.sendValueSettingMsg(u.RPointMask.RPM_Box_Receive,!0)):(cc.Tween.stopAllByTarget(this.rewardbox),this.recruiLight.active=!1),this.recruit.string=g.default.lUserData.recruitCtrl+"/"+g.default.addDialData.getRaw(g.default.lUserData.addDial).needNext,this.recruitProgress.fillRange=-g.default.lUserData.recruitCtrl/g.default.addDialData.getRaw(g.default.lUserData.addDial).needNext},e.prototype.onPageIn=function(){g.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.recruit,{msg:u.PointInfo.rcruit_enter})},e.prototype.onceRecruit=function(){var t=g.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.onceCard),e=new f.default([u.CURRENCY.GOLD,u.ITEM_TYPE.CURRENCY,t]),o=g.default.itemMgr.testCost(e,1,!0);o.enough?(s.GCtrl.ES.emit(u.CMsg.client.bag.onBagItemChange,[[u.CURRENCY.GOLD,u.ITEM_TYPE.CURRENCY,-t]]),this.luckDraw(1),g.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.recruit,{msg:u.PointInfo.recruit_click})):g.default.uiMgr.showToast(o.tip)},e.prototype.tenRecruit=function(){var t=this;g.default.sdkMgr.watchAd(function(){g.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.recruit,{msg:u.PointInfo.recruit_ad}),t.luckDraw(10)},function(){},"\u5341\u8fde\u62bd")},e.prototype.boxRecruit=function(){var t=g.default.lUserData.receiveId;g.default.lUserData.recruitCtrl>=g.default.addDialData.getRaw(g.default.lUserData.addDial).needNext?(g.default.jumpToMgr.jumpGoTo(p.VIEW_ID.rewardCtrl,[g.default.addDialData.getRaw(t).award]),g.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.recruit,{msg:h.L(d.JXLocales.tower.clickRecruit,g.default.addDialData.getRaw(t).needNext)}),g.default.lUserData.addDial++,this.initDialData(),g.default.lUserData.addDial>56&&(g.default.lUserData.addDial=1)):(this.recruiLight.active=!1,g.default.uiMgr.showToast("\u8fdb\u5ea6\u6761\u6ee1\u5373\u53ef\u5f00\u542f\u54e6"))},e.prototype.luckDraw=function(t){var e=this;void 0===t&&(t=1),_.default.ins().addDailyTaskState(5,t),g.default.lUserData.recruitCtrl=t;var o=null;o=g.default.callData.data.values();var i=[],n=[];o.forEach(function(t){var o={id:t.id,weight:t.weight,award:t.award};1029==t.award[0]?e.checkDiaocanGet()&&i.push(o):i.push(o)});for(var r=0;r<i.length;r++)for(var s=i[r].weight,c=0;c<s;c++)n.push(r);if(n=l.default.fisherYatesShuffle(n),1==t){var h=Math.floor(Math.random()*n.length),d=[];d.push(i[n[h]].award);var f={recruitNum:t,award:d,cb:function(){g.default.jumpToMgr.jumpGoTo(p.VIEW_ID.rewardCtrl,d,null,!0)}};g.default.jumpToMgr.jumpGoTo(p.VIEW_ID.recuitCardCtrl,f),i=[]}else if(10==t){var m=[],y=!1,v=g.default.rHeroData.getHaveHeros(u.SQUAD_BUTTON.ALL),C=v.have.length+v.notHave.length,I=this.checkGuanyuGet();for(r=0;r<t;r++)h=Math.floor(Math.random()*n.length),0==i[n[h]].award[1]&&(y=!0,I||(i[n[h]].award[0]=g.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.guideHero),I=!0)),m.push(i[n[h]].award);if(!y){m.splice(Math.floor(Math.random()*m.length),1);var E=parseInt(g.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.guideHero)),S=I?[1001+Math.floor(Math.random()*C),0,1]:[E,0,1];m.push(S)}f={recruitNum:t,award:m,cb:function(){g.default.jumpToMgr.jumpGoTo(p.VIEW_ID.rewardCtrl,m,u.REWARD.HERO),m=[]}},g.default.jumpToMgr.jumpGoTo(p.VIEW_ID.recuitCardCtrl,f),i=[]}this.initDialData()},e.prototype.checkGuanyuGet=function(){for(var t=g.default.rHeroData.getHaveHeros(u.SQUAD_BUTTON.ALL).have,e=0;e<t.length;e++)if(t[e].tableId==g.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.guideHero))return!0;return!1},e.prototype.checkDiaocanGet=function(){for(var t=g.default.rHeroData.getHaveHeros(u.SQUAD_BUTTON.ALL).have,e=0;e<t.length;e++)if(1029==t[e].tableId)return!0;return!1},r([v({type:cc.Label,tooltip:"\u62db\u52df\u6b21\u6570"})],e.prototype,"recruit",void 0),r([v({type:cc.Sprite,tooltip:"\u62db\u52df\u8fdb\u5ea6"})],e.prototype,"recruitProgress",void 0),r([v({type:cc.Node,tooltip:"\u62db\u52df\u5b9d\u7bb1\u5149"})],e.prototype,"recruiLight",void 0),r([v({type:cc.Node,tooltip:"\u5b9d\u7bb1"})],e.prototype,"rewardbox",void 0),r([y,C("View/Home/RecruitCtrl")],e)}(c.default);o.default=I,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../../Core/GView/GPage":"GPage","../../../Core/Math/MathEx":"MathEx","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/Language":"Language","../../Common/UI":"UI","../../Common/Zh":"Zh","../../Data/RunTime/RunRaw/RJXItem":"RJXItem","../../Logic/GameMgr":"GameMgr","../../Logic/UserMgr":"UserMgr"}],RecuitCardItem:[function(t,e,o){"use strict";cc._RF.push(e,"904bd/SZMxIyp9UwsPpMTOt","RecuitCardItem");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GView/GChild"),s=t("../../Common/Define"),c=t("../../Common/UIResources"),l=t("../../Logic/GameMgr"),u=cc._decorator,h=u.ccclass,p=u.property,d=u.menu,f=(u.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._index=0,e._award=[],e._cb=null,e._scale=null,e.onceHeroCard=null,e.heroLight=null,e.itembg=null,e.choukaAni=null,e.nameLab=null,e.suipianLab=null,e}return n(e,t),e.prototype.onGLoad=function(){},e.prototype.init=function(t,e,o){this._index=t,this._award=e,this._scale=this.node.scaleX,this.onceHeroCard.node.active=!1;var i=this,n=l.default.heroData.getRaw(this._award[0]);this.nameLab.string=n.name,this.itembg.node.active=!1,this.suipianLab.string=this._award[1]!=s.ITEM_TYPE.HERO?"\u82f1\u96c4\u788e\u7247\uff1a"+this._award[2]:"\u8f6c\u5316\u4e3a\u82f1\u96c4\u788e\u7247\uff1a10",this.choukaAni.setCompleteListener(function(){i.itembg.node.active=!0,i.itembg.node.getChildByName("recruit_chip").active=i._award[1]!=s.ITEM_TYPE.HERO,i.heroLight.node.active=!1,i.assetImpl.spriteFrame(i.onceHeroCard,c.Res.texture.hero.hero+""+i._award[0]),i._award[1]==s.ITEM_TYPE.HERO?(i.assetImpl.spriteFrame(i.itembg,c.Res.bigpic.main+"ui_kp"),i.itembg.node.width=305,i.itembg.node.height=403):(i.assetImpl.spriteFrame(i.itembg,c.Res.bigpic.main+"ui_pt"),i.itembg.node.width=305,i.itembg.node.height=403),i.scheduleOnce(function(){o&&o()},1),i.choukaAni.node.active=!1,i.onceHeroCard.node.active=!0})},r([p({type:cc.Sprite,tooltip:"\u62db\u52df\u5355\u5f20\u5361\u82f1\u96c4\u56fe\u7247"})],e.prototype,"onceHeroCard",void 0),r([p({type:cc.Sprite,tooltip:"\u62db\u52df\u5355\u5f20\u5361\u82f1\u96c4\u56fe\u7247\u5149"})],e.prototype,"heroLight",void 0),r([p({type:cc.Sprite,tooltip:""})],e.prototype,"itembg",void 0),r([p({type:sp.Skeleton,tooltip:""})],e.prototype,"choukaAni",void 0),r([p({type:cc.Label,tooltip:""})],e.prototype,"nameLab",void 0),r([p({type:cc.Label,tooltip:""})],e.prototype,"suipianLab",void 0),r([h,d("View/Home/RecuitCardItem")],e)}(a.default));o.default=f,cc._RF.pop()},{"../../../Core/GView/GChild":"GChild","../../Common/Define":"Define","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr"}],RedPointLogicMgr:[function(t,e,o){"use strict";cc._RF.push(e,"a8eecW4qC5GZoq64q3A+67f","RedPointLogicMgr");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.RedPointLogicMgr=o.RED_POINT_LABEL_NAME=o.RED_POINT_NAME=void 0;var r=t("../../Game/Common/Define"),a=t("../../Game/Logic/GameMgr"),s=t("../CoreDefine"),c=t("../FrameEx/ES5Ex"),l=t("../GCtrl"),u=t("../GLoader/GLoader"),h=/^[0-9]+.?[0-9]*$/;o.RED_POINT_NAME="red_point",o.RED_POINT_LABEL_NAME="label";var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._updateHandler=s.INVALID_VALUE,e}return n(e,t),e.ins=function(){return null==this._instance&&(this._instance=new e),this._instance},e.prototype.update=function(){this.updateCheck(),this.updateVisit(),this.checkState()},e.prototype.initGame=function(){this.initEvent(),this._redPointMask=new c.MapWrap,this._waitSends=[],this._waitChecks=[],this._unlockMasks=[],this._targets=new c.MapWrap,this._targetWraps=new c.MapWrap,this._masks=new c.MapWrap,this.stopUpdate();for(var t=0,e=Object.keys(r.RPointMask);t<e.length;t++){var o=e[t];h.test(o)&&this._waitChecks.push(parseInt(o))}this.checkState()},e.prototype.initEvent=function(){l.GCtrl.ES.on(r.CMsg.rPoint.valueSetting,this,this.onCMSGRPValueSetting.bind(this),s.PRIORITY_VIEW),l.GCtrl.ES.on(r.CMsg.client.bag.onBagItemChange,this,this.updateState.bind(this),s.PRIORITY_VIEW),l.GCtrl.ES.on(r.CMsg.client.hero.onAddHero,this,this.updateState.bind(this),s.PRIORITY_VIEW)},e.prototype.updateState=function(){for(var t=0,e=Object.keys(r.RPointMask);t<e.length;t++){var o=e[t];h.test(o)&&this._waitChecks.indexOf(parseInt(o))===s.INVALID_VALUE&&this._waitChecks.push(parseInt(o))}this.checkState()},e.prototype.on=function(t,e){var o=this._targets.get(t.uuid);o||(o=[],this._targets.set(t.uuid,o),this._targetWraps.set(t.uuid,t)),o.push.apply(o,e);for(var i=0,n=e;i<n.length;i++){for(var r=n[i],a=!1,c=0,l=r.mask;c<l.length;c++){var u=l[c],h=this._masks.get(u);h||(h=[],this._masks.set(u,h)),h.indexOf(t)==s.INVALID_VALUE&&h.push(t),a=a||this._redPointMask.get(u)}this.setRPointView(t,r.subPath,a,r.effectType,r.posType,r.cb)}},e.prototype.off=function(t){var e=this._targets.get(t.uuid);if(e){for(var o=0,i=e;o<i.length;o++)for(var n=0,r=i[o].mask;n<r.length;n++){var a=r[n],c=this._masks.get(a);if(c){var l=c.indexOf(t);l!=s.INVALID_VALUE&&c.splice(l,1),0==c.length&&this._masks.delete(a)}}this._targets.delete(t.uuid),this._targetWraps.delete(t.uuid)}},e.prototype.loginOut=function(){this.stopUpdate(),l.GCtrl.ES.off(this),this._waitChecks=[],this._waitSends=[],this._targets.clear(),this._targetWraps.clear(),this._masks.clear()},e.prototype.sendValueSettingMsg=function(t,e,o){var i={mask:t,value:e,forceStop:o};l.GCtrl.ES.emit(r.CMsg.rPoint.valueSetting,l.GCtrl.param(i))},e.prototype.sendValuesSettingMsgs=function(t,e,o){for(var i=0;i<t.length;i++)this.sendValueSettingMsg(t[i],e,o)},e.prototype.timingCheck=function(){},e.prototype.onCMSGRPValueSetting=function(t,e){var o=e.get();if(1==o.value){if((i=this._waitChecks.indexOf(o.mask))!=s.INVALID_VALUE&&this._waitChecks.splice(i,1),this._redPointMask.get(o.mask))return;if(this._redPointMask.set(o.mask,o.value),this._waitSends.indexOf(o.mask)!=s.INVALID_VALUE)return;this._waitSends.push(o.mask)}else if(1==o.forceStop){var i;if((i=this._waitChecks.indexOf(o.mask))!=s.INVALID_VALUE&&this._waitChecks.splice(i,1),this._redPointMask.set(o.mask,o.value),this._waitSends.indexOf(o.mask)!=s.INVALID_VALUE)return;this._waitSends.push(o.mask)}else this._waitChecks.indexOf(o.mask)==s.INVALID_VALUE&&this._waitChecks.push(o.mask);this.checkState()},e.prototype.startUpdate=function(){this._updateHandler==s.INVALID_VALUE&&(this._updateHandler=setInterval(this.update.bind(this),100))},e.prototype.stopUpdate=function(){s.INVALID_VALUE!=this._updateHandler&&(clearInterval(this._updateHandler),this._updateHandler=s.INVALID_VALUE)},e.prototype.checkState=function(){this._waitChecks.length>0||this._waitSends.length>0?this._updateHandler==s.INVALID_VALUE&&this.startUpdate():0==this._waitChecks.length&&0==this._waitSends.length&&this._updateHandler!=s.INVALID_VALUE&&this.stopUpdate()},e.prototype.updateCheck=function(){if(0!=this._waitChecks.length){var t=this._waitChecks.shift(),e=!0;if(e)switch(e=!1,t){case r.RPointMask.RPM_Vip_Frist:case r.RPointMask.RPM_Vip_Daily:e=a.default.userMgr.checkVipRedPoint(t===r.RPointMask.RPM_Vip_Frist);break;case r.RPointMask.RPM_Office:e=a.default.userMgr.checkOfficeRedPoint();break;case r.RPointMask.RPM_Sign:e=a.default.userMgr.checkSignRedPoint();break;case r.RPointMask.RPM_Tower:e=a.default.userMgr.checkTowerRewardTime();break;case r.RPointMask.RPM_Go_To_Battle:e=a.default.heroMgr.checkHaveHeroCanGotoBattle();break;case r.RPointMask.RPM_Hero_UnLock:e=a.default.heroMgr.checkHaveHeroUnlockByChip();break;case r.RPointMask.RPM_Hero_LvUp:case r.RPointMask.RPM_Hero_Tupo:e=a.default.heroMgr.checkHavaHeroCanGrow(t===r.RPointMask.RPM_Hero_Tupo);break;case r.RPointMask.RPM_Box_Baiyin:e=a.default.itemMgr.checkHaveBoxCanOpen(1);break;case r.RPointMask.RPM_Box_Huangjin:e=a.default.itemMgr.checkHaveBoxCanOpen(2);break;case r.RPointMask.RPM_Box_Zhuanshu:e=a.default.itemMgr.checkHaveBoxCanOpen(3);break;case r.RPointMask.RPM_Hero_AddStar:e=a.default.heroMgr.checkHavaHeroCanAddStar();break;case r.RPointMask.RPM_Have_Base:e=a.default.heroMgr.checkHavaHeroCanWear();break;case r.RPointMask.RPM_Have_Sync:e=!0;break;case r.RPointMask.RPM_Have_LvUp:e=a.default.itemMgr.checkHaveEquipCanLv();break;case r.RPointMask.RPM_Box_Receive:e=a.default.lUserData.recruitCtrl>=a.default.addDialData.getRaw(a.default.lUserData.addDial).needNext;break;case r.RPointMask.RPM_Task_Receive:e=a.default.userMgr.checTaskReceive();break;default:e=!1}this._redPointMask.get(t)!=e&&(this._redPointMask.set(t,e),this._waitSends.indexOf(t)==s.INVALID_VALUE&&this._waitSends.push(t))}},e.prototype.updateVisit=function(){if(0!=this._waitSends.length){var t=this._waitSends.shift(),e=this._redPointMask.get(t),o=this._masks.get(t);if(o&&0!=o.length)for(var i=0,n=o;i<n.length;i++){var r=n[i],a=this._targets.get(r.uuid);if(!a)return;for(var c=0,l=a;c<l.length;c++){var u=l[c];if(u&&u.mask.indexOf(t)!=s.INVALID_VALUE)if(1==e)this.setRPointView(r,u.subPath,e,u.effectType,u.posType,u.cb);else{for(var h=!1,p=0,d=u.mask;p<d.length;p++){var f=d[p];if(this._redPointMask.get(f)){h=!0;break}}this.setRPointView(r,u.subPath,h,u.effectType,u.posType,u.cb)}}}}},e.prototype.setRPointView=function(t,e,i,n,a,s){var c=t;if(e&&(c="string"==typeof e?cc.find(e,t):e),c){switch(n){case r.RedpointEffect.BLING:i?(c.stopAllActions(),cc.tween(c).repeatForever(cc.tween(c).to(1,{opacity:51}).to(1,{opacity:255})).start()):(c.opacity=255,c.stopAllActions());break;case r.RedpointEffect.RUNNING:var l=c.getChildByName(o.RED_POINT_NAME);if(!i)return void(l&&(l.active=!1));if(l)return void(l.active=!0);u.GLoader.loadJXAniClips("anis/frames/btnAni",function(t){if(cc.isValid(c)){var e=new cc.Node;e.y=12.5,e.name=o.RED_POINT_NAME,e.setAnchorPoint(cc.v2(.5,.5)),e.addComponent(cc.Sprite);for(var i=e.addComponent(cc.Animation),n=0;n<t.length;n++)i.addClip(t[n]);c.addChild(e),i.play("effect").wrapMode=cc.WrapMode.Loop}},{aniName:"effect",prefix:"anniu",maxIdx:8,numberFix:4});break;case r.RedpointEffect.REDPOINT:if(l=c.getChildByName(o.RED_POINT_NAME),!i)return void(l&&(l.active=!1));if(l)return void(l.active=!0);u.GLoader.spine("spine/views/red/gth",function(t){if(cc.isValid(c)){var e=new cc.Node;e.y=12.5,e.name=o.RED_POINT_NAME,e.setAnchorPoint(cc.v2(.5,.5));var i=e.addComponent(sp.Skeleton);switch(i.skeletonData=t,i.premultipliedAlpha=!1,c.addChild(e),e.scale=1,i.setAnimation(0,"gth",!1),i.setCompleteListener(function(){i.addAnimation(0,"gth",!1,1.5)}),i.timeScale=.7,a){case r.RedpointPos.Main:e.position=cc.v2(c.width*(1-c.anchorX),c.height*(1-c.anchorY)-40);break;case r.RedpointPos.right:e.position=cc.v2(c.width*(1-c.anchorX)-20,c.height*(1-c.anchorY)-40);break;default:e.position=cc.v2(c.width*(1-c.anchorX)-15,c.height*(1-c.anchorY)-30)}}})}s&&s(c)}},e.prototype.getMaskRedpointState=function(t){for(var e=0;e<t.length;e++){var o=this._redPointMask.get(t[e]);if(o)return o}return!1},e._instance=null,e}(c.ObjectWrap);o.RedPointLogicMgr=p,cc._RF.pop()},{"../../Game/Common/Define":"Define","../../Game/Logic/GameMgr":"GameMgr","../CoreDefine":"CoreDefine","../FrameEx/ES5Ex":"ES5Ex","../GCtrl":"GCtrl","../GLoader/GLoader":"GLoader"}],RewardAnimalView:[function(t,e,o){"use strict";cc._RF.push(e,"358eb1FbQpDobaeFoRKJvP/","RewardAnimalView");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../Game/Common/Define"),s=t("../../Game/Common/UIResources"),c=t("../../Game/Logic/GameMgr"),l=t("../Manager/AudioMgr"),u=t("./GViewBase"),h=cc._decorator,p=h.ccclass,d=(h.property,h.menu),f=(h.executeInEditMode,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.onGLoad=function(){},e.prototype.change=function(t){var e=null,o=null,i=null;t.id==a.CURRENCY.GOLD&&c.default.uiMgr.uiRoot.getChildByName("TopUiItem")&&(o=(e=c.default.uiMgr.uiRoot.getChildByName("TopUiItem").getChildByName("coinBg").getChildByName("coin")).parent.convertToWorldSpaceAR(e.position),i=this.node.convertToNodeSpaceAR(o)),t.id==a.CURRENCY.YUSHI&&c.default.uiMgr.uiRoot.getChildByName("TopUiItem")&&(o=(e=c.default.uiMgr.uiRoot.getChildByName("TopUiItem").getChildByName("gemBg").getChildByName("coin")).parent.convertToWorldSpaceAR(e.position),i=this.node.convertToNodeSpaceAR(o)),i&&this.playAnimation(new cc.Vec2(0,0),i,function(){},t)},e.prototype.creatorReward=function(){},e.prototype.calcDistance=function(t,e){var o=t.x-e.x,i=t.y-e.y;return Math.pow(o*o+i*i,.5)},e.prototype.playAnimation=function(t,e,o,i){l.AudioMgr.Ins().playEffect(s.Res.audio.coin);var n=e;this.playCoinFlyAnim(15,t,n,o,i)},e.prototype.playCoinFlyAnim=function(t,e,o,i,n,r){var c=this;void 0===r&&(r=50),this.getCirclePoints(r,e,t).map(function(t){var i=new cc.Node("New Sprite");i.addComponent(cc.Sprite);var r=i.getComponent(cc.Sprite);return n.id==a.CURRENCY.GOLD&&c.assetImpl.spriteAtlasFrame(r,s.Res.texture.views.icon,"icon_101"),n.id==a.CURRENCY.YUSHI&&c.assetImpl.spriteAtlasFrame(r,s.Res.texture.views.icon,"icon_100"),c.node.addChild(i),i.setPosition(e.x,e.y),{node:i,startPos:e,midPos:t,endPos:o,dis:c.calcDistance(t,o)}}).forEach(function(t,e){cc.tween(t.node).to(.35,{position:cc.v2(t.midPos.x,t.midPos.y)}).delay(.01*e).to(.35,{position:cc.v2(t.endPos.x,t.endPos.y)}).call(function(){t.node.destroy()}).union().start()}),this.scheduleOnce(function(){i()},.2)},e.prototype.getCirclePoints=function(t,e,o,i){void 0===i&&(i=50);for(var n=[],r=0;r<o;r++){var a=Math.PI/180*Math.round(360/o),s=e.x+t*Math.sin(a*r),c=e.y+t*Math.cos(a*r);n.unshift(cc.v3(s+Math.random()*i,c+Math.random()*i,0))}return n},e.prototype.update=function(){},r([p,d("View/GBase/RewardAnimalView")],e)}(u.default));o.default=f,cc._RF.pop()},{"../../Game/Common/Define":"Define","../../Game/Common/UIResources":"UIResources","../../Game/Logic/GameMgr":"GameMgr","../Manager/AudioMgr":"AudioMgr","./GViewBase":"GViewBase"}],RewardCrtl:[function(t,e,o){"use strict";cc._RF.push(e,"3a6bcUT9jJARqKh/aac3ZGa","RewardCrtl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/CoreDefine"),c=t("../../../Core/GView/GViewBase"),l=t("../../../Core/Manager/AudioMgr"),u=t("../../Common/UI"),h=t("../../Common/UIResources"),p=t("../../Common/Zh"),d=t("../../Data/RunTime/RunRaw/RJXItem"),f=t("../../Logic/GameMgr"),g=t("./../../../Core/GCtrl"),_=t("./../../Common/Define"),m=cc._decorator,y=m.ccclass,v=m.property,C=m.menu,I=(m.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.iconLay=null,e.iconLay1=null,e.endPoint=null,e.ui_queding=null,e._rewardData=null,e._index=0,e._bool=!1,e._featurtArr=[],e._reward=null,e._featurtNum=0,e._featurtType=_.REWARD.ALL,e}return n(e,t),e.prototype.onGLoad=function(){this.node.setContentSize(cc.winSize),g.GCtrl.ES.on(_.CMsg.client.home.onFeature,this,this.onFeature.bind(this),s.PRIORITY_VIEW),g.GCtrl.ES.on("doubleGet",this,this.doubleGet.bind(this),s.PRIORITY_VIEW)},e.prototype.doubleGet=function(){g.GCtrl.ES.emit(_.CMsg.client.bag.onBagItemChange,this._rewardData)},e.prototype.onFeature=function(t,e){var o=this;e.reward.length>0&&e.bool&&this._rewardData.forEach(function(t,o){t[1]==e.reward[1]&&t[0]==e.reward[0]&&o==e.index&&(t[2]+=e.reward[2])});var i=!1;this._featurtArr.forEach(function(t,e){i||(o._featurtNum==o._featurtArr.length&&(i=!0,o._reward()),e==o._featurtNum&&(i=!0,o._featurtNum++,f.default.jumpToMgr.jumpGoTo(u.VIEW_ID.featureCtrl,t)))})},e.prototype.onGStart=function(e,o,i,n){var r=this;void 0===i&&(i=!1),void 0===n&&(n=!1),t.prototype.onGStart.call(this),o&&(console.log("\u66f4\u6362\u7279\u5199\u5c55\u793a\u7c7b\u578b"),this._featurtType=o),this._rewardData=s.OBJECT_COPY(e),g.GCtrl.ES.emit(_.CMsg.client.bag.onBagItemChange,this._rewardData);var a=f.default.rHeroData.getHaveHeros(_.SQUAD_BUTTON.ALL);if(this._rewardData.forEach(function(t,e){t.forEach(function(o,i){var n={index:e,reward:t};r._featurtType==_.REWARD.ALL?i!=_.PART_ITEM.TYPE||o!=_.ITEM_TYPE.HERO&&o!=_.ITEM_TYPE.PROP||t[_.PART_ITEM.ID]>=1001&&t[_.PART_ITEM.ID]<=1e3+a.have.length+a.notHave.length&&r._featurtArr.push(n):r._featurtType==_.REWARD.HERO&&i==_.PART_ITEM.TYPE&&o==_.ITEM_TYPE.HERO&&t[_.PART_ITEM.ID]>=1001&&t[_.PART_ITEM.ID]<=1e3+a.have.length+a.notHave.length&&r._featurtArr.push(n)})}),1==this._rewardData.length&&i?this._reward=function(){r.close()}:this._reward=function(){r.node.getChildByName("bg").active=!0,r.creatorReward(),l.AudioMgr.Ins().playEffect(h.Res.audio.reward),r.win.maskNode.opacity=200},this._featurtArr.length>0){this.node.getChildByName("bg").active=!1;var c=!1;this._featurtArr.forEach(function(t){c||(c=!0,r._featurtNum++,f.default.jumpToMgr.jumpGoTo(u.VIEW_ID.featureCtrl,t,1==r._rewardData.length&&i))})}else this._reward();n&&this.scheduleOnce(this.close,1.5)},e.prototype.adVideo=function(){var t=this;this.ui_queding.active=!1,f.default.sdkMgr.watchAd(function(){f.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.rewardCtrl,{msg:_.PointInfo.rewardCtrl_ad}),t.ui_queding.active=!0,g.GCtrl.ES.emit(_.CMsg.client.bag.onBagItemChange,t._rewardData),f.default.uiMgr.showToast(p.JXLocales.tip.alldoubleClick),t.close()},function(){t.ui_queding.active=!0},"\u5956\u52b1\u53cc\u500d\u9886\u53d6")},e.prototype.close=function(){this._rewardData=[],this._featurtArr=[],this.onClose()},e.prototype.change=function(t){var e=this,o=null,i=null,n=null;t.id==_.CURRENCY.GOLD&&f.default.uiMgr.uiRoot.getChildByName("TopUiItem")&&(i=(o=f.default.uiMgr.uiRoot.getChildByName("TopUiItem").getChildByName("coinBg").getChildByName("coin")).parent.convertToWorldSpaceAR(o.position),n=this.node.convertToNodeSpaceAR(i)),t.id==_.CURRENCY.YUSHI&&f.default.uiMgr.uiRoot.getChildByName("TopUiItem")&&(i=(o=f.default.uiMgr.uiRoot.getChildByName("TopUiItem").getChildByName("gemBg").getChildByName("coin")).parent.convertToWorldSpaceAR(o.position),n=this.node.convertToNodeSpaceAR(i)),t.id==_.CURRENCY.WHEAT&&f.default.uiMgr.uiRoot.getChildByName("TopUiItem")&&(i=(o=f.default.uiMgr.uiRoot.getChildByName("TopUiItem").getChildByName("armyBg").getChildByName("coin")).parent.convertToWorldSpaceAR(o.position),n=this.node.convertToNodeSpaceAR(i)),n?this.playAnimation(new cc.Vec2(0,0),n,function(){e.ui_queding.active=!0},t):this.ui_queding.active=!0},e.prototype.creatorReward=function(){var t=this,e=!1;this.assetImpl.prefab(h.Res.prefab.item.jxItem,function(o){t._rewardData.forEach(function(i){var n=t.assetImpl.addGChild(o);t._rewardData.length>5?n.node.parent=t.iconLay1:n.node.parent=t.iconLay;var r=new d.default(i);r.type==_.ITEM_TYPE.PROP?n.setView(r,_.ITEM_DETAIL_FLAG.BAG|_.ITEM_DETAIL_FLAG.NUMPOS_ITEM_BC|_.ITEM_DETAIL_FLAG.NOT_TOUCH|_.ITEM_DETAIL_FLAG.LIGHT):n.setView(r,_.ITEM_DETAIL_FLAG.BAG|_.ITEM_DETAIL_FLAG.NUMPOS_ITEM_BC|_.ITEM_DETAIL_FLAG.NOT_TOUCH|_.ITEM_DETAIL_FLAG.SHOWLIGHT|_.ITEM_DETAIL_FLAG.LIGHT|_.ITEM_DETAIL_FLAG.SCALEICON),r.id!=_.CURRENCY.GOLD&&r.id!=_.CURRENCY.YUSHI&&r.id!=_.CURRENCY.WHEAT||(e=!0,t.scheduleOnce(function(){var e={startPos:n.node.position,id:r.id};t.change(e)},.2))})}),e||(this.ui_queding.active=!0)},e.prototype.calcDistance=function(t,e){var o=t.x-e.x,i=t.y-e.y;return Math.pow(o*o+i*i,.5)},e.prototype.playAnimation=function(t,e,o,i){l.AudioMgr.Ins().playEffect(h.Res.audio.coin);var n=e;this.playCoinFlyAnim(15,t,n,o,i)},e.prototype.playCoinFlyAnim=function(t,e,o,i,n,r){var a=this;void 0===r&&(r=50),this.getCirclePoints(r,e,t).map(function(t){var i=new cc.Node("New Sprite");i.addComponent(cc.Sprite);var r=i.getComponent(cc.Sprite);return n.id==_.CURRENCY.GOLD&&a.assetImpl.spriteAtlasFrame(r,h.Res.texture.views.icon,"icon_101"),n.id==_.CURRENCY.YUSHI&&a.assetImpl.spriteAtlasFrame(r,h.Res.texture.views.icon,"icon_100"),n.id==_.CURRENCY.WHEAT&&a.assetImpl.spriteAtlasFrame(r,h.Res.texture.views.icon,"icon_103"),a.node.addChild(i),i.setPosition(e.x,e.y),{node:i,startPos:e,midPos:t,endPos:o,dis:a.calcDistance(t,o)}}).forEach(function(t,e){cc.tween(t.node).to(.35,{position:cc.v2(t.midPos.x,t.midPos.y)}).delay(.01*e).to(.35,{position:cc.v2(t.endPos.x,t.endPos.y)}).call(function(){t.node.destroy()}).union().start()}),this.scheduleOnce(function(){i()},.2)},e.prototype.getCirclePoints=function(t,e,o,i){void 0===i&&(i=50);for(var n=[],r=0;r<o;r++){var a=Math.PI/180*Math.round(360/o),s=e.x+t*Math.sin(a*r),c=e.y+t*Math.cos(a*r);n.unshift(cc.v3(s+Math.random()*i,c+Math.random()*i,0))}return n},e.prototype.update=function(){this._index++,this._bool||100==this._index&&(this._bool=!0)},r([v({type:cc.Node,tooltip:"\u56fe\u6807\u81ea\u52a8\u6392\u5e8f"})],e.prototype,"iconLay",void 0),r([v({type:cc.Node,tooltip:"\u56fe\u6807\u81ea\u52a8\u6392\u5e8f"})],e.prototype,"iconLay1",void 0),r([v({type:cc.Node,tooltip:"\u7ec8\u70b9"})],e.prototype,"endPoint",void 0),r([v({type:cc.Node,tooltip:"\u786e\u5b9a"})],e.prototype,"ui_queding",void 0),r([y,C("View/Tip/RewardCtrl")],e)}(c.default));o.default=I,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/GView/GViewBase":"GViewBase","../../../Core/Manager/AudioMgr":"AudioMgr","../../../conventions/JXCommon":"JXCommon","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Common/Zh":"Zh","../../Data/RunTime/RunRaw/RJXItem":"RJXItem","../../Logic/GameMgr":"GameMgr","./../../../Core/GCtrl":"GCtrl","./../../Common/Define":"Define"}],RoleHead:[function(t,e,o){"use strict";cc._RF.push(e,"df63doW1QBPV4ux529SLN88","RoleHead");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../Core/GView/GChild"),s=t("../Common/UIResources"),c=t("../Logic/GameMgr"),l=cc._decorator,u=l.ccclass,h=l.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._roleId=0,e.icon=null,e.icongray=null,e.headbg=null,e.selectbg=null,e}var o;return n(e,t),o=e,e.prototype.start=function(){this.setState(o.State_Wait)},e.prototype.setRoleId=function(t,e){this._roleId=e;var o=c.default.heroData.getRaw(this._roleId);this.assetImpl.spriteAtlasFrame(this.selectbg.getComponent(cc.Sprite),s.Res.texture.views.mainUi,1==t?"ui_l":"ui_h"),this.assetImpl.spriteAtlasFrame(this.headbg.getComponent(cc.Sprite),s.Res.texture.views.mainUi,1==t?"headbg2":"headbg1"),this.assetImpl.spriteFrame(this.icon.getComponent(cc.Sprite),s.Res.texture.hero.hero+"head_"+o.icon),this.assetImpl.spriteFrame(this.icongray.getComponent(cc.Sprite),s.Res.texture.hero.hero+"head_"+o.icon),this.icon.active=!0,this.icongray.active=!1},e.prototype.setState=function(t){t==o.State_Wait?(this.node.scale=.9,this.selectbg.active=!1,this.icon.active=!0,this.icongray.active=!1):t==o.State_Fight?(this.node.scale=1.1,this.selectbg.active=!0,this.icon.active=!0,this.icongray.active=!1):t==o.State_Die&&(this.node.scale=.9,this.selectbg.active=!1,this.icon.active=!1,this.icongray.active=!0)},e.State_Wait="Wait",e.State_Fight="Fight",e.State_Die="Die",r([h(cc.Node)],e.prototype,"icon",void 0),r([h(cc.Node)],e.prototype,"icongray",void 0),r([h(cc.Node)],e.prototype,"headbg",void 0),r([h(cc.Node)],e.prototype,"selectbg",void 0),o=r([u],e)}(a.default);o.default=p,cc._RF.pop()},{"../../Core/GView/GChild":"GChild","../Common/UIResources":"UIResources","../Logic/GameMgr":"GameMgr"}],RoleManager:[function(t,e,o){"use strict";cc._RF.push(e,"1f2f58i7/9Ee6u2kVSXzJJX","RoleManager");var i=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../../conventions/JXCommon"),r=t("../../tyqSDK/tyqSDK"),a=t("../Common/Define"),s=t("../Common/UI"),c=t("../Common/UIResources"),l=t("../Common/Zh"),u=t("../Entity/RoleScript"),h=t("../Logic/GameMgr"),p=t("../Views/JXBattle/JXULAsset"),d=t("../Views/JXBattle/JXULDefine"),f=function(){function t(){this.assetManager=new p.BattleAssets("rolemanager")}return t.getInstance=function(){return null==t._instance&&(t._instance=new t),t._instance},t.prototype.loadAllRoundAssets=function(t,e){for(var o=this,n=[],r=[],a=Object.keys(d.JXSceneEffect),s=0;s<a.length;s++){var l=d.JXSceneEffect[a[s]];this.hasLoadAsset(n,l)||(r.push({type:sp.SkeletonData,path:l}),n.push(l))}t.forEach(function(t){var e=h.default.heroData.getRaw(t);r.push({type:sp.SkeletonData,path:c.Res.model+e.animation+"/"+e.animation});for(var i=0;i<e.skill.length;i++){var a=e.skill[i],s=h.default.skillData.getRaw(a);if(!s)return;if(s.skillSk){var l=d.JXBattleSkillSpine+s.skillSk;o.hasLoadAsset(n,l)||(r.push({type:sp.SkeletonData,path:l}),n.push(l))}var u=c.Res.audio.battle+a;o.hasLoadAsset(n,u)||(r.push({type:cc.AudioClip,path:u}),n.push(u))}}),this.preLoads.apply(this,i([e],r))},t.prototype.loadHeroAssets=function(t,e){var o,n=[];t.forEach(function(t){var e=h.default.heroData.getRaw(t);n.push({type:sp.SkeletonData,path:c.Res.model+e.animation+"/"+e.animation})}),(o=this.assetManager.assetImpl).preLoads.apply(o,i([function(t,o){t==o&&e()}],n))},t.prototype.hasLoadAsset=function(t,e){return-1!=t.indexOf(e)},t.prototype.preLoads=function(t){for(var e,o=[],n=1;n<arguments.length;n++)o[n-1]=arguments[n];(e=this.assetManager.assetImpl).preLoads.apply(e,i([function(e,o){e==o&&t()},{type:cc.Prefab,path:c.Res.prefab.fight.role},{type:cc.Prefab,path:c.Res.prefab.fight.head},{type:cc.Prefab,path:c.Res.prefab.fight.fightFlags},{type:cc.Prefab,path:c.Res.prefab.fight.roleHead}],o))},t.prototype.createRole=function(t,e,o,i){void 0===e&&(e=null),void 0===o&&(o=0),void 0===i&&(i=[]);var n=this.assetManager.assetImpl.getPreLoadAsset(c.Res.prefab.fight.role);if(n){var r=cc.instantiate(n),a=r.getChildComByName("skeleton",sp.Skeleton);if(a){var s=h.default.heroData.getRaw(t),l=c.Res.model+s.animation+"/"+s.animation,p=this.assetManager.assetImpl.getPreLoadAsset(l);return null==p?(console.log("skeldata = null "),this.assetManager.assetImpl.spine(l,function(t){setTimeout(function(){a&&(a.skeletonData=t,a.setSkin(s.aniSkin),a.setAnimation(0,s.ani[0],!0))},.1)})):(a.skeletonData=p,a.defaultSkin=s.aniSkin),e&&r.getComponent(u.default).setRoleData(t,e,o,i),r}}},t.prototype.changeRoleSkel=function(t,e){var o=t.getChildComByName("skeleton",sp.Skeleton);if(o){var i=h.default.heroData.getRaw(e),n=c.Res.model+i.animation+"/"+i.animation;o.skeletonData=this.assetManager.assetImpl.getPreLoadAsset(n),o.defaultSkin=i.aniSkin}},t.prototype.changeNodeSkel=function(t,e){var o=t.getComponent(sp.Skeleton);if(o){var i=h.default.heroData.getRaw(e),n=c.Res.model+i.animation+"/"+i.animation;this.assetManager.assetImpl.spine(n,function(t){o.skeletonData=t,o.setSkin(i.aniSkin),o.setAnimation(0,i.ani[0],!0)})}},t.prototype.getRolePowerProp=function(t){var e=h.default.rHeroData.getHero(t);return e?e.propts:h.default.heroData.getRaw(t).property},t.prototype.getEnemyPowerProp=function(t,e,o){for(var i=[],n=h.default.heroData.getRaw(t),r=0;r<n.property.length&&r<n.growValue.length;r++){var a=Math.floor((n.property[r]+n.growValue[r]*e)*o/100);i.push(a)}return i},t.prototype.getCurHurt=function(){},t.prototype.dealCurDamage=function(t,e,o,i){var n=o,r=i,s=Math.max(n[a.PART_PROPTS.GongJi]-r[a.PART_PROPTS.FangYu],.05*n[a.PART_PROPTS.GongJi])*(1e4*Math.random()<n[a.PART_PROPTS.BaoJi]?1+n[a.PART_PROPTS.BaoShang]:1)*Math.min(1-r[a.PART_PROPTS.ShanBi]/100,1)*(1+(n[a.PART_PROPTS.BingGong]-r[a.PART_PROPTS.BingKang])/100+(n[a.PART_PROPTS.HuoGong]-r[a.PART_PROPTS.HuoKang])/100);return Math.ceil(s)},t.prototype.createRoleHead=function(){var t=this.assetManager.assetImpl.getPreLoadAsset(c.Res.prefab.fight.roleHead);if(t)return cc.instantiate(t)},t.prototype.onStartFight=function(){if(h.default.rHeroData.checkInNoHero())h.default.uiMgr.showToast(l.JXLocales.fight.teamEmpty);else{var e=h.default.rHeroData.heroIdsInBattle,o=0;e.forEach(function(e){if(e>0){var i=t.getInstance().getRolePowerProp(e);o+=i[2]}});var i=h.default.systemConfig.value(n.JXDef.SYS_CONFIG_KEY.basicsWheat);if(i+=h.default.lUserData.getUserBuff(a.BUFFINFO.InitBattlefieldRes),(i+=h.default.RBagData.getMegreItems(a.CURRENCY.WHEAT,a.ITEM_TYPE.CURRENCY).num)>=o){var c={sceneId:a.PART_BTL_SCENE.GUANQIA,args:{level:h.default.lUserData.level+1,isFullPower:!0}};return r.tyqSDK.eventLevelStart(h.default.lUserData.level+1),void h.default.jumpToMgr.jumpGoTo(s.VIEW_ID.fightLayerPut,c)}h.default.jumpToMgr.jumpGoTo(s.VIEW_ID.FightDataPreView,function(){})}},t._instance=null,t}();o.default=f,cc._RF.pop()},{"../../conventions/JXCommon":"JXCommon","../../tyqSDK/tyqSDK":"tyqSDK","../Common/Define":"Define","../Common/UI":"UI","../Common/UIResources":"UIResources","../Common/Zh":"Zh","../Entity/RoleScript":"RoleScript","../Logic/GameMgr":"GameMgr","../Views/JXBattle/JXULAsset":"JXULAsset","../Views/JXBattle/JXULDefine":"JXULDefine"}],RoleScript:[function(t,e,o){"use strict";cc._RF.push(e,"24907XrA1FIqo6x5+ZBFo14","RoleScript");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../Core/GView/GChild"),s=t("../Common/UIResources"),c=t("../Logic/GameMgr"),l=t("../Manager/RoleManager"),u=t("../Views/Hero/HeroChange"),h=cc._decorator,p=h.ccclass,d=h.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.heroNode=null,e.skeleton=null,e.namelabel=null,e.bloodBar=null,e.bloodlabel=null,e.hitNode=null,e.HeroChange=null,e.icon=null,e._animations=[],e._roleId=0,e._roleName="",e._type="Hero",e._isReady=!1,e._maxHp=0,e._curHp=0,e._attack=0,e._defense=0,e._criticalPro=0,e._resist=0,e._criticalDamage=0,e._iceAttr=0,e._iceDef=0,e._fireAttr=0,e._fireDef=0,e}var o;return n(e,t),o=e,e.prototype.start=function(){this.HeroChange.changeSpine(this._roleId)},e.prototype.initSkel=function(){if(!this.skeleton){var t=this.heroNode.getComponent(sp.Skeleton);t||(t=this.addComponent(sp.Skeleton)),this.skeleton=t}},e.prototype.setRoleData=function(t,e,i,n){void 0===n&&(n=[]);var r=c.default.heroData.getRaw(t),a=l.default.getInstance().getRolePowerProp(t);this._roleId=r.id,this._roleName=r.name,this._attack=a[0],this._defense=a[1],n.length>2?this._maxHp=n[2]:a[2],this._curHp=i,this._criticalPro=a[3],this._resist=a[4],this._criticalDamage=a[5],this._iceAttr=a[6],this._iceDef=a[7],this._fireAttr=a[8],this._fireDef=a[9],this.assetImpl.spriteAtlasFrame(this.namelabel.getComponent(cc.Sprite),"frames/views/squadImg","lname_"+r.icon),this._animations=r.ani,this.bloodBar.progress=this._curHp/this._maxHp,this.heroNode.opacity=255,this._type=e,this.node.x=e==o.Type_Hero?-400:400,this.heroNode.scaleX=e==o.Type_Hero?-r.roleScale:r.roleScale,this.heroNode.scaleY=r.roleScale,this.bloodlabel.string=this._curHp+"/"+this._maxHp,e==o.Type_Hero?(this.heroNode.color=cc.color(255,255,255,255),this.namelabel.parent.x=-100,this.assetImpl.spriteFrame(this.bloodBar.node.getChildByName("bar").getComponent(cc.Sprite),"battleView/bar3"),this.assetImpl.spriteAtlasFrame(this.icon,s.Res.texture.views.mainUi,"ui_sb")):(this.assetImpl.spriteFrame(this.bloodBar.node.getChildByName("bar").getComponent(cc.Sprite),"battleView/bar2"),this.heroNode.color=cc.color(100,100,100,255),this.namelabel.parent.x=100,this.assetImpl.spriteAtlasFrame(this.icon,s.Res.texture.views.mainUi,"ui_sb2"))},e.prototype.changeAnimation=function(t,e,i,n){if(void 0===e&&(e=!1),void 0===n&&(n=!0),this.skeleton){var r;r=t==o.State_Idle?this._animations[0]:t==o.State_Fight?this._animations[1]:t;var a=this.skeleton.setAnimation(0,r,e);if(i?this.skeleton.setCompleteListener(i):this.skeleton.setCompleteListener(null),a)return{track:a,duration:a.animation.duration};console.log(this._roleName+"\u627e\u4e0d\u5230\u52a8\u4f5c: ",t)}},e.prototype.setRoleReady=function(){this.setRoleState(o.State_Idle);var t=this;cc.tween(this.node).to(.1,{x:0}).call(function(){t._isReady=!0},this).start()},e.prototype.isReady=function(){return this._isReady},e.prototype.setRoleState=function(t){if(t==o.State_Fight){var e=this._type==o.Type_Hero?80:-80;cc.tween(this.node).delay(.1).call(function(){this.changeAnimation(t,!0)},this).to(.1,{x:e,y:1.6*e},{easing:"elasticInOut"}).delay(1).call(function(){this.hitNode.active=!0,this.hitNode.getComponent(sp.Skeleton).setAnimation(0,"animation",!1),this.changeAnimation("hit",!1)},this).delay(.5).call(function(){this.hitNode.active=!1,this.changeAnimation(o.State_Idle,t!=o.State_Die),this.heroNode.x=0},this).to(.1,{x:0,y:0}).start()}else this.changeAnimation(t,t!=o.State_Die)},e.prototype.setMaxHp=function(t){this._maxHp=t,this._curHp=t,this.bloodBar.progress=1,this.heroNode.opacity=255},e.prototype.setRoleBeAttacked=function(t){var e=this;if(!(t<=0)){var o=this._curHp;this._curHp-=t,this._curHp<=0&&(this._curHp=0),this.bloodlabel.string=this._curHp+"/"+this._maxHp,cc.tween(this.bloodBar).to(2,{progress:this._curHp/this._maxHp}).call(this.setRoleDie,this).start();var i=this,n=o-this._curHp;return this.bloodlabel.string=o+"/"+this._maxHp,cc.tween({a:0}).to(1.5,{a:100},{progress:function(t,r,a,s){i.bloodlabel&&(i.bloodlabel.string=Math.max(0,o-Math.floor(n*s))+"/"+e._maxHp)}}).start(),this._curHp}},e.prototype.getRoleHp=function(){return this._curHp},e.prototype.setRoleDie=function(){this.hitNode.active=!1,this.setRoleState(o.State_Idle),this._curHp<=0&&(this._curHp=0,cc.tween(this.node).to(.2,{x:this._type==o.Type_Hero?-400:400}).start())},e.State_Idle="idle",e.State_Fight="skill1",e.State_Die="die",e.Type_Hero="Hero",e.Type_Enemy="Enemy",r([d(cc.Node)],e.prototype,"heroNode",void 0),r([d(sp.Skeleton)],e.prototype,"skeleton",void 0),r([d(cc.Node)],e.prototype,"namelabel",void 0),r([d(cc.ProgressBar)],e.prototype,"bloodBar",void 0),r([d(cc.Label)],e.prototype,"bloodlabel",void 0),r([d(cc.Node)],e.prototype,"hitNode",void 0),r([d(u.default)],e.prototype,"HeroChange",void 0),r([d(cc.Sprite)],e.prototype,"icon",void 0),o=r([p],e)}(a.default);o.default=f,cc._RF.pop()},{"../../Core/GView/GChild":"GChild","../Common/UIResources":"UIResources","../Logic/GameMgr":"GameMgr","../Manager/RoleManager":"RoleManager","../Views/Hero/HeroChange":"HeroChange"}],SActionCollision:[function(t,e,o){"use strict";cc._RF.push(e,"10779iJK6pL878l3DB62iwC","SActionCollision");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SActionCollision=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.collisionId,o)}return!0},r([s],e)}(a.GStatic);o.SActionCollision=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SAction:[function(t,e,o){"use strict";cc._RF.push(e,"8bcb4UJK5pNXIsV3NRFsnsh","SAction");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SAction=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},r([s],e)}(a.GStatic);o.SAction=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SAddDialData:[function(t,e,o){"use strict";cc._RF.push(e,"4a410whkMJC+52YMPUcNcOb","SAddDialData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SAddDialData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},r([s],e)}(a.GStatic);o.SAddDialData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SBuffData:[function(t,e,o){"use strict";cc._RF.push(e,"a47f0tOwEZCY4VQnFzHgZff","SBuffData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SBuffData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},r([s],e)}(a.GStatic);o.SBuffData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SBullet:[function(t,e,o){"use strict";cc._RF.push(e,"0bf89l53D9LS4vSuXV8jiTx","SBullet");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SBullet=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},r([s],e)}(a.GStatic);o.SBullet=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SCallData:[function(t,e,o){"use strict";cc._RF.push(e,"ab027ghRfZA47mRKvUAc4Cp","SCallData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SCallData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},r([s],e)}(a.GStatic);o.SCallData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SDailyTaskData:[function(t,e,o){"use strict";cc._RF.push(e,"2e4c5wscmNHXLzHYrOWWQCC","SDailyTaskData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SDailyTaskData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},r([s],e)}(a.GStatic);o.SDailyTaskData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SDialData:[function(t,e,o){"use strict";cc._RF.push(e,"75506/2A+xCVoqWCr9s7szL","SDialData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SDialData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},e.prototype.getDialByType=function(t){var e=[];return this._data.forEach(function(o){o.type==t&&e.push(o)}),e},r([s],e)}(a.GStatic);o.SDialData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SEffectAnim:[function(t,e,o){"use strict";cc._RF.push(e,"f48cbwB6GVJVaFW1k4jWVA3","SEffectAnim");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SEffectAnim=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},r([s],e)}(a.GStatic);o.SEffectAnim=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SEquipData:[function(t,e,o){"use strict";cc._RF.push(e,"fa8c9akLapPwZPt+taCR/fo","SEquipData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SEquipData=void 0;var a=t("../../../conventions/JXCommon"),s=t("../../../Core/Manager/DataPool"),c=t("../../Logic/GameMgr"),l=cc._decorator.ccclass,u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=s.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},e.prototype.getEquipByEquip=function(t,e){var o=[];return this._data.forEach(function(i){(i.job===t&&i.lv<=e||0===i.job&&i.lv===e)&&c.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.quality).forEach(function(t){i.trait==t&&o.push(i)})}),o},e.prototype.getJackpot=function(t,e,o,i,n){var r=[];return this._data.forEach(function(a){a.target.forEach(function(s){s!=e&&0!=s||(a.trait==n&&a.lv>=o&&a.lv<=i&&a.job==t||a.trait==n&&a.lv>=o&&a.lv<=i&&0==a.job)&&r.push(a)})}),r.length,r},e.prototype.getJackpotJob=function(t,e,o,i,n){var r=[];return this._data.forEach(function(a){a.target.forEach(function(s){s!=e&&0!=s||a.trait==n&&a.lv>=o&&a.lv<=i&&a.job==t&&r.push(a)})}),r.length,r},r([l],e)}(s.GStatic);o.SEquipData=u,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool","../../../conventions/JXCommon":"JXCommon","../../Logic/GameMgr":"GameMgr"}],SGuideChainData:[function(t,e,o){"use strict";cc._RF.push(e,"2212akihAtMdb4EDsJR8lIh","SGuideChainData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SGuideChainData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.guideId,o)}return!0},r([s],e)}(a.GStatic);o.SGuideChainData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SGuideStepData:[function(t,e,o){"use strict";cc._RF.push(e,"288d8D5RXZCOJobcgl7T+s5","SGuideStepData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SGuideStepData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.stepId,o)}return!0},r([s],e)}(a.GStatic);o.SGuideStepData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SHeroData:[function(t,e,o){"use strict";cc._RF.push(e,"237acjtUkVLEK0iVEQjYiNs","SHeroData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SHeroData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},e.prototype.getHeroByType=function(t){var e=[];return this._data.forEach(function(o){o.type===t&&1===o.true&&e.push(o)}),e},e.prototype.getHeroTrue=function(){var t=[];return this._data.forEach(function(e){1===e.true&&t.push(e)}),t},r([s],e)}(a.GStatic);o.SHeroData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SHeroTryData:[function(t,e,o){"use strict";cc._RF.push(e,"38765LeNXBEsbBbSyR0tNzO","SHeroTryData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SHeroTryData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},r([s],e)}(a.GStatic);o.SHeroTryData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SItemData:[function(t,e,o){"use strict";cc._RF.push(e,"29ceciUNX9Gd5tkzC9MnKWo","SItemData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SItemData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},r([s],e)}(a.GStatic);o.SItemData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SLGuideShader:[function(t,e,o){"use strict";cc._RF.push(e,"c5fd8CDsc9HE4+40pqgIIN8","SLGuideShader");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../Core/FrameEx/GComponent"),s=cc._decorator,c=s.ccclass,l=s.property,u=(s.requireComponent,s.executeInEditMode,s.menu),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mask1=[0,0,0,0],e.mask2=[0,0,0,0],e.inverted=!1,e._maskMaterial=null,e._sprite=null,e}return n(e,t),e.prototype.__onLoad=function(){this.node.setContentSize(cc.winSize);var t=this.assetImpl.getPreLoadAsset("materials/ui-guide");this._sprite=this.node.getComponent(cc.Sprite),t&&(this._sprite.setMaterial(0,t),this._maskMaterial=this._sprite.getMaterial(0),this._maskMaterial.setProperty("wh_ratio",cc.winSize.width/cc.winSize.height))},e.prototype.reSetMask1=function(t,e){this._maskMaterial&&(this.mask1[0]==t[0]&&this.mask1[1]==t[1]&&this.mask1[2]==t[2]&&this.mask1[3]==t[3]||(this.mask1=t,this._maskMaterial.setProperty("mask1_point",cc.v2(this.mask1[0]/this.node.width,1-this.mask1[1]/this.node.height)),this._maskMaterial.setProperty("mask1_size",cc.v2(this.mask1[2]/this.node.width,this.mask1[3]/this.node.height)),e&&this.reSetMask2(e)))},e.prototype.reSetMask2=function(t){this._maskMaterial&&(this.mask2[0]==t[0]&&this.mask2[1]==t[1]&&this.mask2[2]==t[2]&&this.mask2[3]==t[3]||(this.mask2=t,this._maskMaterial.setProperty("mask2_point",cc.v2(this.mask2[0]/this.node.width,1-this.mask2[1]/this.node.height)),this._maskMaterial.setProperty("mask2_size",cc.v2(this.mask2[2]/this.node.width,this.mask2[3]/this.node.height))))},r([l([cc.Float])],e.prototype,"mask1",void 0),r([l([cc.Float])],e.prototype,"mask2",void 0),r([l(cc.Boolean)],e.prototype,"inverted",void 0),r([l(cc.Material)],e.prototype,"_maskMaterial",void 0),r([l(cc.Sprite)],e.prototype,"_sprite",void 0),r([c,u("Shaders/SLGuideShader")],e)}(a.default);o.default=h,cc._RF.pop()},{"../Core/FrameEx/GComponent":"GComponent"}],SLTextShowShader:[function(t,e,o){"use strict";cc._RF.push(e,"9cec2sM/K1ES6arCcYpGUGk","SLTextShowShader");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../Core/FrameEx/GComponent"),s=cc._decorator,c=s.ccclass,l=s.property,u=(s.requireComponent,s.executeInEditMode),h=s.menu,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._maskMaterial=null,e._sprite=null,e._easpTime=0,e}return n(e,t),e.prototype.__onLoad=function(){this._sprite=this.node.getComponent(cc.Sprite),this._sprite.spriteFrame.__unpack=!0,this._maskMaterial=this._sprite.getMaterial(0)},e.prototype.update=function(t){this._easpTime+=t,this._easpTime>5&&(this._easpTime=5),this._maskMaterial.setProperty("u_time",this._easpTime/3)},r([l(cc.Material)],e.prototype,"_maskMaterial",void 0),r([l(cc.Sprite)],e.prototype,"_sprite",void 0),r([c,h("Shaders/SLTextShowShader"),u],e)}(a.default);o.default=p,cc._RF.pop()},{"../Core/FrameEx/GComponent":"GComponent"}],SLTransitions:[function(t,e,o){"use strict";cc._RF.push(e,"f86a2HyyIZPGbQvU5CvCVmO","SLTransitions");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../Core/FrameEx/GComponent"),s=t("../Core/GLoader/GLoader"),c=t("../Game/Common/JXColor"),l=t("../Game/Common/UIAction"),u=cc._decorator,h=u.ccclass,p=u.property,d=(u.requireComponent,u.executeInEditMode,u.menu),f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.material=null,e.sprite=null,e.targetNode=null,e.transitionTime=1,e._insMaterial=null,e._inited=!1,e._texture1=null,e._texture2=null,e._camera=null,e._time=0,e._isLoading=!1,e._isStartFlag=!1,e._finishedCallBack=null,e}return n(e,t),e.prototype.setOnceFinishedCallback=function(t){this._finishedCallBack=t},e.prototype.__onLoad=function(){this._init()},e.prototype.__onDestroy=function(){cc.isValid(this._camera)&&this._camera.node.destroy(),cc.isValid(this.sprite)&&this.sprite.node.destroy()},e.prototype._init=function(){if(!this._inited){if(this._inited=!0,this._texture1||(this._texture1=this._createTexture()),this._texture2||(this._texture2=this._createTexture()),!this._camera){var t=new cc.Node("TRANSITION_CAMERA");this._camera=t.addComponent(cc.Camera),this._camera.backgroundColor=c.JXColor.C000000,t.parent=this.node}this._camera.cullingMask=cc.Camera.main.cullingMask,this.sprite&&this.updateSpriteMaterial()}},e.prototype.updateSpriteMaterial=function(){this.sprite&&this.material&&(this._insMaterial&&this.material._effect._name==this._insMaterial._effect._name||(this._insMaterial=cc.MaterialVariant.create(this.material,this.sprite),this.sprite.setMaterial(0,this._insMaterial)),this._insMaterial.setProperty("texture2",this._texture2),this._insMaterial.setProperty("ratio",this._texture2.width/this._texture2.height),this._insMaterial.setProperty("screenSize",cc.v2(this._texture2.width,this._texture2.height)))},e.prototype._createTexture=function(){var t=new cc.RenderTexture;return t.initWithSize(cc.visibleRect.width,cc.visibleRect.height,cc.gfx.RB_FMT_D24S8),t},e.prototype.prepareTransitions=function(){if(this._inited&&this.sprite&&(this._insMaterial||this.updateSpriteMaterial(),this.targetNode)){this._camera.enabled=!0,this._camera.targetTexture=this._texture1,this._camera.render(this.targetNode);var t=new cc.SpriteFrame(this._texture1);this.sprite.spriteFrame=t,this._camera.targetTexture=null,this._insMaterial.setProperty("time",0)}},e.prototype.startTransitions=function(){this._inited&&this.sprite&&this.targetNode&&(s.GAssetImpl.isLoading()?this._isStartFlag=!0:this.renderTexure2())},e.prototype.renderTexure2=function(){var t=this;l.delayAction(this._camera.node,.01,function(){t._camera.targetTexture=t._texture2,t._camera.render(t.targetNode),t._camera.targetTexture=null,t._isLoading=!0,t._time=0,t._insMaterial.setProperty("time",0)})},e.prototype.update=function(t){if(this._isStartFlag){if(s.GAssetImpl.isLoading())return;return this._isStartFlag=!1,void this.renderTexure2()}this._isLoading&&(this._time+=t,this._time>=this.transitionTime&&(this._time=this.transitionTime,this._isLoading=!1,this.sprite.spriteFrame=null,this._camera.targetTexture=null,this._camera.enabled=!1,this._finishedCallBack&&(this._finishedCallBack(),this._finishedCallBack=null)),this._insMaterial.setProperty("time",this._time/this.transitionTime))},r([p(cc.Material)],e.prototype,"material",void 0),r([p(cc.Sprite)],e.prototype,"sprite",void 0),r([p(cc.Node)],e.prototype,"targetNode",void 0),r([p],e.prototype,"transitionTime",void 0),r([h,d("Shaders/SLTransitions")],e)}(a.default);o.default=f,cc._RF.pop()},{"../Core/FrameEx/GComponent":"GComponent","../Core/GLoader/GLoader":"GLoader","../Game/Common/JXColor":"JXColor","../Game/Common/UIAction":"UIAction"}],SLvData:[function(t,e,o){"use strict";cc._RF.push(e,"8d20fTC7YpMNoZUtxAaWOA7","SLvData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SLvData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.lv,o)}return!0},e.prototype.getLvMinByTrait=function(t){var e=1e10;return this.data.values().forEach(function(o){o.quality===t&&e>o.lv&&(e=o.lv)}),e},e.prototype.getMaxlv=function(){var t=this.data.values();return t[t.length-1]},e.prototype.getIdByInfo=function(t){var e=null;return this.data.forEach(function(o){o.lv==t&&(e=o)}),e},r([s],e)}(a.GStatic);o.SLvData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SLvUpData:[function(t,e,o){"use strict";cc._RF.push(e,"4e5f5QgRVJA35WiJ33desno","SLvUpData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SLvUpData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},r([s],e)}(a.GStatic);o.SLvUpData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SMapData:[function(t,e,o){"use strict";cc._RF.push(e,"9f81fMDh7ZIDqVoicDU5x/K","SMapData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SMapData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},r([s],e)}(a.GStatic);o.SMapData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SMapStyleData:[function(t,e,o){"use strict";cc._RF.push(e,"68443ErMIBGBZMq/T18OwkL","SMapStyleData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SMapStyleData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},r([s],e)}(a.GStatic);o.SMapStyleData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SNoticeData:[function(t,e,o){"use strict";cc._RF.push(e,"2de93GsxfZO87r+bkwOo9Y5","SNoticeData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SNoticeData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},r([s],e)}(a.GStatic);o.SNoticeData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SNpcTeamData:[function(t,e,o){"use strict";cc._RF.push(e,"76528HViixITKZTLOIOpLiT","SNpcTeamData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SNpcTeamData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},r([s],e)}(a.GStatic);o.SNpcTeamData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SOfficerData:[function(t,e,o){"use strict";cc._RF.push(e,"86aaa9281NDg4OQItlnsBL0","SOfficerData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SOfficerData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},e.prototype.getTv=function(t,e){var o=0;return this._data.forEach(function(i){i.id==t&&(o=i.tv[e])}),o},r([s],e)}(a.GStatic);o.SOfficerData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SOnLineAwardData:[function(t,e,o){"use strict";cc._RF.push(e,"ffab8ckJwpGGbl54vq70b7m","SOnLineAwardData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SOnLineAwardData=void 0;var a=t("../../../Core/Manager/DataPool"),s=t("../../Logic/GameMgr"),c=cc._decorator.ccclass,l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},e.prototype.isReceiveReward=function(t){var e=this,o=!1,i={bool:o,reward:[],index:1};return this.data.forEach(function(n){if(!o){var r=s.default.lUserData.getOnLineRewardNum();r<e.data.size&&(t>=n.time&&r<n.id?(o=!0,i.bool=o,i.reward=n.award):i.index=r+1)}}),i},e.prototype.isAllReward=function(t){return t>=this.data.values.length},Object.defineProperty(e.prototype,"maxTimeId",{get:function(){var t=1;return this._data.forEach(function(e){t=e.id}),t},enumerable:!1,configurable:!0}),r([c],e)}(a.GStatic);o.SOnLineAwardData=l,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool","../../Logic/GameMgr":"GameMgr"}],SScopeData:[function(t,e,o){"use strict";cc._RF.push(e,"eeb51Ve1hBC5KQ/+NnxzExi","SScopeData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SScopeData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},r([s],e)}(a.GStatic);o.SScopeData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SSignInData:[function(t,e,o){"use strict";cc._RF.push(e,"de7c2EI6zZFfpxumOaxN8U+","SSignInData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SSignInData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},e.prototype.getSignByLv=function(t){var e=[];return this._data.forEach(function(o){o.lv===t&&e.push(o)}),e},r([s],e)}(a.GStatic);o.SSignInData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SSkillData:[function(t,e,o){"use strict";cc._RF.push(e,"31240weTrRKjobapRhqYdSD","SSkillData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SSkillData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},e.prototype.getHeroSkillData=function(t){var e=this._data.values(),o=[];return e.forEach(function(e){e.who.forEach(function(i){i==t&&o.push(e)})}),o},e.prototype.getHeroUseSkill=function(t,e){var o=this._data.values(),i=[];return o.forEach(function(o){o.who.forEach(function(n){n==t&&(0==o.unlocking?i.push(o.id):e>=o.unlocking&&i.push(o.id))})}),i},r([s],e)}(a.GStatic);o.SSkillData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SSkillEffect:[function(t,e,o){"use strict";cc._RF.push(e,"3c7eePj4c9NTZjdh0fZWXTU","SSkillEffect");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SSkillEffect=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},r([s],e)}(a.GStatic);o.SSkillEffect=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SStarLvData:[function(t,e,o){"use strict";cc._RF.push(e,"1ed6dQeNOtIS4csqd+XqLT8","SStarLvData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SStarLvData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},r([s],e)}(a.GStatic);o.SStarLvData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SStoryData:[function(t,e,o){"use strict";cc._RF.push(e,"b25f0G+FypOy44Jz7Dk/A4K","SStoryData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SStoryData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},e.prototype.getStorysBySection=function(t){var e=[];return this._data.forEach(function(o){o.section===t&&e.push(o)}),e},e.prototype.getSection=function(){var t=[],e=1,o=!1;return this._data.forEach(function(i){i.section!==e||o?o=!1:(o=!0,t.push(i.section),e++)}),t},e.prototype.getSnow=function(){var t=[],e=0,o=!1;return this._data.forEach(function(i){i.snow==e||o?o=!1:(o=!0,t.push(i.snow),e=i.snow)}),t},r([s],e)}(a.GStatic);o.SStoryData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SSuitData:[function(t,e,o){"use strict";cc._RF.push(e,"542f7nDR3NCkJSWcg45q7gJ","SSuitData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SSuitData=void 0;var a=t("../../../Core/Manager/DataPool"),s=t("../../Logic/GameMgr"),c=cc._decorator.ccclass,l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},e.prototype.getAllHeroSuit=function(t){var e=[];return this._data.forEach(function(o){o.hero.forEach(function(i){i==t&&e.push(o.id)})}),e},e.prototype.getHeroSuit=function(t,e){var o;return e.forEach(function(e){s.default.suitData.getRaw(e).suit.forEach(function(i){i==t&&(o=s.default.suitData.getRaw(e))})}),o},r([c],e)}(a.GStatic);o.SSuitData=l,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool","../../Logic/GameMgr":"GameMgr"}],SSystemConfig:[function(t,e,o){"use strict";cc._RF.push(e,"54326d2RQ5IV5HnbbOS177A","SSystemConfig");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SSystemConfig=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.key,o)}return!0},e.prototype.value=function(t){var e=this.getRaw(t);return e?e.value:null},r([s],e)}(a.GStatic);o.SSystemConfig=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],STowerData:[function(t,e,o){"use strict";cc._RF.push(e,"9223caQOfdAk6lGC4NaUvSE","STowerData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.STowerData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},e.prototype.getInfo=function(){return{min:this._data.values()[0].id,max:this._data.values()[this._data.size-1].id,count:this._data.size}},r([s],e)}(a.GStatic);o.STowerData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SUnitData:[function(t,e,o){"use strict";cc._RF.push(e,"bb54a83jUlFz7rRxX0dPAvs","SUnitData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SUnitData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},r([s],e)}(a.GStatic);o.SUnitData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SVipData:[function(t,e,o){"use strict";cc._RF.push(e,"4d685FTl75E45uhugDQXLxh","SVipData");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.SVipData=void 0;var a=t("../../../Core/Manager/DataPool"),s=cc._decorator.ccclass,c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.parse=function(t){for(var e=0;e<t.data.length;e++){var o=a.GStatic.addonRaw(t.data[e]);this._data.set(o.id,o)}return!0},r([s],e)}(a.GStatic);o.SVipData=c,cc._RF.pop()},{"../../../Core/Manager/DataPool":"DataPool"}],SdkMgr:[function(t,e,o){"use strict";cc._RF.push(e,"ed682TfuOdMu49wwxkkc4Ic","SdkMgr");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),t("../../tyqSDK/platform/wechat/wechat");var r=t("../../tyqSDK/tyqSDK"),a=t("../Guide/GuideLogic"),s=t("./../../Core/FrameEx/ES5Ex"),c=t("./../Common/Define"),l=t("./GameMgr"),u=function(t){function e(){var e=t.call(this)||this;return e._isWhitePag=!0,e._isCloseAd=!0,e._mediaRecorder=null,e.channel=c.Channel.DEFAULT,e._videoRes="",cc.sys.platform==cc.sys.WECHAT_GAME&&window.wx&&(e.channel=c.Channel.WECHAT),r.tyqSDK.setLogOpen(!0),r.tyqSDK.setAppVersion(2),e.channel,c.Channel.WECHAT,r.tyqSDK.init("TyqApp20221031153232","EOcHe2caWawP0sSV1AyTJ2FyCUufSYlQ"),e}return n(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!1,configurable:!0}),e.prototype.getChannel=function(){return this.channel},e.prototype.watchAd=function(t,o,i){void 0===i&&(i=""),a.GuideLogic.ins().isGuidding()?t&&t():this.channel!=c.Channel.ANDROID233?e.ins._isWhitePag?t&&t():e.ins._isCloseAd?t&&t():(l.default.lUserData.addAdWatchTime(),r.tyqSDK.showRewardedAd(i,function(e){1==e?t&&t():o&&o()})):r.tyqSDK.showRewardedAd(i,function(e){1==e?t&&t():o&&o()})},e.prototype.umaSetPoint=function(){},e.prototype.showMoreGamesModal=function(){switch(this.channel){case c.Channel.TT:}},e.prototype.ttFocusOn=function(){},e.prototype.startRecoding=function(){},e.prototype.recordStart=function(){},e.prototype.puaseRecord=function(){console.log("\u6682\u505c\u5f55\u5c4f"),this.channel==c.Channel.TT||this.channel==c.Channel.KS&&this._mediaRecorder.pause()},e.prototype.resumeRecord=function(){console.log("\u7ee7\u7eed\u5f55\u5c4f"),this.channel===c.Channel.TT||this.channel==c.Channel.KS&&this._mediaRecorder.resume()},e.prototype.recordEnd=function(){console.log("\u5f55\u5c4f\u7ed3\u675f*--*"),this.channel==c.Channel.TT||this.channel==c.Channel.KS&&this._mediaRecorder.stop()},e.prototype.recordCut=function(t){this.channel==c.Channel.TT?console.log("\u5f55\u5c4f"+this._videoRes):this.channel==c.Channel.KS?this._mediaRecorder.publishVideo({}):(console.log("\u5047\u88c5\u5206\u4eab\u89c6\u9891\u6210\u529f"),t())},e.prototype.authorize=function(t){this.channel==c.Channel.TT||this.channel==c.Channel.KS||(this.channel==c.Channel.DEFAULT?t(null):(this.channel,c.Channel.WECHAT))},e.prototype.initGame=function(){},e.prototype.loginOut=function(){},e.prototype.isShowRecordBtn=function(){return this.channel==c.Channel.TT||this.channel==c.Channel.KS},e.prototype.isWechat=function(){return this.channel==c.Channel.WECHAT},e}(s.ObjectWrap);o.default=u,cc._RF.pop()},{"../../tyqSDK/platform/wechat/wechat":"wechat","../../tyqSDK/tyqSDK":"tyqSDK","../Guide/GuideLogic":"GuideLogic","./../../Core/FrameEx/ES5Ex":"ES5Ex","./../Common/Define":"Define","./GameMgr":"GameMgr"}],SetCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"2255d0y5PpLQZv5cczLaFpC","SetCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GView/GViewBase"),s=t("../../../Core/Manager/AudioMgr"),c=cc._decorator,l=c.ccclass,u=c.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.slider_music=null,e.slider_effect=null,e}return n(e,t),e.prototype.onGStart=function(){t.prototype.onGStart.call(this);var e=s.AudioMgr.Ins().getMusicVolume();this.slider_music.progress=e;var o=s.AudioMgr.Ins().getEffectVolume();this.slider_effect.progress=o},e.prototype.onToggleMusci=function(t){s.AudioMgr.Ins().setMusicVolume(t?.1:0)},e.prototype.onToggleEffect=function(t){s.AudioMgr.Ins().setEffectVolume(t?1:0)},e.prototype.onSliderMusic=function(t){s.AudioMgr.Ins().setMusicVolume(t.progress)},e.prototype.onSliderEffect=function(t){s.AudioMgr.Ins().setEffectVolume(t.progress)},r([u(cc.Slider)],e.prototype,"slider_music",void 0),r([u(cc.Slider)],e.prototype,"slider_effect",void 0),r([l],e)}(a.default);o.default=h,cc._RF.pop()},{"../../../Core/GView/GViewBase":"GViewBase","../../../Core/Manager/AudioMgr":"AudioMgr"}],ShaderUtil:[function(t,e,o){"use strict";cc._RF.push(e,"15622WbImFFspo9LHsyieP4","ShaderUtil"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../../Core/GLoader/GLoader"),n=t("./../../Game/Views/ViewUtil/VIewUtil"),r=function(){function t(){}return t.gray=function(t,e){if(void 0===e&&(e=!0),t)if(e)n.ViewUtil.func.seachChildrens(t,function(t){var e=t.getComponent(cc.Sprite)||t.getComponent("MaskSprite")||t.getComponent("PlistLabel");e&&(e.setMaterial(0,cc.MaterialVariant.createWithBuiltin("2d-gray-sprite",e)),e._activateMaterial(!0))});else{var o=t.getComponent(cc.Sprite)||t.getComponent("MaskSprite")||t.getComponent("PlistLabel");o&&(o.setMaterial(0,cc.MaterialVariant.createWithBuiltin("2d-gray-sprite",o)),o._activateMaterial(!0))}},t.normal=function(t,e){if(void 0===e&&(e=!0),t)if(e)n.ViewUtil.func.seachChildrens(t,function(t){var e=t.getComponent(cc.Sprite)||t.getComponent("MaskSprite")||t.getComponent("PlistLabel");e&&(e.setMaterial(0,cc.MaterialVariant.createWithBuiltin("2d-sprite",e)),e._activateMaterial(!0))});else{var o=t.getComponent(cc.Sprite)||t.getComponent("MaskSprite")||t.getComponent("PlistLabel");o&&(o.setMaterial(0,cc.MaterialVariant.createWithBuiltin("2d-sprite",o)),o._activateMaterial(!0))}},t.circularMask1=function(t){var e=i.GLoader.getPreLoadAsset("Materials/sp-circular");if(t){var o=t.getComponent(cc.Sprite);o&&o.setMaterial(0,e)}},t}();o.default=r,cc._RF.pop()},{"../../Core/GLoader/GLoader":"GLoader","./../../Game/Views/ViewUtil/VIewUtil":"VIewUtil"}],SignInCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"60173bMdMNJf70beBvlvPBf","SignInCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a},a=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0});var s=t("../../../conventions/JXCommon"),c=t("../../../Core/GCtrl"),l=t("../../../Core/GView/GViewBase"),u=t("../../../Shaders/Manager/ShaderUtil"),h=t("../../Common/Define"),p=t("../../Common/Language"),d=t("../../Common/TimeUtils"),f=t("../../Common/UI"),g=t("../../Common/UIResources"),_=t("../../Common/Zh"),m=t("../../Logic/GameMgr"),y=t("../../Logic/UserMgr"),v=t("./ItemSignIn"),C=cc._decorator,I=C.ccclass,E=C.property,S=C.menu,R=(C.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lb_ct=null,e.lb_day=null,e.Signed=null,e.signBtn=null,e.adSiBtn=null,e.signBtnArr=[],e.items=[],e.itemTemp=null,e.signCount=0,e.officerLv=0,e.signOfficerLv=0,e.awardDatas=null,e}return n(e,t),e.prototype.onGLoad=function(){this.getSignLv()},e.prototype.onGStart=function(){t.prototype.onGStart.call(this),this.getSignAwardData(),this.initSignAward(),this.initSignState(),this.initLeftTime(),this.setRedPoint(),c.GCtrl.ES.on(c.GCtrl.GTimerSecondEventMsg,this,this.initLeftTime.bind(this))},e.prototype.setRedPoint=function(){var t=m.default.userMgr.checkSignRedPoint();m.default.redMgr.setRPointView(this.adSiBtn,this.adSiBtn,t,h.RedpointEffect.REDPOINT),m.default.redMgr.setRPointView(this.signBtn,this.signBtn,t,h.RedpointEffect.REDPOINT)},e.prototype.getSignAwardData=function(){this.awardDatas=m.default.signInData.getSignByLv(this.signOfficerLv)},e.prototype.initSignAward=function(){for(var t=this.awardDatas,e=0;e<7;e++){var o=cc.instantiate(this.itemTemp);o.parent=this.items[e],o.x=o.y=0;var i=o.getComponent(v.default);i.initTextureWithData(t[e],e),this.assetImpl.spriteAtlasFrame(o.getChildByName("labDay").getComponent(cc.Sprite),g.Res.texture.views.sign,"day"+(e+1)),i.init()}this.itemTemp.active=!1},e.prototype.getSignLv=function(){var t=this;this.officerLv=m.default.lUserData.officerLv,this.signOfficerLv=m.default.lUserData.signOfficerLv;var e=[],o=-1;this.signCount=m.default.lUserData.getSignCount(),7!=this.signCount||m.default.lUserData.todayIsSignIn()||(this.signCount=0,m.default.lUserData.setSignCount(this.signCount)),0!=this.signCount&&7!=this.signCount||(m.default.signInData.data.forEach(function(t){o<t.lv&&(o=t.lv,e.push(o))}),e.forEach(function(o){o==t.officerLv?t.signOfficerLv=o:t.officerLv>e.length-1&&(t.signOfficerLv=e[e.length-1])}),m.default.lUserData.signOfficerLv=this.signOfficerLv)},e.prototype.initSignState=function(){for(var t=m.default.lUserData.getSignCount(),e=m.default.lUserData.getSignTodayIndex(),o=0;o<s.JXDef.System.SIGN_ROUND;o++){var i=this.items[o].getChildByName("item_signIn").getComponent(v.default);o<t?i.haveSigned():o>t?i.hideSigned():(i.recoverySigned(),i.showTodayToday(o==e))}t==e?(this.Signed.active=!0,u.default.gray(this.signBtnArr[0]),m.default.lUserData.doubleSign()&&(u.default.gray(this.signBtnArr[1]),this.adSiBtn.removeComponent(cc.Animation))):this.Signed.active=!1},e.prototype.initLeftTime=function(){var t=new Date(c.GCtrl.now),e=3600*t.getHours();e+=60*t.getMinutes();var o=86400-(e+=t.getSeconds());this.lb_ct.string=d.default.formatClock(o,"hh:mm:ss")},e.prototype.recAward=function(t){var e=m.default.lUserData.getSignCount(),o=null,i=null;m.default.lUserData.todayIsSignIn()?(o=m.default.signInData.getRaw(e),i=new(Array.bind.apply(Array,a([void 0],o.award)))):(o=m.default.signInData.getRaw(e+1),i=new(Array.bind.apply(Array,a([void 0],o.award)))),t&&(i.forEach(function(t){t[2]*=2}),u.default.gray(this.signBtnArr[1])),this.Signed.active=!0,u.default.gray(this.signBtnArr[0]),m.default.jumpToMgr.jumpGoTo(f.VIEW_ID.rewardCtrl,i),m.default.lUserData.todayIsSignIn()||(m.default.sdkMgr.umaSetPoint(s.JXDef.umaPoint.signCtrl,{msg:p.L(_.JXLocales.tower.sign,e+1)}),m.default.lUserData.signIn()),this.initSignState()},e.prototype.onSignClick=function(){m.default.lUserData.todayIsSignIn()||(this.recAward(!1),this.setRedPoint(),m.default.redMgr.sendValueSettingMsg(h.RPointMask.RPM_Sign,!1),y.default.ins().addDailyTaskState(2,1))},e.prototype.onSignAdClick=function(){var t=this;m.default.lUserData.doubleSign()||m.default.sdkMgr.watchAd(function(){t.recAward(!0),t.setRedPoint(),m.default.lUserData.signDouble(),t.signBtnArr[1].removeComponent(cc.Animation),m.default.redMgr.sendValueSettingMsg(h.RPointMask.RPM_Sign,!1),m.default.sdkMgr.umaSetPoint(s.JXDef.umaPoint.signCtrl,{msg:h.PointInfo.sign_ad}),y.default.ins().addDailyTaskState(2,1)},function(){},"\u7b7e\u5230\u53cc\u500d")},e.prototype.close=function(){this.onClose()},r([E(cc.Label)],e.prototype,"lb_ct",void 0),r([E(cc.Sprite)],e.prototype,"lb_day",void 0),r([E(cc.Node)],e.prototype,"Signed",void 0),r([E(cc.Node)],e.prototype,"signBtn",void 0),r([E(cc.Node)],e.prototype,"adSiBtn",void 0),r([E(cc.Node)],e.prototype,"signBtnArr",void 0),r([E(cc.Node)],e.prototype,"items",void 0),r([E(cc.Node)],e.prototype,"itemTemp",void 0),r([I,S("View/Home/SignInCtrl")],e)}(l.default));o.default=R,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../../Core/GView/GViewBase":"GViewBase","../../../Shaders/Manager/ShaderUtil":"ShaderUtil","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/Language":"Language","../../Common/TimeUtils":"TimeUtils","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Common/Zh":"Zh","../../Logic/GameMgr":"GameMgr","../../Logic/UserMgr":"UserMgr","./ItemSignIn":"ItemSignIn"}],SkillItem:[function(t,e,o){"use strict";cc._RF.push(e,"8dcfcRem9pEKrkSkaaZiJ5u","SkillItem");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GView/GChild"),s=t("../../../Shaders/Manager/ShaderUtil"),c=t("../../Common/UI"),l=t("../../Common/UIResources"),u=t("../../Logic/GameMgr"),h=cc._decorator,p=h.ccclass,d=h.property,f=h.menu,g=(h.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.icon=null,e._data=null,e}return n(e,t),e.prototype.setView=function(t,e){this._data=t,e||s.default.gray(this.icon.node),this.assetImpl.spriteAtlasFrame(this.icon,l.Res.texture.views.skillIcon,t.icon.toString())},e.prototype.skillClick=function(){this.node.getComponent(cc.Button).interactable&&u.default.jumpToMgr.jumpGoTo(c.VIEW_ID.skillPage,this._data)},r([d(cc.Sprite)],e.prototype,"icon",void 0),r([p,f("View/Home/SkillItem")],e)}(a.default));o.default=g,cc._RF.pop()},{"../../../Core/GView/GChild":"GChild","../../../Shaders/Manager/ShaderUtil":"ShaderUtil","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr"}],SkillPage:[function(t,e,o){"use strict";cc._RF.push(e,"d37fdC/zKZFaJXjowTnm+Gh","SkillPage");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/GView/GViewBase"),c=t("../../Common/UIResources"),l=t("../../Logic/GameMgr"),u=cc._decorator,h=u.ccclass,p=u.property,d=u.menu,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.skillName=null,e.skillImg=null,e.skillInfo=null,e.skillLock=null,e.skillBtn=null,e._carName=[],e}return n(e,t),e.prototype.onGStart=function(t,e){1==e&&(this.skillLock.node.active=!1,this.skillBtn.active=!0),this.initCarName(),this.initView(t)},e.prototype.initCarName=function(){var t=l.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.white);this._carName.push(t);var e=l.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.green);this._carName.push(e);var o=l.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.Blue);this._carName.push(o);var i=l.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.purple);this._carName.push(i);var n=l.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.orange);this._carName.push(n);var r=l.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.red);this._carName.push(r)},e.prototype.initView=function(t){this.skillName.string=t.name,this.skillInfo.string=t.txt,this.skillInfo.spacingX=10,this.skillLock.string="\u89e3\u9501\u7b49\u7ea7\uff1a\u54c1\u8d28="+this._carName[t.unlockingState[0]]+t.unlockingState[1]+"\u7ea7",this.assetImpl.spriteAtlasFrame(this.skillImg,c.Res.texture.views.skillIcon,t.icon.toString())},e.prototype.close=function(){this.onClose()},r([p({type:cc.Label,tooltip:"\u6280\u80fd\u540d\u5b57"})],e.prototype,"skillName",void 0),r([p({type:cc.Sprite,tooltip:"\u6280\u80fd\u56fe\u7247"})],e.prototype,"skillImg",void 0),r([p({type:cc.Label,tooltip:"\u6280\u80fd\u4fe1\u606f"})],e.prototype,"skillInfo",void 0),r([p({type:cc.Label,tooltip:"\u6280\u80fd\u89e3\u9501\u6761\u4ef6"})],e.prototype,"skillLock",void 0),r([p({type:cc.Node,tooltip:"\u6280\u80fd\u4fe1\u606f"})],e.prototype,"skillBtn",void 0),r([h,d("View/Home/SkillPage")],e)}(s.default);o.default=f,cc._RF.pop()},{"../../../Core/GView/GViewBase":"GViewBase","../../../conventions/JXCommon":"JXCommon","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr"}],SquadCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"cd98a7DRX9PTqmhSY+BkINW","SquadCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/CoreDefine"),s=t("../../../Core/GCtrl"),c=t("../../../Core/GView/GPage"),l=t("../../Common/Define"),u=t("../../Common/UIResources"),h=t("../../Logic/GameMgr"),p=t("../../Manager/RoleManager"),d=t("./../../Logic/HeroMgr"),f=t("./HeroCardItem"),g=cc._decorator,_=g.ccclass,m=g.property,y=g.menu,v=(g.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._rHeroDataBattle=null,e.cardView=null,e.content=null,e.mask=null,e.storeWindow=null,e.battle=null,e.battle1=null,e.break=null,e._listView=null,e._curListIndex=0,e}return n(e,t),e.prototype.onGLoad=function(){this.node.setContentSize(cc.winSize),s.GCtrl.ES.on(l.CMsg.client.home.onheroBattleItem,this,this.render.bind(this),a.PRIORITY_VIEW),s.GCtrl.ES.on(l.CMsg.client.hero.onAddHero,this,this.initList.bind(this),a.PRIORITY_VIEW),s.GCtrl.ES.on(l.CMsg.client.hero.onHeroLvUp,this,this.initList.bind(this),a.PRIORITY_VIEW),s.GCtrl.ES.on(l.CMsg.client.hero.onHeroBreach,this,this.initList.bind(this),a.PRIORITY_VIEW),s.GCtrl.ES.on(l.CMsg.client.hero.onHeroAddStar,this,this.initList.bind(this),a.PRIORITY_VIEW)},e.prototype.onPageIn=function(){this.initList(),this._rHeroDataBattle=h.default.rHeroData.heroIdsInBattle,this.render(),this.renderIcon();var t,e=cc.view.getFrameSize(),o=cc.view.getDesignResolutionSize();t=e.width/e.height<=640/1136?e.width/o.width:e.height/o.height,this.mask.height=Math.min(e.height/t/2-568+490,650),this.mask.parent.height=this.content.height,this.storeWindow.height=Math.min(e.height/t/2-568+580,740)},e.prototype._onTouchStar=function(){s.GCtrl.ES.emit(l.CMsg.client.home.onBattleItem,-1)},e.prototype.initEmbattle=function(){},e.prototype.initList=function(){var t=this,e=h.default.rHeroData.getHaveHeros(this._curListIndex),o=e.have,i=[d.IHeroSort.sortLvUp,d.IHeroSort.sortStart,d.IHeroSort.sortZhanli];o.sort(function(t,e){return d.IHeroSort.sorts(i,t,e)});var n=e.notHave,r=this;this.content.removeAllChildren(),this.assetImpl.prefab(u.Res.prefab.item.heroCardItem,function(e){for(var i=0;i<o.length;i++){var a=o[i];(c=cc.instantiate(e)).parent=t.content,c.name="item_"+i,r.onItemSetter(c.getComponent(f.default),a,i)}var s=o.length;for(i=0;i<n.length;i++){var c,l=n[i];(c=cc.instantiate(e)).parent=t.content,c.name="item_"+(i+s),r.onItemSetter(c.getComponent(f.default),l,i)}})},e.prototype.dealWithData=function(){var t=h.default.rHeroData.getHaveHeros(this._curListIndex).have,e=[d.IHeroSort.sortLvUp,d.IHeroSort.sortStart,d.IHeroSort.sortZhanli];t.sort(function(t,o){return d.IHeroSort.sorts(e,t,o)}),this._listView.setData(t)},e.prototype.btnOnce=function(t){this._curListIndex=Number(t.node._name),s.GCtrl.ES.emit(l.CMsg.client.home.onBattleItem,-1),this.dealWithData()},e.prototype.onItemSetter=function(t,e,o){t.setSeatNode(this.battle1),t.init(e,o,l.LISTENTTYPE.listent1)},e.prototype.render=function(){for(var t=h.default.rHeroData.getHaveHeros(this._curListIndex).have,e=0,o=0;o<this._rHeroDataBattle.length;o++)-1!=Number(this._rHeroDataBattle[o])&&e++;var i=e<t.length&&e<5;for(o=0;o<this._rHeroDataBattle.length;o++)if(-1!=Number(this._rHeroDataBattle[o])){this.battle.children[o].getChildByName("prepareBattle").active=!0,this.battle.children[o].getChildByName("wait").active=!1,this.battle.children[o].getChildByName("touying").active=!0;var n=h.default.heroData.getRaw(this._rHeroDataBattle[o]);this.battle.children[o].getChildByName("prepareBattle").scale=.6*n.roleScale,this.battle.children[o].getChildByName("xiazhen").active=!0,p.default.getInstance().changeNodeSkel(this.battle.children[o].getChildByName("prepareBattle"),this._rHeroDataBattle[o])}else this.battle.children[o].getChildByName("prepareBattle").active=!1,this.battle.children[o].getChildByName("wait").active=i,this.battle.children[o].getChildByName("touying").active=!1,this.battle.children[o].getChildByName("xiazhen").active=!1;h.default.redMgr.sendValueSettingMsg(l.RPointMask.RPM_Go_To_Battle,!1)},e.prototype.renderIcon=function(){for(var t=0;t<this._rHeroDataBattle.length;t++)-1!=this._rHeroDataBattle[t]?this.battle.children[t].getChildByName("prepareBattle").active=!0:this.battle.children[t].getChildByName("prepareBattle").active=!1},e.prototype.childClick=function(){},e.prototype.addHeroBattle=function(t,e){for(var o=h.default.rHeroData.getHaveHeros(this._curListIndex).have,i=0;i<o.length;i++)if(!h.default.rHeroData.checkHeroIsInBattle(o[i].tableId))return h.default.rHeroData.heroIdsInBattle[e]=o[i].tableId,s.GCtrl.ES.emit(l.CMsg.client.home.onHeroItem,[l.FRONT.battle,o[i].tableId]),s.GCtrl.ES.emit(l.CMsg.client.home.onheroBattleItem),void this.render()},e.prototype.isBattle=function(t,e){this.brush(Number(e))},e.prototype.brush=function(t){var e=h.default.rHeroData.heroIdsInBattle;-1!=e[t]&&(s.GCtrl.ES.emit(l.CMsg.client.home.onHeroItem,[l.FRONT.Lower,e[t]]),e[t]=-1,s.GCtrl.ES.emit(l.CMsg.client.home.onheroBattleItem)),h.default.rHeroData.heroIdsInBattle=e},e.prototype.oneKey=function(){var t=h.default.rHeroData.heroIdsInBattle,e=h.default.rHeroData.getHaveHeros(this._curListIndex).have,o=[d.IHeroSort.sortLvUp,d.IHeroSort.sortStart,d.IHeroSort.sortZhanli];e.sort(function(t,e){return d.IHeroSort.sorts(o,t,e)});var i=[];t.forEach(function(o,n){-1==o&&i.push(n),n==t.length-1&&(i.length>=e.length?i.forEach(function(o,i){e[i]&&(t[o]=e[i].tableId,s.GCtrl.ES.emit(l.CMsg.client.home.onHeroItem,[l.FRONT.battle,e[i].tableId]),s.GCtrl.ES.emit(l.CMsg.client.home.onheroBattleItem))}):i.forEach(function(o,i){t[o]=e[i].tableId,s.GCtrl.ES.emit(l.CMsg.client.home.onHeroItem,[l.FRONT.battle,e[i].tableId]),s.GCtrl.ES.emit(l.CMsg.client.home.onheroBattleItem)}))}),h.default.rHeroData.heroIdsInBattle=t},r([m(cc.ScrollView)],e.prototype,"cardView",void 0),r([m(cc.Node)],e.prototype,"content",void 0),r([m(cc.Node)],e.prototype,"mask",void 0),r([m(cc.Node)],e.prototype,"storeWindow",void 0),r([m(cc.Node)],e.prototype,"battle",void 0),r([m(cc.Node)],e.prototype,"battle1",void 0),r([m(cc.Node)],e.prototype,"break",void 0),r([_,y("View/Hero/SquadCtrl")],e)}(c.default));o.default=v,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/GCtrl":"GCtrl","../../../Core/GView/GPage":"GPage","../../Common/Define":"Define","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr","../../Manager/RoleManager":"RoleManager","./../../Logic/HeroMgr":"HeroMgr","./HeroCardItem":"HeroCardItem"}],StoreCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"7c37eIndkNMNrcLIz9mxw3L","StoreCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/CoreDefine"),c=t("../../../Core/GView/GPage"),l=t("../../../Core/Math/MathEx"),u=t("../../Common/Define"),h=t("../../Common/UI"),p=t("../../Common/UIResources"),d=t("../../Data/RunTime/RunRaw/RJXItem"),f=t("../../Logic/GameMgr"),g=t("./../../Common/Define"),_=t("./StoreEquipItem"),m=cc._decorator,y=m.ccclass,v=m.property,C=m.menu,I=(m.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.content=null,e.maskView=null,e.timeLabel=null,e.btnUpdate=null,e.buyBtn=[],e._equipData=null,e._curEquipIndex=1,e._curOnceEquip=[],e._curOnceEquipState=[],e.heroLv=1,e.buyArr=[],e._arr=[],e._bool=!1,e._allGoodsPos=[],e}var o;return n(e,t),o=e,e.prototype.onGLoad=function(){this.node.setContentSize(cc.winSize),this._equipData=f.default.equipData.data.values(),this.goodsPos(),this.init();var t,e=cc.view.getFrameSize(),o=cc.view.getDesignResolutionSize();t=e.width/e.height<=640/1136?e.width/o.width:e.height/o.height,this.maskView.height=Math.min(e.height/t/2-568+600,700)-6,this.maskView.parent.height=Math.min(e.height/t/2-568+600,700),this.maskView.y=this.maskView.height/2-3},e.prototype.btnOnce=function(t){this._curEquipIndex=Number(t.node._name),this.init()},e.prototype.updateStoreData=function(){o.storeItemData=[],o.storeItemState=[],this.init(),this.btnUpdate.interactable=!1,this.timeLabel.active=!0;var t=10,e=this.timeLabel.getComponent(cc.Label),i=this;e.string=t+"\u79d2\u540e\u53ef\u4ee5\u5237\u65b0",this.schedule(function(){t--,e.string=t+"\u79d2\u540e\u53ef\u4ee5\u5237\u65b0",t<=0&&(e.string="")},1,10),this.scheduleOnce(function(){i.btnUpdate.interactable=!0,i.timeLabel.active=!1},10)},e.prototype.section=function(t){for(var e=f.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.lvCap),o=Number(e)/10,i=!1,n=1,r=0;r<o;r++)i||(t<=10?(i=!0,n=r):t>=10*(r+1)&&t<10*(r+2)?(i=!0,n=r+1):t>=10*o&&(i=!0,n=o));return n},e.prototype.goodsPos=function(){for(var t=0;t<5;t++)for(var e=0;e<4;e++){var o=[t,e];this._allGoodsPos.push(o)}},e.prototype.init=function(){var t=this;this.buyArr=[],this.heroLv=f.default.rHeroData.curHeroTypeMaxLv(this._curEquipIndex);var e=this.section(this.heroLv);this._curOnceEquip[this._curEquipIndex]=f.default.equipData.getEquipByEquip(this._curEquipIndex,10*e),this.assetImpl.prefab(p.Res.prefab.vw.store.storeEquipItem,function(e){var o={pillIndex:null,chipIndex:null,pillInfo:null,chipInfo:null},i=null;i=s.OBJECT_COPY(t._allGoodsPos);var n=l.default.random(0,i.length-1);o.pillIndex=[i[n]],i.splice(n,1);var r=f.default.lvData.getRaw(t.heroLv).quality+1;r>=6&&(r=6),o.pillInfo=r;for(var a=[],c=[],h=0;h<0;h++){var p=f.default.rHeroData.getHaveHeros(u.SQUAD_BUTTON.ALL),d=p.have.length+p.notHave.length,g=l.default.random(1,d);c.push(g);var m=l.default.random(0,i.length-1);a.push(i[m]),i.splice(m,1)}if(o.chipIndex=a,o.chipInfo=c,t.content.children.length>=5)for(h=0;h<5;h++)(y=t.content.children[h].getComponent(_.default)).init(t._curOnceEquip[t._curEquipIndex],t._curEquipIndex,o,h);else for(h=0;h<5;h++){var y;(y=t.assetImpl.addGChild(e)).node.parent=t.content,y.init(t._curOnceEquip[t._curEquipIndex],t._curEquipIndex,o,h)}})},e.prototype.setRedPoint=function(){for(var t=0;t<this.buyArr.length;t++);for(t=0;t<this.buyBtn.length;t++){var e=this.buyBtn[t];if(e.type!==u.STOREBUYTYPE.VIDEO){var o=new d.default([e.id,g.ITEM_TYPE.CURRENCY,e.num]);f.default.itemMgr.testCost(o,1,!1)}}f.default.redMgr.sendValuesSettingMsgs([u.RPointMask.RPM_Box_Baiyin,u.RPointMask.RPM_Box_Huangjin,u.RPointMask.RPM_Box_Zhuanshu],!1)},e.prototype.close=function(){f.default.jumpToMgr.jumpGoTo(h.VIEW_ID.mainPage)},e.storeItemData=[],e.storeItemState=[],r([v({type:cc.Node,tooltip:"\u5b9d\u5e93content"})],e.prototype,"content",void 0),r([v({type:cc.Node,tooltip:"\u906e\u7f69"})],e.prototype,"maskView",void 0),r([v({type:cc.Node,tooltip:"\u5012\u8ba1\u65f6"})],e.prototype,"timeLabel",void 0),r([v({type:cc.Button,tooltip:"\u5237\u65b0\u6309\u94ae"})],e.prototype,"btnUpdate",void 0),o=r([y,C("View/Store/StoreCtrl")],e)}(c.default));o.default=I,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/GView/GPage":"GPage","../../../Core/Math/MathEx":"MathEx","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Data/RunTime/RunRaw/RJXItem":"RJXItem","../../Logic/GameMgr":"GameMgr","./../../Common/Define":"Define","./StoreEquipItem":"StoreEquipItem"}],StoreEquipItem:[function(t,e,o){"use strict";cc._RF.push(e,"0be3eIMpuJF3KQEhW6JiqD2","StoreEquipItem");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/CoreDefine"),c=t("../../../Core/GCtrl"),l=t("../../../Core/GView/GChild"),u=t("../../../Core/Math/MathEx"),h=t("../../../Shaders/Manager/ShaderUtil"),p=t("../../Common/Define"),d=t("../../Common/Language"),f=t("../../Common/UI"),g=t("../../Common/UIResources"),_=t("../../Common/Zh"),m=t("../../Data/RunTime/RunRaw/RItemAttach"),y=t("../../Data/RunTime/RunRaw/RJXItem"),v=t("../../Logic/GameMgr"),C=t("../../Logic/SdkMgr"),I=t("../../Logic/UserMgr"),E=t("../Common/JXItem"),S=t("./StoreCtrl"),R=cc._decorator,D=R.ccclass,b=R.menu,w=R.property,A=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.storeItem=[],e.storeSell=[],e.storeImg=[],e.buyArr=[],e._curOnceEquip=null,e._curEquipIndex=1,e._index=0,e._type=null,e._replaceId=[],e}return n(e,t),e.prototype.onGLoad=function(){c.GCtrl.ES.on(p.CMsg.client.bag.onCurrencyChange,this,this.setRedPoint.bind(this),s.PRIORITY_VIEW)},e.prototype.touchLock=function(t,e){v.default.uiMgr.showToast("\u901a\u5173\u7b2c"+e+"\u5173\u5373\u53ef\u5f00\u542f\u54e6")},e.prototype.init=function(t,e,o,i){var n=this;this.buyArr=[],this._index=i;var r,s=[],c=v.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.sell);this._curOnceEquip=t,this._curEquipIndex=e,this._replaceId=[];for(var l,d=function(t){_.storeItem[t].getChildByName("sell").getComponent(cc.Button).interactable=!0,h.default.normal(_.storeItem[t].getChildByName("sell"),!0);var e=4*_._index+t+_._curEquipIndex+5*(4*_._index+t);S.default.storeItemData[e]=S.default.storeItemData[e]||u.default.random(0,_._curOnceEquip.length-1);var i=S.default.storeItemData[e];l=null;var a=!1;if(a=!1,_._type=null,_._index==o.pillIndex[0][0]&&t==o.pillIndex[0][1]&&(_._type=p.GOODSTYPE.PILL,a=!0),o.chipIndex.forEach(function(e,o){e[1]==t&&e[0]==n._index&&(n._type=p.GOODSTYPE.CHIP,l=o,a=!0)}),!a)if(_._curOnceEquip[i].trait<4)for(var d=u.default.random(0,c.length-2),I=0;I<c.length;I++)I==d&&(r=c[I]);else r=3;if(_.assetImpl.prefab(g.Res.prefab.item.jxItem,function(e){var r=n.storeItem[t].getChildByName("JXItem"),a=n.storeItem[t].getChildByName("lockNode");a.zIndex=10;var s=4*n._index+t+n._curEquipIndex+5*(4*n._index+t);if(n._index<=0||C.default.ins._isWhitePag?a.active=!1:(a.active=v.default.lUserData.level+43<s,v.default.lUserData.level<s&&(a.getChildByName("singleColor").off(cc.Node.EventType.TOUCH_END),a.getChildByName("singleColor").on(cc.Node.EventType.TOUCH_END,function(){v.default.uiMgr.showToast("\u901a\u5173\u7b2c"+(s-43)+"\u5173\u5373\u53ef\u5f00\u542f\u54e6")},n))),null==r){var c=n.assetImpl.addGChild(e);c.node.parent=n.storeItem[t],c.node.setPosition(6,0),r=c.node}var u=null;if(n._type){if(n._type==p.GOODSTYPE.CHIP){u=[1e3+o.chipInfo[l],p.ITEM_TYPE.PROP,1],n._replaceId.push(1e3+o.chipInfo[l]);var h=new y.default(u);n.assetImpl.spriteAtlasFrame(n.storeItem[t].getComponent(cc.Sprite),g.Res.texture.views.common,"equip_1"),r.getComponent(E.default).setView(h,p.ITEM_DETAIL_FLAG.NO_BG|p.ITEM_DETAIL_FLAG.NUMPOS_ITEM_BC|p.ITEM_DETAIL_FLAG.NO_NUM|p.ITEM_DETAIL_FLAG.SCALEICON|p.ITEM_DETAIL_FLAG.STOREHERO,function(){}),n._type=null}n._type==p.GOODSTYPE.PILL&&(u=[200+o.pillInfo,p.ITEM_TYPE.PROP,1],n._replaceId.push(200+o.pillInfo),n.storeItem[t].getChildByName("icon_201").active=!0,n.assetImpl.spriteAtlasFrame(n.storeItem[t].getChildByName("icon_201").getComponent(cc.Sprite),g.Res.texture.views.icon,"icon_20"+o.pillInfo),n.assetImpl.spriteAtlasFrame(n.storeItem[t].getComponent(cc.Sprite),g.Res.texture.views.common,"equip_"+o.pillInfo),r.active=!1,n._type=null)}else{r.active=!0,n._replaceId.push(null),u=[n._curOnceEquip[i].id,p.ITEM_TYPE.EQUIPDATA,1],h=new y.default(u);var d={insId:"",bool:!1,site:0},_=n,I=function(){_.buyClick(null,t,s)};S.default.storeItemState[s]&&1==S.default.storeItemState[s]&&n.store(t,s,!1),r.getComponent(E.default).setView(h,p.ITEM_DETAIL_FLAG.NO_BG|p.ITEM_DETAIL_FLAG.NUMPOS_ITEM_BC|p.ITEM_DETAIL_FLAG.NO_NUM|p.ITEM_DETAIL_FLAG.SCALEICON|p.ITEM_DETAIL_FLAG.STORECHIPHIDE,function(){var t=["0",n._curOnceEquip[i].id,0],e=new m.REquireItem(t);console.log("curindex = ",s),v.default.jumpToMgr.jumpGoTo(f.VIEW_ID.EquipDetailsCtrl,e,d,null,S.default.storeItemState[s]&&1==S.default.storeItemState[s]?null:p.DETAILSBTN.DETAILSBTN3,I)})}}),a)_.buyArr.push(null);else{_.storeItem[t].getChildByName("icon_201").active=!1;var R={sell:r,sellData:_._curOnceEquip[i]};_.buyArr.push(R),_.assetImpl.spriteAtlasFrame(_.storeItem[t].getComponent(cc.Sprite),g.Res.texture.views.common,"equip_"+_._curOnceEquip[i].trait)}s.push(i)},_=this,I=0;I<this.storeItem.length;I++)d(I);s.forEach(function(t,e){n.initBtnLab(e,t)}),this.setRedPoint()},e.prototype.initBtnLab=function(t){if(!this.buyArr[t])return this.storeSell[t].node.x=47,this.storeSell[t].string="\u9886\u53d6",this.storeImg[t].spriteFrame=null,this.assetImpl.spriteAtlasFrame(this.storeImg[t],g.Res.texture.views.icon,"icon_video"),void this.storeImg[t].node.setScale(.7);switch(this.buyArr[t].sell){case p.SELLSTORE.COIN:this.storeSell[t].node.x=47,this.storeSell[t].string=d.LCoin(this.buyArr[t].sellData.sellRecycle[p.SELLSTORE.COIN-1]),this.assetImpl.spriteAtlasFrame(this.storeImg[t],g.Res.texture.views.icon,"icon_101b"),this.storeImg[t].node.setScale(.8);break;case p.SELLSTORE.DIAMONDS:this.storeSell[t].node.x=47,this.storeSell[t].string=d.LCoin(this.buyArr[t].sellData.sellRecycle[p.SELLSTORE.DIAMONDS-1]),this.assetImpl.spriteAtlasFrame(this.storeImg[t],g.Res.texture.views.icon,"icon_100b"),this.storeImg[t].node.setScale(.8);break;case p.SELLSTORE.VIDEO:this.storeSell[t].node.x=47,this.storeSell[t].string="\u9886\u53d6",this.storeImg[t].spriteFrame=null,this.assetImpl.spriteAtlasFrame(this.storeImg[t],g.Res.texture.views.icon,"icon_video"),this.storeImg[t].node.setScale(.7);break;case p.SELLSTORE.FREE:this.storeSell[t].node.x=33,this.storeSell[t].string="\u514d\u8d39",this.storeImg[t].spriteFrame=null}0==this.storeItem[t].getChildByName("sell").getComponent(cc.Button).interactable&&(this.storeSell[t].string="\u5df2\u9886\u53d6")},e.prototype.setRedPoint=function(){v.default.redMgr.sendValuesSettingMsgs([p.RPointMask.RPM_Box_Baiyin,p.RPointMask.RPM_Box_Huangjin,p.RPointMask.RPM_Box_Zhuanshu],!1)},e.prototype.buyClick=function(t,e,o){var i=this,n=!1;if(e=parseInt(e+""),o=o||4*this._index+e+this._curEquipIndex+5*(4*this._index+e),this.buyArr[e]){switch(this.buyArr[e].sell){case p.SELLSTORE.FREE:n=!0,this.buyArr[e].sell=p.SELLSTORE.COIN,v.default.lUserData.useDayFree(),this.setRedPoint(),n&&this.store(e,o);break;case p.SELLSTORE.COIN:var r=this.buyArr[e].sellData.sellRecycle[p.SELLSTORE.COIN-1],s=new y.default([p.CURRENCY.GOLD,p.ITEM_TYPE.CURRENCY,r]);(l=v.default.itemMgr.testCost(s,1,!0)).enough?(c.GCtrl.ES.emit(p.CMsg.client.bag.onBagItemChange,[[p.CURRENCY.GOLD,p.ITEM_TYPE.CURRENCY,-r]]),(n=!0)&&this.store(e,o)):v.default.uiMgr.showToast(l.tip);break;case p.SELLSTORE.DIAMONDS:r=this.buyArr[e].sellData.sellRecycle[p.SELLSTORE.DIAMONDS-1];var l,u=new y.default([p.CURRENCY.YUSHI,p.ITEM_TYPE.CURRENCY,r]);(l=v.default.itemMgr.testCost(u,1,!0)).enough?(c.GCtrl.ES.emit(p.CMsg.client.bag.onBagItemChange,[[p.CURRENCY.YUSHI,p.ITEM_TYPE.CURRENCY,-r]]),(n=!0)&&this.store(e,o)):v.default.uiMgr.showToast(l.tip);break;case p.SELLSTORE.VIDEO:var d=o,g=this;v.default.sdkMgr.watchAd(function(){(n=!0)&&g.store(e,d)},function(){},"\u89e3\u9501\u5b9d\u5e93\u88c5\u5907")}var m=v.default.lUserData.heroType(this._curEquipIndex);v.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.storeCtrl,{msg:_.JXLocales.tower.store+"-"+m})}else v.default.sdkMgr.watchAd(function(){if(n=!0){i.storeItem[e].getChildByName("sell").getComponent(cc.Button).interactable=!1,h.default.gray(i.storeItem[e].getChildByName("sell"),!0);var t=[],o=[];o.push(i._replaceId[e]),o.push(p.ITEM_TYPE.PROP),o.push(p.SELLSTORE.COIN),t.push(o),v.default.jumpToMgr.jumpGoTo(f.VIEW_ID.rewardCtrl,t)}})},e.prototype.store=function(t,e,o){if(void 0===o&&(o=!0),console.log("curindex = ",e),this.storeItem[t].getChildByName("sell").getComponent(cc.Button).interactable=!1,h.default.gray(this.storeItem[t].getChildByName("sell"),!0),S.default.storeItemState[e]=1,this.storeSell[t].string="\u5df2\u8d2d\u4e70",I.default.ins().addDailyTaskState(6,1),o){var i=[],n=[];n.push(this.buyArr[t].sellData.id),n.push(p.SELLSTORE.COIN),n.push(p.SELLSTORE.COIN),i.push(n),v.default.jumpToMgr.jumpGoTo(f.VIEW_ID.rewardCtrl,i)}},r([w({type:cc.Node,tooltip:"4\u4e2a\u56fa\u5b9a\u88c5\u5907\u4f4d\u7f6e"})],e.prototype,"storeItem",void 0),r([w({type:cc.Label,tooltip:"4\u4e2a\u52a8\u6001\u6e32\u67d3\u6587\u6848"})],e.prototype,"storeSell",void 0),r([w({type:cc.Sprite,tooltip:"4\u4e2a\u52a8\u6001\u6e32\u67d3\u56fe\u7247"})],e.prototype,"storeImg",void 0),r([D,b("View/Store/StoreEquipItem")],e)}(l.default);o.default=A,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/GCtrl":"GCtrl","../../../Core/GView/GChild":"GChild","../../../Core/Math/MathEx":"MathEx","../../../Shaders/Manager/ShaderUtil":"ShaderUtil","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/Language":"Language","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Common/Zh":"Zh","../../Data/RunTime/RunRaw/RItemAttach":"RItemAttach","../../Data/RunTime/RunRaw/RJXItem":"RJXItem","../../Logic/GameMgr":"GameMgr","../../Logic/SdkMgr":"SdkMgr","../../Logic/UserMgr":"UserMgr","../Common/JXItem":"JXItem","./StoreCtrl":"StoreCtrl"}],StrengthenView:[function(t,e,o){"use strict";cc._RF.push(e,"54319/Thm9ChIHoMROPezOG","StrengthenView");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/GCtrl"),s=t("../../../Core/GEvent/GParam"),c=t("../../../Core/GView/GViewBase"),l=t("../../Common/Define"),u=t("../../Common/JXColor"),h=t("../../Common/Language"),p=t("../../Common/UICreate"),d=t("../../Common/UIResources"),f=t("../../Common/Zh"),g=t("../../Data/RunTime/RunRaw/RJXItem"),_=t("../../Logic/GameMgr"),m=cc._decorator,y=m.ccclass,v=m.menu,C=m.property,I=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.strLab=null,e.resBg=null,e.propertyParent=null,e.jxPos=null,e.info=null,e._data=null,e._qhItem=null,e}return n(e,t),e.prototype.onGStart=function(e,o){var i=this;t.prototype.onGStart.call(this),this._data=e;var n={equipId:this._data.insId,exp:this._data.sLv-1};this._data.sLv>0?this.info.string="+"+this._data.sLv+"  "+e.itemData.raw.name:this.info.string=""+e.itemData.raw.name,this.assetImpl.prefab(d.Res.prefab.item.jxItem,function(t){if(!i._qhItem){var o=i.assetImpl.addGChild(t);o.node.parent=i.jxPos,o.node.setPosition(0,0),i._qhItem=o}var n=new g.default([e.equipId,l.ITEM_TYPE.EQUIPDATA,1]);i._qhItem.setView(n,l.ITEM_DETAIL_FLAG.TPL|l.ITEM_DETAIL_FLAG.NO_NUM)}),o==l.BLESSEND_INFO.strSus?(this.strSus(n),this.assetImpl.spriteFrame(this.strLab,d.Res.bigpic.main+"synthesisTitle"),this.assetImpl.spriteFrame(this.resBg,d.Res.bigpic.main+"failBg")):o==l.BLESSEND_INFO.strFail?(this.assetImpl.spriteFrame(this.strLab,d.Res.bigpic.main+"synthesisTitle"),this.assetImpl.spriteFrame(this.resBg,d.Res.bigpic.main+"failBg"),this.jxPos.setPosition(-135,45),this.info.node.setPosition(49,48)):o==l.BLESSEND_INFO.synthesis&&(this.assetImpl.spriteFrame(this.strLab,d.Res.bigpic.main+"synthesisTitle"),this.assetImpl.spriteFrame(this.resBg,d.Res.bigpic.main+"failBg"),this._data.sLv>0&&this.strSus(n))},e.prototype.strSus=function(t){var e=this,o=_.default.RBagData.ontopEquip(null,new s.default(t)),i=_.default.equipData.getRaw(this._data.equipId).property,n=this._data.propts,r=[],a=[];o.forEach(function(t,o){0!=(t-=i[o])&&e.assetImpl.font(d.Res.font.mnpw,function(e){var i=t<1?100*t+"%":t.toString(),n=h.L(f.JXLocales.propts["info"+o],"+"+i),s=p.default.label(n);s.fontSize=21,s.lineHeight=21,s.horizontalAlign=cc.Label.HorizontalAlign.LEFT,s.node.anchorX=0,s.node.color=u.JXColor.Cffffff,s.node.addComponent(cc.LabelOutline);var c=s.node.getComponent(cc.LabelOutline);c.color=cc.color(8,89,152,255),c.width=2,s.font=e,r.push(o),a.push(s.node)})});var c=[],l=[];n.forEach(function(t,o){0!=(t-=i[o])&&e.assetImpl.font(d.Res.font.mnpw,function(e){var i=t<1?100*t+"%":t.toString(),n=h.L(f.JXLocales.propts["info"+o],"+"+i),r=p.default.label(n);r.fontSize=21,r.lineHeight=21,r.horizontalAlign=cc.Label.HorizontalAlign.LEFT,r.node.anchorX=0,r.node.color=u.JXColor.Cffffff,c.push(o),l.push(r.node),r.node.addComponent(cc.LabelOutline);var a=r.node.getComponent(cc.LabelOutline);a.color=cc.color(8,89,152,255),a.width=2,r.font=e})}),this.assetImpl.prefab(d.Res.prefab.vw.home.propertyItem,function(t){for(var o=function(o){var i=e.assetImpl.addGChild(t);e._data.sLv-1<=0?e.assetImpl.font(d.Res.font.mnpw,function(t){var e=h.L(f.JXLocales.propts["info"+o],"+0"),n=p.default.label(e);n.node.addComponent(cc.LabelOutline);var r=n.node.getComponent(cc.LabelOutline);n.node.anchorX=0,r.color=cc.color(8,89,152,255),r.width=2,n.font=t,i.node.getChildByName("topProperty").addChild(n.node),i.node.getChildByName("nextProperty").addChild(l[o])}):(a[o]?i.node.getChildByName("topProperty").addChild(a[o]):e.assetImpl.font(d.Res.font.mnpw,function(t){var e=h.L(f.JXLocales.propts["info"+o],"+0"),n=p.default.label(e);n.node.addComponent(cc.LabelOutline),n.node.anchorX=0;var r=n.node.getComponent(cc.LabelOutline);r.color=cc.color(8,89,152,255),r.width=2,n.font=t,i.node.getChildByName("topProperty").addChild(n.node)}),i.node.getChildByName("nextProperty").addChild(l[o])),e.propertyParent.addChild(i.node)},i=0;i<c.length;i++)o(i)})},e.prototype.close=function(){a.GCtrl.ES.emit(l.CMsg.client.equip.onBlessClearPut),this.onClose()},r([C({type:cc.Sprite,tooltip:"\u5f3a\u5316\u6587\u6848"})],e.prototype,"strLab",void 0),r([C({type:cc.Sprite,tooltip:"\u5f3a\u5316\u540e\u80cc\u666f"})],e.prototype,"resBg",void 0),r([C({type:cc.Node,tooltip:"\u663e\u793a\u5c5e\u6027\u8282\u70b9"})],e.prototype,"propertyParent",void 0),r([C({type:cc.Node,tooltip:"\u56fe\u6807"})],e.prototype,"jxPos",void 0),r([C({type:cc.Label,tooltip:"\u5f3a\u5316\u4fe1\u606f"})],e.prototype,"info",void 0),r([y,v("View/Home/StrengthenView")],e)}(c.default);o.default=I,cc._RF.pop()},{"../../../Core/GCtrl":"GCtrl","../../../Core/GEvent/GParam":"GParam","../../../Core/GView/GViewBase":"GViewBase","../../Common/Define":"Define","../../Common/JXColor":"JXColor","../../Common/Language":"Language","../../Common/UICreate":"UICreate","../../Common/UIResources":"UIResources","../../Common/Zh":"Zh","../../Data/RunTime/RunRaw/RJXItem":"RJXItem","../../Logic/GameMgr":"GameMgr"}],TimeLimitGift:[function(t,e,o){"use strict";cc._RF.push(e,"9c20etSfM9E1ZZV4t6BvdLk","TimeLimitGift");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/GView/GViewBase"),c=t("../../Common/Define"),l=t("../../Common/UI"),u=t("../../Common/UIResources"),h=t("../../Data/RunTime/RunRaw/RItemAttach"),p=t("../../Data/RunTime/RunRaw/RJXItem"),d=t("../../Logic/GameMgr"),f=t("../Common/JXItem"),g=cc._decorator,_=g.ccclass,m=g.property,y=g.menu,v=(g.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.equipLayout=[],e._equipArr=[],e._equipArr2=[],e}return n(e,t),e.prototype.onGLoad=function(){this.node.setContentSize(cc.winSize)},e.prototype.onGStart=function(){var e=this;t.prototype.onGStart.call(this),this.assetImpl.prefab(u.Res.prefab.item.jxItem,function(t){e.dealWithData(t)})},e.prototype.dealWithData=function(t){var e=parseInt(d.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.guideHero)),o=d.default.heroData.getRaw(e),i=d.default.equipData.getJackpotJob(o.type,o.id,0,1,4,1),n=d.default.equipData.getJackpotJob(0,o.id,0,1,4,0);this._equipArr=i,this._equipArr2=n;for(var r=0;r<i.length&&r<3;r++)this.equipLayout[r].addChild(this.setItem(t,i[r])),this.equipLayout[r].addChild(this.setItem(t,n[r]))},e.prototype.setItem=function(t,e){var o=this.assetImpl.addGChild(t);o.node.setPosition(0,0),o.node.scale=.8;var i=[e.id,c.ITEM_TYPE.EQUIPDATA,1],n=new p.default(i),r={insId:"",bool:!1,site:0};return o.node.getComponent(f.default).setView(n,c.ITEM_DETAIL_FLAG.NO_NUM|c.ITEM_DETAIL_FLAG.TPL|c.ITEM_DETAIL_FLAG.SHOWLIGHT,function(){var t=["0",e.id,0],o=new h.REquireItem(t);d.default.jumpToMgr.jumpGoTo(l.VIEW_ID.EquipDetailsCtrl,o,r,null,null,null)}),o.node},e.prototype.getEquip=function(t,e){var o=this;d.default.sdkMgr.watchAd(function(){var t=[],i=[];i.push(o._equipArr[e].id),i.push(c.SELLSTORE.COIN),i.push(c.SELLSTORE.COIN),t.push(i),(i=[]).push(o._equipArr2[e].id),i.push(c.SELLSTORE.COIN),i.push(c.SELLSTORE.COIN),t.push(i),d.default.jumpToMgr.jumpGoTo(l.VIEW_ID.rewardCtrl,t)},function(){},"\u89e3\u9501\u5f20\u98de\u5168\u5957\u88c5\u5907")},r([m({type:cc.Node,tooltip:"\u56fe\u6807\u81ea\u52a8\u6392\u5e8f"})],e.prototype,"equipLayout",void 0),r([_,y("View/Tip/TimeLimitGift")],e)}(s.default));o.default=v,cc._RF.pop()},{"../../../Core/GView/GViewBase":"GViewBase","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Data/RunTime/RunRaw/RItemAttach":"RItemAttach","../../Data/RunTime/RunRaw/RJXItem":"RJXItem","../../Logic/GameMgr":"GameMgr","../Common/JXItem":"JXItem"}],TimeUtils:[function(t,e,o){"use strict";cc._RF.push(e,"25013McdnlH6Zh8wXVyhQPq","TimeUtils"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../../conventions/JXCommon"),n=t("./../../Core/GCtrl"),r=function(){function t(){}return t.isSameDay=function(t,e){var o=new Date(t),i=new Date(e);return o.getFullYear()==i.getFullYear()&&o.getMonth()==i.getMonth()&&o.getDay()==i.getDay()},t.getSubTaskTime=function(t,e){var o=e-t,i=n.GCtrl.now-t;return Math.max(o-i,0)},t.getZeroHours=function(t){var e=t||n.GCtrl.now,o=new Date(e).getHours();return this.getDayZero(e)+o*i.JXDef.Time.HOUR},t.isPassHoursTime=function(t){var e=n.GCtrl.now;return this.getZeroHours(e)+t<e},t.isSameHours=function(t,e){return this.getZeroHours(t)==this.getZeroHours(e)},t.getDayZero=function(t,e){void 0===e&&(e=8);var o=e*i.JXDef.Time.HOUR;return 864e5*Math.floor((t+o)/864e5)-o},t.getDayEnd=function(t,e){void 0===e&&(e=8);var o=e*i.JXDef.Time.HOUR;return 864e5*Math.floor((t+o)/864e5)-o+864e5-1e3},t.isPassDayTime=function(t,e){return((e=e||n.GCtrl.now)-this.getDayZero(e))/i.JXDef.Time.HOUR>=t},t.getDayDiff=function(e,o){var i=t.getDayZero(e);return(t.getDayZero(o)-i)/864e5},t.chkPassNWeeks=function(e,o,i){var n=0;if(e>o)return n;var r=t.getMondayStamp(e);return(t.getMondayStamp(o)-r)/864e5/7>=i&&(n=1),n},t.isSameWheek=function(t,e){return e=e||n.GCtrl.now,this.getMondayStamp(t)==this.getMondayStamp(e)},t.isPassWeekTime=function(t,e){return((e=e||n.GCtrl.now)-this.getMondayStamp(e))/i.JXDef.Time.HOUR>=t},t.getMondayStamp=function(t){var e=new Date(t).getDay(),o=new Date(t-864e5*((e||7)-1));return new Date(o.getFullYear(),o.getMonth(),o.getDate()).valueOf()},t.getDayStamp=function(e,o){return t.getMondayStamp(e)+864e5*(o-1)},t.getDayHourStamp=function(e,o,n,r){return void 0===r&&(r=0),t.getMondayStamp(e)+864e5*(o-1)+n*i.JXDef.Time.HOUR+r*i.JXDef.Time.MINUTE},t.getDayTimeHM=function(t,e,o){var i=new Date(t);return new Date(i.getFullYear(),i.getMonth(),i.getDate(),e,o).valueOf()},t.timeInSameMonth=function(t,e,o){void 0===o&&(o=0);var i=new Date(e+o).getFullYear(),n=new Date(t).getFullYear(),r=new Date(e+o).getMonth(),a=new Date(t).getMonth();return i!=n?0:r!=a?0:1},t.isSameMonth=function(t,e,o){return void 0===o&&(o=0),1==this.timeInSameMonth(t,e,o)},t.timestamp=function(t){return new Date(t.replace(/-/gi,"/")).valueOf()},t.getYearDay=function(){return Math.ceil(((new Date).getTime()-new Date((new Date).getFullYear().toString()).getTime())/(24*i.JXDef.Time.HOUR))+1},t.beforeTime=function(t){var e=(new Date).getTime()-t;if(!(e<0)){var o,i=e/6e4,n=e/36e5,r=e/864e5,a=e/6048e5,s=e/2592e6,c=e/31536e6;if(c>=1)o=parseInt(c.toString())+"\u5e74\u524d";else if(s>=1&&s<=12)o=parseInt(s.toString())+"\u6708\u524d";else if(a>=1&&a<=4)o=parseInt(a.toString())+"\u5468\u524d";else if(r>=1&&r<=7)o=parseInt(r.toString())+"\u5929\u524d";else if(n>=1&&n<=24)o=parseInt(n.toString())+"\u5c0f\u65f6\u524d";else if(i>=1&&i<=60)o=parseInt(i.toString())+"\u5206\u949f\u524d";else if(e>=0&&e<=6e4)o="\u521a\u521a";else{var l=new Date;l.setTime(t),o=l.getFullYear()+"-"+(l.getMonth()+1<10?"0"+(l.getMonth()+1):l.getMonth()+1)+"-"+(l.getDate()<10?"0"+l.getDate():l.getDate())}return o}},t.getNextTimeByHours=function(t,e){return e=e||n.GCtrl.now,t>new Date(e).getHours()?this.getDayZero(e)+t*i.JXDef.Time.HOUR:this.getDayZero(e)+(24+t)*i.JXDef.Time.HOUR},t.getOffsetTime=function(t,e){var o=new Date(n.GCtrl.now);return o.setDate(o.getDate()-e),o.setHours(t,0,0,0),o.getTime()},t.getTimeByString=function(t){var e=t.split("-");if(3==e.length){var o=new Date;return o.setFullYear(Number(e[0]),Number(e[1])-1,Number(e[2])),o.getTime()}},t.getDateStr=function(t){var e=new Date(t),o=e.getFullYear(),i=e.getMonth()+1,n=e.getDate();return o+"-"+(i<10?"0"+i:i)+"-"+(n<10?"0"+n:n)+" "+e.toTimeString().substr(0,8)},t.formatClock=function(t,e){var o=Math.floor(t/3600),i=t%3600,n=Math.floor(i/60),r=i%60,a={"h+":("00"+o).substr(-2),"m+":("00"+n).substr(-2),"s+":("00"+r).substr(-2)};for(var s in a)if(new RegExp("("+s+")").test(e)){var c=a[s]+"";e=e.replace(RegExp.$1,c)}return e},t.dayEndStamp=function(t){return this.timestamp(t)+24*i.JXDef.Time.HOUR-1},t}();o.default=r,cc._RF.pop()},{"../../conventions/JXCommon":"JXCommon","./../../Core/GCtrl":"GCtrl"}],ToastCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"2f70f90tIpAhLQbkU0sAvfX","ToastCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/FrameEx/MaskSprite"),s=t("../../../Core/GView/GChild"),c=cc._decorator,l=c.ccclass,u=c.property,h=c.menu,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tip=null,e.icon=null,e.bgImage=null,e._duration=2,e._rCb=null,e}return n(e,t),e.prototype.setRcb=function(t){this._rCb=t},e.prototype.setText=function(t,e){var o=this;this.node.y=0,this.node.x=0,this.node.opacity=255;var i,n,r=t.split("$");if(r.length>1&&(i=r[0],n=parseInt(r[1]),t=r[2]),this.icon&&i?(this.icon.node.active=!0,this.icon._maskType=n,this.assetImpl.spriteFrame(this.icon,i)):this.icon&&(this.icon.node.active=!0),this.tip){e&&(this._duration=e),this.tip.string=t,this.node.y=-100;var a=cc.spawn(cc.moveTo(this._duration,cc.v2(0,100)),cc.sequence(cc.delayTime(1*this._duration/2),cc.fadeOut(1*this._duration/2))),s=cc.sequence(a,cc.callFunc(function(){o._rCb&&o._rCb(o.node)}));this.node.runAction(s),this.tip.node.width>350?this.bgImage.node.width=this.tip.node.width+50:this.bgImage.node.width=350}},e.prototype.setDuration=function(t){this._duration=t},r([u(cc.RichText)],e.prototype,"tip",void 0),r([u(a.default)],e.prototype,"icon",void 0),r([u(cc.Sprite)],e.prototype,"bgImage",void 0),r([l,h("View/Tip/ToastCtrl")],e)}(s.default);o.default=p,cc._RF.pop()},{"../../../Core/FrameEx/MaskSprite":"MaskSprite","../../../Core/GView/GChild":"GChild"}],ToastMgr:[function(t,e,o){"use strict";cc._RF.push(e,"c74d2KcjJhBip/IwbofsiD/","ToastMgr");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0}),o.Toast=void 0;var a=t("../../Core/CoreDefine"),s=t("../../Core/FrameEx/ES5Ex"),c=t("../../Core/GCtrl"),l=t("../../Core/GLoader/GLoader"),u=t("../Common/Define"),h=t("../Common/Language"),p=t("../Common/UI"),d=t("../Common/UIResources"),f=t("../Views/Tip/ToastCtrl"),g=t("./GameMgr"),_=function(t){function e(e){var o=t.call(this)||this;return o._toastQueue={},o._msgCount=0,o._targetNode=e,cc.game.on(cc.game.EVENT_SHOW,o.onGameShow.bind(o),e),c.GCtrl.ES.on(c.GCtrl.GClientWinDestroyEventMsg,o,o.TopWinChange.bind(o),a.PRIORITY_VIEW),o}return n(e,t),e.prototype.getQueue=function(t){if(t)return(o=this._toastQueue[t])?{type:t,queues:o}:null;for(var e=0;e<u.ToastType.End;e++){var o;if((o=this._toastQueue[e])&&o.length>0)return{type:e,queues:o}}return null},e.prototype.pushMsg=function(t,e){var o=this._toastQueue[t];o||(o=this._toastQueue[t]=[]),o.push(e),this._msgCount++},e.getPool=function(t){var e=this._pools[t];return e||(e=this._pools[t]=new cc.NodePool),e},e.getToastCtrl=function(t){var e=null,o=this.getPool(t);if(0==o.size()){var i=[null,d.Res.prefab.vw.tip.toast,null];return l.GLoader.addGChild(i[t],function(t){(e=t).setRcb(function(t){o?o.put(t):t.destroy()})}),e}return o.get().getComponent(f.default)},e.prototype.show=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];this.showByType.apply(this,r([u.ToastType.WarnTip,t],e))},e.prototype.showByType=function(t,e){for(var o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];var n=h.L.apply(void 0,r([e],o));this.pushMsg(t,n);var a=this._targetNode.getActionByTag(1e3);a||this.startShow()},e.prototype.startShow=function(){var t,o=this,i=this._targetNode.getActionByTag(1e3);i&&this._targetNode.stopActionByTag(1e3),(i=cc.sequence(cc.callFunc(function(){var i=o.getQueue();if(i){var n=e.getToastCtrl(i.type);if(t=i.type,n){n.node.zIndex=a.MAX_TAG,n.node.parent=o._targetNode;var r=Math.min(1.5,.1*o._msgCount);n.setDuration(2-r),n.setText(i.queues[0]),i.type,u.ToastType.WarnTip}}else cc.isValid(o._targetNode)&&o._targetNode.stopActionByTag(1e3)}),cc.delayTime(.4-Math.min(.3,.02*this._msgCount)),cc.callFunc(function(){var e=o.getQueue(t);e&&(e.queues.shift(),o._msgCount--),o.startShow()}))).setTag(1e3),this._targetNode.runAction(i)},e.prototype.onGameShow=function(){this._toastQueue={},this._msgCount=0},e.prototype.TopWinChange=function(){var t=g.default.uiMgr.getActiveTopWin();t&&(t.winId,p.VIEW_ID.home)},e._pools={},e}(s.ObjectWrap);o.Toast=_,cc._RF.pop()},{"../../Core/CoreDefine":"CoreDefine","../../Core/FrameEx/ES5Ex":"ES5Ex","../../Core/GCtrl":"GCtrl","../../Core/GLoader/GLoader":"GLoader","../Common/Define":"Define","../Common/Language":"Language","../Common/UI":"UI","../Common/UIResources":"UIResources","../Views/Tip/ToastCtrl":"ToastCtrl","./GameMgr":"GameMgr"}],ToggleSwitcher:[function(t,e,o){"use strict";cc._RF.push(e,"282b9WVZn9Cf4yHR9T6tdZL","ToggleSwitcher");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,s=a.property,c=a.ccclass,l=a.executeInEditMode,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.markNode=null,e.unMarkNode=null,e.clickNode=null,e._isMark=!1,e.clickEventHander=null,e}return n(e,t),Object.defineProperty(e.prototype,"Mark",{get:function(){return this._isMark},set:function(t){this._isMark=t,this.init()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){var t=this;this.init(),this.clickNode.getComponent(cc.Button)||this.clickNode.addComponent(cc.Button),this.clickNode.on("click",function(){t.Mark=!t.Mark,t.init(),t.clickEventHander.emit([t.Mark,t.clickEventHander.customEventData])},this)},e.prototype.init=function(){this.unMarkNode&&this.markNode&&(this.Mark?(this.markNode.active=!0,this.unMarkNode.active=!1):(this.markNode.active=!1,this.unMarkNode.active=!0))},r([s(cc.Node)],e.prototype,"markNode",void 0),r([s(cc.Node)],e.prototype,"unMarkNode",void 0),r([s(cc.Node)],e.prototype,"clickNode",void 0),r([s({type:cc.Boolean})],e.prototype,"Mark",null),r([s()],e.prototype,"_isMark",void 0),r([s({type:cc.Component.EventHandler})],e.prototype,"clickEventHander",void 0),r([c,l],e)}(cc.Component);o.default=u,cc._RF.pop()},{}],TopUiItem:[function(t,e,o){"use strict";cc._RF.push(e,"794eeDNKpVIcYup5lBLlVA9","TopUiItem");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/CoreDefine"),c=t("../../../Core/GCtrl"),l=t("../../../Core/GView/GChild"),u=t("../../../tyqSDK/tyqAdManager"),h=t("../../Common/Define"),p=t("../../Common/Language"),d=t("../../Common/UI"),f=t("../../Common/UIResources"),g=t("../../Logic/GameMgr"),_=t("./../../Common/Define"),m=t("./HangPage"),y=cc._decorator,v=y.ccclass,C=y.property,I=y.menu,E=(y.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lb_gem=null,e.lb_coin=null,e.exitBtn=null,e.setting=null,e.coin=null,e.gem=null,e.armyBg=null,e.lb_army=null,e.addLable=null,e._isRecruit=!0,e._winId=null,e}return n(e,t),e.prototype.onSetClick=function(){g.default.jumpToMgr.jumpGoTo(d.VIEW_ID.setting)},e.prototype.onGLoad=function(){this.init(),c.GCtrl.ES.on(h.CMsg.client.bag.onCurrencyChange,this,this.init.bind(this),s.PRIORITY_VIEW),c.GCtrl.ES.on(h.CMsg.client.view.onViewChange,this,this.onViewChange.bind(this),s.PRIORITY_VIEW)},e.prototype.onGStart=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.initPositiony()},e.prototype.initPositiony=function(){var t,e=cc.view.getFrameSize(),o=cc.view.getDesignResolutionSize();t=e.width/e.height<=.5625?e.width/o.width:e.height/o.height,this.node.y=e.height/t/2-39,e.height/e.width>2?this.node.y-=120:this.node.y-=55},e.prototype.showProgressBar=function(t){var e=this.node.getChildByName(t).getChildByName("ui_rjd");cc.tween(e).to(1,{width:130}).delay(.1).set({width:0}).start()},e.prototype.return=function(){g.default.jumpToMgr.jumpGoTo(d.VIEW_ID.mainPage)},e.prototype.returndel=function(){g.default.uiMgr.uiRoot.getChildByName("TopUiItem")&&(g.default.uiMgr.uiRoot.getChildByName("TopUiItem").active=!0),this.node.parent.removeFromParent()},e.prototype.onViewChange=function(){var t=this.getComponent(m.default);if(t){var e=t.getCurWin();e!=d.VIEW_ID.storePage&&e!=d.VIEW_ID.heroPage&&e!=d.VIEW_ID.squadPage&&e!=d.VIEW_ID.recruitPage||(this.setting.active=!1,this.exitBtn.active=!0),e==d.VIEW_ID.home&&(this.setting.active=!0,this.exitBtn.active=!1)}},e.prototype.addCoin=function(){if(this._isRecruit){var t=[_.CURRENCY.GOLD,h.ITEM_TYPE.CURRENCY,1];g.default.jumpToMgr.jumpGoTo(d.VIEW_ID.currencyFrame,t,1)}},e.prototype.addYuSi=function(){if(this._isRecruit){var t=[_.CURRENCY.YUSHI,h.ITEM_TYPE.CURRENCY,1];g.default.jumpToMgr.jumpGoTo(d.VIEW_ID.currencyFrame,t,1)}},e.prototype.addArmy=function(){if(this._isRecruit){var t=[_.CURRENCY.WHEAT,h.ITEM_TYPE.CURRENCY,g.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.forageUp)];g.default.jumpToMgr.jumpGoTo(d.VIEW_ID.currencyFrame,t,1)}},e.prototype.init=function(){this.lb_coin.string=p.LCoin(g.default.RBagData.getMegreItems(_.CURRENCY.GOLD,h.ITEM_TYPE.CURRENCY).num)+"",this.lb_gem.string=p.LCoin(g.default.RBagData.getMegreItems(_.CURRENCY.YUSHI,h.ITEM_TYPE.CURRENCY).num)+"";var t=g.default.systemConfig.value(a.JXDef.SYS_CONFIG_KEY.basicsWheat);t+=g.default.lUserData.getUserBuff(h.BUFFINFO.InitBattlefieldRes),this.lb_army.string=p.LCoin(t+g.default.RBagData.getMegreItems(_.CURRENCY.WHEAT,h.ITEM_TYPE.CURRENCY).num)},e.prototype.unitNumStr=function(t){return t>1e7?Math.floor(t/1e4)/10+"W":t>1e4?Math.floor(t/100)/10+"K":t+""},e.prototype.showAddNum=function(t,e){this.addLable.getComponent(cc.Label).string="+"+t,this.addLable.y=-35,e==_.CURRENCY.WHEAT?this.addLable.x=this.armyBg.x:e==_.CURRENCY.GOLD?this.addLable.x=this.coin.x:e==_.CURRENCY.YUSHI&&(this.addLable.x=this.gem.x),this.addLable.active=!0,cc.tween(this.addLable).stop(),cc.tween(this.addLable).show().to(.1,{opacity:255}).delay(.5).to(.5,{y:0,opacity:0}).start()},e.prototype.change=function(t){t.id==_.CURRENCY.GOLD&&g.default.uiMgr.uiRoot.getChildByName("TopUiItem").getChildByName("coinBg").getChildByName("coin"),t.id==_.CURRENCY.YUSHI&&g.default.uiMgr.uiRoot.getChildByName("TopUiItem").getChildByName("gemBg").getChildByName("coin"),this.playAnimation(new cc.Vec2(0,0),null,function(){},t)},e.prototype.calcDistance=function(t,e){var o=t.x-e.x,i=t.y-e.y;return Math.pow(o*o+i*i,.5)},e.prototype.playAnimation=function(t,e,o,i){var n=e;this.playCoinFlyAnim(15,t,n,o,i)},e.prototype.playCoinFlyAnim=function(t,e,o,i,n,r){var a=this;void 0===r&&(r=50),this.getCirclePoints(r,e,t).map(function(t){var i=new cc.Node("New Sprite");i.addComponent(cc.Sprite);var r=i.getComponent(cc.Sprite);return n.id==_.CURRENCY.GOLD&&a.assetImpl.spriteAtlasFrame(r,f.Res.texture.views.icon,"icon_101"),n.id==_.CURRENCY.YUSHI&&a.assetImpl.spriteAtlasFrame(r,f.Res.texture.views.icon,"icon_100"),a.node.addChild(i),i.setPosition(e.x,e.y),{node:i,startPos:e,midPos:t,endPos:o,dis:a.calcDistance(t,o)}}).forEach(function(t,e){cc.tween(t.node).to(.5,{position:cc.v2(t.midPos.x,t.midPos.y)}).delay(.01*e).to(1,{position:cc.v2(t.endPos.x,t.endPos.y)}).call(function(){t.node.destroy()}).union().start()}),this.scheduleOnce(function(){i()},1.5)},e.prototype.getCirclePoints=function(t,e,o,i){void 0===i&&(i=50);for(var n=[],r=0;r<o;r++){var a=Math.PI/180*Math.round(360/o),s=e.x+t*Math.sin(a*r),c=e.y+t*Math.cos(a*r);n.unshift(cc.v3(s+Math.random()*i,c+Math.random()*i,0))}return n},e.prototype.clearData=function(){u.tyqAdManager.showAppMessage()},r([C({type:cc.Label,tooltip:"\u5b9d\u77f3\u6570\u91cf"})],e.prototype,"lb_gem",void 0),r([C({type:cc.Label,tooltip:"\u91d1\u5e01\u6570\u91cf"})],e.prototype,"lb_coin",void 0),r([C({type:cc.Node,tooltip:"\u8fd4\u56de\u6309\u94ae"})],e.prototype,"exitBtn",void 0),r([C({type:cc.Node,tooltip:"\u8bbe\u7f6e\u6309\u94ae"})],e.prototype,"setting",void 0),r([C({type:cc.Node,tooltip:"\u91d1\u5e01"})],e.prototype,"coin",void 0),r([C({type:cc.Node,tooltip:"\u7389\u77f3"})],e.prototype,"gem",void 0),r([C({type:cc.Node,tooltip:"\u7cae\u8349"})],e.prototype,"armyBg",void 0),r([C({type:cc.Label,tooltip:"\u7cae\u8349\u6570\u91cf"})],e.prototype,"lb_army",void 0),r([C(cc.Node)],e.prototype,"addLable",void 0),r([v,I("View/Common/TopUiItem")],e)}(l.default));o.default=E,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/GCtrl":"GCtrl","../../../Core/GView/GChild":"GChild","../../../conventions/JXCommon":"JXCommon","../../../tyqSDK/tyqAdManager":"tyqAdManager","../../Common/Define":"Define","../../Common/Language":"Language","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr","./../../Common/Define":"Define","./HangPage":"HangPage"}],TyqBaseLayer:[function(t,e,o){"use strict";cc._RF.push(e,"e02ee1QB6FGBrWSMbBoQ7oz","TyqBaseLayer");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.TyqBaseLayer=void 0;var r=t("../../tyqSDK"),a=t("../manager/tyqLayerManager"),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.obj={},e.layerName="DefaultLayer",e.pathNodeObj=new Map,e}return n(e,t),e.prototype.onLoad=function(){this.addButtonListener(this.node),this.addPathNode(this.node,"")},e.prototype.addPathNode=function(t,e){t!=this.node&&this.pathNodeObj.set(e,t),e&&(e+="/");for(var o=t.children,i=0,n=o.length;i<n;i++){var r=o[i];this.addPathNode(r,e+r.name)}},e.prototype.getNodeByPath=function(t){var e=this.pathNodeObj.get(t);return e||((e=cc.find(t,this.node))?(this.pathNodeObj.set(t,e),e):null)},e.prototype.addButtonListener=function(t){t.getComponent(cc.Button)&&t.on("click",this.preOnButtonClick,this);for(var e=t.children,o=0,i=e.length;o<i;o++){var n=e[o];this.addButtonListener(n)}},e.prototype.preOnButtonClick=function(t){var e=t.node,o=e.name;r.tyqSDK.log(this.layerName+" onButtonClick "+o),this.onButtonClick(e,e.name)},e.prototype.onButtonClick=function(){},e.prototype.openLayer=function(t,e,o){a.tyqLayerManager.openLayer(t,e,o)},e.prototype.closeLayer=function(){a.tyqLayerManager.closeLayer(this)},e.prototype.setString=function(t,e){e+="";var o=t.getComponent(cc.Label);if(o)o.string=e;else{var i=t.getComponent(cc.RichText);i&&(i.string=e)}},e}(cc.Component);o.TyqBaseLayer=s,cc._RF.pop()},{"../../tyqSDK":"tyqSDK","../manager/tyqLayerManager":"tyqLayerManager"}],TyqMoreGameLayer:[function(t,e,o){"use strict";cc._RF.push(e,"685f1py939JGI7YLPDD7Fea","TyqMoreGameLayer");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.TyqMoreGameLayer=void 0;var a=t("../../tyqSDK"),s=t("../../tyqSDKConfig"),c=t("./TyqBaseLayer"),l=cc._decorator,u=l.ccclass,h=(l.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.level=0,e.isShowBanner=!1,e.lastBannerShow=!1,e}return n(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this),this.level=this.obj.level,this.lastBannerShow=a.tyqSDK.isBannerAdShowing(),a.tyqSDK.hideBannerAd(),a.tyqSDK.showCustomHorizontalTopAd(!0),a.tyqSDK.showCustomRectCenterAd()},e.prototype.onButtonClick=function(t,e){switch(e){case"btnGoOn":this.onClickBtnGoOn(t)}},e.prototype.onClickBtnGoOn=function(){var t=a.tyqSDK.getSwitchValue(s.tyqSDKConfig.paramsKeys.tyq_banner_touch);if(t&&this.level>parseInt(t)&&!this.isShowBanner)return this.isShowBanner=!0,a.tyqSDK.showBannerAd(),void this.scheduleOnce(function(){a.tyqSDK.hideBannerAd()},1.5+Math.random());this.unscheduleAllCallbacks(),this.closeLayer(),this.cb&&this.cb(),this.lastBannerShow&&a.tyqSDK.showBannerAd()},r([u("TyqMoreGameLayer")],e)}(c.TyqBaseLayer));o.TyqMoreGameLayer=h,cc._RF.pop()},{"../../tyqSDK":"tyqSDK","../../tyqSDKConfig":"tyqSDKConfig","./TyqBaseLayer":"TyqBaseLayer"}],UIAction:[function(t,e,o){"use strict";function i(t,e,o){t.stopAllActions();var i=cc.fadeOut(e),n=cc.callFunc(function(){t.active=!1,o&&o()});return t.runAction(cc.sequence(i,n))}function n(t,e,o){t.active=!0,t.opacity=0,t.stopAllActions();var i=cc.fadeIn(e),n=cc.callFunc(function(){o&&o()});return t.runAction(cc.sequence(i,n))}cc._RF.push(e,"a6638cReqFLTrfeOYhmxd5M","UIAction"),Object.defineProperty(o,"__esModule",{value:!0}),o.winTweenScale=o.delayAction=o.scaleTo=o.timerAction=o.breathe=o.blink3=o.blink2=o.blink=o.fadeTrans=o.fadeIn=o.fadeOut=void 0,o.fadeOut=i,o.fadeIn=n,o.fadeTrans=function(t,e,o,r){i(e,o/2,function(){n(t,o/2,function(){r&&r()})})},o.blink=function(t,e){cc.tween(t).repeatForever(cc.tween(t).to(e/2,{opacity:50}).to(e/2,{opacity:255})).start()},o.blink2=function(t,e,o,i){cc.tween(t).repeatForever(cc.tween(t).to(i/2,{opacity:255*o}).to(i/2,{opacity:255*e})).start()},o.blink3=function(t,e,o){var i=cc.tween(t).to(e/2,{opacity:50}).to(e/2,{opacity:255});o&&(i=cc.tween(t).repeat(o,i)),i.start()},o.breathe=function(t,e,o){void 0===e&&(e=.9),void 0===o&&(o=.4),cc.tween(t).repeatForever(cc.tween(t).to(o,{scale:e}).to(o,{scale:1})).start()},o.timerAction=function(t,e,o,i){void 0===i&&(i=!0),t.stopAllActions();var n=cc.callFunc(o),r=cc.delayTime(e),a=cc.sequence(n,r),s=cc.repeatForever(a),c=t.runAction(s);return i&&o(),c},o.scaleTo=function(t,e,o){t.stopAllActions();var i=cc.callFunc(o),n=cc.scaleTo(e,.8);t.runAction(cc.sequence(n,i))},o.delayAction=function(t,e,o){var i=cc.callFunc(o),n=cc.delayTime(e),r=cc.sequence(n,i);t.runAction(r)},o.winTweenScale=function(t){return t.scale=.6,t.opacity=0,cc.tween(t).to(.2,{scale:1,opacity:255})},cc._RF.pop()},{}],UICreate:[function(t,e,o){"use strict";cc._RF.push(e,"6134fz3OIpPHKNVJVdHt+K8","UICreate"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("../../Core/CoreDefine"),n=t("../../Core/FrameEx/ES5Ex"),r=t("../../Core/FrameEx/MaskSprite"),a=t("../../Core/FrameEx/PlistLabel"),s=t("../../Core/GCtrl"),c=t("../../Core/GLoader/GLoader"),l=t("../Guide/GuideComponent"),u=t("./JXColor"),h=t("./UIResources"),p=function(){function t(){}return t.label=function(t){var e=new cc.Node;if(e){e.anchorX=.5,e.anchorY=.5;var o=e.addComponent(cc.Label);if(o)return o.fontSize=22,o.lineHeight=22,o.cacheMode=cc.Label.CacheMode.CHAR,t&&(o.string=t),o}},t.richText=function(t,e,o,i){var n=new cc.Node;if(n){n.anchorX=0,n.anchorY=.5;var r=n.addComponent(cc.RichText);return i&&(n.color=i),r.fontSize=o||22,r.lineHeight=o||22,e?e.apl.spriteAtlas(e.path,function(e){r.isValid&&(r.imageAtlas=e,r.string=t)}):t&&(r.string=t),r}},t.sprite=function(t,e){var o=new cc.Node;if(o){var i=o.addComponent(cc.Sprite);if(i)return t&&t.apl.spriteFrame(i,t.path,e),i}},t.maskSprite=function(t,e){var o=new cc.Node;if(o){var n=o.addComponent(r.default);if(n)return n.maskType=i.MaskSpriteType.Square,n.center=cc.Vec2.ZERO,n.radius=42,t&&t.apl.spriteFrame(n,t.path,e),n}},t.altsSprite=function(t,e){var o=new cc.Node;if(o){var i=o.addComponent(cc.Sprite);if(i)return t&&t.apl.spriteAtlasFrame(i,t.path,t.sub,e),i}},t.spine=function(t,e){var o=new cc.Node;if(o){var i=o.addComponent(sp.Skeleton);if(i)return t&&t.apl.spine(t.path,function(t){i.isValid&&(i.skeletonData=t,e&&e(i))}),i}},t.addLabelCom=function(t){if(t){var e=t.addComponent(cc.Label);if(e)return e.fontSize=22,e.lineHeight=22,e}},t.plistLabel=function(t,e,o,i){var n=new cc.Node,r=n.addComponent(a.default);return e.spriteAtlas(t,function(t){n.isValid&&(r.atlas=t)}),r.spliteChar=o,r.lineHeight=i,r},t.unTouchNode=function(){var t=new cc.Node;return t.addComponent(cc.BlockInputEvents),t.setContentSize(cc.view.getVisibleSize()),t},t.createrPageMask=function(t,e){var o=new cc.Node("PAGE_MASK");this.sprite({path:h.Res.texture.single,apl:t},function(t){t.node.setContentSize(cc.winSize),t.node.color=u.JXColor.C000000,t.node.opacity=168}).node.parent=o;var i=c.GLoader.getPreLoadAsset(h.Res.prefab.item.guide_item),n=cc.instantiate(i);n.name="GudieRoot",n.setContentSize(cc.winSize);var r=n.getComponent(l.default);return r.text.node.color=u.JXColor.C000000,r.text.string=e,r.talkNode.active=!0,r.talkNode.position=cc.v2(0,-280),r.talkNode.getChildByName("contiue").active=!1,n.parent=o,o},t.createCanvaseMask=function(t){var e=s.GCtrl.actualSize,o=cc.winSize,n=new cc.Node("_GLOBAL_LEFT_"),r=n.addComponent(cc.Sprite);r.sizeMode=cc.Sprite.SizeMode.CUSTOM,n.anchorX=0,n.x=-o.width/2,c.GLoader.spriteFrame(r,"singleColor"),n.color=cc.Color.BLACK,n.parent=t,n.zIndex=i.MAX_TAG;var a=new cc.Node("_GLOBAL_RIGHT_"),l=a.addComponent(cc.Sprite);l.sizeMode=cc.Sprite.SizeMode.CUSTOM,a.anchorX=0,a.x=e.width/2,c.GLoader.spriteFrame(l,"singleColor"),a.color=cc.Color.BLACK,a.parent=t,a.zIndex=i.MAX_TAG;var u=function(){o=cc.winSize,n.width=a.width=o.width/2-e.width/2,n.height=a.height=a.height=o.height,n.x=-o.width/2,a.x=e.width/2};u(),cc.director.getScene().getComponentInChildren(cc.Canvas).node.on(cc.Node.EventType.SIZE_CHANGED,u,n)},t.createDescribe=function(t){for(var e=new cc.Node,o=e.addComponent(cc.Layout),i=t.split("|"),r=c.GAssetImpl.getAssetImpl(h.Res.texture.fight.vipNum),a=n.NewFillArray(i.length),s=0;s<i.length;s++){var l=i[s],u=(new cc.Node).addComponent(cc.Sprite).node;r.spriteAtlasFrame(u.getComponent(cc.Sprite),h.Res.texture.fight.vipNum,l),a[s]=u,u.name=l}return a.forEach(function(t){t.position=cc.Vec2.ZERO,t.parent=e}),o.node},t}();o.default=p,cc._RF.pop()},{"../../Core/CoreDefine":"CoreDefine","../../Core/FrameEx/ES5Ex":"ES5Ex","../../Core/FrameEx/MaskSprite":"MaskSprite","../../Core/FrameEx/PlistLabel":"PlistLabel","../../Core/GCtrl":"GCtrl","../../Core/GLoader/GLoader":"GLoader","../Guide/GuideComponent":"GuideComponent","./JXColor":"JXColor","./UIResources":"UIResources"}],UIMgr:[function(t,e,o){"use strict";cc._RF.push(e,"1aeb8xMjqJJCo49m1lzR6e0","UIMgr");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0}),o.UIMgr=o.BASE_VIEW_ID_EX=o.Win=o.WinInfos=o.WinInfo=o.WinModel=void 0;var a=t("../../tyqSDK/tyqSDK"),s=t("../CoreDefine"),c=t("../FrameEx/ES5Ex"),l=t("../FrameEx/GComponent"),u=t("../GLoader/GLoader"),h=t("../GView/GViewBase"),p=t("../GView/GViewDestory"),d=t("./../GCtrl"),f=t("./AudioMgr");o.WinModel=function(t,e,o,i,n){this.winType=t,this.winMask=e,this.winAddMode=o,this.winCloseMode=i,this.winLayer=n};o.WinInfo=function(t,e){this.path=t,this.winModel=e};o.WinInfos=function(t,e){this.winIds=t,this.winInfos=e};var g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._runGStart=!0,e.isDestroy=!1,e}return n(e,t),Object.defineProperty(e.prototype,"logicArgs",{get:function(){return this._logicArgs},set:function(t){if(!this._logicArgs&&t)this._runGStart=!0;else if(this._logicArgs&&t)if(this._logicArgs.length!=t.length)this._runGStart=!0;else for(var e=0;e<t.length;e++)if(this._logicArgs[e]!=t[e]){this._runGStart=!0;break}this._logicArgs=t},enumerable:!1,configurable:!0}),e.prototype.onBinder=function(t){var e,o,i=this;if(this.viewBinder&&this.viewBinder!=t)throw new Error("this win has viewBinder!");if(this.viewBinder=t,this.viewBinder.win=this,this.isDestroy)this.onClose(!0);else{this.isDestroy=!1;var n=this.viewBinder.node;if(n.zIndex!=this.sortOrder&&(n.zIndex=this.sortOrder),this.winInfo.winModel.winType==s.WinType.Window){var r=n.getComponent(cc.Animation);if(r){var a=r.getClips();r.play(a[0].name),r.once(cc.Animation.EventType.FINISHED,function(){i.viewBinder.onAnimationLoaded()})}else n.scale=.6,n.opacity=0,cc.tween(n).to(.2,{scale:1,opacity:255}).call(function(){i.viewBinder.onAnimationLoaded()}).start()}if(this._runGStart||this.viewBinder.checkReGStart()){this._runGStart=!1,(e=this.viewBinder).__onGStart.apply(e,this._logicArgs);var c=this.viewBinder.getComponents(l.default);if(c.length>1)for(var u=0;u<c.length;u++)c[u]!=this.viewBinder&&(o=c[u]).__onGStart.apply(o,this._logicArgs)}this.viewBinder.onGActive(),_.removeMutexWin(this),this.playWinAudioEffect(!0)}},Object.defineProperty(e.prototype,"isLoad",{get:function(){return!!this.viewBinder},enumerable:!1,configurable:!0}),e.prototype.addMaskEvent=function(t){this.maskNode&&t&&(this.maskNode.on("click",t),this.maskNode.getComponent(cc.Button).clickAudio=null)},e.prototype.onClose=function(t){void 0===t&&(t=!1),a.tyqSDK.hideBannerAd(),this.isDestroy&&!t||(this.isDestroy=!0,_.onWinClose(this,t),this.playWinAudioEffect(!1))},e.prototype.playWinAudioEffect=function(t){var e=null;(e=t?_.winAudios["winOpen_"+this.winId]:_.winAudios["winClose_"+this.winId])||this.winInfo.winModel.winLayer!=s.WinLayer.FirstWindow&&this.winInfo.winModel.winLayer<s.WinLayer.RollWindow&&this.winInfo.winModel.winType!=s.WinType.FullView&&(e=t?_.winAudios.winOpen:_.winAudios.winClose),e&&f.AudioMgr.Ins().playEffect(e)},e.prototype.onDestroy=function(){_.onWinDestroy(this)},e}(c.ObjectWrap);o.Win=g,o.BASE_VIEW_ID_EX={roll:7001e3,updateRemindCtrl:8001e3,TOAST:9000100,WAIT:9000200,CONFIRM:9000300,hotUpdate:9000500};var _=function(){function t(){}return Object.defineProperty(t,"stack",{get:function(){return this._stack},enumerable:!1,configurable:!0}),t.initWinInfos=function(t,e,o){this._infos=t,this._preLoadAssets=e,this._creatorToastCb=o},Object.defineProperty(t,"uiRoot",{get:function(){var t=cc.director.getScene().getChildByList("Canvas/uiRoot");if(!t){var e=cc.director.getScene().getChildByName("Canvas");if(!e)return;(t=new cc.Node).addComponent(p.default),t.width=e.width,t.height=e.height,e.addChild(t),t.name="uiRoot",t.position=cc.Vec2.ZERO,t.zIndex=5e3,this.initLayerSort(),this._creatorToastCb&&(this._toast=this._creatorToastCb(t));var o=d.GCtrl.actualSize,i=cc.winSize,n=new cc.Node("_GLOBAL_LEFT_"),r=n.addComponent(cc.Sprite);r.sizeMode=cc.Sprite.SizeMode.CUSTOM,n.anchorX=0,n.x=-i.width/2,u.GLoader.spriteFrame(r,"singleColor"),n.color=cc.Color.BLACK,n.parent=e,n.zIndex=s.MAX_TAG;var a=new cc.Node("_GLOBAL_RIGHT_"),c=a.addComponent(cc.Sprite);c.sizeMode=cc.Sprite.SizeMode.CUSTOM,a.anchorX=0,a.x=o.width/2,u.GLoader.spriteFrame(c,"singleColor"),a.color=cc.Color.BLACK,a.parent=e,a.zIndex=s.MAX_TAG;var l=function(){i=cc.winSize,n.width=a.width=i.width/2-o.width/2,n.height=a.height=a.height=i.height,n.x=-i.width/2-n.width,a.x=o.width/2+n.width};l(),e.on(cc.Node.EventType.SIZE_CHANGED,l,n)}return t},enumerable:!1,configurable:!0}),t.layerOrder=function(t){return 1e3*(t+1)-1e3+50},t.initLayerSort=function(){for(var t in this._layerSortDic=new c.MapWrap,s.WinLayer){var e=parseInt(s.WinLayer[t]);this._layerSortDic.set(e,[this.layerOrder(e)])}},t.genSortOrder=function(t,e){var o=this._layerSortDic.get(t);if(!o)return cc.error("the layer init failed: "+t),this.layerOrder(t);var i=o[o.length-1];return e?i+=49:(i+=50,o.push(i),i)},t.getCurTopOrder=function(t){var e=this._layerSortDic.get(t);return e?e[e.length-1]:(cc.error("the layer init failed: "+t),this.layerOrder(t))},t.removeSortOrder=function(t,e){var o=this._layerSortDic.get(t);if(o){var i=o.indexOf(e);i!=s.INVALID_VALUE&&o.splice(i,1)}else cc.error("the layer init failed: "+t)},t.createMask=function(){var t,e;if(this._maskPool=this._maskPool||new cc.NodePool,0==this._maskPool.size()){var o=(t=new cc.Node).addComponent(cc.Sprite);u.GLoader.spriteFrame(o,"singleColor",function(){t.setContentSize(cc.size(3e3,3e3))}),e=t.addComponent(cc.Button),t.color=cc.Color.BLACK}else(t=this._maskPool.get()).opacity=180,t.off("click"),(e=t.getComponent(cc.Button))&&(e.clickEvents=[]);return t.setContentSize(cc.size(3e3,3e3)),this.invalidAudio&&(e.clickAudio=this.invalidAudio),t},t.indexOfStack=function(t){for(var e=0;e<this._stack.length;e++)if(this._stack[e]==t)return e;return s.INVALID_VALUE},t.stackToHeap=function(t,e){this.removeStackWin(t,e),this._heap.push(t)},t.removeStackWin=function(t,e){e||(e=this.indexOfStack(t)),e!=s.INVALID_VALUE&&this._stack.splice(e,1),t.maskNode&&(this._maskPool.put(t.maskNode),t.maskNode=null),t.viewBinder&&t.viewBinder.node&&t.viewBinder.node.parent&&t.viewBinder.node.removeFromParent(!1),t.sortOrder!=s.INVALID_VALUE&&(this.removeSortOrder(t.winInfo.winModel.winLayer,t.sortOrder),t.sortOrder=s.INVALID_VALUE)},t.pushStackWin=function(t){this.indexOfStack(t)!=s.INVALID_VALUE&&this.removeStackWin(t);var e,o=this.getWinName(t.winInfo.path),i=t.winInfo.winModel.winMask;if(i&s.WinMaskStatus.kNone||(t.maskNode?((e=t.maskNode).active=!0,e.parent||(e.parent=this.uiRoot)):((e=this.createMask()).name=o+"_mask",e.parent=this.uiRoot)),e&&e.setContentSize(cc.winSize),t.maskNode=e,t.sortOrder=this.genSortOrder(t.winInfo.winModel.winLayer),t.maskNode&&(t.maskNode.zIndex=t.sortOrder-1,i&s.WinMaskStatus.kOpacity156?t.maskNode.opacity=180:i&s.WinMaskStatus.kOpacity255?t.maskNode.opacity=255:t.maskNode.opacity=180,i&s.WinMaskStatus.kOpacity56&&(t.maskNode.opacity=50),i&s.WinMaskStatus.kTouchClose&&t.addMaskEvent(function(){return t.onClose()})),this._stack.push(t),t.viewBinder){var n=t.viewBinder.node;return n.parent||(n.parent=this.uiRoot),n.active||(n.active=!0),t.isDestroy=!1,void t.onBinder(t.viewBinder)}},t.getWinName=function(t){var e="";if("string"==typeof t){var o=t.split("/");e=o[o.length-1]}else e=t.name;return e},t.getFristWinById=function(t){for(var e=this._stack,o=0;o<e.length;o++)if(e[o].winId==t)return e[o]},t.tryGetWinByNode=function(t){for(var e=t;e;){if(e==this.uiRoot)return;if(e==cc.director.getScene())return;var o=e.getComponent(h.default);if(o)return o.win;e=e.parent}},t.tryPopHeapWin=function(t){for(var e=this._heap,o=0;o<e.length;o++)if(e[o].winId==t){var i=e[o];return e.splice(o,1),i}},t.tryGetRecycles=function(t){var e=this._recycles.get(t);return e&&e.length>0?e.pop():null},t.getWinInfo=function(t){return this._infos.winInfos.get(t)},t.showWin=function(t){for(var e=this,o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];var n=this._infos.winInfos.get(t);if(n){var a=n.winModel,c=null;if(a.winAddMode!=s.WinAddMode.Stack&&(c=this.getFristWinById(t)))return c.createStats=s.WinCreateEnv.lStack,c.logicArgs=o,void(c.isLoad&&this.pushStackWin(c));if((c=this.tryPopHeapWin(t))?c.createStats=s.WinCreateEnv.Heap:(c=this.tryGetRecycles(t))&&(c.createStats=s.WinCreateEnv.Recycle),c||((c=new g).winInfo=n,c.winId=t,c.createStats=s.WinCreateEnv.New),c&&(c.logicArgs=o,this.pushStackWin(c),!c.viewBinder)){var l=function(){var t=c.winInfo.path;u.GLoader.prefab(t,function(t){var o=cc.instantiate(t);if(o){o.zIndex=c.sortOrder,o.parent=e.uiRoot;var i=o.getComponent(h.default);i&&(c.winInfo.winModel.winType==s.WinType.FullView&&o.setContentSize(cc.winSize),c.winInfo.winModel.winMask&s.WinMaskStatus.kUnBlockInput||!i.bgImage||i.bgImage.node.getComponent(cc.BlockInputEvents)||i.bgImage.node.addComponent(cc.BlockInputEvents),c.onBinder(i))}})},p=this._preLoadAssets[c.winId];p&&p.length>0?(this.showWait(),d.GCtrl.preLoadRawAssets.apply(d.GCtrl,r([function(t,e,o){o&&cc.log("preload assets: "+t+"/"+e+": "+o.url)},function(){e.closeWait(),l()}],p))):l()}}else cc.error("this winId of: "+t+" not init config (UI.ts)")},t.removeMutexWin=function(t){for(var e=this._stack,o=t.winInfo.winModel.winLayer,i=this.indexOfStack(t),n=i=i==s.INVALID_VALUE?this._stack.length-1:i;n>=0;n--){var r=e[n];if(r!=t){var a=r.winInfo.winModel.winLayer;if(!(a>=s.WinLayer.UnCheckMutex))switch(t.winInfo.winModel.winAddMode){case s.WinAddMode.ReplaceLayer:o<=a&&r.onClose(!0);break;case s.WinAddMode.ReplaceSelf:o<a&&r.onClose(!0);break;case s.WinAddMode.PushLower:t.sortOrder>r.sortOrder?this.stackToHeap(r):t.sortOrder<r.sortOrder&&r.onClose(!0);break;case s.WinAddMode.Stack:t.sortOrder<r.sortOrder&&r.onClose(!0);break;case s.WinAddMode.PushHeigh:o<a&&this.stackToHeap(r)}}}},t.onWinClose=function(t,e){var o=this;void 0===e&&(e=!1);var i=function(){var i=t.winInfo.winModel.winCloseMode;if(i&s.WinCloseMode.OnlyDestroy){if(o.removeStackWin(t),t.viewBinder){t.viewBinder.node.destroy();var n=o._preLoadAssets[t.winId];if(n)for(var r=0;r<n.length;r++)u.GLoader.releaseAsset(n[r].path);var a=t.winInfo.path;u.GLoader.releaseAsset(a)}}else if(i&s.WinCloseMode.Recycle){o.removeStackWin(t);var c=o._recycles.get(t.winId);c||(c=[],o._recycles.set(t.winId,c)),c.push(t)}else i&s.WinCloseMode.Hide&&(t.maskNode&&(t.maskNode.active=!1),t.viewBinder&&(t.viewBinder.node.active=!1));if(i&s.WinCloseMode.PopAll&&!e)for(;o._heap.length>0;){var l=o._heap.pop();if(o.pushStackWin(l),l.winInfo.winModel.winCloseMode&s.WinCloseMode.PopAll)break}};if(t.winInfo.winModel.winType==s.WinType.Window&&t.viewBinder&&!e){var n=t.viewBinder.node,r=t.maskNode,a=t.viewBinder.getComponent(cc.Animation);if(a){var c=a.getClips();a.play(c[1].name),a.once(cc.Animation.EventType.FINISHED,function(){cc.director.getActionManager().removeAllActionsFromTarget(r,!0),i()})}else cc.tween(n).to(.3,{opacity:0}).call(function(){cc.director.getActionManager().removeAllActionsFromTarget(r,!0),i()}).start();r&&(r.zIndex=t.sortOrder+1,cc.tween(r).to(.3,{opacity:0}).start())}else i()},t.onWinDestroy=function(t){this.removeStackWin(t);for(var e=0;e<this._heap.length;e++)this._heap[e]==t&&this._heap.splice(e,1);var o=this._recycles.get(t.winId);if(o)for(e=0;e<o.length;e++)o[e]==t&&o.splice(e,1);d.GCtrl.ES.emit(d.GCtrl.GClientWinDestroyEventMsg,t),t.viewBinder=null,t.winInfo=null,t.maskNode=null,t.winId=s.INVALID_VALUE},t.getActiveTopWin=function(t){if(!t){for(var e=this._stack.length-1;e>=0;e--){var i=this._stack[e];if(!(i.winId>=o.BASE_VIEW_ID_EX.roll))return i}return null}for(e=this._stack.length-1;e>=0;e--)if(this._stack[e].winId==t)return this._stack[e]},t.removeAllActiveWin=function(){if(this._stack){for(;this._stack.length>0;)this._stack.pop().onClose(!0);for(;this._heap.length>0;){var t=this._heap.pop();t.viewBinder.node.destroy(),t.viewBinder=null,t.logicArgs=null,t.winInfo=null}}},t.removeActiveByViewLayer=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var o=this._stack.length;o>=0;o--){var i=this._stack[o].winInfo.winModel.winLayer;t.indexOf(i)!=s.INVALID_VALUE&&this._stack[o].onClose()}},t.removeActiveByViewId=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var o=this._stack.length-1;o>=0;o--)t.indexOf(this._stack[o].winId)!=s.INVALID_VALUE&&this._stack[o].onClose()},t.getView=function(t){var e=this.getActiveTopWin(t);return e?e.viewBinder:null},t.isActiveView=function(t){return null!=this.getActiveTopWin(t)},t.activeWin=function(t,e){t.maskNode&&(t.maskNode.active=e),t.viewBinder&&(t.viewBinder.node.active=e)},t.getHeapViewByName=function(t){for(var e=0;e<this._heap.length;e++)if(this._heap[e].viewBinder.node.name==t)return this._heap[e]},t.showWait=function(){this.showWin(o.BASE_VIEW_ID_EX.WAIT);var t=this.getActiveTopWin(o.BASE_VIEW_ID_EX.WAIT);t&&t.viewBinder&&t.viewBinder.onGStart()},t.closeWait=function(){var t=this.getActiveTopWin(o.BASE_VIEW_ID_EX.WAIT);t&&t.onClose()},t.showToast=function(t){for(var e,o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];this._toast&&(e=this._toast).show.apply(e,r([t],o))},t.touchShow=function(t,e,o){void 0===e&&(e=!0);var i=(o=o||this.uiRoot).getChildByName("touchNode");return i||((i=new cc.Node("touchNode")).parent=o,i.position=cc.v2(0,0),i.zIndex=this.layerOrder(s.WinLayer.TouchShow),i.setContentSize(cc.winSize)),i.on(cc.Node.EventType.TOUCH_START,function(){e&&(i.destroyAllChildren(),i.active=!1,i.off(cc.Node.EventType.TOUCH_START)),t&&t(i)}),i.destroyAllChildren(),i.active=!0,i},t.touchHid=function(t){var e=(t=t||this.uiRoot).getChildByName("touchNode");e&&(e.destroyAllChildren(),e.active=!1,e.off(cc.Node.EventType.TOUCH_START))},t.showBlockInput=function(){var t=this.uiRoot.getChildByName("uiRootMaskNode");t||((t=new cc.Node("uiRootMaskNode")).parent=this.uiRoot,t.position=cc.Vec2.ZERO,t.zIndex=this.layerOrder(s.WinLayer.WarnWindow),t.setContentSize(cc.winSize),t.addComponent(cc.BlockInputEvents)),t.active=!0},t.hidBlockInput=function(){var t=this.uiRoot.getChildByName("uiRootMaskNode");t&&t.destroy()},t.playSpine=function(t,e,o,i){t.setAnimation(0,e,o)&&t.setCompleteListener(function(t){(t.animation?t.animation.name:"")===e&&i&&i()})},t._stack=[],t._heap=[],t._recycles=new c.MapWrap,t._maskPool=new cc.NodePool,t.winAudios={},t}();o.UIMgr=_,cc._RF.pop()},{"../../tyqSDK/tyqSDK":"tyqSDK","../CoreDefine":"CoreDefine","../FrameEx/ES5Ex":"ES5Ex","../FrameEx/GComponent":"GComponent","../GLoader/GLoader":"GLoader","../GView/GViewBase":"GViewBase","../GView/GViewDestory":"GViewDestory","./../GCtrl":"GCtrl","./AudioMgr":"AudioMgr"}],UIModeAction:[function(t,e,o){"use strict";cc._RF.push(e,"80001UzNO1CBqxh2klfX3px","UIModeAction");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.UIModeAction=o.MoveDir=void 0;var a,s,c=t("../../../Core/FrameEx/GComponent"),l=t("../../../Core/GCtrl"),u=cc._decorator,h=u.ccclass,p=u.property,d=u.menu;(function(t){t[t.Move=1001]="Move",t[t.Fade=1002]="Fade",t[t.Discard=1003]="Discard"})(a||(a={})),function(t){t[t.None=0]="None",t[t.Left2R=1]="Left2R",t[t.Right2L=2]="Right2L",t[t.top2B=3]="top2B",t[t.bottom2T=4]="bottom2T",t[t.custom=5]="custom"}(s=o.MoveDir||(o.MoveDir={}));var f=function(){function t(){this.delayTime=0,this.moveDuration=0,this.fadeDuration=0,this.nodes=[],this.moveDir=s.None,this.startPos=cc.v2(),this._nodeDefaultPositions=[],this._forcedDisplay=!1}return t.prototype.init=function(){for(var t=0;t<this.nodes.length;t++)this.nodes[t]&&(this._nodeDefaultPositions[t]=this.nodes[t].position)},t.prototype.onEnable=function(){for(var t=l.GCtrl.actualSize,e=cc.winSize,o=0;o<this.nodes.length;o++){var i=this.nodes[o];if(i&&(this._forcedDisplay||i.active)){if(i.stopAllActions(),this.moveDuration>0){var n=i.convertToWorldSpaceAR(cc.Vec2.ZERO),r=n;switch(this.moveDir){case s.None:break;case s.Left2R:r=cc.v2(-(-(e.width-t.width)/2+i.width*(1-i.anchorX)),n.y);break;case s.Right2L:r=cc.v2(t.width+(e.width-t.width)/2+i.width*i.anchorX,n.y);break;case s.top2B:r=cc.v2(n.x,t.height+i.height*i.anchorY);break;case s.bottom2T:r=cc.v2(n.x,-i.height*(1-i.anchorY));break;case s.custom:r=cc.v2(n.x+this.startPos.x,n.y+this.startPos.y)}i.position=i.parent.convertToNodeSpaceAR(r),i.active=!0,i.runAction(cc.sequence(cc.delayTime(this.delayTime*o),cc.moveTo(this.moveDuration,this._nodeDefaultPositions[o]))).setTag(a.Move)}this.fadeDuration>0&&(i.opacity=0,i.active=!0,i.runAction(cc.sequence(cc.delayTime(this.delayTime*o),cc.fadeIn(this.fadeDuration))).setTag(a.Fade))}}},t.prototype.onDisable=function(){for(var t=0;t<this.nodes.length;t++){var e=this.nodes[t];e&&(e.stopAllActions(),e.position=this._nodeDefaultPositions[t])}},r([p()],t.prototype,"delayTime",void 0),r([p()],t.prototype,"moveDuration",void 0),r([p()],t.prototype,"fadeDuration",void 0),r([p([cc.Node])],t.prototype,"nodes",void 0),r([p({type:cc.Enum(s)})],t.prototype,"moveDir",void 0),r([p({visible:function(){return this.moveDir===s.custom}})],t.prototype,"startPos",void 0),r([h("Move$Fade$Config")],t)}(),g=(function(){function t(){this.sprites=[],this._utime=1,this._into_isbegin=!1,this._timeTag=!1}t.prototype.init=function(){},t.prototype.onEnable=function(){this._utime=1,this._timeTag=!0},t.prototype.onDisable=function(){if(this._timeTag){this._timeTag=!1,this._utime=1;for(var t=0;t<this.sprites.length;t++){var e=this.sprites[t];e&&e.getMaterial(0).setProperty("u_time",0)}}},t.prototype.update=function(t){if(this._timeTag)if(this._utime>0){for(var e=0;e<this.sprites.length;e++)(o=this.sprites[e])&&o.getMaterial(0).setProperty("u_time",this._utime);this._utime=this._utime-2*t}else{for(this._timeTag=!1,e=0;e<this.sprites.length;e++){var o;(o=this.sprites[e])&&o.getMaterial(0).setProperty("u_time",0)}this._utime=1}},r([p([cc.Sprite])],t.prototype,"sprites",void 0),t=r([h("Disslove$Config")],t)}(),function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.left2R=null,e.right2L=null,e.top2B=null,e.bottom2T=null,e.onlyFade=null,e._inits=!1,e}return n(e,t),e.prototype.start=function(){var t=this;l.GCtrl.afterFrames(function(){t.left2R&&t.left2R.init(),t.right2L&&t.right2L.init(),t.top2B&&t.top2B.init(),t.bottom2T&&t.bottom2T.init(),t.onlyFade&&t.onlyFade.init(),t._inits=!0,t.onEnable()})},e.prototype.onEnable=function(){var t=this;this._inits&&l.GCtrl.afterFrames(function(){t.left2R&&t.left2R.onEnable(),t.right2L&&t.right2L.onEnable(),t.top2B&&t.top2B.onEnable(),t.bottom2T&&t.bottom2T.onEnable(),t.onlyFade&&t.onlyFade.onEnable()})},e.prototype.onDisable=function(){this.left2R&&this.left2R.onDisable(),this.right2L&&this.right2L.onDisable(),this.top2B&&this.top2B.onDisable(),this.bottom2T&&this.bottom2T.onDisable(),this.onlyFade&&this.onlyFade.onDisable()},r([p(f)],e.prototype,"left2R",void 0),r([p(f)],e.prototype,"right2L",void 0),r([p(f)],e.prototype,"top2B",void 0),r([p(f)],e.prototype,"bottom2T",void 0),r([p(f)],e.prototype,"onlyFade",void 0),r([h,d("ViewUtil/UIModeAction")],e)}(c.default));o.UIModeAction=g,cc._RF.pop()},{"../../../Core/FrameEx/GComponent":"GComponent","../../../Core/GCtrl":"GCtrl"}],UIResources:[function(t,e,o){"use strict";cc._RF.push(e,"61557VWuFFNUZmZrs2fPTTZ","UIResources"),Object.defineProperty(o,"__esModule",{value:!0}),o.Res=void 0;var i=t("../../Core/GLoader/GLoader");o.Res={font:{mnpw:"font/mnpw",ysbth:"font/ysbth",fzcy:"font/fzcy"},texture:{single:"singleColor",map:{grid:"frames/views/map/mapGrid",quality:"frames/views/quality",material:"frames/views/map/mapMaterial"},fight:{ui:"frames/views/fight",vipNum:"frames/views/vipNum",describe:"frames/battle/describe"},hero:{hero:"frames/hero/"},views:{mainUi:"frames/views/mainUi",common:"frames/views/common",heroDetail:"frames/views/detailsImg",homeUI:"frames/views/mainUi",skillIcon:"frames/views/skill",sign:"frames/views/sign",icon:"frames/views/icon",tower:"frames/views/tower",bless:"frames/views/bless",vip:"frames/views/vip"}},bigpic:{main:"bg/main/",map:"bg/map/"},prefab:{vw:{home:{strengthenView:"main/StrengthenView",EquipDetailsCtrl:"main/EquipDetailsCtrl",blessCtrl:"main/BlessCtrl",detailsCtrl:"hero/DetailsCtrl",officerCtrl:"main/OfficerCtrl",signInCtrl:"main/SignInCtrl",loadCtrl:"main/LoadCtrl",vipCtrl:"main/VipCtrl",vipPage:"main/VipPage",timeLimitGift:"tip/TimeLimitGift",rankView:"tip/RankView",powerUp:"tip/PowerUp",propertyItem:"main/PropertyItem",mainCtrl:"main/MainCtrl",recruitCtrl:"main/RecruitCtrl",chapterPage:"main/ChapterPage",homeCtrl:"main/HomeCtrl",levelCtrl:"main/LevelCtrl",levelItem:"main/LevelItem",skillPage:"main/SkillPage",currencyFrame:"common/CurrencyFrame",previewCtrl:"common/PreviewCtrl",featureCtrl:"main/FeatureCtrl",setCtrl:"main/SetCtrl",FightDataPreView:"main/FightDataPreView",recuitCardItem:"main/RecuitCardItem",recuitCardCtrl:"main/RecruitCardCtrl",dailyView:"main/DailyView"},store:{storeEquipItem:"store/StoreEquipItem",storeCtrl:"store/StoreCtrl"},hero:{heroTry:"hero/HeroTryCtrl",heroCtrl:"hero/HeroCtrl",squadCtrl:"hero/SquadCtrl",equipAddCtrl:"hero/EquipAddCtrl"},fight:{fightLayer:"fight/BattleViewCtrl",mapLayer:"fight/BtlMapLayer",head:"fight/BtlHeroHead",battleResult:"fight/BattleResultCtrl",battleResultView:"fight/BattleResultView",battleReward:"fight/BattleRewardCtrl",resultHero:"fight/JXResultHero",fightLayerPut:"fight/BattleViewPut",guessLayer:"fight/GuessView",ceremonialGiftView:"fight/CeremonialGiftView"},tip:{rewardCtrl:"tip/RewardCtrl",toast:"tip/ToastCtrl",moreGame:"tip/MoreGame",diacan:"tip/DiaoChanView",guessResultView:"tip/GuessResultView"}},item:{topUiItem:"common/TopUiItem",officerItem:"main/OfficerItem",boxItem:"main/BoxItem",jxItem:"common/JXItem",skillItem:"main/SkillItem",FightDataItem:"main/FightDataItem",heroCardItem:"hero/HeroCardItem",HeroItem:"hero/HeroItem",guide_item:"guide/GuideNode",jxRoadPoint:"fight/JXRoadPoint"},fight:{ArmRole:"fight/ArmRole",role:"fight/JXRole",head:"fight/JXRBRoleHead",fightFlags:"fight/JXRBFlags",roleHead:"fight/RoleHead"}},model:"spine/model/",comskills:"dragonBones/comskills",animation:{kuang:{}},spine:{},dragonBones:{guide:"dragon/sp_shouzhi_"},material:{},audio:{addEquip:"ui/addEquip",addHero:"ui/addHero",battle:"battle/",btnClick:"ui/btnClick",invalidClick:"ui/invalidClick",main:"ui/main_bgm",reward:"ui/reward",sign:"ui/sign",qhSuc:"ui/qianghuaSuc",qh:"ui/qianghua",lvUp:"ui/lvUp",tupo:"ui/tupo",wear:"ui/wear",suc:"ui/suc",lost:"ui/lost",nextWave:"ui/nextWave",goBattle:"ui/goBattle",haojiao:"ui/haojiao",coin:"ui/coin"},positionOffset:{}},i.GAssetImpl.loader.textureRes=o.Res.texture,cc._RF.pop()},{"../../Core/GLoader/GLoader":"GLoader"}],UI:[function(t,e,o){"use strict";var i,n;cc._RF.push(e,"63a50zdMd5G+pc2ZLGaCsbl","UI"),Object.defineProperty(o,"__esModule",{value:!0}),o.VIEW_PageNumByID=o.VIEW_IDByPageNum=o.JXViewPreLoad=o.JXWinInfo=o.VIEW_ID=void 0;var r=t("../../conventions/JXCommon"),a=t("../../Core/CoreDefine"),s=t("../../Core/FrameEx/ES5Ex"),c=t("../../Core/Manager/UIMgr"),l=t("./../../Core/CoreDefine"),u=t("./UIResources");o.VIEW_ID=r.JXDef.SYS_IDENTITY_ID,cc.js.mixin(o.VIEW_ID,c.BASE_VIEW_ID_EX);var h=new c.WinModel(a.WinType.FullView,a.WinMaskStatus.kOnlyShow,a.WinAddMode.ReplaceLayer,a.WinCloseMode.OnlyDestroy|a.WinCloseMode.PopAll,a.WinLayer.FirstWindow),p=new c.WinModel(a.WinType.FullView,a.WinMaskStatus.kOnlyShow,a.WinAddMode.PushLower,a.WinCloseMode.OnlyDestroy|a.WinCloseMode.PopAll,a.WinLayer.FirstWindow),d=new c.WinModel(a.WinType.Window,a.WinMaskStatus.kTouchClose|a.WinMaskStatus.kOpacity156,a.WinAddMode.ReplaceSelf,a.WinCloseMode.OnlyDestroy,a.WinLayer.SecondWindow),f=(new c.WinModel(a.WinType.Window,a.WinMaskStatus.kTouchClose|a.WinMaskStatus.kOpacity156,a.WinAddMode.Stack,a.WinCloseMode.OnlyDestroy,a.WinLayer.SecondWindow),new c.WinModel(a.WinType.Window,a.WinMaskStatus.kTouchClose|a.WinMaskStatus.kOpacity156,a.WinAddMode.Stack,a.WinCloseMode.Hide,a.WinLayer.SecondWindow),new c.WinModel(a.WinType.FullView,a.WinMaskStatus.kOnlyShow|a.WinMaskStatus.kOpacity156,a.WinAddMode.Stack,a.WinCloseMode.OnlyDestroy,a.WinLayer.SecondWindow)),g=new c.WinModel(a.WinType.FullView,a.WinMaskStatus.kNone,a.WinAddMode.Stack,a.WinCloseMode.OnlyDestroy,a.WinLayer.ThirdWindow),_=new c.WinModel(a.WinType.FullView,a.WinMaskStatus.kOpacity56,a.WinAddMode.Stack,a.WinCloseMode.OnlyDestroy,a.WinLayer.ThirdWindow),m=(new c.WinModel(a.WinType.FullView,a.WinMaskStatus.kTouchClose|a.WinMaskStatus.kOpacity156,a.WinAddMode.ReplaceSelf,a.WinCloseMode.OnlyDestroy,a.WinLayer.SecondWindow),new c.WinModel(a.WinType.FullView,a.WinMaskStatus.kOnlyShow|a.WinMaskStatus.kOpacity255,a.WinAddMode.ReplaceSelf,a.WinCloseMode.OnlyDestroy,a.WinLayer.SecondWindow),new c.WinModel(a.WinType.Window,a.WinMaskStatus.kTouchClose|a.WinMaskStatus.kOpacity156,a.WinAddMode.Stack,a.WinCloseMode.OnlyDestroy,a.WinLayer.ThirdWindow),new c.WinModel(a.WinType.Window,a.WinMaskStatus.kTouchClose|a.WinMaskStatus.kOpacity156,a.WinAddMode.ReplaceSelf,a.WinCloseMode.OnlyDestroy,a.WinLayer.ThirdWindow)),y=new c.WinModel(a.WinType.Window,a.WinMaskStatus.kOnlyShow|a.WinMaskStatus.kOpacity156,a.WinAddMode.Stack,a.WinCloseMode.OnlyDestroy,a.WinLayer.ThirdWindow),v=(new c.WinModel(a.WinType.Window,a.WinMaskStatus.kTouchClose|a.WinMaskStatus.kOpacity156,a.WinAddMode.Stack,a.WinCloseMode.Recycle,a.WinLayer.ThirdWindow),new c.WinModel(a.WinType.Window,a.WinMaskStatus.kOnlyShow|a.WinMaskStatus.kOpacity156,a.WinAddMode.Stack,a.WinCloseMode.Recycle,a.WinLayer.WarnWindow),new c.WinModel(a.WinType.Window,a.WinMaskStatus.kTouchClose,a.WinAddMode.Stack,a.WinCloseMode.Recycle,a.WinLayer.WarnWindow),new c.WinModel(a.WinType.Fix,a.WinMaskStatus.kOnlyShow,a.WinAddMode.ReplaceSelf,a.WinCloseMode.Recycle,a.WinLayer.TopWindow),new c.WinModel(a.WinType.Fix,a.WinMaskStatus.kOnlyShow|a.WinMaskStatus.kOpacity156,a.WinAddMode.Stack,a.WinCloseMode.Recycle,a.WinLayer.TopWindow),new c.WinModel(a.WinType.Fix,a.WinMaskStatus.kNone,a.WinAddMode.Stack,a.WinCloseMode.OnlyDestroy,a.WinLayer.TopUpWindow),new c.WinModel(a.WinType.Fix,a.WinMaskStatus.kNone|a.WinMaskStatus.kUnBlockInput,a.WinAddMode.Stack,a.WinCloseMode.OnlyDestroy,a.WinLayer.TopUpWindow),u.Res.prefab.vw);o.JXWinInfo=new c.WinInfos(Object.keys(o.VIEW_ID).map(function(t){return o.VIEW_ID[t]}),new s.MapWrap([[o.VIEW_ID.load,new c.WinInfo(v.home.loadCtrl,h)],[o.VIEW_ID.home,new c.WinInfo(v.home.homeCtrl,h)],[o.VIEW_ID.fightLayer,new c.WinInfo(v.fight.fightLayer,p)],[o.VIEW_ID.fightLayerPut,new c.WinInfo(v.fight.fightLayerPut,p)],[o.VIEW_ID.guessLayer,new c.WinInfo(v.fight.guessLayer,p)],[o.VIEW_ID.ceremonialGiftView,new c.WinInfo(v.fight.ceremonialGiftView,f)],[o.VIEW_ID.dailyView,new c.WinInfo(v.home.dailyView,f)],[o.VIEW_ID.vip,new c.WinInfo(v.home.vipCtrl,m)],[o.VIEW_ID.TimeLimitGift,new c.WinInfo(v.home.timeLimitGift,m)],[o.VIEW_ID.RankView,new c.WinInfo(v.home.rankView,m)],[o.VIEW_ID.PowerUp,new c.WinInfo(v.home.powerUp,_)],[o.VIEW_ID.sginIn,new c.WinInfo(v.home.signInCtrl,m)],[o.VIEW_ID.officer,new c.WinInfo(v.home.officerCtrl,p)],[o.VIEW_ID.detailsCtrl,new c.WinInfo(v.home.detailsCtrl,p)],[o.VIEW_ID.rewardCtrl,new c.WinInfo(v.tip.rewardCtrl,f)],[o.VIEW_ID.guessResultView,new c.WinInfo(v.tip.guessResultView,f)],[o.VIEW_ID.levelCtrl,new c.WinInfo(v.home.levelCtrl,d)],[o.VIEW_ID.blessCtrl,new c.WinInfo(v.home.blessCtrl,g)],[o.VIEW_ID.battleResult,new c.WinInfo(v.fight.battleResult,f)],[o.VIEW_ID.battleResultView,new c.WinInfo(v.fight.battleResultView,m)],[o.VIEW_ID.battleReward,new c.WinInfo(v.fight.battleReward,f)],[o.VIEW_ID.EquipDetailsCtrl,new c.WinInfo(v.home.EquipDetailsCtrl,y)],[o.VIEW_ID.setting,new c.WinInfo(v.home.setCtrl,d)],[o.VIEW_ID.skillPage,new c.WinInfo(v.home.skillPage,y)],[o.VIEW_ID.strengthenView,new c.WinInfo(v.home.strengthenView,y)],[o.VIEW_ID.currencyFrame,new c.WinInfo(v.home.currencyFrame,m)],[o.VIEW_ID.previewCtrl,new c.WinInfo(v.home.previewCtrl,y)],[o.VIEW_ID.featureCtrl,new c.WinInfo(v.home.featureCtrl,y)],[o.VIEW_ID.heroTry,new c.WinInfo(v.hero.heroTry,y)],[o.VIEW_ID.FightDataPreView,new c.WinInfo(v.home.FightDataPreView,y)],[o.VIEW_ID.recuitCardCtrl,new c.WinInfo(v.home.recuitCardCtrl,y)],[o.VIEW_ID.MoreGameCtrl,new c.WinInfo(v.tip.moreGame,g)],[o.VIEW_ID.DaioCanView,new c.WinInfo(v.tip.diacan,g)]])),o.JXViewPreLoad={},o.VIEW_IDByPageNum=((i={})[o.VIEW_ID.storePage]={page:[l.WinPage.Page0],view:o.VIEW_ID.home},i[o.VIEW_ID.heroPage]={page:[l.WinPage.Page1],view:o.VIEW_ID.home},i[o.VIEW_ID.mainPage]={page:[l.WinPage.Page2],view:o.VIEW_ID.home},i[o.VIEW_ID.squadPage]={page:[l.WinPage.Page3],view:o.VIEW_ID.home},i[o.VIEW_ID.recruitPage]={page:[l.WinPage.Page4],view:o.VIEW_ID.home},i),o.VIEW_PageNumByID=((n={})[l.WinPage.Page0]={id:o.VIEW_ID.storePage,view:o.VIEW_ID.storePage},n[l.WinPage.Page1]={id:o.VIEW_ID.heroPage,view:o.VIEW_ID.heroPage},n[l.WinPage.Page2]={id:o.VIEW_ID.mainPage,view:o.VIEW_ID.home},n[l.WinPage.Page3]={id:o.VIEW_ID.squadPage,view:o.VIEW_ID.squadPage},n[l.WinPage.Page4]={id:o.VIEW_ID.recruitPage,view:o.VIEW_ID.recruitPage},n),cc._RF.pop()},{"../../Core/CoreDefine":"CoreDefine","../../Core/FrameEx/ES5Ex":"ES5Ex","../../Core/Manager/UIMgr":"UIMgr","../../conventions/JXCommon":"JXCommon","./../../Core/CoreDefine":"CoreDefine","./UIResources":"UIResources"}],UserMgr:[function(t,e,o){"use strict";cc._RF.push(e,"27bfeu1iudFLaZI/OakPLm3","UserMgr");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var r=t("../../conventions/JXCommon"),a=t("../../Core/GCtrl"),s=t("../../Core/Math/MathEx"),c=t("../Common/Define"),l=t("../Common/UI"),u=t("../Data/RunTime/RunRaw/RJXItem"),h=t("./../../Core/FrameEx/ES5Ex"),p=t("./GameMgr"),d=function(t){function e(){return t.call(this)||this}return n(e,t),e.ins=function(){return null==this._instance&&(this._instance=new e),this._instance},e.prototype.getCurLevelRaw=function(){var t=p.default.lUserData.level+1;t>125&&(t%=125);var e=p.default.storyData.tryGetRaw(t);return e||(e=p.default.storyData.getRaw(t-1)),e},e.prototype.getLevelRaw=function(t){var e=p.default.storyData.tryGetRaw(t);return e||(e=p.default.storyData.getRaw(t-1)),e||(e=p.default.storyData.getRaw(t%125)),e},e.prototype.checkVipReward=function(t,e){var o=p.default.lUserData.vipReward[t-1];return!!o&&(e?o.recycle!==c.VIPRECEIVE.No&&o.recycle===c.VIPRECEIVE.FIRSTNORECEIVE:o.recycleUp!==c.VIPRECEIVE.No&&o.recycleUp===c.VIPRECEIVE.DATNORECEIVE)},e.prototype.vipReward=function(t,e){var o=p.default.lUserData.vipReward[t-1];return!!o&&(e?o.recycle===c.VIPRECEIVE.FIRSTRECEIVE||void 0:o.recycleUp===c.VIPRECEIVE.DAYRECEIVE)},e.prototype.checkVipRedPoint=function(t){for(var e=p.default.vipData.data.values(),o=!1,i=0;i<e.length;i++){var n=e[i];if(o=p.default.userMgr.checkVipReward(n.id,t))break}return o},e.prototype.checkOfficeReward=function(t){var e=p.default.lUserData.getOfficeStatus(t);return!!e&&e.box!==c.OFFICERITEM.NOT&&e.box===c.OFFICERITEM.LOCK},e.prototype.checkOfficeRedPoint=function(){for(var t=p.default.officerData.data.values(),e=!1,o=0;o<t.length;o++){var i=t[o];if(e=p.default.userMgr.checkOfficeReward(i.id))break}return e},e.prototype.checkSignRedPoint=function(){return!p.default.lUserData.todayIsSignIn()},e.prototype.checkTowerRewardTime=function(){var t=p.default.lUserData.lastTowerGet,e=a.GCtrl.now,o=p.default.lUserData.getRewardInfo();return e-t>=12*r.JXDef.Time.HOUR&&o[0]&&o[1]},e.prototype.checTaskReceive=function(){var t=p.default.dailyTaskData.data,o=[];t.forEach(function(t){o.push(t)});for(var i=0;i<o.length;i++){var n=e.ins().getDailyTaskState(o[i].id);if(0==n.receive&&n.ftime>=o[i].needNum)return!0}return!1},e.prototype.checkCanBuyFree=function(){},e.prototype.getDailyTaskState=function(t){for(var e=p.default.lUserData.getDailyTaskState(),o=(p.default.dailyTaskData.data,0);o<e.length;o++)if(e[o].id==t)return e[o];var i={id:t,ftime:0,receive:0};return p.default.lUserData.pushDailyTaskState(i),i},e.prototype.addDailyTaskState=function(t,e){this.getDailyTaskState(t).ftime+=e,p.default.redMgr.sendValueSettingMsg(c.RPointMask.RPM_Task_Receive,!0)},e.prototype.setDailyTaskReceive=function(t,e){this.getDailyTaskState(t).receive=e},e.prototype.drawCard=function(t){void 0===t&&(t=1);var e=p.default.systemConfig.value(r.JXDef.SYS_CONFIG_KEY.onceCard),o=new u.default([c.CURRENCY.GOLD,c.ITEM_TYPE.CURRENCY,e]),i=p.default.itemMgr.testCost(o,1,!0);i.enough?(a.GCtrl.ES.emit(c.CMsg.client.bag.onBagItemChange,[[c.CURRENCY.GOLD,c.ITEM_TYPE.CURRENCY,-e]]),this.luckDraw(t),p.default.sdkMgr.umaSetPoint(r.JXDef.umaPoint.recruit,{msg:c.PointInfo.recruit_click})):p.default.uiMgr.showToast(i.tip)},e.prototype.luckDraw=function(t){void 0===t&&(t=1),e.ins().addDailyTaskState(5,t),p.default.lUserData.recruitCtrl=t;var o=null;o=p.default.callData.data.values();var i=[],n=[];o.forEach(function(t){var e={id:t.id,weight:t.weight,award:t.award};i.push(e)});for(var r=0;r<i.length;r++)for(var a=i[r].weight,u=0;u<a;u++)n.push(r);if(n=s.default.fisherYatesShuffle(n),1==t){var h=Math.floor(Math.random()*n.length),d=[];d.push(i[n[h]].award);var f={recruitNum:t,award:d,cb:function(){p.default.jumpToMgr.jumpGoTo(l.VIEW_ID.rewardCtrl,d)}};p.default.jumpToMgr.jumpGoTo(l.VIEW_ID.recuitCardCtrl,f),i=[]}else if(10==t){var g=[],_=!1,m=p.default.rHeroData.getHaveHeros(c.SQUAD_BUTTON.ALL),y=m.have.length+m.notHave.length;for(r=0;r<t;r++)h=Math.floor(Math.random()*n.length),0==i[n[h]].award[1]&&(_=!0),g.push(i[n[h]].award);if(!_){g.splice(Math.floor(Math.random()*g.length),1);var v=[1001+Math.floor(Math.random()*y),0,1];g.push(v),console.log("\u5341\u8fde\u62bd\u6ca1\u5f97\u5230\u82f1\u96c4\u8865\u8fdb",v)}f={recruitNum:t,award:g,cb:function(){p.default.jumpToMgr.jumpGoTo(l.VIEW_ID.rewardCtrl,g,c.REWARD.HERO),g=[]}},p.default.jumpToMgr.jumpGoTo(l.VIEW_ID.recuitCardCtrl,f),i=[]}},e._instance=null,e}(h.ObjectWrap);o.default=d,cc._RF.pop()},{"../../Core/GCtrl":"GCtrl","../../Core/Math/MathEx":"MathEx","../../conventions/JXCommon":"JXCommon","../Common/Define":"Define","../Common/UI":"UI","../Data/RunTime/RunRaw/RJXItem":"RJXItem","./../../Core/FrameEx/ES5Ex":"ES5Ex","./GameMgr":"GameMgr"}],VIewUtil:[function(t,e,o){"use strict";cc._RF.push(e,"e7a9ciUbpxLvqlXbu8k3P2J","VIewUtil"),Object.defineProperty(o,"__esModule",{value:!0}),o.ViewUtil=void 0;var i=t("../../Common/UIAction"),n=t("./../../../Core/GCtrl"),r=t("./../../Common/Language");o.ViewUtil={taskTick:function(t,e,o,a,s,c){void 0===c&&(c="");var l=t.tickTime||.1;i.timerAction(e,l,function(){var i=t.end-t.start,s=n.GCtrl.now-t.start,l=Math.max(i-s,0);o&&(o.string=c+r.LTimer(Math.floor(l/1e3))),a&&(a.fillRange=l/i),t.update&&t.update(l,i),0==l&&(e.stopAllActions(),t.endcb&&t.endcb())})},func:{seachChildrens:function(t,e){for(var i=0,n=t.children.length;i<n;i++){var r=t.children[i];r.children.length>0&&o.ViewUtil.func.seachChildrens(r,e),e(r)}e(t)},preventClicks:function(t){var e=!1;t.target.on("click",function(){e||(e=!0,t.startCb&&t.startCb(),setTimeout(function(){e=!1,t.endCb&&t.endCb()},1e3*t.time))})}},addButtonHander:function(t,e,o,i,n){t instanceof cc.Button||(t=t.getComponent(cc.Button)?t.getComponent(cc.Button):t.addComponent(cc.Button)),t.transition=cc.Button.Transition.SCALE;var r=new cc.Component.EventHandler;r.target=e,r.component=o,r.handler=i,r.customEventData=n,t.clickEvents=[r]},addToggleHander:function(t,e,o,i,n){t instanceof cc.Toggle||(t=t.getComponent(cc.Toggle))||(t=t.addComponent(cc.Toggle));var r=new cc.Component.EventHandler;r.target=e,r.component=o,r.handler=i,r.customEventData=n,t.checkEvents.push(r)}},cc._RF.pop()},{"../../Common/UIAction":"UIAction","./../../../Core/GCtrl":"GCtrl","./../../Common/Language":"Language"}],VipCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"fc3460alJJMHoWlu9sTVe/z","VipCtrl");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../Core/CoreDefine"),s=t("../../../Core/GCtrl"),c=t("../../../Core/GView/GViewBase"),l=t("../../Common/Define"),u=t("../../Common/UI"),h=t("../../Common/UIResources"),p=t("../../Logic/GameMgr"),d=cc._decorator,f=d.ccclass,g=d.property,_=d.menu,m=(d.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageView=null,e.content=null,e.curvipLv=null,e.nextLv=null,e.curAdNum=null,e.progressBar=null,e._index=0,e._maxIndex=0,e}return n(e,t),e.prototype.nextPage=function(){this._maxIndex=this.content.children.length,this._index=this.pageView.getCurrentPageIndex(),this._index++,this._index>=this._maxIndex&&(this._index=this._maxIndex),this.pageView.setCurrentPageIndex(this._index)},e.prototype.previousPage=function(){this._index=this.pageView.getCurrentPageIndex(),this._index--,this._index<=0&&(this._index=0),this.pageView.setCurrentPageIndex(this._index)},e.prototype.onGLoad=function(){s.GCtrl.ES.on(l.CMsg.client.home.onVipLvUp,this,this.initUserLvInfo.bind(this),a.PRIORITY_VIEW),this.creatorPage(),this.initUserLvInfo()},e.prototype.changePage=function(){p.default.lUserData.vipLv>=1&&(this._index=p.default.lUserData.vipLv-1,this.pageView.setCurrentPageIndex(this._index))},e.prototype.setLoadProgress=function(t){this.progressBar&&(this.progressBar.progress=Math.min(t,1))},e.prototype.initUserLvInfo=function(){var t=this;p.default.redMgr.sendValueSettingMsg(l.RPointMask.RPM_Vip_Daily,!1),p.default.redMgr.sendValueSettingMsg(l.RPointMask.RPM_Vip_Frist,!1);var e=p.default.lUserData.vipLv;this.curvipLv.string=e+"";var o=e+1;if(o>p.default.vipData.size)o=e,this.nextLv.string="vip\u7b49\u7ea7\u5df2\u8fbe\u6700\u9ad8\u7ea7",this.progressBar&&(this.progressBar.progress=1);else{var i=p.default.vipData.getRaw(o).next-p.default.lUserData.adWatchTime;this.nextLv.string="\u89c2\u770b"+(i+1)+"\u6b21\u5e7f\u544a\u8fbe\u5230Vip"+o}0==e&&0==p.default.lUserData.adWatchTime?this.progressBar&&(this.progressBar.progress=0):p.default.vipData.data.forEach(function(o,i){if(o.id==e+1){var n=p.default.lUserData.adWatchTime/(o.next+1);t.setLoadProgress(n)}if(e>=1&&i<=e){t.changePage();var r=p.default.lUserData.getVipReward(i-1,l.VIPBOXTYPE.DAYBOX),a=p.default.lUserData.getVipReward(i-1,l.VIPBOXTYPE.FIRSTBOX);r==l.VIPRECEIVE.No&&p.default.lUserData.setVipReward(i-1,l.VIPBOXTYPE.DAYBOX,l.VIPRECEIVE.FIRSTNORECEIVE),a!=l.VIPRECEIVE.No&&a!=l.VIPRECEIVE.DAYRECEIVE||p.default.lUserData.todayIsDayReceiveDate(i-1)||p.default.lUserData.setVipReward(i-1,l.VIPBOXTYPE.FIRSTBOX,l.VIPRECEIVE.DATNORECEIVE)}})},e.prototype.addVideo=function(){var t=[l.SPECIALWINDOW.VIDEO,l.SPECIALWINDOW.VIDEO,1];p.default.jumpToMgr.jumpGoTo(u.VIEW_ID.currencyFrame,t,1)},e.prototype.textadBtn=function(){p.default.lUserData.addAdWatchTime(),this.initUserLvInfo()},e.prototype.creatorPage=function(){var t=this;this.assetImpl.prefab(h.Res.prefab.vw.home.vipPage,function(e){p.default.vipData.data.forEach(function(o,i){var n=t.assetImpl.addGChild(e);n.init(o,i),t.pageView.addPage(n.node)})})},e.prototype.close=function(){this.onClose()},e.prototype.update=function(){this.pageView._unregisterEvent(),this.pageView.setCurrentPageIndex(this._index)},r([g({type:cc.PageView,tooltip:"Vip\u6eda\u52a8"})],e.prototype,"pageView",void 0),r([g({type:cc.Node,tooltip:"\u7ffb\u9875\u7236\u8282\u70b9"})],e.prototype,"content",void 0),r([g({type:cc.Label,tooltip:"\u5f53\u524dvip\u7b49\u7ea7"})],e.prototype,"curvipLv",void 0),r([g({type:cc.Label,tooltip:"\u4e0b\u4e00\u4e2avip\u7b49\u7ea7"})],e.prototype,"nextLv",void 0),r([g({type:cc.Label,tooltip:"\u5f53\u524d\u89c2\u770b\u89c6\u9891\u6b21\u6570"})],e.prototype,"curAdNum",void 0),r([g(cc.ProgressBar)],e.prototype,"progressBar",void 0),r([f,_("View/Home/VipCtrl")],e)}(c.default));o.default=m,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/GCtrl":"GCtrl","../../../Core/GView/GViewBase":"GViewBase","../../Common/Define":"Define","../../Common/UI":"UI","../../Common/UIResources":"UIResources","../../Logic/GameMgr":"GameMgr"}],VipPage:[function(t,e,o){"use strict";cc._RF.push(e,"a1a3aQuivVFLK07cdZtP6mr","VipPage");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../../conventions/JXCommon"),s=t("../../../Core/CoreDefine"),c=t("../../../Core/GCtrl"),l=t("../../../Core/GView/GChild"),u=t("../../../Shaders/Manager/ShaderUtil"),h=t("../../Common/Define"),p=t("../../Common/UI"),d=t("../../Common/UICreate"),f=t("../../Logic/GameMgr"),g=cc._decorator,_=g.ccclass,m=g.property,y=g.menu,v=(g.executeInEditMode,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vipBuffLabel=null,e.vipBuffLab=null,e.vipLv=null,e.rewardBtn=[],e.colors=[],e.preview=[],e.previewPos=[],e.boxLab=[],e._staticData=null,e._index=null,e}return n(e,t),e.prototype.onGLoad=function(){c.GCtrl.ES.on(h.CMsg.client.home.onVipLvUp,this,this.setRedPoint.bind(this),s.PRIORITY_VIEW),this.initEvent()},e.prototype.initEvent=function(){this.preview[h.VIPBOXTYPE.DAYBOX].on(cc.Node.EventType.TOUCH_START,this._onTouchStar0,this),this.preview[h.VIPBOXTYPE.FIRSTBOX].on(cc.Node.EventType.TOUCH_START,this._onTouchStar1,this)},e.prototype._onTouchStar1=function(){this.preViewShow(h.BOXPREVIEW.FIRSTBOX)},e.prototype._onTouchStar0=function(){this.preViewShow(h.BOXPREVIEW.DAYBOX)},e.prototype.preViewShow=function(t){f.default.jumpToMgr.jumpGoTo(p.VIEW_ID.previewCtrl,this._staticData,t)},e.prototype.init=function(t,e){this._staticData=t,this._index=Number(e);var o=""+e,i=d.default.createDescribe(o);i.setPosition(0,0),this.vipLv.node.addChild(i),this.initBuffInfo();var n=f.default.vipData.data.values(),r=f.default.lUserData.vipReward,a=f.default.lUserData.dayReceiveDate;if(a.length<n.length&&(a.push(h.VIPRECEIVE.No),f.default.lUserData.dayReceiveDate=a),r.length<n.length){var s={recycle:h.VIPRECEIVE.No,recycleUp:h.VIPRECEIVE.No};r.push(s),f.default.lUserData.vipReward=r}this.setRedPoint()},e.prototype.setRedPoint=function(){var t=f.default.userMgr.checkVipReward(this._staticData.id,!1),e=f.default.userMgr.checkVipReward(this._staticData.id,!0),o=f.default.userMgr.vipReward(this._staticData.id,!1),i=f.default.userMgr.vipReward(this._staticData.id,!0);this.boxLab[1].string=o?"\u5df2\u9886\u53d6":"\u9886\u53d6",this.boxLab[0].string=i?"\u5df2\u9886\u53d6":"\u9886\u53d6",t?u.default.normal(this.rewardBtn[1],!0):u.default.gray(this.rewardBtn[1],!0),e?u.default.normal(this.rewardBtn[0],!0):u.default.gray(this.rewardBtn[0],!0),f.default.redMgr.setRPointView(this.rewardBtn[1],this.rewardBtn[1],t,h.RedpointEffect.REDPOINT,null),f.default.redMgr.setRPointView(this.rewardBtn[0],this.rewardBtn[0],e,h.RedpointEffect.REDPOINT,null)},e.prototype.initBuffInfo=function(){var t=this._staticData.txt;this.vipBuffLab.string=t},e.prototype.initGiftReward=function(){var t=f.default.lUserData.getVipReward(this._index-1,h.VIPBOXTYPE.DAYBOX);f.default.lUserData.vipLv>=this._index&&t==h.VIPRECEIVE.FIRSTNORECEIVE&&(this.boxLab[0].string="\u5df2\u9886\u53d6",f.default.lUserData.setVipReward(this._index-1,h.VIPBOXTYPE.DAYBOX,h.VIPRECEIVE.FIRSTRECEIVE),f.default.jumpToMgr.jumpGoTo(p.VIEW_ID.rewardCtrl,this._staticData.recycle),this.setRedPoint(),f.default.redMgr.sendValueSettingMsg(h.RPointMask.RPM_Vip_Frist,!1),f.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.VipCtrl,{msg:h.PointInfo.vip_frist}))},e.prototype.initDayGiftReward=function(){var t=f.default.lUserData.getVipReward(this._index-1,h.VIPBOXTYPE.FIRSTBOX);f.default.lUserData.vipLv>=this._index&&t==h.VIPRECEIVE.DATNORECEIVE&&(this.boxLab[1].string="\u5df2\u9886\u53d6",f.default.lUserData.setVipReward(this._index-1,h.VIPBOXTYPE.FIRSTBOX,h.VIPRECEIVE.DAYRECEIVE),f.default.lUserData.useDayReceiveDate(this._index-1),f.default.jumpToMgr.jumpGoTo(p.VIEW_ID.rewardCtrl,this._staticData.recycleUp),this.setRedPoint(),f.default.redMgr.sendValueSettingMsg(h.RPointMask.RPM_Vip_Daily,!1),f.default.sdkMgr.umaSetPoint(a.JXDef.umaPoint.VipCtrl,{msg:h.PointInfo.vip_daily}))},r([m({type:cc.Node,tooltip:"vipbuff\u4fe1\u606f"})],e.prototype,"vipBuffLabel",void 0),r([m({type:cc.Label,tooltip:"vipbuff"})],e.prototype,"vipBuffLab",void 0),r([m({type:cc.Label,tooltip:"vipLv"})],e.prototype,"vipLv",void 0),r([m({type:cc.Node,tooltip:"vipbuff\u4fe1\u606f"})],e.prototype,"rewardBtn",void 0),r([m({type:cc.Color,tooltip:"\u989c\u8272"})],e.prototype,"colors",void 0),r([m({type:cc.Node,tooltip:"\u9884\u89c8\u5b9d\u7bb1"})],e.prototype,"preview",void 0),r([m({type:cc.Node,tooltip:"\u9884\u89c8\u751f\u6210\u4f4d\u7f6e"})],e.prototype,"previewPos",void 0),r([m({type:cc.Label,tooltip:"\u6309\u94ae\u6587\u6848"})],e.prototype,"boxLab",void 0),r([_,y("View/Home/VipPage")],e)}(l.default));o.default=v,cc._RF.pop()},{"../../../Core/CoreDefine":"CoreDefine","../../../Core/GCtrl":"GCtrl","../../../Core/GView/GChild":"GChild","../../../Shaders/Manager/ShaderUtil":"ShaderUtil","../../../conventions/JXCommon":"JXCommon","../../Common/Define":"Define","../../Common/UI":"UI","../../Common/UICreate":"UICreate","../../Logic/GameMgr":"GameMgr"}],WXCustomAd:[function(t,e,o){"use strict";cc._RF.push(e,"9131drpFqNKgbU8ax4JiJNz","WXCustomAd"),Object.defineProperty(o,"__esModule",{value:!0}),o.WXCustomAd=o.EType=void 0;var i=t("../../tyqSDK");(function(t){t[t.rect=1]="rect",t[t.horizontal=2]="horizontal",t[t.vertical=3]="vertical",t[t.grid=4]="grid"})(o.EType||(o.EType={}));var n=function(){function t(){}return t.setadunit=function(t,e,o,i){this._customc_rect_adunit=t,this._customc_h_adunit=e,this._customc_v_adunit=o,this._customc_one_adunit=i},t.createCustomAd=function(t,e,o,n,r,a){var s=this;if(window.wx){this.sysInfo||(this.sysInfo=wx.getSystemInfoSync());var c=this.sysInfo.SDKVersion,l=null,u="",h=this;if(a&&(this.cb=a),1==e?u=this._customc_rect_adunit[this.rand(0,this._customc_rect_adunit.length-1)]:2==e?u=this._customc_h_adunit[this.rand(0,this._customc_h_adunit.length-1)]:3==e?u=this._customc_v_adunit[this.rand(0,this._customc_v_adunit.length-1)]:4==e&&(u=this._customc_one_adunit[this.rand(0,this._customc_one_adunit.length-1)]),r&&""!==r&&("string"==typeof r?u=r:r instanceof Array&&(u=r[this.rand(0,r.length-1)])),i.tyqSDK.log("\u663e\u793a\u539f\u751f\u6a21\u677f\u5e7f\u544a id",u),""!=u)if(i.tyqSDK.log("\u663e\u793a\u539f\u751f\u6a21\u677f\u5e7f\u544a",t,this._ads,this._waits),this._ads[t])l=this._ads[t],i.tyqSDK.log("\u7f13\u5b58\u6709"),l.isShow()||l.show();else if(this.compareVersion(c,"2.11.1")>=0){i.tyqSDK.log("\u521b\u5efa\u539f\u751f\u6a21\u677f\u5e7f\u544a"+t,"id:"+u,"pos:",o);var p=h.getPos(n,o);(l=wx.createCustomAd({adUnitId:u,adIntervals:30,style:{top:p.top,left:p.left,width:n.width,fixed:!1}})).onLoad(function(){h._ads[t]=l;var e=h._waits.indexOf(t);i.tyqSDK.log("\u539f\u751f\u6a21\u677f\u5e7f\u544a\u52a0\u8f7d\u5b8c\u6210\uff1a"+t,h._waits,e),-1==e?l.show():(h._waits=h._waits.filter(function(e){return e!=t}),l.hide().then(function(){}).catch(function(){i.tyqSDK.log("\u7b2c\u4e8c\u6b21hide"),l.hide().catch(function(){i.tyqSDK.log("\u7b2c\u4e09\u6b21hide")})}))}),l.onError(function(t){i.tyqSDK.log("\u539f\u751f\u6a21\u677f\u5e7f\u544a\u52a0\u8f7d\u5931\u8d25:",t.errCode," ",t.errMsg),1004===parseInt(t.errCode)&&s.cb&&(i.tyqSDK.log("\u62c9\u53d6\u5931\u8d25"),s.cb())}),l.onClose(function(){i.tyqSDK.log("\u539f\u751f\u6a21\u677f\u5e7f\u544a\u5173\u95ed")})}}},t.rand=function(t,e){return t+Math.floor(Math.random()*(e-t+1))},t.hideCustomAd=function(t){var e=null;i.tyqSDK.log("\u9690\u85cf\u539f\u751f\u6a21\u677f\u5e7f\u544a",t,this._ads,this._waits),this._ads[t]?(e=this._ads[t]).isShow()&&e.hide().then(function(){}).catch(function(){i.tyqSDK.log("\u7b2c\u4e8c\u6b21hide"),e.hide().catch(function(){i.tyqSDK.log("\u7b2c\u4e09\u6b21hide")})}):-1==this._waits.indexOf(t)&&this._waits.push(t)},t.destroyCustomAd=function(t){this._ads[t]&&(this._ads[t].destroy(),this._ads[t]=null)},t.compareVersion=function(t,e){t=t.split("."),e=e.split(".");for(var o=Math.max(t.length,e.length);t.length<o;)t.push("0");for(;e.length<o;)e.push("0");for(var i=0;i<o;i++){var n=parseInt(t[i]),r=parseInt(e[i]);if(n>r)return 1;if(n<r)return-1}return 0},t.getPos=function(t,e){this.sysInfo||(this.sysInfo=wx.getSystemInfoSync());var o=this.sysInfo,i=t.width,n=t.height,r=o.windowWidth/cc.winSize.width,a=o.windowHeight/cc.winSize.height,s=(o.windowWidth-i)/2,c=(o.windowHeight-n)/2;return e&&null!=e.left&&(s=e.left*r),e&&null!=e.top&&(c=e.top*a),e&&null!=e.right&&(s=o.windowWidth-i-e.right*r),e&&null!=e.bottom&&(c=o.windowHeight-n-e.bottom*a),e&&null!=e.centerX&&(s=(o.windowWidth-i)/2+e.centerX*r),e&&null!=e.centerY&&(c=(o.windowHeight-n)/2+e.centerY*a),{left:s,top:c}},t.hideAllAd=function(){for(var t in this._ads)this.hideCustomAd(t)},t._customc_rect_adunit=[],t._customc_h_adunit=[],t._customc_v_adunit=[],t._customc_one_adunit=[],t._ads={},t._waits=[],t.sysInfo=null,t}();o.WXCustomAd=n,cc._RF.pop()},{"../../tyqSDK":"tyqSDK"}],Zh:[function(t,e,o){"use strict";cc._RF.push(e,"aa14dpjH3NMJoEMyAkwMKG0","Zh"),Object.defineProperty(o,"__esModule",{value:!0}),o.JXLocales=void 0,o.JXLocales={load:{assetLoad:"\u8d44\u6e90\u52a0\u8f7d\u4e2d...",process:"\u8d44\u6e90\u52a0\u8f7d\u4e2d\uff1a {1}/{2}",static:"\u914d\u7f6e\u6570\u636e\u52a0\u8f7d\u4e2d\uff1a{1}/{2}",load_pro:"\u8fdb\u5ea6\u663e\u793a",initUserData:"\u521d\u59cb\u5316\u7528\u6237\u6570\u636e",userDataLoad:"\u7528\u6237\u6570\u636e\u52a0\u8f7d\u4e2d{1}/{2}",loading:"\u52a0\u8f7d\u4e2d...",loadPackage:"\u6b63\u5728\u52a0\u8f7d\u5206\u5305",enter_game:"\u6b63\u5728\u8fdb\u5165\u6e38\u620f\u4e16\u754c"},tower:{clickRecruit:"\u62bd\u5361\u7d2f\u8ba1\u9886\u53d6\u5956\u52b1{1}\u6b21\u6570",sign:"\u7b7e\u5230\u5956\u52b1-\u7b2c{1}\u5929",guide:"\u65b0\u624b\u5f15\u5bfc\u7b2c{1}\u5173\u7ed3\u675f",store:"\u88c5\u5907\u5b9d\u5e93\u88c5\u5907\u83b7\u53d6\u6b21\u6570",hero:"\u62e5\u6709\u82f1\u96c4",heroTrait:"\u82f1\u96c4\u54c1\u8d28",heroStar:"\u82f1\u96c4{1}\u661f",mainBox0:"\u9010\u9e7f\u4e4b\u6218\u7b2c{1}\u5173\u5b9d\u7bb1",mainBox1:"\u7267\u91ce\u4e4b\u6218\u7b2c{1}\u5173\u5b9d\u7bb1",mainBox2:"\u5de8\u9e7f\u4e4b\u6218\u7b2c{1}\u5173\u5b9d\u7bb1",mainBox3:"\u5b98\u6e21\u4e4b\u6218\u7b2c{1}\u5173\u5b9d\u7bb1",mainBox4:"\u8d64\u58c1\u4e4b\u6218\u7b2c{1}\u5173\u5b9d\u7bb1",onlineRwWard:"\u5728\u7ebf\u5956\u52b1\u793c\u5305{1}\u6b21",officer:"\u5b98\u804c\u5956\u52b1-{1}",level:"\u7b2c{1}\u5173",isTop:"\u5df2\u8fbe\u5230\u6700\u9ad8\u5c42",noReward:"\u6682\u65e0\u5956\u52b1\u9886\u53d6"},tip:{alldoubleClick:"\u6240\u6709\u5956\u52b1\u5df2\u7ffb\u500d\u53d1\u9001",doubleClick:"\u5956\u52b1\u5df2\u7ffb\u500d\u53d1\u9001",level:"\u901a\u8fc7\u7b2c9\u5173\u5f00\u542f\u5408\u6210\u5f3a\u5316\u754c\u9762",lvNO:"\u82f1\u96c4\u7b49\u7ea7\u4e0d\u8db3\uff0c\u53ef\u901a\u8fc7\u6218\u6597\u83b7\u5f97\u7ecf\u9a8c\u5347\u7ea7",lvExp:"\u82f1\u96c4\u7ecf\u9a8c\u4e0d\u8db3\uff0c\u53ef\u901a\u8fc7\u6218\u6597\u83b7\u5f97\u7ecf\u9a8c",blessLose:"\u5f3a\u5316\u5931\u8d25",unBless:"\u8be5\u88c5\u5907\u4e0d\u53ef\u4ee5\u5f3a\u5316",result:"\u5408\u6210\u5931\u8d25\uff0c\u8bf7\u4fee\u6539\u5408\u6210\u6750\u6599",noEnoughtBless:"\u5408\u6210\u6750\u6599\u4e0d\u8db3",bless:"\u8bf7\u9009\u62e9\u5bf9\u5e94\u54c1\u8d28\u88c5\u5907\u8fdb\u884c\u5408\u6210",equip:"\u8bf7\u9009\u62e9\u5bf9\u5e94\u88c5\u5907\u7a7f\u6234",equipLv:"\u82f1\u96c4\u7b49\u7ea7\u672a\u6ee1\u8db3\u7a7f\u6234\u7b49\u7ea7",coin:"\u91d1\u5e01\u4e0d\u8db3",jewel:"\u5b9d\u77f3\u4e0d\u8db3",unlock:"q"},vip:{info0:"\u6218\u573a\u52a0\u901f{1}\u500d",info1:"\u6218\u573a\u521d\u59cb\u8d44\u6e90+{1}",info2:"\u5408\u6210\u6d88\u8017\u8d44\u6e90{1}",info3:"\u5f3a\u5316\u6d88\u8017\u8d44\u6e90{1}",info4:"\u722c\u5854\u514d\u8d39\u5f3a\u5f81\u6b21\u6570+{1}\u6b21"},propts:{info1000:"\u54c1\u8d28:",info1001:"\u8017\u7cae:",info0:"\u653b\u51fb:{1}",info1:"\u9632\u5fa1:{1}",info2:"\u751f\u547d:{1}",info3:"\u66b4\u51fb:{1}",info4:"\u95ea\u907f:{1}",info5:"\u7206\u4f24:{1}",info6:"\u51b0\u5c5e\u6027\u653b\u51fb:{1}",info7:"\u706b\u5c5e\u6027\u653b\u51fb:{1}",info8:"\u51b0\u5c5e\u6027\u6297\u6027:{1}",info9:"\u706b\u5c5e\u6027\u6297\u6027:{1}"},currencyLab:{info103:"\u662f\u5426\u89c2\u770b\u89c6\u9891\u83b7\u5f97{1}\u5175\u529b",info100:"\u7389\u77f3\u4e0d\u8db3\uff0c\u662f\u5426\u89c2\u770b\u89c6\u9891\u83b7\u5f97{1}\u4e2a\u7389\u77f3",info101:"\u91d1\u5e01\u4e0d\u8db3\uff0c\u662f\u5426\u89c2\u770b\u89c6\u9891\u83b7\u5f97{1}\u4e2a\u91d1\u5e01",info201:"\u7a81\u7834\u4e39\u4e0d\u8db3\uff0c\u662f\u5426\u89c2\u770b\u89c6\u9891\u83b7\u5f971\u9897\u7a81\u7834\u4e39",info1001:"\u788e\u7247\u4e0d\u8db3\uff0c\u662f\u5426\u89c2\u770b\u89c6\u9891\u83b7\u5f97{1}\u788e\u7247",del100:"\u56de\u6536\u8be5\u88c5\u5907\u53ef\u83b7\u5f97{1}\u7389\u77f3\uff0c\u662f\u5426\u56de\u6536\uff1f",info99999:"\u89c2\u770b\u89c6\u9891\u63d0\u5347vip\u7b49\u7ea7"},equipPropts:{info1000:"\u54c1\u8d28:",info1001:"\u8017\u7cae:",info0:"\u653b\u51fb:",info1:"\u9632\u5fa1:",info2:"\u751f\u547d:",info3:"\u66b4\u51fb\u7387:",info4:"\u62b5\u6297:",info5:"\u7206\u4f24:",info6:"\u51b0\u5c5e\u6027\u653b\u51fb:",info7:"\u706b\u5c5e\u6027\u653b\u51fb:",info8:"\u51b0\u5c5e\u6027\u6297\u6027:",info9:"\u706b\u5c5e\u6027\u6297\u6027:"},heroGroup:{group1:"\u5175",group2:"\u8f66",group3:"\u9a6c",group4:"\u70ae",group5:"\u8c61",group6:"\u58eb"},bless:{info2:"\u6210\u529f\u7387\uff1a{1}"},currency:{not_enough:"\u4e0d\u8db3"},alert:{roseNoEnough:"\u8d27\u5e01\u4e0d\u8db3,\u662f\u5426\u89c2\u770b\u89c6\u9891\u83b7\u5f97\u4e00\u6b21\u5956\u52b1",fragNoEnough:"\u788e\u7247\u4e0d\u8db3,\u662f\u5426\u89c2\u770b\u89c6\u9891\u83b7\u5f97\u4e00\u6b21\u5956\u52b1",addStrength:"\u662f\u5426\u89c2\u770b\u89c6\u9891\u83b7\u5f97{1}\u70b9\u4f53\u529b"},fight:{teamEmpty:"\u6ca1\u6709\u4e0a\u9635\u82f1\u96c4",hasHero:"\u5df2\u7ecf\u5b58\u5728\u82f1\u96c4",noWheat:"\u7cae\u8349\u4e0d\u8db3",bool:"\u751f\u547d:{1}",wave:"\u7b2c{1}\u6ce2"},skillType:{Active:"\u4e3b\u52a8",Passive:"\u88ab\u52a8"},common:{guide_step_tip:"\u5f53\u524d\u5f15\u5bfc{1}/{2}"},tth:"\u4e07"},cc._RF.pop()},{}],beHaviorComponent:[function(t,e,o){"use strict";cc._RF.push(e,"075abe8g6VGh68VDx7fc9Tj","beHaviorComponent");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.beHaviorComponent=void 0;var a=t("../Core/GLoader/GLoader"),s=t("./platform/wechat/wechat"),c=t("./tyqAdManager"),l=cc._decorator,u=l.ccclass,h=l.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.icon=null,e.strategy=1,e.currentShow=0,e.isClick=!1,e}return n(e,t),e.prototype.onEnable=function(){},e.prototype.start=function(){var t=this;c.tyqAdManager.isOpenBeHavior?(this.node.on(cc.Node.EventType.TOUCH_START,function(){console.log("beHaviorComponent \u70b9\u51fb"),t.isClick=!0},this),c.tyqAdManager.getChannel()==c.Channel.WECHAT&&(1==this.strategy?s.Wechat.isShareBehavior()?(this.spriteFrame(this.icon.getComponent(cc.Sprite),"ui_Share"),c.tyqAdManager.reportShareBehavior(1,this.strategy,1)):c.tyqAdManager.reportShareBehavior(1,this.strategy,0):1==this.currentShow?(this.spriteFrame(this.icon.getComponent(cc.Sprite),"ui_Share"),c.tyqAdManager.reportShareBehavior(1,this.strategy,1)):c.tyqAdManager.reportShareBehavior(1,this.strategy,0))):console.log("beHaviorComponent destroy")},e.prototype.onDisable=function(){c.tyqAdManager.getChannel()==c.Channel.WECHAT&&(1==this.strategy?s.Wechat.isShareBehavior()?c.tyqAdManager.reportShareBehavior(this.isClick?4:3,this.strategy,1):c.tyqAdManager.reportShareBehavior(this.isClick?4:3,this.strategy,0):1==this.currentShow?c.tyqAdManager.reportShareBehavior(this.isClick?4:3,this.strategy,1):c.tyqAdManager.reportShareBehavior(this.isClick?4:3,this.strategy,0))},e.prototype.spriteFrame=function(t,e){if(t&&e&&(e=a.GAssetImpl.realUrl(e))){var o=function(e,o){if(e)return cc.warn(e.message),void(t.spriteFrame=null);t.spriteFrame=o}.bind(this);a.GAssetImpl.loader.loadRes(e,cc.SpriteFrame,o)}},r([h({type:cc.Node})],e.prototype,"icon",void 0),r([h({tooltip:"\u5e7f\u544a\u4e1a\u52a11\uff1a\u7cfb\u7edf\u5206\u914d\uff0c0\uff1a\u81ea\u5b9a\u4e49"})],e.prototype,"strategy",void 0),r([h({tooltip:"\u5f3a\u52360\uff1a\u5e7f\u544a\uff0c1\u5206\u4eab\uff0cstrategy == 1\u65f6\u624d\u751f\u6548"})],e.prototype,"currentShow",void 0),r([u("beHaviorComponent")],e)}(cc.Component);o.beHaviorComponent=p,cc._RF.pop()},{"../Core/GLoader/GLoader":"GLoader","./platform/wechat/wechat":"wechat","./tyqAdManager":"tyqAdManager"}],cocosUtil:[function(t,e,o){"use strict";cc._RF.push(e,"c6b74pmm/VEqaWZqrRtczgX","cocosUtil"),Object.defineProperty(o,"__esModule",{value:!0}),o.UIOpacity=o.cocosUtil=void 0,o.cocosUtil={tweenRotate:function(t,e){e||(e=2);var o=new cc.Quat;cc.Quat.fromEuler(o,0,0,360),cc.tween(t).by(e,{rotation:o},{easing:"linear",onUpdate:function(t,e){var i=360*e;cc.Quat.fromEuler(o,0,0,i),t.setRotation(o)}}).repeatForever().start()},tweenUpDown:function(t,e,o){e||(e=10),o||(o=1);var i=t.getPosition();i.y+=e;var n=t.getPosition();cc.tween(t).to(o,{position:i}).to(o,{position:n}).union().repeatForever().start()},tweenFadeOut:function(t,e,o){e||(e=1.5),cc.tween(t).to(e,{opacity:0}).call(function(){o&&o()}).start()},tweenScaleBreath:function(t,e,o){e||(e=.4),o||(o=1.2),cc.tween(t).to(e,{scale:cc.v3(o,o,1)}).to(e,{scale:cc.v3(1,1,1)}).union().repeatForever().start()},tweenShake:function(t,e,o,i){e||(e=.2),o||(o=6),null==i&&(i=5*e);var n=new cc.Quat;cc.Quat.fromEuler(n,0,0,o);var r=new cc.Quat;cc.Quat.fromEuler(r,0,0,-o);var a=new cc.Quat;cc.Quat.fromEuler(a,0,0,0),cc.tween(t).to(e,{rotation:n}).to(2*e,{rotation:r}).to(e,{rotation:a}).delay(i).union().repeatForever().start()},isNodeValid:function(t){return!(!t||!cc.isValid(t))},isAndroid:function(){return cc.sys.platform===cc.sys.ANDROID},isDesktopBrowser:function(){return cc.sys.platform===cc.sys.DESKTOP_BROWSER},isIos:function(){return cc.sys.platform===cc.sys.IPHONE},isWechatGame:function(){return cc.sys.platform===cc.sys.WECHAT_GAME},addKeyDownListener:function(t,e){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,t,e)},init:function(){this.designSize=cc.view.getDesignResolutionSize(),this.frameSize=cc.view.getFrameSize(),this.safeAreaRect=cc.sys.getSafeAreaRect(),this.safeAreaMarginTop=this.designSize.height-this.safeAreaRect.height,this.safeAreaMarginTop<0&&(this.safeAreaMarginTop=0),this.intiScreenAdapterWidthScale(),this.initScreenBgAdapterWidthScale()},intiScreenAdapterWidthScale:function(){var t=this.frameSize.height,e=this.frameSize.width,o=t/this.designSize.height,i=this.designSize.width*o,n=1;i>e&&(n=e/i),this.screenAdapterScale=n},getScreenAdapterScale:function(){return this.screenAdapterScale||(this.screenAdapterScale=1),this.screenAdapterScale},initScreenBgAdapterWidthScale:function(){var t=this.frameSize.height,e=this.frameSize.width,o=t/this.designSize.height,i=this.designSize.width*o,n=1;i<e&&(n=e/i),this.screenBgAdapterScale=n},getScreenBgAdapterScale:function(){return this.screenBgAdapterScale||(this.screenBgAdapterScale=1),this.screenBgAdapterScale},convertToWorldSpace:function(t,e){var o=t.parent,i=t.getPosition();if(e){var n=t;i.x=i.x+(.5-n.anchorX)*n.width,i.y=i.y+(.5-n.anchorY)*n.height}return o.convertToWorldSpaceAR(i)},convertToNodeSpace:function(t,e){return t.parent.convertToNodeSpaceAR(e)},setPositionX:function(t,e){var o=t.getPosition();o.x=e,t.setPosition(o)},setPositionY:function(t,e){var o=t.getPosition();o.y=e,t.setPosition(o)}},o.UIOpacity=function(){throw new Error("Function not implemented.")},cc._RF.pop()},{}],preventClicks:[function(t,e,o){"use strict";cc._RF.push(e,"b3846ykDtdP941rh0zQlXSM","preventClicks");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.delayTime=2,e._clickTime=0,e}return n(e,t),e.prototype.onLoad=function(){var t=this,e=this.node.getComponent(cc.Button);if(e){var o=e._onTouchBegan;e._onTouchBegan=function(i){Date.now()-t._clickTime<100*t.delayTime?i.stopPropagation():(t._clickTime=Date.now(),o.call(e,i))}}},r([c()],e.prototype,"delayTime",void 0),r([s],e)}(cc.Component);o.default=l,cc._RF.pop()},{}],resourceUtil:[function(t,e,o){"use strict";cc._RF.push(e,"6a176GExv5I3pHcJyue+PSt","resourceUtil");var i=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.resourceUtil=void 0;var n=cc._decorator.ccclass,r=function(){function t(){}return t.loadRes=function(t,e,o){e?cc.resources.load(t,e,function(t,e){if(t)return cc.error(t.message||t),void(o&&o(t,e));o&&o(t,e)}):cc.resources.load(t,function(t,e){if(t)return cc.error(t.message||t),void(o&&o(t,e));o&&o(t,e)})},t.loadResWithBundle=function(t,e,o){var i=t.split("|")[0],n=t.split("|")[1],r=cc.assetManager.getBundle(i);r&&(e?r.load(n,e,function(t,e){if(t)return cc.error(t.message||t),void(o&&o(t,e));o&&o(t,e)}):r.load(n,function(t,e){if(t)return cc.error(t.message||t),void(o&&o(t,e));o&&o(t,e)}))},t.loadResDirWithBundle=function(t,e,o){cc.assetManager.getBundle(t).loadDir(e,function(t,e){if(t)return cc.error(t.message||t),void(o&&o(t,e));o&&o(t,e)})},t.getUIPrefabRes=function(t,e){this.loadRes(t,cc.Prefab,e)},t.getUIPrefabResWithBundle=function(t,e){this.loadResWithBundle(t,cc.Prefab,e)},t.createUIWithBundle=function(t,e,o){var i=this;this.getUIPrefabResWithBundle(t,function(n,r){var a;n||(a=null!=i.dialog[t]?i.dialog[t]:cc.instantiate(r),o||(o=cc.find("Canvas")),a.setPosition(0,0),o.addChild(a),e&&e(null,a))})},t.setSpriteFrame=function(t,e,o){this.loadRes(t+"/spriteFrame",cc.SpriteFrame,function(i,n){if(i)return console.error("set sprite frame failed! err:",t,i),void o(i,n);e&&cc.isValid(e)&&(e.spriteFrame=n,o(null,n))})},t.setRemoteImage=function(){},t.dialog={},t.prefabs={},i([n("resourceUtil")],t)}();o.resourceUtil=r,cc._RF.pop()},{}],tyqAdManager:[function(t,e,o){"use strict";cc._RF.push(e,"a7efdPQBClCuJv4kti+aQlO","tyqAdManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.tyqAdManager=o.Channel=void 0;var i,n=t("./platform/wechat/wechat"),r=t("./platform/wechat/WXCustomAd"),a=t("./tyqSDK"),s=t("./tyqSDKConfig"),c=t("./utils/weHttp");(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.WECHAT=1]="WECHAT",t[t.ANDROID=2]="ANDROID",t[t.IOS=3]="IOS",t[t.ANDROID_233=4]="ANDROID_233"})(i=o.Channel||(o.Channel={}));var l=function(){function t(){if(this.channel=i.DEFAULT,this.customAdSizeObj={rect:{width:360,height:506},horizontal:{width:288,height:90},vertical:{width:62,height:388},grid:{width:68,height:102}},this.bannerAdShowing=!1,this.shareTime=0,this.shareListenerSuccess=null,this.shareListenerFail=null,this.videoCallBack=function(){},this.videoCallBackFail=function(){},this.isOpenBeHavior=!0,this.strategy=1,this.openID="",this.shareopenID="",cc.sys.platform==cc.sys.WECHAT_GAME){this.channel=i.WECHAT;var t=this;wx.login({success:function(e){e.code&&c.Http.httpGet("https://api.play.xmtyq.com:39997/getOpenId?game=tyld&code="+e.code,null,function(e){e.wxRes.openid&&(t.openID=e.wxRes.openid,console.log("\u8bf7\u6c42 openid \u6210\u529f",t.openID))},function(t){console.log("\u8bf7\u6c42 openid \u5931\u8d25",t)})}})}}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!1,configurable:!0}),t.prototype.getChannel=function(){return this.channel},t.prototype.getEnterUrlQuery=function(){if(this.channel==i.WECHAT&&wx.getEnterOptionsSync){var t=wx.getEnterOptionsSync();if(t&&t.query){var e=t.query.shareGameSync;return e&&(this.shareopenID=e),t.query}}return null},t.prototype.showAppMessage=function(){this.shareTime=(new Date).getTime(),console.log("this.openID = ",this.openID),n.Wechat.shareAppMessage("\u4e09\u56fd\u4e71\u4e16\uff0c\u6843\u56ed\u4e71\u6597\uff01","","shareGameSync="+this.openID)},t.prototype.initAdIds=function(){var t=this;if(this.channel!=i.WECHAT)return console.log(" NATIVE android \u5e73\u53f0 "),window.rewardedVideoAdCallBack=function(e){console.log("AD_DEMO rewardedVideoAdCallBack ",e),t.videoCallBack&&t.videoCallBack()},void(window.rewardedVideoAdFailCallBack=function(e){console.log("AD_DEMO rewardedVideoAdCallBack ",e),t.videoCallBackFail&&t.videoCallBackFail()});wx.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]}),wx.onHide(this.wxOnHide.bind(this)),wx.onShow(this.wxOnShow.bind(this));var e=a.tyqSDK.getSwitchValue(s.tyqSDKConfig.paramsKeys.tyq_ad_banners);e?n.Wechat._bannerAdUnitId=e.split(";"):a.tyqSDK.log("\u672a\u914d\u7f6ebanner\u5e7f\u544a\u53c2\u6570");var o=a.tyqSDK.getSwitchValue(s.tyqSDKConfig.paramsKeys.tyq_ad_interstitial);o?n.Wechat._interstitialAdUnitId=o.split(";"):a.tyqSDK.log("\u672a\u914d\u7f6ebanner\u5e7f\u544a\u53c2\u6570");var c=a.tyqSDK.getSwitchValue(s.tyqSDKConfig.paramsKeys.tyq_ad_custom_rect);c?r.WXCustomAd._customc_rect_adunit=c.split(";"):a.tyqSDK.log("\u672a\u914d\u7f6e\u539f\u751f\u77e9\u9635\u5e7f\u544a\u53c2\u6570");var l=a.tyqSDK.getSwitchValue(s.tyqSDKConfig.paramsKeys.tyq_ad_custom_v);l?r.WXCustomAd._customc_v_adunit=l.split(";"):a.tyqSDK.log("\u672a\u914d\u7f6e\u539f\u751f\u5782\u76f4\u5e7f\u544a\u53c2\u6570");var u=a.tyqSDK.getSwitchValue(s.tyqSDKConfig.paramsKeys.tyq_ad_custom_h);u?r.WXCustomAd._customc_h_adunit=u.split(";"):a.tyqSDK.log("\u672a\u914d\u7f6e\u539f\u751f\u6c34\u5e73\u5e7f\u544a\u53c2\u6570");var h=a.tyqSDK.getSwitchValue(s.tyqSDKConfig.paramsKeys.tyq_ad_rewarded);h?n.Wechat._rewardedVideoAdUnitId=h.split(";"):a.tyqSDK.log("\u672a\u914d\u7f6e\u6fc0\u52b1\u89c6\u9891\u5e7f\u544a\u53c2\u6570"),n.Wechat.preLoadBanner()},t.prototype.preloadAds=function(){this.channel==i.WECHAT&&(n.Wechat.preLoadBanner(),n.Wechat.createRewardedVideoAd(),n.Wechat.createInterstitialAd())},t.prototype.preloadAds2=function(){this.channel==i.WECHAT&&n.Wechat.createRewardedVideoAd()},t.prototype.wxOnHide=function(t){if(t){var e=t.mode,o=t.targetAction,i=t.targetPagePath;-1!=[8,9,10].indexOf(o)&&(this.adShowType?a.tyqSDK.adClickUpload(this.adShowType,e,o,i):9!=o?i&&("WCCanvasPageViewController"!=i&&-1==i.indexOf("ad.weixin.qq.com")&&-1==i.indexOf("ad_biz_info")&&-1==i.indexOf("weixinadkey")||a.tyqSDK.adClickUpload(s.tyqSDKConfig.adShowTypes.bannerAndCustomAd,e,o,i)):a.tyqSDK.adClickUpload(s.tyqSDKConfig.adShowTypes.bannerAndCustomAd,e,o,i))}},t.prototype.wxOnShow=function(t){console.log("wx onShow:",t),this.shareTime>0&&(new Date).getTime()-this.shareTime>=3e3?this.shareListenerSuccess&&this.shareListenerSuccess():this.shareListenerFail&&this.shareListenerFail(),this.shareListenerFail=null,this.shareListenerSuccess=null,this.shareTime=0},t.prototype.showBannerAd=function(t){this.channel==i.WECHAT&&(t||(t=5e3),n.Wechat.showBannerTurns(t),this.bannerAdShowing=!0)},t.prototype.hideBannerAd=function(){this.channel==i.WECHAT&&(n.Wechat.hideBannerAd(),this.bannerAdShowing=!1)},t.prototype.isBannerAdShowing=function(){return this.bannerAdShowing},t.prototype.showInterstitialAd=function(){var t=this;this.channel==i.WECHAT&&n.Wechat.showInterstitialAd(function(){t.adShowType=""},function(){t.adShowType=s.tyqSDKConfig.adShowTypes.interstitialAd})},t.prototype.showCustomRectCenterAd=function(t){this.channel==i.WECHAT&&r.WXCustomAd.createCustomAd("default_custom_ad_rect",r.EType.rect,{centerX:0,centerY:0},this.customAdSizeObj.rect,null,t)},t.prototype.hideCustomRectCenterAd=function(){this.channel==i.WECHAT&&r.WXCustomAd.hideCustomAd("default_custom_ad_rect")},t.prototype.showCustomVerticalLeftRightAd=function(){this.channel==i.WECHAT&&(r.WXCustomAd.createCustomAd("default_custom_ad_v_left",r.EType.vertical,{left:0},this.customAdSizeObj.vertical),r.WXCustomAd.createCustomAd("default_custom_ad_v_right",r.EType.vertical,{right:0},this.customAdSizeObj.vertical))},t.prototype.hideCustomVerticalLeftRightAd=function(){this.channel==i.WECHAT&&(r.WXCustomAd.hideCustomAd("default_custom_ad_v_left"),r.WXCustomAd.hideCustomAd("default_custom_ad_v_right"))},t.prototype.showCustomHorizontalTopAd=function(){this.channel==i.WECHAT&&r.WXCustomAd.createCustomAd("default_custom_ad_h",r.EType.horizontal,{top:0},this.customAdSizeObj.horizontal)},t.prototype.hideCustomHorizontalTopAd=function(){this.channel==i.WECHAT&&r.WXCustomAd.hideCustomAd("default_custom_ad_h")},t.prototype.showCustomAd=function(t,e,o,n,a,s){this.channel==i.WECHAT&&r.WXCustomAd.createCustomAd(t,e,o,n,a,s)},t.prototype.hideCustomAd=function(t){this.channel==i.WECHAT&&r.WXCustomAd.hideCustomAd(t)},t.prototype.hideCustomAllAd=function(){this.channel==i.WECHAT&&r.WXCustomAd.hideAllAd()},t.prototype.showFullRewardedAd=function(){if(this.channel==i.ANDROID_233)return console.log(" NATIVE android \u5e73\u53f0 "),void jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","ShowFullRewardVideoShow","(Ljava/lang/String;)Z","\u5c55\u793a\u5168\u5c4f\u89c6\u9891\u5e7f\u544a")},t.prototype.reportShareBehavior=function(t,e,o){void 0===e&&(e=1),void 0===o&&(o=null),this.isOpenBeHavior&&(""!=this.shareopenID&&(n.Wechat.reportShareBehavior({operation:6,strategy:1,inviteUser:this.shareopenID}),this.shareopenID=""),n.Wechat.reportShareBehavior({operation:t,strategy:e,currentShow:o}))},t.prototype.showRewardedAd=function(t,e,r){var a=this;if(void 0===r&&(r=!1),this.strategy=1,this.isOpenBeHavior&&this.channel==i.WECHAT)if(n.Wechat.isShareBehavior()){if(!r)return o.tyqAdManager.showAppMessage(),this.shareListenerSuccess=t,this.shareListenerFail=e,void n.Wechat.reportShareBehavior({operation:2,strategy:1,currentShow:1});this.strategy=0,n.Wechat.reportShareBehavior({operation:2,strategy:0,currentShow:0})}else n.Wechat.reportShareBehavior({operation:2,strategy:1,currentShow:0});if(this.channel==i.ANDROID_233)return this.videoCallBack=t,this.videoCallBackFail=e,console.log(" NATIVE android \u5e73\u53f0 "),void(jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","RewardVideoShow","(Ljava/lang/String;)Z","\u5c55\u793a\u5e7f\u544a")||e&&e());n.Wechat.showRewardVideoAd(function(){a.adShowType=s.tyqSDKConfig.adShowTypes.rewardedAd}).then(function(o){a.adShowType="",o?t&&t():e&&e()},function(){o.tyqAdManager.showAppMessage(),a.shareListenerSuccess=t,a.shareListenerFail=e})},t}();o.tyqAdManager=l.instance,cc._RF.pop()},{"./platform/wechat/WXCustomAd":"WXCustomAd","./platform/wechat/wechat":"wechat","./tyqSDK":"tyqSDK","./tyqSDKConfig":"tyqSDKConfig","./utils/weHttp":"weHttp"}],tyqConstants:[function(t,e,o){"use strict";cc._RF.push(e,"23f92qFRc5AfpxZI+NwGKvi","tyqConstants"),Object.defineProperty(o,"__esModule",{value:!0}),o.tyqConstants=void 0,o.tyqConstants={paths:{layer:"layer/"},bundles:{tyqSDKBundle:"tyqSDKBundle"},layers:{TyqMoreGameLayer:"TyqMoreGameLayer"}},cc._RF.pop()},{}],tyqLayerManager:[function(t,e,o){"use strict";cc._RF.push(e,"ebafbgZhLpLF4vGDQqNHnuQ","tyqLayerManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.tyqLayerManager=void 0;var i=t("../../tyqSDK"),n=t("../tyqConstants"),r=t("./tyqResManager"),a=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!1,configurable:!0}),t.prototype.openLayer=function(t,e,o){var a=n.tyqConstants.paths.layer+t;r.tyqResManager.loadAsset(n.tyqConstants.bundles.tyqSDKBundle,a,cc.Prefab,null,function(n,r){if(n)i.tyqSDK.log("LayerManager.openLayer error:"+n.message,t,n);else{var a=cc.instantiate(r),s=a.addComponent(t);s.obj=e,s.cb=o,s.layerName=t,a.zIndex=999,a.parent=cc.find("Canvas"),i.tyqSDK.log("openLayer "+t,e)}})},t.prototype.closeLayer=function(t){t.layerName,t.node.destroy()},t}();o.tyqLayerManager=a.instance,cc._RF.pop()},{"../../tyqSDK":"tyqSDK","../tyqConstants":"tyqConstants","./tyqResManager":"tyqResManager"}],tyqResManager:[function(t,e,o){"use strict";cc._RF.push(e,"5728ethBaVNMYTEjGyrKX5e","tyqResManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.tyqResManager=void 0;var i=t("../../tyqSDK"),n=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!1,configurable:!0}),t.prototype.loadAsset=function(t,e,o,n,r){var a=cc.assetManager.getBundle(t);if(a&&a.get(e,o))r&&r(null,a.get(e,o));else{var s=function(){a.load(e,o,function(t,e){n&&n(t,e)},function(o,n){if(o)return i.tyqSDK.log("ResManager.loadAsset error:"+o.message,t,e,o),void(r&&r(o));r&&r(null,n)})};a?s():cc.assetManager.loadBundle(t,function(t,e){t?r&&r(t):(a=e,s())})}},t}();o.tyqResManager=n.instance,cc._RF.pop()},{"../../tyqSDK":"tyqSDK"}],tyqSDKConfig:[function(t,e,o){"use strict";cc._RF.push(e,"f178bvR9/NGlpcPMk18dzqn","tyqSDKConfig"),Object.defineProperty(o,"__esModule",{value:!0}),o.tyqSDKConfig=void 0,o.tyqSDKConfig={gameName:"Sangoku Hero",gameVersion:"1.0.0",appVersion:1,appId:"",apiKey:"",AppSecret:"1",server:"https://api.game.xmtyq.com/china_app_game_sdk/",paramsKeys:{tyq_ad_banners:"tyq_ad_banners",tyq_ad_interstitial:"tyq_ad_interstitial",tyq_ad_custom_rect:"tyq_ad_custom_rect",tyq_ad_custom_v:"tyq_ad_custom_v",tyq_ad_custom_h:"tyq_ad_custom_h",tyq_ad_rewarded:"tyq_ad_rewarded",tyq_banner_turns:"tyq_banner_turns",tyq_custom_h_switch:"tyq_custom_h_switch",tyq_custom_v_switch:"tyq_custom_v_switch",tyq_show_main_layer:"tyq_show_main_layer",tyq_level_count:"tyq_level_count",tyq_reward_level:"tyq_reward_level",tyq_banner_touch:"tyq_banner_touch",tyq_more_game_level:"tyq_more_game_level"},adShowTypes:{rewardedAd:"\u6fc0\u52b1\u89c6\u9891\u5e7f\u544a\u70b9\u51fb",interstitialAd:"\u63d2\u5c4f\u5e7f\u544a\u70b9\u51fb",bannerAndCustomAd:"banner\u4e0e\u539f\u751f\u5e7f\u544a\u70b9\u51fb"},eventNames:{enterLoadingLayer:"\u8fdb\u5165\u52a0\u8f7d\u9875",enterHomeLayer:"\u8fdb\u5165\u4e3b\u754c\u9762",rewardedAdStart:"\u89c2\u770b\u6fc0\u52b1\u89c6\u9891-",rewardedAdSuccess:"\u89c2\u770b\u5b8c\u6fc0\u52b1\u89c6\u9891-"}},cc._RF.pop()},{}],tyqSDK:[function(t,e,o){"use strict";cc._RF.push(e,"d8578LNF/JJjJLviW8sUzou","tyqSDK");var i=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0}),o.tyqSDK=o.TyqSDKAppVersion=void 0;var n=t("./cocos/manager/tyqLayerManager"),r=t("./cocos/tyqConstants"),a=t("./platform/wechat/WXCustomAd"),s=t("./tyqAdManager"),c=t("./tyqSDKConfig");(function(t){t[t.VERSION_1=1]="VERSION_1",t[t.VERSION_2=2]="VERSION_2"})(o.TyqSDKAppVersion||(o.TyqSDKAppVersion={}));var l=function(){function t(){this.switch_info={},this.master_switch=0,this.openid="MyOpenID",this._playTime=0,this.isLogOpen=!0,this._gameLevel=0,this.item_openId="tyq_item_openid",this.item_watermark="tyq_item_watermark_",this._watermark="",this._onlineTime=0,this.weixin_ads_data=null,this.wxGameIconData=[],this.levelCount=0,this.timeDiff=0}return t.prototype.init=function(){this.switch_info={tyq_gameType:2,tyq_openHero:1},this.master_switch=1},t.prototype.login=function(){},t.prototype.setAppVersion=function(t){c.tyqSDKConfig.appVersion=t},t.prototype.getSwitchValue=function(t,e){return 0==this.master_switch?0:this.switch_info[t]?"0"==this.switch_info[t]?0:this.switch_info[t]:(this.log(t+"\u5f00\u5173\u4e0d\u5b58\u5728"),e||0)},t.prototype.getConfigProbability=function(t){var e=this.getSwitchValue(t);return!!e&&Math.random()<e},t.prototype.collectPlayeTime=function(){},t.prototype.httpPost=function(){},t.prototype.wxIconData=function(){return this.wxGameIconData},t.prototype.wxJumpData=function(){return this.weixin_ads_data},t.prototype.collectClickEventGame=function(){},t.prototype.randomStr=function(t){void 0===t&&(t=32);for(var e=t,o="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",i=o.length,n="",r=0;r<e;r++)n+=o.charAt(Math.floor(Math.random()*i));return n},t.prototype.getTimeStamp=function(t){void 0===t&&(t=!1);var e=Date.now();return t&&(e=Math.floor(e/1e3)),e},t.prototype.initOpenId=function(){var t=cc.sys.localStorage.getItem(this.item_openId);return t||(t=this.randOpenId(),cc.sys.localStorage.setItem(this.item_openId,t),this.log("\u6ce8\u518c\uff1a"+t)),this.log("openid=",t),t},t.prototype.randOpenId=function(){for(var t=[],e=0;e<40;e++)t[e]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]="0123456789abcdef".substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]=t[28]="-",t.join("")},t.prototype.eventLevelStart=function(t){this._gameLevel=t,this.collectLevelInfo(1)},t.prototype.eventLevelEnd=function(t,e){this._gameLevel=t,this.collectLevelInfo(e?2:3)},t.prototype.eventSendCustomEvent=function(){},t.prototype.adClickUpload=function(){},t.prototype.collectLevelInfo=function(){},t.prototype.setLogOpen=function(t){this.isLogOpen=t},t.prototype.log=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];this.isLogOpen&&("string"==typeof t?console.log.apply(console,i(["[TyqSDK]"+t],e)):console.log.apply(console,i(["[TyqSDK]",t],e)))},t.prototype.error=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];this.isLogOpen&&console.error.apply(console,i(["[TyqSDK]"+t],e))},t.prototype.showBannerAd=function(t){var e=this.getSwitchValue(c.tyqSDKConfig.paramsKeys.tyq_banner_turns);e?s.tyqAdManager.showBannerAd(parseInt(e)):t&&s.tyqAdManager.showBannerAd()},t.prototype.hideBannerAd=function(){s.tyqAdManager.hideBannerAd()},t.prototype.isBannerAdShowing=function(){return s.tyqAdManager.isBannerAdShowing()},t.prototype.showInterstitialAd=function(){s.tyqAdManager.showInterstitialAd()},t.prototype.showCustomRectCenterAd=function(t){s.tyqAdManager.showCustomRectCenterAd(t)},t.prototype.hideCustomRectCenterAd=function(){s.tyqAdManager.hideCustomRectCenterAd()},t.prototype.showCustomVerticalLeftRightAd=function(t){(t||this.getSwitchValue(c.tyqSDKConfig.paramsKeys.tyq_custom_v_switch))&&s.tyqAdManager.showCustomVerticalLeftRightAd()},t.prototype.hideCustomVerticalLeftRightAd=function(){s.tyqAdManager.hideCustomVerticalLeftRightAd()},t.prototype.showCustomHorizontalTopAd=function(t){(t||this.getSwitchValue(c.tyqSDKConfig.paramsKeys.tyq_custom_h_switch))&&s.tyqAdManager.showCustomHorizontalTopAd()},t.prototype.hideCustomHorizontalTopAd=function(){s.tyqAdManager.hideCustomHorizontalTopAd()},t.prototype.showCustomAd=function(t,e,o,i,n,r){if(!i)switch(e){case a.EType.rect:i=s.tyqAdManager.customAdSizeObj.rect;break;case a.EType.horizontal:i=s.tyqAdManager.customAdSizeObj.horizontal;break;case a.EType.vertical:i=s.tyqAdManager.customAdSizeObj.vertical;break;default:i=s.tyqAdManager.customAdSizeObj.gird}s.tyqAdManager.showCustomAd(t,e,o,i,n,r)},t.prototype.hideCustomAd=function(t){s.tyqAdManager.hideCustomAd(t)},t.prototype.hideCustomAllAd=function(){s.tyqAdManager.hideCustomAllAd()},t.prototype.setCustomRectAdSize=function(t,e){s.tyqAdManager.customAdSizeObj.rect.width=t,s.tyqAdManager.customAdSizeObj.rect.height=e},t.prototype.setCustomHorizontalAdSize=function(t,e){s.tyqAdManager.customAdSizeObj.horizontal.width=t,s.tyqAdManager.customAdSizeObj.horizontal.height=e},t.prototype.setCustomVerticalAdSize=function(t,e){s.tyqAdManager.customAdSizeObj.vertical.width=t,s.tyqAdManager.customAdSizeObj.vertical.height=e},t.prototype.setCustomGridAdSize=function(t,e){s.tyqAdManager.customAdSizeObj.grid.width=t,s.tyqAdManager.customAdSizeObj.grid.height=e},t.prototype.showRewardedAd=function(t,e){var o=this;t&&this.eventSendCustomEvent(c.tyqSDKConfig.eventNames.rewardedAdStart+t),s.tyqAdManager.showRewardedAd(function(){t&&o.eventSendCustomEvent(c.tyqSDKConfig.eventNames.rewardedAdSuccess+t),e&&e(1)},function(){e&&e(0)})},t.prototype.onShowLoadingLayer=function(){this.eventSendCustomEvent(c.tyqSDKConfig.eventNames.enterLoadingLayer)},t.prototype.onShowHomeLayer=function(){this.eventSendCustomEvent(c.tyqSDKConfig.eventNames.enterHomeLayer);var t=this.getSwitchValue(c.tyqSDKConfig.paramsKeys.tyq_show_main_layer);t&&(1==(t=parseInt(t))?this.showInterstitialAd():2==t&&this.showCustomRectCenterAd(null))},t.prototype.addLevelCount=function(t){var e=this.getSwitchValue(c.tyqSDKConfig.paramsKeys.tyq_reward_level);if(e&&!(t<=(e=parseInt(e)))){this.levelCount++;var i=o.tyqSDK.getSwitchValue(c.tyqSDKConfig.paramsKeys.tyq_level_count);i&&(i=parseInt(i),this.levelCount>=i&&(this.levelCount=0,this.showRewardedAd()))}},t.prototype.onShowSettlementLayer=function(){this.showInterstitialAd()},t.prototype.showMoreGameLayer=function(t,e){var o=this.getSwitchValue(c.tyqSDKConfig.paramsKeys.tyq_more_game_level);if(o)if(t<=(o=parseInt(o)))e();else{var i={};i.level=t,n.tyqLayerManager.openLayer(r.tyqConstants.layers.TyqMoreGameLayer,i,function(){e()})}else e()},t.instance=new t,t}();o.tyqSDK=l.instance,cc._RF.pop()},{"./cocos/manager/tyqLayerManager":"tyqLayerManager","./cocos/tyqConstants":"tyqConstants","./platform/wechat/WXCustomAd":"WXCustomAd","./tyqAdManager":"tyqAdManager","./tyqSDKConfig":"tyqSDKConfig"}],uiManager:[function(t,e,o){"use strict";cc._RF.push(e,"0c292iyhYRFEbEPf8Ez04h6","uiManager");var i=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a},n=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(n,r){function a(t){try{c(i.next(t))}catch(e){r(e)}}function s(t){try{c(i.throw(t))}catch(e){r(e)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(a,s)}c((i=i.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){var o,i,n,r,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return c([t,e])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){a.label=r[1];break}if(6===r[0]&&a.label<n[1]){a.label=n[1],n=r;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(r);break}n[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(s){r=[6,s],i=0}finally{o=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.uiManager=void 0;var a=t("./resourceUtil"),s=cc._decorator,c=s.ccclass,l=(s.property,function(){function t(){this.dictSharedPanel={},this.dictLoading={},this.arrPopupDialog=[],this.showTipsTime=0,this.panelPath=""}var e;return e=t,Object.defineProperty(t,"instance",{get:function(){return this._instance?this._instance:(this._instance=new e,this._instance)},enumerable:!1,configurable:!0}),t.prototype.show=function(){},t.prototype.hide=function(){},t.prototype.close=function(){},t.prototype.getDialog=function(t){return this.dictSharedPanel[t]},t.prototype.loadDialog=function(t){return n(this,void 0,void 0,function(){var e=this;return r(this,function(){return[2,new Promise(function(o){var i=t.split("|")[1],n=i.lastIndexOf("/"),r=i.slice(n+1);a.resourceUtil.createUIWithBundle(t,function(i,n){if(e.dictLoading[t]=!1,i)console.error(i);else{e.dictSharedPanel[t]=n;var a=n.getComponent(r);n.setSiblingIndex(a.zIndex),a.dialogPath=t,n.active=!1,o()}})})]})})},t.prototype.showDialog=function(t,e,o,i,n){var r=this;if(this.panelPath=t,!this.dictLoading[t]){null==n&&(n=!0);var s=t.split("|")[1],c=s.lastIndexOf("/"),l=s.slice(c+1);if(e||(e=[]),this.dictSharedPanel.hasOwnProperty(t)){var u=this.dictSharedPanel[t];if(cc.isValid(u)){u.parent=null==i?cc.find("Canvas"):i;var h=u.getComponent(l);return h.show(e),u.setSiblingIndex(h.zIndex),h.dialogPath=t,u.active=!0,void(o&&o(h))}}this.dictLoading[t]=!0,a.resourceUtil.createUIWithBundle(t,function(i,a){var s=!1;if(r.dictLoading[t]||(s=!0),r.dictLoading[t]=!1,i)console.error(i);else{r.dictSharedPanel[t]=a;var c=a.getComponent(l);c.show&&c.show(e),a.setSiblingIndex(c.zIndex),c.dialogPath=t,a.active=n,o&&o(c),s&&r.hideDialog(t)}},i)}},t.prototype.hideDialog=function(t,e){if(this.dictSharedPanel.hasOwnProperty(t)){var o=this.dictSharedPanel[t];if(o&&cc.isValid(o)){var i=t.split("|")[1],n=i.lastIndexOf("/"),r=i.slice(n+1),a=o.getComponent(r);a.hide&&a.hide(),o.active=!1,o.parent=null,e&&"function"==typeof e&&e()}else e&&"function"==typeof e&&e()}this.dictLoading[t]=!1},t.prototype.destroyDialog=function(t){if(this.dictSharedPanel.hasOwnProperty(t)){var e=this.dictSharedPanel[t];delete this.dictSharedPanel[t],e.destroy()}},t.prototype.pushToPopupSeq=function(t,e,o){var i={panelPath:t,scriptName:e,param:o,isShow:!1};this.arrPopupDialog.push(i),this.checkPopupSeq()},t.prototype.insertToPopupSeq=function(t,e,o){var i={panelPath:e,param:o,isShow:!1};this.arrPopupDialog.splice(t,0,i)},t.prototype.shiftFromPopupSeq=function(t){var e=this;this.hideDialog(t,function(){e.arrPopupDialog[0]&&e.arrPopupDialog[0].panelPath===t&&(e.arrPopupDialog.shift(),e.checkPopupSeq())})},t.prototype.checkPopupSeq=function(){if(this.arrPopupDialog.length>0){var t=this.arrPopupDialog[0];t.isShow||(this.showDialog(t.panelPath,t.param),this.arrPopupDialog[0].isShow=!0)}},e=i([c("uiManager")],t)}());o.uiManager=l,cc._RF.pop()},{"./resourceUtil":"resourceUtil"}],utilTools:[function(t,e,o){"use strict";cc._RF.push(e,"b89676Mxu5K2pyA+Ct5gTyj","utilTools"),Object.defineProperty(o,"__esModule",{value:!0}),o.utilTools=void 0,o.utilTools={randomArr:function(t){t=JSON.parse(JSON.stringify(t));for(var e=[];t.length>0;){var o=Math.floor(Math.random()*t.length);e.push(t[o]),t.splice(o,1)}return e},getFloatValue:function(t,e){var o=e-t;return o<0?0:t+Math.random()*o},overDay:function(t,e){if(!t)return!0;e||(e=new Date);var o=!1;return t.getDate()==e.getDate()?e-t>=864e5&&(o=!0):o=!0,o},getRowsByWeightAndNum:function(t,e,i){e||(e=1);var n=[];t=o.utilTools.copyObj(t);for(var r=0;r<e&&!(t.length<=0);r++){var a=this.getRowByWeight(t);if(n.push(a),!i){var s=t.indexOf(a);t.splice(s,1)}}return n},getRowByWeight:function(t,e){if(!e)for(var o in e=0,t)(a=t[o].weight)||(a=0),e+=a;var i=Math.random()*e,n=0,r=null;for(var o in t){var a,s=t[o];if((a=s.weight)||(a=0),i>=n&&i<n+a){r=s;break}n+=a}return r},getRandomItemByArr:function(t){return!t||t.length<=0?null:t[Math.floor(Math.random()*t.length)]},copyObj:function(t){return JSON.parse(JSON.stringify(t))}},cc._RF.pop()},{}],weHttp:[function(t,e,o){"use strict";cc._RF.push(e,"67a54/nHy5Hy4I3dKgzSWtB","weHttp"),Object.defineProperty(o,"__esModule",{value:!0}),o.Http=void 0;var i=t("./weNetworkMgr"),n=function(){function t(){this._timeOut=1e4,this._httpUrl="",this._apiKey=""}return Object.defineProperty(t.prototype,"timeOut",{set:function(t){this._timeOut=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"httpUrl",{set:function(t){this._httpUrl=t},enumerable:!1,configurable:!0}),t.prototype.init=function(t,e){this._httpUrl=t,this._apiKey=e},t.prototype.post=function(t,e,o){var n="";e&&(n=this.createSign(e));var r=new XMLHttpRequest;r.timeout=this._timeOut,r.open("POST",this._httpUrl+t,!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r.send(n),r.onreadystatechange=function(){if(4===r.readyState&&r.status>=200&&r.status<300){var e=r.responseText;if(!e)return void i.NetworkMgr.onHttpError(o,null,"http request respone is null");i.NetworkMgr.checkRespone(t,e,o)}}.bind(this),r.ontimeout=function(t){console.error("http request timeout: ",t),i.NetworkMgr.onHttpError(o,null,"http request timeout: ")}.bind(this),r.onerror=function(t){i.NetworkMgr.onHttpError(o,t,"http request error: ")}.bind(this)},t.prototype.post2=function(t,e,o){var n=this.MsgToString(e),r=new XMLHttpRequest;r.timeout=this._timeOut,r.open("GET",this._httpUrl+t+"?"+n,!0),r.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),r.send(JSON.stringify(e)),r.onreadystatechange=function(){if(4===r.readyState&&r.status>=200&&r.status<300){var e=r.responseText;if(!e)return void i.NetworkMgr.onHttpError(o,null,"http request respone is null");i.NetworkMgr.checkRespone(t,e,o)}}.bind(this),r.ontimeout=function(t){console.error("http request timeout: ",t)}.bind(this),r.onerror=function(t){i.NetworkMgr.onHttpError(o,t,"http request error: ")}.bind(this)},t.prototype.httpGet=function(t,e,o){var i=new XMLHttpRequest;i.timeout=this._timeOut,i.open("POST",t,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.send(),i.onreadystatechange=function(){if(4===i.readyState&&i.status>=200&&i.status<300){var t=i.responseText;if(t)return void o(JSON.parse(t))}},i.ontimeout=function(t){console.error("http request timeout: ",t)}.bind(this),i.onerror=function(t){console.error("http request error: ",t)}.bind(this)},t.prototype.MsgToString=function(t){for(var e="",o=0,i=Object.keys(t);o<i.length;o++){var n=i[o];e+=n+'="'+t[n]+'"&'}return e},t.prototype.strToDES3=function(){},t.prototype.createSign=function(t){var e=new Array,o=0;for(var i in t)e[o]=i,o++;var n=e.sort(),r="";for(var i in n)(t[n[i]]||"number"==typeof t[n[i]])&&(r+=n[i]+"="+t[n[i]]+"&&");var a=r;return a+="api_key="+this._apiKey,r+"sign="+this.MD5(decodeURIComponent(a))},t.prototype.md5encode=function(t){var e,o=function(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;for(var o=1732584193,i=-271733879,l=-1732584194,u=271733878,h=0;h<t.length;h+=16){var p=o,d=i,f=l,g=u;o=n(o,i,l,u,t[h+0],7,-680876936),u=n(u,o,i,l,t[h+1],12,-389564586),l=n(l,u,o,i,t[h+2],17,606105819),i=n(i,l,u,o,t[h+3],22,-1044525330),o=n(o,i,l,u,t[h+4],7,-176418897),u=n(u,o,i,l,t[h+5],12,1200080426),l=n(l,u,o,i,t[h+6],17,-1473231341),i=n(i,l,u,o,t[h+7],22,-45705983),o=n(o,i,l,u,t[h+8],7,1770035416),u=n(u,o,i,l,t[h+9],12,-1958414417),l=n(l,u,o,i,t[h+10],17,-42063),i=n(i,l,u,o,t[h+11],22,-1990404162),o=n(o,i,l,u,t[h+12],7,1804603682),u=n(u,o,i,l,t[h+13],12,-40341101),l=n(l,u,o,i,t[h+14],17,-1502002290),i=n(i,l,u,o,t[h+15],22,1236535329),o=r(o,i,l,u,t[h+1],5,-165796510),u=r(u,o,i,l,t[h+6],9,-1069501632),l=r(l,u,o,i,t[h+11],14,643717713),i=r(i,l,u,o,t[h+0],20,-373897302),o=r(o,i,l,u,t[h+5],5,-701558691),u=r(u,o,i,l,t[h+10],9,38016083),l=r(l,u,o,i,t[h+15],14,-660478335),i=r(i,l,u,o,t[h+4],20,-405537848),o=r(o,i,l,u,t[h+9],5,568446438),u=r(u,o,i,l,t[h+14],9,-1019803690),l=r(l,u,o,i,t[h+3],14,-187363961),i=r(i,l,u,o,t[h+8],20,1163531501),o=r(o,i,l,u,t[h+13],5,-1444681467),u=r(u,o,i,l,t[h+2],9,-51403784),l=r(l,u,o,i,t[h+7],14,1735328473),i=r(i,l,u,o,t[h+12],20,-1926607734),o=a(o,i,l,u,t[h+5],4,-378558),u=a(u,o,i,l,t[h+8],11,-2022574463),l=a(l,u,o,i,t[h+11],16,1839030562),i=a(i,l,u,o,t[h+14],23,-35309556),o=a(o,i,l,u,t[h+1],4,-1530992060),u=a(u,o,i,l,t[h+4],11,1272893353),l=a(l,u,o,i,t[h+7],16,-155497632),i=a(i,l,u,o,t[h+10],23,-1094730640),o=a(o,i,l,u,t[h+13],4,681279174),u=a(u,o,i,l,t[h+0],11,-358537222),l=a(l,u,o,i,t[h+3],16,-722521979),i=a(i,l,u,o,t[h+6],23,76029189),o=a(o,i,l,u,t[h+9],4,-640364487),u=a(u,o,i,l,t[h+12],11,-421815835),l=a(l,u,o,i,t[h+15],16,530742520),i=a(i,l,u,o,t[h+2],23,-995338651),o=s(o,i,l,u,t[h+0],6,-198630844),u=s(u,o,i,l,t[h+7],10,1126891415),l=s(l,u,o,i,t[h+14],15,-1416354905),i=s(i,l,u,o,t[h+5],21,-57434055),o=s(o,i,l,u,t[h+12],6,1700485571),u=s(u,o,i,l,t[h+3],10,-1894986606),l=s(l,u,o,i,t[h+10],15,-1051523),i=s(i,l,u,o,t[h+1],21,-2054922799),o=s(o,i,l,u,t[h+8],6,1873313359),u=s(u,o,i,l,t[h+15],10,-30611744),l=s(l,u,o,i,t[h+6],15,-1560198380),i=s(i,l,u,o,t[h+13],21,1309151649),o=s(o,i,l,u,t[h+4],6,-145523070),u=s(u,o,i,l,t[h+11],10,-1120210379),l=s(l,u,o,i,t[h+2],15,718787259),i=s(i,l,u,o,t[h+9],21,-343485551),o=c(o,p),i=c(i,d),l=c(l,f),u=c(u,g)}return Array(o,i,l,u)},i=function(t,e,o,i,n,r){return c(l(c(c(e,t),c(i,r)),n),o)},n=function(t,e,o,n,r,a,s){return i(e&o|~e&n,t,e,r,a,s)},r=function(t,e,o,n,r,a,s){return i(e&n|o&~n,t,e,r,a,s)},a=function(t,e,o,n,r,a,s){return i(e^o^n,t,e,r,a,s)},s=function(t,e,o,n,r,a,s){return i(o^(e|~n),t,e,r,a,s)},c=function(t,e){var o=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(o>>16)<<16|65535&o},l=function(t,e){return t<<e|t>>>32-e};return function(t){for(var e="",o=0;o<4*t.length;o++)e+="0123456789abcdef".charAt(t[o>>2]>>o%4*8+4&15)+"0123456789abcdef".charAt(t[o>>2]>>o%4*8&15);return e}(o(function(t){for(var e=Array(),o=0;o<8*t.length;o+=8)e[o>>5]|=(255&t.charCodeAt(o/8))<<o%32;return e}(e=t),8*e.length))},t.prototype.MD5=function(t){var e=0;function o(t){return a(s(r(t),8*t.length))}function i(t){for(var o,i=e?"0123456789ABCDEF":"0123456789abcdef",n="",r=0;r<t.length;r++)o=t.charCodeAt(r),n+=i.charAt(o>>>4&15)+i.charAt(15&o);return n}function n(t){for(var e,o,i="",n=-1;++n<t.length;)e=t.charCodeAt(n),o=n+1<t.length?t.charCodeAt(n+1):0,55296<=e&&e<=56319&&56320<=o&&o<=57343&&(e=65536+((1023&e)<<10)+(1023&o),n++),e<=127?i+=String.fromCharCode(e):e<=2047?i+=String.fromCharCode(192|e>>>6&31,128|63&e):e<=65535?i+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|63&e):e<=2097151&&(i+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|63&e));return i}function r(t){for(var e=Array(t.length>>2),o=0;o<e.length;o++)e[o]=0;for(o=0;o<8*t.length;o+=8)e[o>>5]|=(255&t.charCodeAt(o/8))<<o%32;return e}function a(t){for(var e="",o=0;o<32*t.length;o+=8)e+=String.fromCharCode(t[o>>5]>>>o%32&255);return e}function s(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;for(var o=1732584193,i=-271733879,n=-1732584194,r=271733878,a=0;a<t.length;a+=16){var s=o,c=i,f=n,g=r;o=l(o,i,n,r,t[a+0],7,-680876936),r=l(r,o,i,n,t[a+1],12,-389564586),n=l(n,r,o,i,t[a+2],17,606105819),i=l(i,n,r,o,t[a+3],22,-1044525330),o=l(o,i,n,r,t[a+4],7,-176418897),r=l(r,o,i,n,t[a+5],12,1200080426),n=l(n,r,o,i,t[a+6],17,-1473231341),i=l(i,n,r,o,t[a+7],22,-45705983),o=l(o,i,n,r,t[a+8],7,1770035416),r=l(r,o,i,n,t[a+9],12,-1958414417),n=l(n,r,o,i,t[a+10],17,-42063),i=l(i,n,r,o,t[a+11],22,-1990404162),o=l(o,i,n,r,t[a+12],7,1804603682),r=l(r,o,i,n,t[a+13],12,-40341101),n=l(n,r,o,i,t[a+14],17,-1502002290),o=u(o,i=l(i,n,r,o,t[a+15],22,1236535329),n,r,t[a+1],5,-165796510),r=u(r,o,i,n,t[a+6],9,-1069501632),n=u(n,r,o,i,t[a+11],14,643717713),i=u(i,n,r,o,t[a+0],20,-373897302),o=u(o,i,n,r,t[a+5],5,-701558691),r=u(r,o,i,n,t[a+10],9,38016083),n=u(n,r,o,i,t[a+15],14,-660478335),i=u(i,n,r,o,t[a+4],20,-405537848),o=u(o,i,n,r,t[a+9],5,568446438),r=u(r,o,i,n,t[a+14],9,-1019803690),n=u(n,r,o,i,t[a+3],14,-187363961),i=u(i,n,r,o,t[a+8],20,1163531501),o=u(o,i,n,r,t[a+13],5,-1444681467),r=u(r,o,i,n,t[a+2],9,-51403784),n=u(n,r,o,i,t[a+7],14,1735328473),o=h(o,i=u(i,n,r,o,t[a+12],20,-1926607734),n,r,t[a+5],4,-378558),r=h(r,o,i,n,t[a+8],11,-2022574463),n=h(n,r,o,i,t[a+11],16,1839030562),i=h(i,n,r,o,t[a+14],23,-35309556),o=h(o,i,n,r,t[a+1],4,-1530992060),r=h(r,o,i,n,t[a+4],11,1272893353),n=h(n,r,o,i,t[a+7],16,-155497632),i=h(i,n,r,o,t[a+10],23,-1094730640),o=h(o,i,n,r,t[a+13],4,681279174),r=h(r,o,i,n,t[a+0],11,-358537222),n=h(n,r,o,i,t[a+3],16,-722521979),i=h(i,n,r,o,t[a+6],23,76029189),o=h(o,i,n,r,t[a+9],4,-640364487),r=h(r,o,i,n,t[a+12],11,-421815835),n=h(n,r,o,i,t[a+15],16,530742520),o=p(o,i=h(i,n,r,o,t[a+2],23,-995338651),n,r,t[a+0],6,-198630844),r=p(r,o,i,n,t[a+7],10,1126891415),n=p(n,r,o,i,t[a+14],15,-1416354905),i=p(i,n,r,o,t[a+5],21,-57434055),o=p(o,i,n,r,t[a+12],6,1700485571),r=p(r,o,i,n,t[a+3],10,-1894986606),n=p(n,r,o,i,t[a+10],15,-1051523),i=p(i,n,r,o,t[a+1],21,-2054922799),o=p(o,i,n,r,t[a+8],6,1873313359),r=p(r,o,i,n,t[a+15],10,-30611744),n=p(n,r,o,i,t[a+6],15,-1560198380),i=p(i,n,r,o,t[a+13],21,1309151649),o=p(o,i,n,r,t[a+4],6,-145523070),r=p(r,o,i,n,t[a+11],10,-1120210379),n=p(n,r,o,i,t[a+2],15,718787259),i=p(i,n,r,o,t[a+9],21,-343485551),o=d(o,s),i=d(i,c),n=d(n,f),r=d(r,g)}return Array(o,i,n,r)}function c(t,e,o,i,n,r){return d((a=d(d(e,t),d(i,r)))<<(s=n)|a>>>32-s,o);var a,s}function l(t,e,o,i,n,r,a){return c(e&o|~e&i,t,e,n,r,a)}function u(t,e,o,i,n,r,a){return c(e&i|o&~i,t,e,n,r,a)}function h(t,e,o,i,n,r,a){return c(e^o^i,t,e,n,r,a)}function p(t,e,o,i,n,r,a){return c(o^(e|~i),t,e,n,r,a)}function d(t,e){var o=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(o>>16)<<16|65535&o}return i(o(n(t)))},t.prototype.get=function(t,e,o,i){var n=new XMLHttpRequest;n.timeout=5e3;var r="?";for(var a in e)"?"!=r&&(r+="&"),r+=a+"="+e[a];null==i&&(i=GHttpClient.url);var s=i+t+r;return n.open("GET",s,!0),n.onreadystatechange=function(){if(4===n.readyState&&n.status>=200&&n.status<300)try{var t=JSON.parse(n.responseText);null!==o&&o(null,t)}catch(e){null!==o&&o(e)}},n.send(),n},t._instance=new t,t}();o.Http=n._instance,cc._RF.pop()},{"./weNetworkMgr":"weNetworkMgr"}],weNetworkMgr:[function(t,e,o){"use strict";cc._RF.push(e,"10c29WpmqJM1az59zH+OxcI","weNetworkMgr"),Object.defineProperty(o,"__esModule",{value:!0}),o.NetworkMgr=void 0;var i=t("./weHttp"),n=function(){function t(){this.mid=0,this.messageList={},this.limitMessageNum=5,this.timer=null,this.token="",this.isLock=!1,this._dealHeadListener=null,this._encryptRule=["mid:","uid:","key:","data:"],this._encryptCode="zqkg",this._intervalTime=3e3,this._errorServerCode=500,this._successCode=0,this._errorRestartGameCode=[102],this._errorNetCode={},this._overTime=5e3,this._uid=0,this.lastMessage=null,this.mid=0,this.messageList={},this.timer=null}return Object.defineProperty(t.prototype,"errorNetCode",{set:function(t){this._errorNetCode=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"encryptCode",{set:function(t){this._encryptCode=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"errorRestartGameCode",{set:function(t){this._errorRestartGameCode=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"successCode",{set:function(t){this._successCode=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"errorServerCode",{set:function(t){this._errorServerCode=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"encryptRule",{set:function(t){this._encryptRule=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intervalTime",{set:function(t){this._intervalTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"overTime",{set:function(t){this._overTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dealHeadListener",{set:function(t){this._dealHeadListener=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uid",{set:function(t){this._uid=t},enumerable:!1,configurable:!0}),t.prototype.xhrPost=function(t,e,o,i,n){void 0===n&&(n=!1),this.mid+=1;var a={head:{route:t,mid:this.mid.toString(),uid:this._uid},body:e},s=new r;s.route=t,s.mid=this.mid,s.data=a,o&&(s.callback=o),s.isRepeat=n,i&&(s.failCallBack=i),this.messageList[this.mid]=s,this.startTimer(),this.isLock||this.sendMessage(this.mid)},t.prototype.checkRespone=function(t,e,o){var i=this.jsdecrypt(e),n=this.messageList[o];this.succeedResponeBody(n,i,o)},t.prototype.succeedResponeHead=function(t){this._dealHeadListener&&this._dealHeadListener(t)},t.prototype.succeedResponeBody=function(t,e,o){this.isLock=!1,this.clearTimer(),this.deleteMessageListItem(o,!1),this.checkNextMessage(),t&&t.callback&&t.callback(e)},t.prototype.checkErrorCode=function(t,e){t!==this._errorServerCode&&this.deleteMessageListItem(e,!0);for(var o=0;o<this._errorRestartGameCode.length;o++)t===this._errorRestartGameCode[o]&&this.restartGame();var i=this.getErrorCodeMeaning(t);console.error("----\x3e \u8fd4\u56de\u9519\u8bef, code:",t,i)},t.prototype.checkNextMessage=function(){for(var t in this.messageList){var e=this.messageList[t];0===e.sendNum&&this.sendMessage(e.mid)}},t.prototype.deleteMessageListItem=function(t,e){this.messageList&&this.messageList[t]&&(this.messageList[t].failCallBack&&e&&this.messageList[t].failCallBack(),delete this.messageList[t])},t.prototype.jsdecrypt=function(t){var e=null;if("string"==typeof t)try{e=JSON.parse(t)}catch(o){}return e},t.prototype.sendMessage=function(t,e){if(void 0===e&&(e=!0),0!==Object.keys(this.messageList).length){var o=this.messageList[t];if(e&&o.sendNum>=this.limitMessageNum||!e&&o.errorNum>=this.limitMessageNum)return console.error(o.data.head.route,"message send too much times"),void this.deleteMessageListItem(t,!1);o.sendNum+=1;var n=o.data,r=n.head.route;n.head.token=this.token,this.lastMessage=o,i.Http.post(r,n.body,t)}},t.prototype.getErrorCodeMeaning=function(t){var e=this._errorNetCode[t],o=e;return e||(o="\u670d\u52a1\u5668\u9519\u8bef\u7801\uff1a "+t),o},t.prototype.restartGame=function(){},t.prototype.startTimer=function(){this.timer||(this.timer=setInterval(this.checkPackage.bind(this),this._intervalTime))},t.prototype.checkPackage=function(){if(0!==Object.keys(this.messageList).length)for(var t in this.messageList){var e=this.messageList[t];if(Date.now()-e.time>this._overTime&&e.isRepeat){var o=e.mid;this.sendMessage(o);break}this.deleteMessageListItem(e.mid,!1)}else this.clearTimer()},t.prototype.clearTimer=function(){this.timer&&(clearInterval(this.timer),this.timer=0)},t.prototype.onHttpError=function(t,e,o){var i=this;o?console.error("----\x3e onHttpError",o,e):console.error("----\x3e onHttpError",e);var n=this.messageList[t];n&&(n.isRepeat?setTimeout(function(){n.errorNum++,i.sendMessage(t,!1)},3e3):this.deleteMessageListItem(t,!0))},t._instance=new t,t}();o.NetworkMgr=n._instance;var r=function(t){for(var e in this.route="",this.lock=!1,this.mid=0,this.data=null,this.callback=null,this.failCallBack=null,this.time=0,this.sendNum=0,this.errorNum=0,this.isRepeat=!1,this.time=Date.now(),t)this[e]=t[e]};o.default=r,cc._RF.pop()},{"./weHttp":"weHttp"}],wechat:[function(t,e,o){"use strict";cc._RF.push(e,"e764a4/SA1KPJQsxia7IWp+","wechat");var i=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,n++)i[n]=r[a];return i};Object.defineProperty(o,"__esModule",{value:!0}),o.Wechat=void 0;var n=t("../../tyqSDK"),r=function(){function t(){this.systemInfo=null,this.userInfoButton=null,this.bannerAd=null,this.rewardedVideoAd=null,this.interstitialAd=null,this.RiconAD=null,this.LiconAD=null,this.gridAd=null,this.gridAdCunt=null,this.GameRecorder=null,this.startListener=null,this.resumeListener=null,this.pauseListener=null,this.stopListener=null,this.errorListener=null,this.abortListener=null,this.timeUpdateListener=null,this.gameClub=null,this.feedbackButton=null,this.showListener=null,this.hideListener=null,this._bannerAdUnitId=[],this._bannerAdObjList=[],this._bannerShowIndex=0,this._bannerTimer=-1,this._bannerAdRefreshTimeOutId=0,this._rewardedVideoAdUnitId=[],this._curRewardVideoAdUnitId="",this._shareValue=0,this._rewardValue=1,this._interstitialAdUnitId=[],this._latticeAdUnitId="",this._RIconAdunit="",this._LIconAdunit="",this.mainBannerAD=null,this._userInfoButtonData={width:null,height:null,x:null,y:null,url:null},this._feedbackButtonData={width:null,height:null,x:null,y:null,url:null},this._bannerSize={width:600,height:172},this._gameClubSize={icon:"",x:0,y:0,width:0,height:0},this._closeRewardVideoListener=null,window.wx&&this.getSystemInfoSync()}return Object.defineProperty(t.prototype,"RIconAduni",{set:function(t){this._RIconAdunit=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"LIconAduni",{set:function(t){this._LIconAdunit=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bannerAdUnitId",{set:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rewardedVideoAdUnitId",{set:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"interstitialAdUnitId",{set:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bannerSize",{set:function(t){this._bannerSize.width=t.width,this._bannerSize.height=t.height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"latticeAdUnitId",{set:function(t){this._latticeAdUnitId=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gameClubSize",{set:function(t){this._gameClubSize.x=t.x,this._gameClubSize.y=t.y,this._gameClubSize.width=t.width,this._gameClubSize.height=t.height,this._gameClubSize.icon=t.icon},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userInfoButtonData",{set:function(t){this._userInfoButtonData.width=t.width,this._userInfoButtonData.height=t.height,this._userInfoButtonData.x=t.x,this._userInfoButtonData.y=t.y,this._userInfoButtonData.url=t.url},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"closeRewardVideoListener",{set:function(t){this._closeRewardVideoListener=t},enumerable:!1,configurable:!0}),t.prototype.preLoadAd=function(){this.createRewardedVideoAd(),this.preLoadBanner(),this.createInterstitialAd()},t.prototype.preLoadBanner=function(){for(var t=0;t<this._bannerAdUnitId.length;t++){var e=this._bannerAdUnitId[t],o=this.createBanner(e);this._bannerAdObjList.push(o)}},t.prototype.createBanner=function(t){var e=this,o={width:.65*this._bannerSize.width,height:.35*this._bannerSize.height},i=wx.createBannerAd({adUnitId:t,adIntervals:30,style:{left:this.systemInfo.windowWidth/2-o.width/2,top:this.systemInfo.windowHeight-o.height+.1*this.systemInfo.windowHeight,height:o.height,width:o.width}});return i.onLoad(function(){n.tyqSDK.log("=====> @framework, banner\u5e7f\u544a\u52a0\u8f7d\u6210\u529f"+t)}),i.onError(function(e){n.tyqSDK.log("=====> @framework, banner\u5e7f\u544a\u52a0\u8f7d\u5931\u8d25\uff1a",t,e)}),i.onResize(function(t){i.style.left=e.systemInfo.windowWidth/2-t.width/2-.1,i.style.top=e.systemInfo.windowHeight-t.height+.1}),i},t.prototype.wetchatLogin=function(t,e){var o={wccode:null,wcencrypted:null,wciv:null};this.login(function(e){o.wccode=e,t&&t(e)},function(t){o.wcencrypted=t.encryptedData,o.wciv=t.iv,e&&e(o)})},t.prototype.getSetting=function(e,o){t.isSupportedAPI(wx.getSetting)?wx.getSetting({success:function(t){e(t.authSetting["scope.userInfo"])},fail:function(t){o&&o(t)}}):(console.error("----\x3e \u5fae\u4fe1\u7248\u672c\u4e0d\u652f\u6301getSetting API"),o&&o("----\x3e \u5fae\u4fe1\u7248\u672c\u4e0d\u652f\u6301getSetting API"))},t.prototype.createUserInfoButton=function(e,o,i,r){void 0===e&&(e=0),void 0===o&&(o=0),void 0===i&&(i=cc.view.getVisibleSize().width),void 0===r&&(r=cc.view.getVisibleSize().height),t.isSupportedAPI(wx.createUserInfoButton)?this.userInfoButton=wx.createUserInfoButton({type:"image",style:{left:e,top:o,width:cc.view.getVisibleSize().width,height:cc.view.getVisibleSize().height}}):n.tyqSDK.log("=====> @framework,\u5f53\u524d\u5fae\u4fe1\u7248\u672c\u8fc7\u4f4e\uff0c\u65e0\u6cd5\u4f7f\u7528\u6388\u6743\u6309\u94ae\uff0c\u8bf7\u5347\u7ea7\u5230\u6700\u65b0\u5fae\u4fe1\u7248\u672c\u540e\u91cd\u8bd5")},t.prototype.destroyAuthorizeBtn=function(){this.userInfoButton&&(this.userInfoButton.destroy(),this.userInfoButton=null)},t.prototype.onTapUserInfoButton=function(t,e){var o=this;this.userInfoButton?this.userInfoButton.onTap(function(i){n.tyqSDK.log("onTap",i),i.userInfo?(o.destroyAuthorizeBtn(),t&&t(i)):e(i)}):e(null)},t.prototype.login=function(t,e){wx.login({success:function(e){t(e.code)},fail:function(){e()}})},t.prototype.getUserInfo=function(t,e){this.getSetting(function(){wx.getUserInfo({success:function(e){t&&t(e)},fail:function(t){e&&e(t)}})},function(t){e&&(n.tyqSDK.log(t),e("getsetting \u5931\u8d25"))})},t.prototype.shareAppMessage=function(t,e,o){wx.shareAppMessage({title:t,imageUrl:e,query:o})},t.prototype.showBannerAd=function(e,o){if(void 0===o&&(o=30),t.isSupportedAPI(wx.createBannerAd))return this.bannerAd?(this.bannerAd.show(),void(e&&e(!0))):(this.createBannerAd(o,e),void this.bannerAd.show())},t.prototype.showBannerTurns=function(e){var o=this;t.isSupportedAPI(wx.createBannerAd)&&(clearInterval(this._bannerTimer),this.showBannerNext(),this._bannerTimer=setInterval(function(){o.showBannerNext()},e))},t.prototype.showBannerNext=function(){var t=this;if(this._bannerAdObjList.length<=0)console.error("zzzzzzz\u65e0banner\u5e7f\u544a");else{this._bannerAdObjList.forEach(function(t){t.hide()}),this._bannerAdObjList[this._bannerShowIndex].hide(),this._bannerShowIndex++,this._bannerShowIndex>=this._bannerAdObjList.length&&(this._bannerShowIndex=0);var e=this._bannerAdObjList[this._bannerShowIndex];if(e)e.show().catch(function(){var o=t._bannerAdUnitId[t._bannerShowIndex];(e=t.createBanner(o))&&e.show()});else{var o=this._bannerAdUnitId[this._bannerShowIndex];(e=this.createBanner(o))&&e.show()}}},t.prototype.hideBannerAd=function(){this.bannerAd&&this.bannerAd.hide(),0!=this._bannerAdRefreshTimeOutId&&(clearTimeout(this._bannerAdRefreshTimeOutId),this._bannerAdRefreshTimeOutId=0),clearInterval(this._bannerTimer),this._bannerAdObjList.forEach(function(t){t.hide()})},t.prototype.destroyBannerAd=function(){this.bannerAd&&(this.bannerAd.destroy(),this.bannerAd=null),0!=this._bannerAdRefreshTimeOutId&&(clearTimeout(this._bannerAdRefreshTimeOutId),this._bannerAdRefreshTimeOutId=0)},t.prototype.createBannerAd=function(t,e,o){var i=this;void 0===o&&(o=!0),n.tyqSDK.log("banner width= ",this._bannerSize.width,this._bannerAdUnitId);var r={width:.65*this._bannerSize.width,height:.35*this._bannerSize.height},a=this._bannerAdUnitId[Math.floor(Math.random()*this._bannerAdUnitId.length)];this.bannerAd=wx.createBannerAd({adUnitId:a,adIntervals:30,style:{left:this.systemInfo.windowWidth/2-r.width/2,top:this.systemInfo.windowHeight-r.height+.1*this.systemInfo.windowHeight,height:r.height,width:r.width}}),n.tyqSDK.log("bannerSize: ",r,", systemInfo: ",this.systemInfo,",this.bannerAd.style: ",this.bannerAd.style),this.bannerAd.onLoad(function(){n.tyqSDK.log("=====> @framework, banner\u5e7f\u544a\u52a0\u8f7d\u6210\u529f"),0!=i._bannerAdRefreshTimeOutId&&(clearTimeout(i._bannerAdRefreshTimeOutId),i._bannerAdRefreshTimeOutId=0),o&&i.bannerAd.show(),e&&e(!0)}),this.bannerAd.onError(function(t){n.tyqSDK.log("=====> @framework, banner\u5e7f\u544a\u52a0\u8f7d\u5931\u8d25\uff1a",t),e&&e(!1)}),this.bannerAd.onResize(function(t){i.bannerAd.style.left=i.systemInfo.windowWidth/2-t.width/2-.1,i.bannerAd.style.top=i.systemInfo.windowHeight-t.height+.1})},t.prototype.showRewardVideoAd=function(t){var e=this;return new Promise(function(o,i){if(e.createRewardedVideoAd(),!e.rewardedVideoAd)return n.tyqSDK.log("=====> @framework, \u5956\u52b1\u89c6\u9891\u5bf9\u8c61\u4e3a\u4e0d\u5b58\u5728"),i(),null;var r=function(t){t&&t.isEnded||void 0===t?o(!0):o(!1),e.closeRewardVideo(),e.rewardedVideoAd.offClose(r),e.rewardedVideoAd.offLoad(e.rewardedVideoAdOnLoadListener),e.rewardedVideoAd.offError(e.rewardedVideoAdOnErrorListener),e.rewardedVideoAd=null,e.createRewardedVideoAd()},a=function(t){n.tyqSDK.log("=====> @framework, \u5956\u52b1\u89c6\u9891\u53d1\u751f\u9519\u8bef\uff1a",t),e.rewardedVideoAd.load().then(function(){return e.rewardedVideoAd.show()}).then(function(){e.rewardedVideoAd.offError(a),e.rewardedVideoAd.offLoad(e.rewardedVideoAdOnLoadListener),e.rewardedVideoAd.offError(e.rewardedVideoAdOnErrorListener)}).catch(function(){e.rewardedVideoAd.offError(a),e.rewardedVideoAd.offLoad(e.rewardedVideoAdOnLoadListener),e.rewardedVideoAd.offError(e.rewardedVideoAdOnErrorListener),i()})};e.rewardedVideoAd.onClose(r),e.rewardedVideoAd.onError(a),e.rewardedVideoAd.load().then(function(){e.rewardedVideoAd.show().then(function(){t&&t()})})})},t.prototype.createRewardedVideoAd=function(){if(wx.createRewardedVideoAd){if(!this.rewardedVideoAd){var t=Math.floor(Math.random()*this._rewardedVideoAdUnitId.length);this.rewardedVideoAd=wx.createRewardedVideoAd({adUnitId:this._rewardedVideoAdUnitId[t]}),this._curRewardVideoAdUnitId=this._rewardedVideoAdUnitId[t],this.rewardedVideoAd.onLoad(this.rewardedVideoAdOnLoadListener.bind(this)),this.rewardedVideoAd.onError(this.rewardedVideoAdOnErrorListener)}}else n.tyqSDK.log("=====> @framework,\u5f53\u524d\u5fae\u4fe1\u7248\u672c\u8fc7\u4f4e\uff0c\u65e0\u6cd5\u4f7f\u7528\u5956\u52b1\u89c6\u9891\u529f\u80fd\uff0c\u8bf7\u5347\u7ea7\u5230\u6700\u65b0\u5fae\u4fe1\u7248\u672c\u540e\u91cd\u8bd5")},t.prototype.rewardedVideoAdOnErrorListener=function(){n.tyqSDK.log("=====> @framework, \u52a0\u8f7d\u89c6\u9891\u5e7f\u544a\u5931\u8d25")},t.prototype.rewardedVideoAdOnLoadListener=function(t){n.tyqSDK.log("=====> @framework, \u52a0\u8f7d\u89c6\u9891\u5e7f\u544a\u6210\u529f",t),t&&(t.shareValue&&(this._shareValue=parseInt(t.shareValue)),t.rewardValue&&(this._rewardValue=parseInt(t.rewardValue)))},t.prototype.isShareBehavior=function(){return 1==this._shareValue},t.prototype.isRewardBehavior=function(){return 1==this._rewardValue},t.prototype.reportShareBehavior=function(t){if(this.rewardedVideoAd){console.log("reportShareBehavior  this.rewardedVideoAd =",this.rewardedVideoAd),t.adunit=this._curRewardVideoAdUnitId,t.sceneID=1,t.shareValue=this._shareValue,t.rewardValue=this._rewardValue;var e=this.rewardedVideoAd.reportShareBehavior(t);console.log("result = ",e.success),e&&e.success?n.tyqSDK.log("=====> @framework, \u89c6\u9891\u5e7f\u544a\u884c\u4e3a\u4e0a\u62a5-\u6210\u529f",t):n.tyqSDK.log("=====> @framework, \u89c6\u9891\u5e7f\u544a\u884c\u4e3a\u4e0a\u62a5-\u5931\u8d25",t)}},t.prototype.closeRewardVideo=function(){this._closeRewardVideoListener&&this._closeRewardVideoListener()},t.prototype.showInterstitialAd=function(t,e){var o=this;if(wx.createInterstitialAd){this.createInterstitialAd();var i=function(e){o.interstitialAd.offError(i),o.interstitialAd.offClose(r),o.interstitialAd.offLoad(o.interstitialAdOnLoadListener),o.interstitialAd=null,n.tyqSDK.log("=====> @framework,\u63d2\u5c4f\u521b\u5efa\u5931\u8d25: ",e),t&&t()};this.interstitialAd.onError(i);var r=function(){o.interstitialAd.offError(i),o.interstitialAd.offClose(r),o.interstitialAd.offLoad(o.interstitialAdOnLoadListener),o.interstitialAd=null,n.tyqSDK.log("----\x3e \u63d2\u5c4f \u5e7f\u544a\u5173\u95ed"),t&&t(),o.createInterstitialAd()};this.interstitialAd.onClose(r),this.interstitialAd.show().then(function(){n.tyqSDK.log("----\x3e \u6210\u529f\u663e\u793a\u63d2\u5c4f\u5e7f\u544a"),e&&e()})}else n.tyqSDK.log("=====> @framework,\u5f53\u524d\u5fae\u4fe1\u7248\u672c\u8fc7\u4f4e\uff0c\u65e0\u6cd5\u4f7f\u7528\u63d2\u5c4f\u5e7f\u544a\u529f\u80fd\uff0c\u8bf7\u5347\u7ea7\u5230\u6700\u65b0\u5fae\u4fe1\u7248\u672c\u540e\u91cd\u8bd5")},t.prototype.createInterstitialAd=function(){if(!this.interstitialAd){var t=this._interstitialAdUnitId[Math.floor(Math.random()*this._interstitialAdUnitId.length)];this.interstitialAd=wx.createInterstitialAd({adUnitId:t}),this.interstitialAd.onLoad(this.interstitialAdOnLoadListener)}},t.prototype.interstitialAdOnLoadListener=function(){n.tyqSDK.log("=====> @framework,\u63d2\u5c4f\u521b\u5efa\u6210\u529f")},t.prototype.createGameClubButton=function(){wx.createGameClubButton?this.gameClub||(this.gameClub=wx.createGameClubButton({icon:this._gameClubSize.icon,style:{left:this._gameClubSize.x/this.systemInfo.pixelRatio,top:this._gameClubSize.y/this.systemInfo.pixelRatio,width:this._gameClubSize.width,height:this._gameClubSize.height}}),this.gameClub.hide(),n.tyqSDK.log("gameClub",this.gameClub)):n.tyqSDK.log("=====> @framework,\u5f53\u524d\u5fae\u4fe1\u7248\u672c\u8fc7\u4f4e\uff0c\u65e0\u6cd5\u4f7f\u7528\u6e38\u620f\u5708\u529f\u80fd\uff0c\u8bf7\u5347\u7ea7\u5230\u6700\u65b0\u5fae\u4fe1\u7248\u672c\u540e\u91cd\u8bd5")},t.prototype.showGameClub=function(){n.tyqSDK.log("\u663e\u793a\u6e38\u620f\u5708\uff1a",this.gameClub),this.createGameClubButton(),this.gameClub&&(this.gameClub.show(),n.tyqSDK.log("\u663e\u793a\u6e38\u620f\u5708\u6210\u529f"))},t.prototype.hideGameClub=function(){this.gameClub&&this.gameClub.hide()},t.prototype.postMessage=function(t,e){var o={message:"",value:e};o.message=t,o.value=e,n.tyqSDK.log("\u53d1\u9001\u4fe1\u606f: ",o),wx.getOpenDataContext().postMessage(o)},t.prototype.createFeedbackButton=function(e,o){t.isSupportedAPI(wx.createFeedbackButton)?(this.feedbackButton=wx.createFeedbackButton({type:"image",image:this._feedbackButtonData.url,style:{left:this._feedbackButtonData.x,top:this._feedbackButtonData.y,width:this._feedbackButtonData.width,height:this._feedbackButtonData.height}}),e(this.feedbackButton)):(n.tyqSDK.log("=====> @framework,\u5f53\u524d\u5fae\u4fe1\u7248\u672c\u8fc7\u4f4e\uff0c\u65e0\u6cd5\u4f7f\u7528\u53cd\u9988\u6309\u94ae\uff0c\u8bf7\u5347\u7ea7\u5230\u6700\u65b0\u5fae\u4fe1\u7248\u672c\u540e\u91cd\u8bd5"),o())},t.prototype.onTapFeedbackButton=function(t,e){this.feedbackButton?this.feedbackButton.onTap(function(){t()}):e()},t.prototype.showFeedbackButton=function(){this.feedbackButton&&this.feedbackButton.show()},t.prototype.hideFeedbackButton=function(){this.feedbackButton&&this.feedbackButton.hide()},t.prototype.getGameRecorder=function(e,o){t.isSupportedAPI(wx.getGameRecorder)?(this.GameRecorder=wx.getGameRecorder(),e()):o()},t.prototype.registerRecordScreenEvent=function(){var e=this;t.isSupportedAPI(wx.getGameRecorder)?(this.GameRecorder=wx.getGameRecorder(),this.GameRecorder.on("start",function(){e.resumeListener&&e.resumeListener()}),this.GameRecorder.on("pause",function(){e.pauseListener&&e.pauseListener()}),this.GameRecorder.on("stop",function(t){e.stopListener&&(n.tyqSDK.log("\u89c6\u9891\u7684\u65f6\u957f\uff1a",t.duration),e.stopListener(t.duration))}),this.GameRecorder.on("error",function(t){n.tyqSDK.log("=====> @framework,\u5f55\u5c4f\u9519\u8bef\uff1a",t.error.message,",code: ",t.error.code),e.errorListener&&e.errorListener()}),this.GameRecorder.on("timeUpdate",function(t){n.tyqSDK.log("=====> @framework,\u5f55\u5c4f\u5230\u7b2c\u51e0\u79d2\uff1a",t.currentTime),e.timeUpdateListener&&e.timeUpdateListener()}),this.GameRecorder.on("abort",function(){e.abortListener&&e.abortListener()})):n.tyqSDK.log("=====> @framework,\u5f53\u524d\u5ba2\u6237\u7aef\u7248\u8fc7\u4f4e\uff0c\u65e0\u6cd5\u4f7f\u7528\u5f55\u5236\u529f\u80fd\uff0c\u8bf7\u5347\u7ea7\u5230\u6700\u65b0\u5ba2\u6237\u7aef\u7248\u672c\u540e\u91cd\u8bd5")},t.prototype.startRecordScreen=function(){},t.prototype.pauseRecordScreen=function(t){this.pauseListener=t,this.GameRecorder.pause()},t.prototype.resumeRecordScreen=function(t){this.resumeListener=t,this.GameRecorder.resume()},t.prototype.stopRecordScreen=function(t){this.stopListener=t,this.GameRecorder.stop()},t.prototype.abortRecordScreen=function(t){this.abortListener=t,this.GameRecorder.abort()},t.prototype.createGameRecorderShareButton=function(){},t.prototype.onShow=function(t){this.showListener=t,wx.onShow(this.onShowListener.bind(this))},t.prototype.offShow=function(){wx.offShow(this.onShowListener)},t.prototype.onHide=function(t){this.hideListener=t,wx.onHide(this.onHideListener.bind(this))},t.prototype.offHide=function(){this.hideListener=null,wx.offHide(this.onHideListener)},t.prototype.onShowListener=function(t){this.showListener&&this.showListener(t)},t.prototype.onHideListener=function(){this.hideListener&&this.hideListener()},t.prototype.navigateToMiniProgram=function(e,o,i,n){t.isSupportedAPI(wx.navigateToMiniProgram)?wx.navigateToMiniProgram({appId:e,path:o,envVersion:"release",success:function(){i()},fail:function(){n()},complete:function(){}}):n()},t.prototype.vibrateLong=function(t){t&&console.warn("----\x3e vibrateLong \u5fae\u4fe1\u53ef\u80fd\u6ca1\u6709cb"),wx.vibrateLong()},t.prototype.vibrateShort=function(){console.warn("----\x3e vibrateShort \u5fae\u4fe1\u53ef\u80fd\u6ca1\u6709cb"),wx.vibrateShort()},t.prototype.getSystemInfoSync=function(){this.systemInfo=wx.getSystemInfoSync()},t.isSupportedAPI=function(t){return!!t||(wx.showModal({title:"\u63d0\u793a",content:"\u5f53\u524d\u5fae\u4fe1\u7248\u672c\u8fc7\u4f4e\uff0c\u65e0\u6cd5\u4f7f\u7528\u8be5\u529f\u80fd\uff0c\u8bf7\u5347\u7ea7\u5230\u6700\u65b0\u5fae\u4fe1\u7248\u672c\u540e\u91cd\u8bd5\u3002"}),!1)},t.prototype.exitMiniProgram=function(t){wx.exitMiniProgram(t)},t.prototype.showToast=function(t,e,o){void 0===e&&(e=3e3),wx.showToast({title:t,duration:e,success:function(){o&&o()}})},t.prototype.getSystemInfo=function(t){wx.getSystemInfo({success:function(e){t&&t(e)}})},t.prototype.aldSendEvent=function(t,e){n.tyqSDK.log("send msg: ",t),wx.aldSendEvent?e?wx.aldSendEvent(t):wx.aldSendEvent(t,e):console.error("----\x3e \u963f\u62c9\u4e01\u63a5\u5165\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5game.js")},t.prototype.createIconAd=function(){var t=this,e=i(Array(1).map(function(t,e){return{appNameHidden:!1,color:"white",size:100,borderWidth:100,borderColor:"white",left:100*e,top:100}}));this.LiconAD=wx.createGameIcon({adUnitId:this._LIconAdunit,count:null,style:e}),this.LiconAD.onError(function(t){n.tyqSDK.log("=====> @framework, \u5c0f\u6e38\u620f\u63a8\u8350\u5de6\u8fb9icon\u52a0\u8f7d\u5931\u8d25\uff1a",t)}),this.LiconAD.onLoad(function(){n.tyqSDK.log("=====> @framework, \u5c0f\u6e38\u620f\u63a8\u8350\u5de6\u8fb9icon\u52a0\u8f7d\u6210\u529f")}),this.LiconAD.onResize(function(e){var o;o=t.systemInfo.windowHeight/2-0*e[0].height;for(var i=0;i<e.length;i++)e[i].left=10,e[i].top=o+72*i})},t.prototype.showIconAd=function(t){var e=this;"R"==t?this.RiconAD?this.RiconAD.load().then(function(){e.RiconAD.show()}).catch(function(t){console.error(t)}):setTimeout(this.createIconAd,1e3):this.LiconAD?this.LiconAD.load().then(function(){e.LiconAD.show()}).catch(function(t){console.error(t)}):setTimeout(this.createIconAd,1e3)},t.prototype.createGridAd=function(t){var e=this;this.gridAd=wx.createGridAd({adUnitId:null,adTheme:"white",gridCount:t,adIntervals:30,style:{left:0,top:this.systemInfo.windowHeight/2-350,width:500,opacity:.8}}),this.gridAd.onLoad(function(){n.tyqSDK.log("=====> @framework, \u683c\u5b50\u5e7f\u544a\u52a0\u8f7d\u6210\u529f"),e.gridAdCunt=t}),this.gridAd.onError(function(t){n.tyqSDK.log("=====> @framework, \u683c\u5b50\u5e7f\u544a\u52a0\u8f7d\u5931\u8d25\uff1a",t)})},t.prototype.showGridAd=function(t){t!=this.gridAdCunt&&(this.gridAd&&this.gridAd.destroy(),this.createGridAd(t)),this.gridAd.show()},t.prototype.hideGridAd=function(){this.gridAd.hide()},t.prototype.showShareMenu=function(t){void 0===t&&(t=!1),window.wx&&wx.showShareMenu({withShareTicket:t,menus:["shareAppMessage","shareTimeline"]})},t._instance=new t,t}();o.Wechat=r._instance,cc._RF.pop()},{"../../tyqSDK":"tyqSDK"}]},{},["FiniteStateMachine","HtmlTextParser","CoreDefine","ActionEx","AnimationEvent","CCEx","CCMaskProgressBar","CCMaskProgressMoreBar","CCNodeImpl","CCSliderEx","CanvasEx","ColorAssembler2D","ES5Ex","GComponent","GDrag","GLongTouch","MaskSprite","PlistLabel","GCtrl","GEventSystem","GParam","GLoader","GHttpClient","GChild","GCustomData","GListView","GPage","GPageView","GScrollView","GTimerComponent","GViewBase","GViewDestory","IrregularTrigger","RewardAnimalView","AudioMgr","DataPool","GNodePool","GTimerMgr","MaskUtil","RedPointLogicMgr","UIMgr","MathEx","BaseView","BtnCDTime","Define","JXColor","Language","TimeUtils","UI","UIAction","UICreate","UIResources","Zh","resourceUtil","uiManager","LHeroData","LOwnEquips","LOwnItems","LUserData","RBagData","RHeroData","RUserData","RItemAttach","RJXItem","SAction","SActionCollision","SAddDialData","SBuffData","SBullet","SCallData","SDailyTaskData","SDialData","SEffectAnim","SEquipData","SGuideChainData","SGuideStepData","SHeroData","SHeroTryData","SItemData","SLvData","SLvUpData","SMapData","SMapStyleData","SNoticeData","SNpcTeamData","SOfficerData","SOnLineAwardData","SScopeData","SSignInData","SSkillData","SSkillEffect","SStarLvData","SStoryData","SSuitData","SSystemConfig","STowerData","SUnitData","SVipData","ArmRoleScript","BlessJxItem","HeroItem","RoleHead","RoleScript","GMCtrl","GuideComponent","GuideLogic","BtlCameraMap","BtlFighltLayer","BtlMapCanverts","BtlMapElement","BtlMapParser","BtlMapTouchLayer","ConditionListener","GameMgr","HeroMgr","ItemMgr","MapMgr","SdkMgr","ToastMgr","UserMgr","RoleManager","CurrencyFrame","HangPage","JXItem","PreviewCtrl","TopUiItem","BattleAutoView","BattleResultCtrl","BattleResultView","BattleRewardCtrl","BattleViewCtrl","BattleViewPut","BtHeroHurt","BtlHeroHead","CeremonialGiftView","GuessView","JXResultHero","DetailsCtrl","EquipAddCtrl","FeatureCtrl","FightDataItem","HeroCardItem","HeroChange","HeroCtrl","HeroTryCtrl","SquadCtrl","BlessCtrl","BoxItem","ChapterPage","DailyView","EquipDetailsCtrl","FightDataPreView","HomeCtrl","ItemSignIn","LevelCtrl","LevelDataNode","LevelItem","LoadCtrl","MainCtrl","MoreGame","NoticeCtrl","OfficerCtrl","OfficerItem","OpenBookCtrl","PropertyItem","RecruitCardCtrl","RecruitCtrl","RecuitCardItem","SetCtrl","SignInCtrl","SkillItem","SkillPage","StrengthenView","VipCtrl","VipPage","BattleTextParse","JXBattleAnalysis","JXBattleCb","JXBattleDefine","JXBattleManager","JXBattleMonster","JXBattleRole","JXBattleSkill","JXBattleStep","JXBattleTeam","JXBattleUtility","JXRBAmbient","JXRBBuff","JXRBBullet","JXRBCmdMgr","JXRBCollisionEffect","JXRBFlags","JXRBRole","JXRBRoleHead","JXRBScript","JXULAsset","JXULDefine","AppCtrl","AppStart","StoreCtrl","StoreEquipItem","DiaoCanView","GuessResultView","PowerUp","RankView","RewardCrtl","TimeLimitGift","ToastCtrl","JumpUtil","ToggleSwitcher","UIModeAction","VIewUtil","preventClicks","ShaderUtil","SLGuideShader","SLTextShowShader","SLTransitions","EnumUtil","JXCommon","H5AdSdk4399","beHaviorComponent","TyqBaseLayer","TyqMoreGameLayer","tyqLayerManager","tyqResManager","tyqConstants","WXCustomAd","wechat","tyqAdManager","tyqSDK","tyqSDKConfig","weHttp","weNetworkMgr","cocosUtil","utilTools"]);