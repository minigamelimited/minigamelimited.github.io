var csv={__ID__:"id",__ROWS__:"values",__SIZE__:"size",__PS_INDEX__:0,__TYPE_INDEX__:2,__HEADER_INDEX__:1,__DATA_INDEX__:3,_StructData:function(){this.header=[],this.type=[],this.body=[]},_Row:function(e,t,c){var s=this;this.index=c;let r=e.header,n=e.type,a=[],i=[];r.forEach(function(e){var[t,c]=e.split(":");if(c){var s=c.match(/\[(\w*)\]/);c=s?""==s[1]||"number"==s[1]?"array.number":"array.default":"default"}else c="default";i.push(t),a.push(c)}),i.forEach(function(e,c){var r=t[c],i=a[c];if(i.startsWith("array"))r&&r.length>0?(r=r.split(/[,\+&;\/\s]/),i.endsWith("number")&&(r=r.map(function(e){return Number(e)}))):r=[];else if("json"==i)r=JSON.parse(r);else{var o=r.match(/\"(.*)\"/);if(o)r=o[1]||r;else{var l=Number(r);isNaN(l)||(r=l)}}if(csv._fieldParser){let e=n[c];r=csv._fieldParser(e,r)||r}Object.defineProperty(s,e,{value:r,writable:!1})})}};csv._Row.prototype.match=function(e){return!(!e||!e(this,this.index))},csv._CSV=function(e){this._data=e,this._rows={},this._values=null;var t=this;let c=e.header.indexOf(csv.__ID__);c=c<0?0:c,e.body.forEach(function(s,r){var n=new csv._Row(e,s,r);delete e.body[r],t._rows[s[c]]=n}),e.body.splice(0),Object.defineProperty(this,csv.__ROWS__,{get:function(){return null==this._values&&(this._values=Object.values(t._rows)),this._values}}),Object.defineProperty(this,csv.__SIZE__,{value:this.values.length,writable:!1})},csv._CSV.prototype.get=function(e){return this._rows[e]},csv._CSV.prototype.search=function(e){let t=[];for(var c in this._rows){var s=this._rows[c];s.match(e)&&t.push(s)}return t},csv.pathToCSV={},csv.cache_indexKeyToTable={},csv._fieldParser=null,csv._evt_tbl={load:[]},csv.on=function(e,t,c){let s=csv._evt_tbl[e];null==s?console.log("[csv] unrecognized event name :"+e):s.push([t,c])},csv.off=function(e,t,c){let s=csv._evt_tbl[e];if(null==s)console.log("[csv] unrecognized event name :"+e);else{let e=s.findIndex(e=>e[0]==t&&e[1]==c);e>=0&&s.splice(e,1)}},csv.emit=function(e,t,c,s,r){csv._evt_tbl[e].forEach(e=>e[0].call(e[1],t,c,s,r))},csv.isLoaded=function(e){return null!=csv.pathToCSV[e]},csv.load=function(e,t,c){cc.resources.load(e,cc.TextAsset,function(s,r){if(""!=r.name){if(!csv.pathToCSV[r.name]){var n=csv.parse(r.text);csv.pathToCSV[r.name]=n,Object.defineProperty(csv,r.name,{value:n,writable:!1,configurable:!0}),csv.emit("load",e)}cc.resources.release(e,cc.TextAsset),t&&t.call(c)}})},csv.remove=function(e){delete csv.pathToCSV[e]},csv.loadString=function(e,t,c,s){let r=csv.pathToCSV[e];if(csv.remove(e),!csv.pathToCSV[e])try{var n=csv.parse(t);csv.pathToCSV[e]=n,delete csv[e],Object.defineProperty(csv,e,{value:n,writable:!1,configurable:!0})}catch(a){console.error("[csv]expcetion occur while parsing csv txt!",a),csv.pathToCSV[e]=r}c&&c.call(s)},csv.parse=function(e){var t=e.split(/\r?\n/g).filter(function(e){return""!=e}),c=new csv._StructData;return c.header=t[csv.__HEADER_INDEX__].replace(/[\r]/g,"").split(/\s*\t/g),c.type=t[csv.__TYPE_INDEX__].replace(/[\r]/g,"").split(/\s*\t/g),c.body=t.slice(csv.__DATA_INDEX__).map(function(e){return csv.parseRowWithT(e.replace(/\r/g,""))}),new csv._CSV(c)},csv.parseRowWithT=function(e){return e.split("\t")},csv.parseRow=function(e){if(-1===e.indexOf('"'))return e.split(",");for(var t="",c=[],s=!1,r=0;r<e.length;r++){var n=e.charAt(r);'"'!==n?","!==n||s?t+=n:(c.push(t),t=""):s=!s}return c.push(t),c},csv.setParser=function(e){this._fieldParser=e},csv.hasIndex=function(e){return null!=csv.cache_indexKeyToTable[e]},csv.removeIndex=function(e,t){let c=e+"."+t;csv.cache_indexKeyToTable[c]=null},csv.createIndex=function(e,t,c){if(!csv.hasIndex(e+"."+t)){var s=this[e];if(null==s)return console.warn("\u8bf7\u5148\u52a0\u8f7dConfig,\u518d\u521b\u5efa\u7d22\u5f15");s.values.forEach(function(e){var r=e[t];""!=r&&0!=r&&(r=r.replace(/\s*/g,""),Object.defineProperty(s,r,{value:e[c],writable:!1}))}),csv.cache_indexKeyToTable[e+"."+t]=s}},csv.loadDir=function(e,t,c){cc.resources.loadDir(e,cc.TextAsset,function(s,r){return r.forEach(function(e,t){var c=r[t];if(!csv.pathToCSV[c.name]){var s=csv.parse(c.text);csv.pathToCSV[e]=s,Object.defineProperty(csv,c.name,{value:s,writable:!1,configurable:!0}),csv.emit("load",e)}}),cc.resources.release(e,cc.TextAsset),t&&t.call(c)})},csv.release=function(){},window.csv=csv;